{"remainingRequest":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/App.vue","mtime":1760085781852},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/babel-loader/lib/index.js","mtime":1756885033526},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1756885033541},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js","mtime":1756885034208}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ2xvZGFzaCcKaW1wb3J0IEd1aSBmcm9tICdAL2NvbXBvbmVudHMvZ3VpLnZ1ZScKaW1wb3J0IEd1aUxvYWRlciBmcm9tICdAL2NvbXBvbmVudHMvZ3VpLWxvYWRlci52dWUnCmltcG9ydCBzd2ggZnJvbSAnQC9hc3NldHMvc3dfaGVscGVycy5qcycKaW1wb3J0IE1vbWVudCBmcm9tICdtb21lbnQnCmltcG9ydCBCYWNrZ3JvdW5kSW1hZ2UgZnJvbSAnQC9hc3NldHMvaW1hZ2VzL3N2Zy91aS9CYWNrZ3JvdW5kLnN2Zyc7CmltcG9ydCBFcnJvckltYWdlIGZyb20gJ0AvYXNzZXRzL2ltYWdlcy9zdmcvdWkvZXJyb3JJbWFnZS5zdmcnOwppbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSAnQC9jb21wb25lbnRzL1Byb2dyZXNzQmFyLnZ1ZSc7CgpsZXQgZ2xUZXN0Q2lyY2xlOwpsZXQgZ2xMYXllcjsKbGV0IGdsU3RlbDsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKGNvbnRleHQpIHsKICAgIHJldHVybiB7CiAgICAgIG1lbnVJdGVtczogWwogICAgICAgIHsgdGl0bGU6IHRoaXMuJHQoJ1ZpZXcgU2V0dGluZ3MnKSwgaWNvbjogJ21kaS1zZXR0aW5ncycsIHN0b3JlX3Zhcl9uYW1lOiAnc2hvd1ZpZXdTZXR0aW5nc0RpYWxvZycsIHN0b3JlX3Nob3dfbWVudV9pdGVtOiAnc2hvd1ZpZXdTZXR0aW5nc01lbnVJdGVtJyB9LAogICAgICAgIHsgdGl0bGU6IHRoaXMuJHQoJ1BsYW5ldHMgVG9uaWdodCcpLCBpY29uOiAnbWRpLXBhbm9yYW1hLWZpc2hleWUnLCBzdG9yZV92YXJfbmFtZTogJ3Nob3dQbGFuZXRzVmlzaWJpbGl0eURpYWxvZycsIHN0b3JlX3Nob3dfbWVudV9pdGVtOiAnc2hvd1BsYW5ldHNWaXNpYmlsaXR5TWVudUl0ZW0nIH0sCiAgICAgICAgeyBkaXZpZGVyOiB0cnVlIH0KICAgICAgXS5jb25jYXQodGhpcy5nZXRQbHVnaW5zTWVudUl0ZW1zKCkpLmNvbmNhdChbCiAgICAgICAgeyB0aXRsZTogdGhpcy4kdCgnRGF0YSBDcmVkaXRzJyksIGZvb3RlcjogdHJ1ZSwgaWNvbjogJ21kaS1jb3B5cmlnaHQnLCBzdG9yZV92YXJfbmFtZTogJ3Nob3dEYXRhQ3JlZGl0c0RpYWxvZycgfQogICAgICBdKSwKICAgICAgbWVudUNvbXBvbmVudHM6IFtdLmNvbmNhdCh0aGlzLmdldFBsdWdpbnNNZW51Q29tcG9uZW50cygpKSwKICAgICAgZ3VpQ29tcG9uZW50OiAnR3VpTG9hZGVyJywKICAgICAgc3RhcnRUaW1lSXNTZXQ6IGZhbHNlLAogICAgICBpbml0RG9uZTogZmFsc2UsCiAgICAgIGRhdGFTb3VyY2VJbml0RG9uZTogZmFsc2UsCiAgICAgIGltYWdlU3JjOiAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9lZ0E1Rkl2LmpwZWcnLCAvLyDmm7/mjaLkuLrkvaDnmoTlm77lg4/ot6/lvoQKICAgICAgY3ZSZWFkeTogZmFsc2UsCiAgICAgIGNhbnZhc1pJbmRleFN0ZWw6IC0xMCwKICAgICAgY2FudmFzWkluZGV4TWFpbkNhbWVyYTogLTExLAogICAgICBjYW52YXNaSW5kZXhHdWlkZXJDYW1lcmE6IC0xMiwKICAgICAgY3VycmVudGNhbnZhczogJ1N0ZWwnLAoKICAgICAgV2ViU29ja2V0VXJsOiAnJywKCiAgICAgIHdlYnNvY2tldDogbnVsbCwKICAgICAgbWVzc2FnZTogJycsCiAgICAgIHJlY2VpdmVkTWVzc2FnZXM6IFtdLC8vIOWtmOWCqOaOpeaUtuWIsOeahOa2iOaBrwogICAgICBzZW50TWVzc2FnZXM6IFtdLCAvLyDlrZjlgqjlt7Llj5HpgIHnmoTmtojmga8KICAgICAgbWVzc2FnZUNvdW50ZXI6IDAsIC8vIOeUqOS6jueUn+aIkOWUr+S4gOeahOa2iOaBr0lECiAgICAgIHdlYnNvY2tldFN0YXRlOiAnZGlzY29ubmVjdGVkJywgLy8g5re75YqgV2ViU29ja2V06L+e5o6l54q25oCBCiAgICAgIG5ldHdvcmtEaXNjb25uZWN0ZWQ6IGZhbHNlLCAvLyDmt7vliqDnvZHnu5zov57mjqXnirbmgIEKCiAgICAgIFFUQ2xpZW50VmVyc2lvbjogJ05vdCBjb25uZWN0ZWQnLAogICAgICBWdWVDbGllbnRWZXJzaW9uOiBwcm9jZXNzLmVudi5WVUVfQVBQX1ZFUlNJT04sCgogICAgICAvLyDmoKHlh4bkv6Hmga/lr7nosaEKICAgICAgY2FsaWJyYXRpb25JbmZvOiB7CiAgICAgICAgaXNDYWxpYnJhdGluZzogZmFsc2UsCiAgICAgICAgY2FsaWJyYXRpb25TdGF0ZTogJ2lkbGUnLAogICAgICAgIGNhbGlicmF0aW9uU3RlcDogMCwKICAgICAgICBjYWxpYnJhdGlvbk1lc3NhZ2U6ICcnCiAgICAgIH0sCgogICAgICAvLyBpc01lc3NhZ2VCb3hTaG93OiBmYWxzZSwKCiAgICAgIEN1cnJlbnREcml2ZXJUeXBlOiAnJywKICAgICAgRGV2aWNlSXNDb25uZWN0ZWQ6IG51bGwsCiAgICAgIGNvbmZpcm1Ecml2ZXJUeXBlOiAnJywKCiAgICAgIE1haW5DYW1lcmFPZmZzZXRNaW46IDAsCiAgICAgIE1haW5DYW1lcmFPZmZzZXRNYXg6IDAsCgogICAgICBNYWluQ2FtZXJhR2Fpbk1pbjogMCwKICAgICAgTWFpbkNhbWVyYUdhaW5NYXg6IDAsCgogICAgICBkZXZpY2VzOiBbCiAgICAgICAgeyBuYW1lOiAn5a+85pif6ZWcJywgZHJpdmVyVHlwZTogJ0d1aWRlcicsIHR5cGU6ICdDQ0RzJywgTGlzdE51bTogIjEiLCBpc2dldDogZmFsc2UsIGRldmljZTogJycsIEJhdWRSYXRlOiA5NjAwLCBkcml2ZXJOYW1lOiAnJywgaXNDb25uZWN0ZWQ6IGZhbHNlLCBkaWFsb2dTdGF0ZVZhcjogJ3Nob3dEZXZpY2VTZXR0aW5nc0RpYWxvZ19HdWlkZXInIH0sCiAgICAgICAgeyBuYW1lOiAn5Li755u45py6JywgZHJpdmVyVHlwZTogJ01haW5DYW1lcmEnLCB0eXBlOiAnQ0NEcycsIExpc3ROdW06ICIyMCIsIGlzZ2V0OiBmYWxzZSwgZGV2aWNlOiAnJywgQmF1ZFJhdGU6IDk2MDAsIGRyaXZlck5hbWU6ICcnLCBpc0Nvbm5lY3RlZDogZmFsc2UsIGRpYWxvZ1N0YXRlVmFyOiAnc2hvd0RldmljZVNldHRpbmdzRGlhbG9nX01haW5DYW1lcmEnIH0sCiAgICAgICAgeyBuYW1lOiAn6LWk6YGT5LuqJywgZHJpdmVyVHlwZTogJ01vdW50JywgdHlwZTogJ1RlbGVzY29wZXMnLCBMaXN0TnVtOiAiMCIsIGlzZ2V0OiBmYWxzZSwgZGV2aWNlOiAnJywgQmF1ZFJhdGU6IDk2MDAsIGRyaXZlck5hbWU6ICcnLCBpc0Nvbm5lY3RlZDogZmFsc2UsIGRpYWxvZ1N0YXRlVmFyOiAnc2hvd0RldmljZVNldHRpbmdzRGlhbG9nX01vdW50JyB9LAogICAgICAgIHsgbmFtZTogJ+acm+i/nOmVnCcsIGRyaXZlclR5cGU6ICdUZWxlc2NvcGVzJywgZGV2aWNlOiAnJywgaXNDb25uZWN0ZWQ6IHRydWUgfSwKICAgICAgICB7IG5hbWU6ICfnlLXliqjosIPnhKblmagnLCBkcml2ZXJUeXBlOiAnRm9jdXNlcicsIHR5cGU6ICdGb2N1c2VycycsIExpc3ROdW06ICIyMiIsIGlzZ2V0OiBmYWxzZSwgZGV2aWNlOiAnJywgQmF1ZFJhdGU6IDk2MDAsIGRyaXZlck5hbWU6ICcnLCBpc0Nvbm5lY3RlZDogZmFsc2UsIGRpYWxvZ1N0YXRlVmFyOiAnc2hvd0RldmljZVNldHRpbmdzRGlhbG9nX0ZvY3VzZXInIH0sCiAgICAgICAgeyBuYW1lOiAn55S15a2Q5p6B6L206ZWcJywgZHJpdmVyVHlwZTogJ1BvbGVDYW1lcmEnLCB0eXBlOiAnQ0NEcycsIExpc3ROdW06ICIyIiwgaXNnZXQ6IGZhbHNlLCBkZXZpY2U6ICcnLCBCYXVkUmF0ZTogOTYwMCwgZHJpdmVyTmFtZTogJycsIGlzQ29ubmVjdGVkOiBmYWxzZSwgZGlhbG9nU3RhdGVWYXI6ICdzaG93RGV2aWNlU2V0dGluZ3NEaWFsb2dfUG9sZUNhbWVyYScgfSwKICAgICAgICB7IG5hbWU6ICfmu6TplZzova4nLCBkcml2ZXJUeXBlOiAnQ0ZXJywgdHlwZTogJ0ZpbHRlciBXaGVlbHMnLCBMaXN0TnVtOiAiMjEiLCBpc2dldDogZmFsc2UsIGRldmljZTogJycsIEJhdWRSYXRlOiA5NjAwLCBkcml2ZXJOYW1lOiAnJywgaXNDb25uZWN0ZWQ6IGZhbHNlLCBkaWFsb2dTdGF0ZVZhcjogJ3Nob3dEZXZpY2VTZXR0aW5nc0RpYWxvZ19DRlcnIH0sCiAgICAgIF0sCgogICAgICAvLyBDaGFuZ2luZyB0aGUgbGFiZWwgbmFtZSBhbHNvIHJlcXVpcmVzIGNoYW5naW5nIHRoZSBlbWl0IHNpZ25hbCBuYW1lCiAgICAgIEd1aWRlckNvbmZpZ0l0ZW1zOiBbCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdHdWlkZXIgRm9jYWwgTGVuZ3RoIChtbSknLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdNdWx0aSBTdGFyIEd1aWRlcicsIHZhbHVlOiBmYWxzZSwgaW5wdXRUeXBlOiAnc3dpdGNoJyB9LAogICAgICAgIC8vIHsgZHJpdmVyVHlwZTogJ0d1aWRlcicsIGxhYmVsOiAnR3VpZGVyIFBpeGVsIHNpemUnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ0d1aWRlciBHYWluJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdzbGlkZXInLCBpbnB1dE1pbjogMCwgaW5wdXRNYXg6IDEwMCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdDYWxpYnJhdGlvbiBzdGVwIChtcyknLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdSYSBBZ2dyZXNzaW9uJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdzbGlkZXInLCBpbnB1dE1pbjogMCwgaW5wdXRNYXg6IDEwMCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdEZWMgQWdncmVzc2lvbicsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAnc2xpZGVyJywgaW5wdXRNaW46IDAsIGlucHV0TWF4OiAxMDAsIGlucHV0U3RlcDogMSB9LAoKICAgICAgXSwKCiAgICAgIE1haW5DYW1lcmFDb25maWdJdGVtczogWwogICAgICAgIC8vIHZ1ZeWkhOeQhuWPguaVsAogICAgICAgIHsgZHJpdmVyVHlwZTogJ01haW5DYW1lcmEnLCBsYWJlbDogJ0ltYWdlQ0ZBJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdzZWxlY3QnLCBzZWxlY3RWYWx1ZTogWydHUicsICdHQicsICdCRycsICdSR0dCJywgJ251bGwnXSB9LAogICAgICAgIC8vIOehrOS7tuWkhOeQhuWPguaVsAogICAgICAgIHsgZHJpdmVyVHlwZTogJ01haW5DYW1lcmEnLCBsYWJlbDogJ0Jpbm5pbmcnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAxLCBpbnB1dE1heDogMTYsIGlucHV0U3RlcDogMSB9LAogICAgICAgIHsgZHJpdmVyVHlwZTogJ01haW5DYW1lcmEnLCBsYWJlbDogJ1RlbXBlcmF0dXJlJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdzZWxlY3QnLCBzZWxlY3RWYWx1ZTogWzUsIDAsIC01LCAtMTAsIC0xNSwgLTIwLCAtMjVdIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnR2FpbicsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAnc2xpZGVyJywgaW5wdXRNaW46IDAsIGlucHV0TWF4OiAwLCBpbnB1dFN0ZXA6IDEgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdNYWluQ2FtZXJhJywgbGFiZWw6ICdPZmZzZXQnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgIF0sCgogICAgICBNb3VudENvbmZpZ0l0ZW1zOiBbCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTW91bnQnLCBsYWJlbDogJ0ZsaXAgRVRBJywgdmFsdWU6ICcwMDowMDowMCcsIGRpc3BsYXlWYWx1ZTogJzAwOjAwOjAwJywgaW5wdXRUeXBlOiAndGlwJyB9LAogICAgICAgIHsgZHJpdmVyVHlwZTogJ01vdW50JywgbGFiZWw6ICdHb3RvVGhlblNvbHZlJywgdmFsdWU6IGZhbHNlLCBpbnB1dFR5cGU6ICdzd2l0Y2gnIH0sCgogICAgICAgIC8vIHsgZHJpdmVyVHlwZTogJ01vdW50JywgbGFiZWw6ICdpc0F1dG9GbGlwJywgdmFsdWU6IGZhbHNlLCBpbnB1dFR5cGU6ICdzd2l0Y2gnIH0sCiAgICAgIF0sCgogICAgICBUZWxlc2NvcGVzQ29uZmlnSXRlbXM6IFsKICAgICAgICB7IGRyaXZlclR5cGU6ICdUZWxlc2NvcGVzJywgbnVtOiAxLCBsYWJlbDogJ0ZvY2FsIExlbmd0aCAobW0pJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdudW1iZXInIH0sCiAgICAgIF0sCgogICAgICBGb2N1c2VyQ29uZmlnSXRlbXM6IFsKICAgICAgICB7IGRyaXZlclR5cGU6ICdGb2N1c2VyJywgbnVtOiAyLCBsYWJlbDogJ1N5bmMgRm9jdXNlciBTdGVwJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICd0ZXh0JyB9LAogICAgICAgIHsgZHJpdmVyVHlwZTogJ0ZvY3VzZXInLCBudW06IDIsIGxhYmVsOiAnTWluIExpbWl0JywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdudW1iZXInIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnRm9jdXNlcicsIG51bTogMiwgbGFiZWw6ICdNYXggTGltaXQnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ251bWJlcicgfSwKICAgICAgXSwKCiAgICAgIFBvbGVDYW1lcmFDb25maWdJdGVtczogWwoKICAgICAgXSwKCiAgICAgIENGV0NvbmZpZ0l0ZW1zOiBbCgogICAgICBdLAoKICAgICAgQmVmb3JlQ2hhbmdlQ29uZmlnSXRlbXM6IFtdLAoKCgogICAgICBpbWFnZURhdGE6IG51bGwsCgogICAgICBoaXN0b2dyYW1JbWFnZTogbnVsbCwKICAgICAgaGlzdG9ncmFtX21pbjogMCwgICAgLy8g55u05pa55Zu+6Ieq5Yqo5ouJ5Ly455qE5pyA5bCP5YC8CiAgICAgIGhpc3RvZ3JhbV9tYXg6IDI1NSwgIC8vIOebtOaWueWbvuiHquWKqOaLieS8uOeahOacgOWkp+WAvAoKICAgICAgY3VycmVudEhpc3RvZ3JhbU1pbjogMCwKICAgICAgY3VycmVudEhpc3RvZ3JhbU1heDogMjU1LAoKICAgICAgSW1hZ2VHYWluUjogMSwKICAgICAgSW1hZ2VHYWluQjogMSwKCiAgICAgIEltYWdlT2Zmc2V0OiAwLAoKICAgICAgSW1hZ2VDRkE6ICdCRycsCgogICAgICBjYW1lcmFCaW46IDEsICAgLy8g5b2T5YmN55u45py6YmlubmluZwoKICAgICAgQ2FudmFzV2lkdGg6IDE5MjAsICAvLyDkuLvnlLvluIPlrr3luqYKICAgICAgQ2FudmFzSGVpZ2h0OiAxMDgwLCAvLyDkuLvnlLvluIPpq5jluqYKCiAgICAgIHNjYWxlOiAxLCAvLyDnvKnmlL7mr5TkvosKICAgICAgdHJhbnNsYXRlWDogMCwgLy8g5bmz56e7eOWdkOaghwogICAgICB0cmFuc2xhdGVZOiAwLCAvLyDlubPnp7t55Z2Q5qCHCiAgICAgIGJ1ZmZlckNhbnZhczogbnVsbCwgLy8g5a2Y5YKo55S75biDCiAgICAgIGJ1ZmZlckN0eDogbnVsbCwgLy8g5a2Y5YKo55S75biD5LiK5LiL5paHCiAgICAgIHRlbXBDYW52YXM6IG51bGwsIC8vIOS4tOaXtueUu+W4gwogICAgICB0ZW1wQ3R4OiBudWxsLCAvLyDkuLTml7bnlLvluIPkuIrkuIvmlocKCiAgICAgIHZpc2libGVXaWR0aDogMCwgLy8g5Y+v6KeB5Yy65Z+f5a695bqmCiAgICAgIHZpc2libGVIZWlnaHQ6IDAsIC8vIOWPr+ingeWMuuWfn+mrmOW6pgogICAgICB2aXNpYmxlWDogMCwgLy8g5Y+v6KeB5Yy65Z+feOWdkOaghwogICAgICB2aXNpYmxlWTogMCwgLy8g5Y+v6KeB5Yy65Z+feeWdkOaghwogICAgICBpc0RyYWdnaW5nOiBmYWxzZSwgLy8g5qCH6K6w55S75biD5piv5ZCm5q2j5Zyo5ouW5YqoCiAgICAgIHBlbmRpbmdTY2FsZUNoYW5nZTogZmFsc2UsIC8vIOagh+iusOeUu+W4g+aYr+WQpuato+WcqOe8qeaUvgoKICAgICAgdG91Y2hTdGFydFg6IDAsIC8vIOinpuaRuOW8gOWni3jlnZDmoIcKICAgICAgdG91Y2hTdGFydFk6IDAsIC8vIOinpuaRuOW8gOWni3nlnZDmoIcKICAgICAgc3RhcnREaXN0YW5jZTogMCwgLy8g6Kem5pG45byA5aeL6Led56a7CgogICAgICBtb3ZlSW50ZXJ2YWxJZDogbnVsbCwgLy8g5ouW5Yqo5a6a5pe25ZmoCiAgICAgIHpvb21JbnRlcnZhbElkOiBudWxsLCAvLyDnvKnmlL7lrprml7blmagKCgogICAgICBpbWFnZVdpZHRoOiAwLCAvLyDlm77lg4/lrr3luqYKICAgICAgaW1hZ2VIZWlnaHQ6IDAsIC8vIOWbvuWDj+mrmOW6pgogICAgICBkcmF3SW1nRGF0YTogbnVsbCwKICAgICAgT3JpZ2luYWxJbWFnZTogbnVsbCwKICAgICAgZGV0ZWN0U3RhcnNJbWc6IG51bGwsCgogICAgICBpc05vdERyYXdTdGFyczogdHJ1ZSwKCiAgICAgIG1haW5DYW1lcmFTaXplWDogMCwKICAgICAgbWFpbkNhbWVyYVNpemVZOiAwLAoKICAgICAgSW1hZ2VQcm9wb3J0aW9uOiAwLAoKICAgICAgRGV0ZWN0ZWRTdGFyc0xpc3Q6IFtdLAogICAgICBEZXRlY3RlZFN0YXJzRmluaXNoOiBmYWxzZSwKCiAgICAgIENhcnRlc2lhbkxpc3Q6IFtdLAoKICAgICAgUG9sYXJQb2ludF9BbHRpdHVkZTogMCwKCiAgICAgIExhc3RQb2ludF9BekFsdDogbnVsbCwKCiAgICAgIE1hcmtDaXJjbGVOdW06IDAsCgogICAgICBMYXN0Q2lyY2xlX1JhRGVjOiBudWxsLAogICAgICBMYXN0Q2lyY2xlX0F6QWx0OiBudWxsLAoKICAgICAgQ2lyY2xlczogW10sCgogICAgICAvLyDmnoHovbTmoKHlh4bnm7jlhbPmlbDnu4QKICAgICAgY2FsaWJyYXRpb25DaXJjbGVzOiBbXSwgIC8vIOagoeWHhueCueWchuWciOaVsOe7hAogICAgICBhZGp1c3RtZW50Q2lyY2xlczogW10sICAgLy8g6LCD5pW054K55ZyG5ZyI5pWw57uECiAgICAgIHRhcmdldFBvaW50Q2lyY2xlOiBudWxsLCAvLyDnm67moIfngrnlnIblvaLlr7nosaEKICAgICAgZmFrZVBvbGFyQXhpc0NpcmNsZTogbnVsbCwgLy8g5YGH5p6B54K55ZyG5b2i5a+56LGhCiAgICAgIGxhc3RQb3NpdGlvbjogbnVsbCwgICAgICAvLyDkuIrkuIDmrKHkvY3nva4KICAgICAgZmllbGRVcGRhdGVUaW1lcjogbnVsbCwgIC8vIOinhuWcuuabtOaWsOWumuaXtuWZqAogICAgICBmaWVsZE9mVmlld1BvbHlnb25zOiBbXSwgLy8g5a2Y5YKo6KeG5Zy65aSa6L655b2i5a+56LGhCgogICAgICBkcmF3ZXJfMjogbnVsbCwgICAgLy8g6K6+572u5L6n6L655qCP55qE5pi+56S65LiO6ZqQ6JePCgogICAgICBkcml2ZXJzOiBbXSwgLy8g6amx5Yqo6YCJ6aG55pWw57uECiAgICAgIHNlbGVjdGVkRHJpdmVyOiBudWxsLCAvLyDpgInkuK3nmoTpqbHliqgKCiAgICAgIGRldmljZXNMaXN0OiBbXSwgLy8g6K6+5aSH6YCJ6aG55pWw57uECiAgICAgIHNlbGVjdGVkRGV2aWNlOiBudWxsLCAvLyDpgInkuK3nmoTorr7lpIcKICAgICAgVG9CZUNvbm5lY3REZXZpY2U6IFtdLAoKICAgICAgbG9hZGluZ1NlbGVjdERyaXZlcjogZmFsc2UsCiAgICAgIGxvYWRpbmdDb25uZWN0QWxsRGV2aWNlOiBmYWxzZSwKCiAgICAgIEN1cnJlbnRMb2NhdGlvbkxuZzogMCwKICAgICAgQ3VycmVudExvY2F0aW9uTGF0OiAwLAoKICAgICAgaGlzdG9ncmFtRGF0YTogW10sCgogICAgICBJbWFnZUFycmF5QnVmZmVyOiBudWxsLAoKICAgICAgaXNPcGVuRGV2aWNlUGFnZTogZmFsc2UsIC8vIOiuvue9ruiuvuWkh+mhtemdouaYr+WQpuaJk+W8gAogICAgICBpc09wZW5Qb3dlclBhZ2U6IGZhbHNlLCAvLyDorr7nva7nlLXmupDpobXpnaLmmK/lkKbmiZPlvIAKCiAgICAgIE91dFB1dFBvd2VyXzFfT046IHRydWUsCiAgICAgIE91dFB1dFBvd2VyXzJfT046IGZhbHNlLAoKICAgICAgaXNQb2xhckF4aXNNb2RlOiBmYWxzZSwKCiAgICAgIGlzVG91Y2hpbmc6IGZhbHNlLCAvLyDmoIforrDmmK/lkKbmraPlnKjlpITnkIbop6bmkbjkuovku7YKICAgICAgQ29ubmVjdEJ0blByZXNzVGltZXI6IG51bGwsCiAgICAgIENvbm5lY3RCdG5sb25nUHJlc3NUaHJlc2hvbGQ6IDEwMDAsCiAgICAgIGlzQ29ubmVjdEJ0bkxvbmdQcmVzczogZmFsc2UsIC8vIOagh+iusOaYr+WQpuS4uumVv+aMiQogICAgICBDb25uZWN0QnRuQ2FuQ2xpY2s6IHRydWUsCgoKICAgICAgaGF2ZURldmljZUNvbm5lY3Q6IGZhbHNlLAogICAgICBpc0Nvbm5lY3Rpbmc6IGZhbHNlLCAvLyDmt7vliqDov57mjqXnirbmgIEKCiAgICAgIGRpc2Nvbm5lY3RUaW1lb3V0VHJpZ2dlcmVkOiBmYWxzZSwKICAgICAgZGlzY29ubmVjdFRpbWVvdXQ6IG51bGwsCgogICAgICBpc0Rvd25sb2FkaW5nSW1hZ2U6IGZhbHNlLAogICAgICBpc0Rvd25sb2FkaW5nSW1hZ2VOYW1lOiAnJywKICAgICAgaXNXYWl0aW5nTG9nZ2VkOiBmYWxzZSwgLy8g5re75Yqg562J5b6F5pel5b+X5qCH5b+XCgogICAgICBzaG93RGlzY29ubmVjdERpYWxvZzogZmFsc2UsCiAgICAgIGN1cnJlbnREaXNjb25uZWN0RHJpdmVyTmFtZTogJycsCgogICAgICBlbmFibGVNYWluQ2FudmFzQ2xpY2s6IGZhbHNlLCAvLyDmjqfliLbnlLvluIPmmK/lkKblj6/ku6Xngrnlh7vvvIznlKjmnaXnp7vliqjosIPnhKbpgInmi6nmoYblkozpgInmmJ8KCiAgICAgIGxhc3RJbWFnZVByb2Nlc3NQYXJhbXM6IHsgLy8g5pyA5ZCO5aSE55CG5Zu+5YOP55qE5Y+C5pWwCiAgICAgICAgYmxhY2tMZXZlbDogMCwKICAgICAgICB3aGl0ZUxldmVsOiA2NTUzNSwKICAgICAgICBDRkE6ICdudWxsJywKICAgICAgICBhbmFseXNpczogbnVsbCwKICAgICAgICBpc0NvbG9yQ2FtZXJhOiBmYWxzZSwKICAgICAgfSwKICAgICAgZm9jdXNlclBpY3R1cmVGaWxlTmFtZTogJycsICAvLyDnhKbot53lm77niYfmlofku7blkI0KICAgICAgaXNQcm9jZXNzaW5nSW1hZ2U6IGZhbHNlLCAgIC8vIOaOp+WItuaYr+WQpuato+WcqOWkhOeQhuWbvuWDjwogICAgICBpc0ZvY3VzTG9vcFNob290aW5nOiBmYWxzZSwgIC8vIOaOp+WItuaYr+WQpui/m+ihjFJPaeW+queOr+aLjeaRhAogICAgICBmb2N1c2VyUk9JU3RhcnNMaXN0OiBbXSwgIC8vIOeUqOadpeS/neWtmFJPSeWMuuWfn+eahOaYn+eCueWIl+ihqO+8jOWIhuWIq+S/neWtmHgseSxIRlIKICAgICAgc2VsZWN0U3Rhclg6IC0xLAogICAgICBzZWxlY3RTdGFyWTogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFyWDogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFyWTogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFySEZSOiAtMSwKICAgICAgUk9JX3g6IC0xLCAgICAvLyDnlKjmnaXkv53lrZhST0nljLrln5/nmoR45Z2Q5qCHLOWcqHZ1ZeS4reiuoeeulwogICAgICBST0lfeTogLTEsICAgIC8vIOeUqOadpeS/neWtmFJPSeWMuuWfn+eahHnlnZDmoIcs5ZyodnVl5Lit6K6h566XCiAgICAgIFJPSV94X3F0OiAtMSwgICAgLy8g55So5p2l5L+d5a2YUk9J5Yy65Z+f55qEeOWdkOaghyzlnKhxdOS4reiuoeeulwogICAgICBST0lfeV9xdDogLTEsICAgIC8vIOeUqOadpeS/neWtmFJPSeWMuuWfn+eahHnlnZDmoIcs5ZyocXTkuK3orqHnrpcKICAgICAgUk9JX2xlbmd0aDogMzAwLCAvLyDnlKjmnaXkv53lrZhST0nljLrln5/nmoTplb/luqYKICAgICAgc2hvd1NlbGVjdFN0YXI6IGZhbHNlLAoKICAgICAgaXNPbmVUb3VjaDogZmFsc2UsCiAgICAgIGN1cnJlbnRUb3VjaFg6IFswLCAwXSwKICAgICAgY3VycmVudFRvdWNoWTogWzAsIDBdLAogICAgICBzdGFydFRvdWNoWDogWzAsIDBdLAogICAgICBzdGFydFRvdWNoWTogWzAsIDBdLAogICAgICBzdGFydFRvdWNoRGlzdGFuY2U6IDAsCgogICAgICAvLyDlrprkuYnms6LnibnnjofpgInpobkKICAgICAgQmF1ZFJhdGVJdGVtczogWwogICAgICAgIHsgbGFiZWw6ICc5NjAwJywgdmFsdWU6IDk2MDAgfSwKICAgICAgICB7IGxhYmVsOiAnMTkyMDAnLCB2YWx1ZTogMTkyMDAgfSwKICAgICAgICB7IGxhYmVsOiAnMzg0MDAnLCB2YWx1ZTogMzg0MDAgfSwKICAgICAgICB7IGxhYmVsOiAnNTc2MDAnLCB2YWx1ZTogNTc2MDAgfSwKICAgICAgICB7IGxhYmVsOiAnMTE1MjAwJywgdmFsdWU6IDExNTIwMCB9LAogICAgICAgIHsgbGFiZWw6ICcyMzA0MDAnLCB2YWx1ZTogMjMwNDAwIH0sCiAgICAgIF0sCiAgICAgIEJhdWRSYXRlU2VsZWN0ZWQ6IDk2MDAsIC8vIOazoueJueeOh+mAieaLqQogICAgICBjcHVUZW1wOiBudWxsLCAgLy8gQ1BV5rip5bqmCiAgICAgIGNwdVVzYWdlOiBudWxsLCAvLyBDUFXkvb/nlKjnjocKCiAgICAgIHByb2dyZXNzVmFsdWU6IDAsLy8g5o6n5Yi25Zu+5YOP5aSE55CG6L+b5bqm5p2h55qE5Y+Y6YePCiAgICAgIHByb2dyZXNzRGVzY3JpcHRpb246ICcnLCAvLyDmjqfliLbov5vluqbmnaHmmL7npLrlhoXlrrkKCiAgICAgIGNhbGN1bGF0ZUdhaW46IHRydWUsIC8vIOaOp+WItuaYr+WQpuiuoeeul+eZveW5s+ihoeWinuebigogICAgICBsdXRDYWNoZTogewogICAgICAgIGxhc3RQYXJhbXM6IG51bGwsIC8vIOeUqOS6juWtmOWCqOS4iuasoeeahOWPguaVsAogICAgICAgIGx1dFI6IG51bGwsCiAgICAgICAgbHV0RzogbnVsbCwKICAgICAgICBsdXRCOiBudWxsCiAgICAgIH0sCiAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBHdWksCiAgICBHdWlMb2FkZXIsCiAgICBQcm9ncmVzc0JhciwKICAgIC8vIE1lc3NhZ2VCb3gsCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy4kYnVzLiRvbignQXBwU2VuZE1lc3NhZ2UnLCB0aGlzLnNlbmRNZXNzYWdlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0FwcFVwZGF0ZURldmljZXMnLCB0aGlzLnVwZGF0ZURldmljZXMpOwogICAgdGhpcy4kYnVzLiRvbignU3dpdGNoLU1haW5QYWdlJywgdGhpcy5oYW5kbGVCdXR0b25UZXN0Q2xpY2spOwogICAgdGhpcy4kYnVzLiRvbignSGFuZGxlSGlzdG9ncmFtTnVtJywgdGhpcy5hcHBseUhpc3RTdHJldGNoKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0ltYWdlR2FpblInLCB0aGlzLkltYWdlR2FpblNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdJbWFnZUdhaW5CJywgdGhpcy5JbWFnZUdhaW5TZXQpOwogICAgdGhpcy4kYnVzLiRvbignT2Zmc2V0JywgdGhpcy5JbWFnZU9mZnNldFNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdCaW5uaW5nJywgdGhpcy5CaW5uaW5nU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0dhaW4nLCB0aGlzLkdhaW5TZXQpOwogICAgdGhpcy4kYnVzLiRvbignT2Zmc2V0JywgdGhpcy5PZmZzZXRTZXQpOwogICAgdGhpcy4kYnVzLiRvbignSW1hZ2VDRkEnLCB0aGlzLkltYWdlQ0ZBU2V0KTsKICAgIC8vIHRoaXMuJGJ1cy4kb24oJ01haW5DYW1lcmFDRkEnLCB0aGlzLkltYWdlQ0ZBU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ1RlbXBlcmF0dXJlJywgdGhpcy5DYW1lcmFUZW1wZXJhdHVyZVNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdGb2NhbCBMZW5ndGggKG1tKScsIHRoaXMuRm9jYWxMZW5ndGhTZXQpOwogICAgdGhpcy4kYnVzLiRvbignR3VpZGVyIEZvY2FsIExlbmd0aCAobW0pJywgdGhpcy5HdWlkZXJGb2NhbExlbmd0aFNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdNdWx0aSBTdGFyIEd1aWRlcicsIHRoaXMuTXVsdGlTdGFyR3VpZGVyU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0d1aWRlciBQaXhlbCBzaXplJywgdGhpcy5HdWlkZXJQaXhlbFNpemVTZXQpOwogICAgdGhpcy4kYnVzLiRvbignR3VpZGVyIEdhaW4nLCB0aGlzLkd1aWRlckdhaW5TZXQpOwogICAgdGhpcy4kYnVzLiRvbignQ2FsaWJyYXRpb24gc3RlcCAobXMpJywgdGhpcy5DYWxpYnJhdGlvbkR1cmF0aW9uU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ1JhIEFnZ3Jlc3Npb24nLCB0aGlzLlJhQWdncmVzc2lvblNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdEZWMgQWdncmVzc2lvbicsIHRoaXMuRGVjQWdncmVzc2lvblNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdTeW5jIEZvY3VzZXIgU3RlcCcsIHRoaXMuU3luY0ZvY3VzZXJTdGVwKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0dvdG9UaGVuU29sdmUnLCB0aGlzLkdvdG9UaGVuU29sdmUpOwogICAgdGhpcy4kYnVzLiRvbignQXV0b0ZsaXAnLCB0aGlzLkF1dG9GbGlwU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ1dlc3RNaW51dGVzUGFzdE1lcmlkaWFuJywgdGhpcy5XZXN0TWludXRlc1Bhc3RNZXJpZGlhblNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdFYXN0TWludXRlc1Bhc3RNZXJpZGlhbicsIHRoaXMuRWFzdE1pbnV0ZXNQYXN0TWVyaWRpYW5TZXQpOwogICAgdGhpcy4kYnVzLiRvbignSW1hZ2VQcm9wb3J0aW9uJywgdGhpcy5zZXRJbWFnZVByb3BvcnRpb24pOwogICAgdGhpcy4kYnVzLiRvbignTW91bnRHb3RvJywgdGhpcy5sb29rYXRjaXJjbGUpOwogICAgdGhpcy4kYnVzLiRvbignU3dpdGNoSW1hZ2VUb1Nob3cnLCB0aGlzLlN3aXRjaEltYWdlVG9TaG93KTsKICAgIHRoaXMuJGJ1cy4kb24oJ1BvbGFyUG9pbnRBbHRpdHVkZScsIHRoaXMuc2V0UG9sYXJQb2ludEFsdGl0dWRlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ3Nob3dTdGVsQ2FudmFzJywgdGhpcy5zaG93U3RlbENhbnZhcyk7CiAgICB0aGlzLiRidXMuJG9uKCdSZWNhbGlicmF0ZVBvbGFyQXhpcycsIHRoaXMuUmVjYWxpYnJhdGVQb2xhckF4aXMpOwogICAgdGhpcy4kYnVzLiRvbignQ3VycmVudEV4cFRpbWVMaXN0JywgdGhpcy5DdXJyZW50RXhwVGltZUxpc3QpOwogICAgdGhpcy4kYnVzLiRvbignZGlzY29ubmVjdEFsbERldmljZScsIHRoaXMuZGlzY29ubmVjdEFsbERldmljZSk7CiAgICB0aGlzLiRidXMuJG9uKCdHZXRDb25uZWN0ZWREZXZpY2VzJywgdGhpcy5SZXR1cm5Db25uZWN0ZWREZXZpY2VzKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0N1cnJlbnRDRldMaXN0JywgdGhpcy5DdXJyZW50Q0ZXTGlzdCk7CiAgICB0aGlzLiRidXMuJG9uKCdjYWxjV2hpdGVCYWxhbmNlR2FpbnMnLCB0aGlzLmNhbGNXaGl0ZUJhbGFuY2VHYWlucyk7CiAgICB0aGlzLiRidXMuJG9uKCdTd2l0Y2hPdXRQdXRQb3dlcicsIHRoaXMuU3dpdGNoT3V0UHV0UG93ZXIpOwogICAgdGhpcy4kYnVzLiRvbignUG9sYXJBeGlzTW9kZScsIHRoaXMuUG9sYXJBeGlzTW9kZSk7CiAgICB0aGlzLiRidXMuJG9uKCdTZW5kQ29uc29sZUxvZ01zZycsIHRoaXMuU2VuZENvbnNvbGVMb2dNc2cpOwogICAgLy8gdGhpcy4kYnVzLiRvbignRGlzY29ubmVjdERyaXZlclN1Y2Nlc3MnLCB0aGlzLmRpc2Nvbm5lY3REcml2ZXJzdWNjZXNzKTsKICAgIHRoaXMuJGJ1cy4kb24oJ1VuQmluZGluZ0RldmljZScsIHRoaXMuVW5CaW5kaW5nRGV2aWNlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0Nsb3NlV2ViVmlldycsIHRoaXMuUXVpdFRvTWFpbkFwcCkKICAgIHRoaXMuJGJ1cy4kb24oJ1JlZEJveFNpemVDaGFuZ2UnLCB0aGlzLlJlZEJveFNpemVDaGFuZ2UpOwogICAgdGhpcy4kYnVzLiRvbignc2V0Rm9jdXNlclN0YXRlJywgdGhpcy5zZXRGb2N1c2VyU3RhdGUpOyAgLy8g6K6+572u6LCD54Sm54q25oCB5ZKM6L+b5bqmCiAgICB0aGlzLiRidXMuJG9uKCdzZXRTaG93U2VsZWN0U3RhcicsIHRoaXMuc2V0U2hvd1NlbGVjdFN0YXIpOyAgLy8g6K6+572u5piv5ZCm5pi+56S66YCJ5oup5pif54K5CiAgICB0aGlzLiRidXMuJG9uKCdTY2FsZUNoYW5nZScsIHRoaXMuU2NhbGVDaGFuZ2UpOwogICAgdGhpcy4kYnVzLiRvbignc2hvd0NhbnZhcycsIHRoaXMuc2hvd0NhbnZhcyk7CgogICAgLy8g5p6B6L205qCh5YeG57uY5Yi255u45YWz55uR5ZCs5ZmoCiAgICB0aGlzLiRidXMuJG9uKCdEcmF3Q2FsaWJyYXRpb25Qb2ludFBvbHlnb24nLCB0aGlzLmRyYXdDYWxpYnJhdGlvblBvaW50UG9seWdvbik7CiAgICB0aGlzLiRidXMuJG9uKCdDbGVhckNhbGlicmF0aW9uUG9pbnRzJywgdGhpcy5jbGVhckNhbGlicmF0aW9uUG9pbnRzKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0RyYXdBZGp1c3RtZW50UG9pbnRzUG9seWdvbicsIHRoaXMuZHJhd0FkanVzdG1lbnRQb2ludHNQb2x5Z29uKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0RyYXdUYXJnZXRQb2ludENpcmNsZScsIHRoaXMuZHJhd1RhcmdldFBvaW50Q2lyY2xlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0RyYXdGYWtlUG9sYXJBeGlzQ2lyY2xlJywgdGhpcy5EcmF3RmFrZVBvbGFyQXhpc0NpcmNsZSkKCiAgICAvLyDmoKHlh4bnm7jlhbPkuovku7bnm5HlkKzlmagKICAgIHRoaXMuJGJ1cy4kb24oJ1N0YXJ0Q2FsaWJyYXRpb24nLCB0aGlzLnN0YXJ0Q2FsaWJyYXRpb25Qcm9jZXNzKTsKICAgIHRoaXMuJGJ1cy4kb24oJ1VwZGF0ZUNhbGlicmF0aW9uSW5mbycsIHRoaXMudXBkYXRlQ2FsaWJyYXRpb25JbmZvKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0VuZENhbGlicmF0aW9uJywgdGhpcy5lbmRDYWxpYnJhdGlvbik7CgogICAgdGhpcy5tZW1vcnlDaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5jaGVja01lbW9yeVVzYWdlLCAzMDAwMCk7CgoKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOaYr+WQpuWFgeiuuOWwj+aVsO+8mnN0ZXAg5LiN5piv5pW05pWw77yM5oiW5pi+5byP5YWB6K64CiAgICBhbGxvd3NEZWNpbWFsKGl0ZW0pIHsKICAgICAgY29uc3Qgc3RlcCA9IGl0ZW0uc3RlcCA/PyAxOwogICAgICByZXR1cm4gaXRlbS5hbGxvd0RlY2ltYWwgPT09IHRydWUgfHwgIU51bWJlci5pc0ludGVnZXIoc3RlcCkgfHwgU3RyaW5nKHN0ZXApLmluY2x1ZGVzKCcuJyk7CiAgICB9LAogICAgLy8g5piv5ZCm5YWB6K646LSf5pWw77ya5qC55o2u6YWN572u5oiWIG1pbjwwIOeMnOa1iwogICAgYWxsb3dzTmVnYXRpdmUoaXRlbSkgewogICAgICByZXR1cm4gaXRlbS5hbGxvd05lZ2F0aXZlID09PSB0cnVlIHx8ICh0eXBlb2YgaXRlbS5taW4gPT09ICdudW1iZXInICYmIGl0ZW0ubWluIDwgMCk7CiAgICB9LAogICAgLy8g56e75Yqo56uv6ZSu55uY57G75Z6LCiAgICBnZXRJbnB1dE1vZGUoaXRlbSkgewogICAgICAvLyDku4Xnp7vliqjnq6/nlJ/mlYjvvJvmoYzpnaLlv73nlaUKICAgICAgaWYgKCF0aGlzLmlzTW9iaWxlKSByZXR1cm4gdW5kZWZpbmVkOwogICAgICAvLyDpnIDopoHlsI/mlbDmiJbotJ/mlbDvvIznlKggZGVjaW1hbO+8iOabtOWuueaYk+WHuueOsOWwj+aVsOeCuS/otJ/lj7fvvIkKICAgICAgcmV0dXJuIHRoaXMuYWxsb3dzRGVjaW1hbChpdGVtKSB8fCB0aGlzLmFsbG93c05lZ2F0aXZlKGl0ZW0pID8gJ2RlY2ltYWwnIDogJ251bWVyaWMnOwogICAgfSwKICAgIC8vIOmFjeWQiCBpT1PvvJpwYXR0ZXJuIOWPr+W9seWTjeW8ueWHuumUruebmOS4juagoemqjAogICAgZ2V0UGF0dGVybihpdGVtKSB7CiAgICAgIGNvbnN0IG5lZyA9IHRoaXMuYWxsb3dzTmVnYXRpdmUoaXRlbSk7CiAgICAgIGlmICh0aGlzLmFsbG93c0RlY2ltYWwoaXRlbSkpIHsKICAgICAgICAvLyDlhYHorrggLiDmiJYgLCDkvZzkuLrlsI/mlbDngrnvvIzkvr/kuo7kuI3lkIzor63oqIDplK7nm5gKICAgICAgICByZXR1cm4gbmVnID8gJ15bLV0/WzAtOV0qKFsuLF1bMC05XSopPyQnIDogJ15bMC05XSooWy4sXVswLTldKik/JCc7CiAgICAgIH0KICAgICAgLy8g5pW05pWwCiAgICAgIHJldHVybiBuZWcgPyAnXlstXT9bMC05XSokJyA6ICdeWzAtOV0qJCc7CiAgICB9LAoKICAgIG51bWJlclJ1bGVzKGl0ZW0pIHsKICAgICAgcmV0dXJuIFsKICAgICAgICB2ID0+IHYgPT09ICcnIHx8IHYgPT09IG51bGwgfHwgIWlzTmFOKHRoaXMuX3RvTnVtYmVyKHYpKSB8fCAn6K+36L6T5YWl5pWw5a2XJywKICAgICAgICB2ID0+IGl0ZW0ubWluID09PSB1bmRlZmluZWQgfHwgdGhpcy5fdG9OdW1iZXIodikgPj0gaXRlbS5taW4gfHwgYOacgOWwj+WAvCAke2l0ZW0ubWlufWAsCiAgICAgICAgdiA9PiBpdGVtLm1heCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuX3RvTnVtYmVyKHYpIDw9IGl0ZW0ubWF4IHx8IGDmnIDlpKflgLwgJHtpdGVtLm1heH1gLAogICAgICBdOwogICAgfSwKCiAgICAvLyDnu5/kuIDmiorpgJflj7flsI/mlbDovazkuLrngrnvvIzljrvmjonlpJrkvZnnqbrnmb0KICAgIF90b051bWJlcih2KSB7CiAgICAgIGlmICh2ID09PSAnJyB8fCB2ID09PSBudWxsIHx8IHYgPT09IHVuZGVmaW5lZCkgcmV0dXJuIE5hTjsKICAgICAgaWYgKHR5cGVvZiB2ID09PSAnbnVtYmVyJykgcmV0dXJuIHY7CiAgICAgIGNvbnN0IHMgPSBTdHJpbmcodikudHJpbSgpLnJlcGxhY2UoJywnLCAnLicpOwogICAgICByZXR1cm4gTnVtYmVyKHMpOwogICAgfSwKCiAgICBvbk51bWJlckNvbW1pdChpdGVtKSB7CiAgICAgIGxldCB2ID0gdGhpcy5fdG9OdW1iZXIoaXRlbS52YWx1ZSk7CiAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHYpKSByZXR1cm47CgogICAgICAvLyAxKSDlpLnlj5bliLAgbWluL21heAogICAgICBpZiAoaXRlbS5taW4gIT09IHVuZGVmaW5lZCAmJiB2IDwgaXRlbS5taW4pIHYgPSBpdGVtLm1pbjsKICAgICAgaWYgKGl0ZW0ubWF4ICE9PSB1bmRlZmluZWQgJiYgdiA+IGl0ZW0ubWF4KSB2ID0gaXRlbS5tYXg7CgogICAgICAvLyAyKSDmjIkgc3RlcCDlr7npvZDvvIjku6UgbWluIOaIliAwIOS4uuWfuuWHhu+8iQogICAgICBjb25zdCBzdGVwID0gaXRlbS5zdGVwID8/IDE7CiAgICAgIGlmIChzdGVwID4gMCkgewogICAgICAgIGNvbnN0IGJhc2UgPSAoaXRlbS5taW4gIT09IHVuZGVmaW5lZCA/IGl0ZW0ubWluIDogMCk7CiAgICAgICAgdiA9IGJhc2UgKyBNYXRoLnJvdW5kKCh2IC0gYmFzZSkgLyBzdGVwKSAqIHN0ZXA7CiAgICAgICAgaWYgKGl0ZW0ubWluICE9PSB1bmRlZmluZWQgJiYgdiA8IGl0ZW0ubWluKSB2ID0gaXRlbS5taW47CiAgICAgICAgaWYgKGl0ZW0ubWF4ICE9PSB1bmRlZmluZWQgJiYgdiA+IGl0ZW0ubWF4KSB2ID0gaXRlbS5tYXg7CiAgICAgICAgdiA9IE51bWJlcih2LnRvRml4ZWQoMTIpKTsgLy8g5Y675rWu54K56K+v5beuCiAgICAgIH0KCiAgICAgIC8vIOWbnuWGmeW5tumAmuefpQogICAgICBpdGVtLnZhbHVlID0gdjsKICAgICAgdGhpcy5oYW5kbGVDb25maWdDaGFuZ2UoaXRlbS5sYWJlbCwgdik7CiAgICB9LAogICAgY2hlY2tNZW1vcnlVc2FnZSgpIHsKICAgICAgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cucGVyZm9ybWFuY2UubWVtb3J5KSB7CiAgICAgICAgY29uc3QgbWVtb3J5SW5mbyA9IHdpbmRvdy5wZXJmb3JtYW5jZS5tZW1vcnk7CiAgICAgICAgY29uc3QgdXNlZCA9IE1hdGgucm91bmQobWVtb3J5SW5mby51c2VkSlNIZWFwU2l6ZSAvIDEwNDg1NzYpOwogICAgICAgIGNvbnN0IGxpbWl0ID0gTWF0aC5yb3VuZChtZW1vcnlJbmZvLmpzSGVhcFNpemVMaW1pdCAvIDEwNDg1NzYpOwoKICAgICAgICAvLyBjb25zb2xlLmxvZyhg5YaF5a2Y5L2/55SoOiAke3VzZWR9TUIgLyAke2xpbWl0fU1CYCk7CgogICAgICAgIGlmIChtZW1vcnlJbmZvLnVzZWRKU0hlYXBTaXplID4gbWVtb3J5SW5mby5qc0hlYXBTaXplTGltaXQgKiAwLjcpIHsKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2hvd1dhcm5pbmcnLCB0aGlzLiRpMThuLmxvY2FsZSA9PT0gJ2NuJyA/CiAgICAgICAgICAgICflhoXlrZjkvb/nlKjmjqXov5HpmZDliLbvvIzor7fkv53lrZjlt6XkvZzlkI7liLfmlrDpobXpnaInIDoKICAgICAgICAgICAgJ01lbW9yeSB1c2FnZSBpcyBhcHByb2FjaGluZyBsaW1pdC4gUGxlYXNlIHNhdmUgeW91ciB3b3JrIGFuZCByZWZyZXNoIHRoZSBwYWdlLicpOwoKICAgICAgICAgIC8vIOWPr+mAie+8muWwneivleaJi+WKqOinpuWPkeWeg+WcvuWbnuaUtgogICAgICAgICAgaWYgKHdpbmRvdy5nYykgewogICAgICAgICAgICB0cnkgeyB3aW5kb3cuZ2MoKTsgfSBjYXRjaCAoZSkgeyB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGZvcm1hdFRpcFZhbHVlKGl0ZW0pIHsKICAgICAgcmV0dXJuIChpdGVtICYmIGl0ZW0uZGlzcGxheVZhbHVlICE9IG51bGwpCiAgICAgICAgPyBTdHJpbmcoaXRlbS5kaXNwbGF5VmFsdWUpCiAgICAgICAgOiAoaXRlbSAmJiBpdGVtLnZhbHVlICE9IG51bGwgPyBTdHJpbmcoaXRlbS52YWx1ZSkgOiAnLScpOwogICAgfSwKICAgIGZvcm1hdFRpcFRpdGxlKGl0ZW0pIHsKICAgICAgaWYgKGl0ZW0gJiYgaXRlbS50b29sdGlwICE9IG51bGwpIHJldHVybiBTdHJpbmcoaXRlbS50b29sdGlwKTsKICAgICAgaWYgKGl0ZW0gJiYgaXRlbS52YWx1ZSAhPSBudWxsKSByZXR1cm4gU3RyaW5nKGl0ZW0udmFsdWUpOwogICAgICByZXR1cm4gJyc7CiAgICB9LAogICAgY29weVRpcChpdGVtKSB7CiAgICAgIGNvbnN0IHRleHQgPSAoaXRlbSAmJiBpdGVtLnZhbHVlICE9IG51bGwpID8gU3RyaW5nKGl0ZW0udmFsdWUpIDogJyc7CiAgICAgIGlmICghdGV4dCkgcmV0dXJuOwogICAgICBpZiAobmF2aWdhdG9yICYmIG5hdmlnYXRvci5jbGlwYm9hcmQgJiYgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQpIHsKICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KTsKICAgICAgfQogICAgfSwKCiAgICAvLyDlpITnkIbmmJ/ngrnor4bliKvnu5PmnpwKICAgIGhhbmRsZVN0YXJEZXRlY3Rpb25SZXN1bHQoZGV0ZWN0ZWQsIGhmcikgewogICAgICBpZiAoZGV0ZWN0ZWQpIHsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChg5pif54K555qESEZS5Li677yaJHtoZnJ9YCwgJ2luZm8nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgn5pyq6K+G5Yir5Yiw5pif54K5JywgJ3dhcm5pbmcnKTsKICAgICAgfQogICAgfSwKCiAgICAvLyDlpITnkIboh6rliqjlr7nnhKbmqKHlvI/lj5jljJYKICAgIGhhbmRsZUF1dG9Gb2N1c01vZGVDaGFuZ2VkKG1vZGUsIGhmcikgewogICAgICBpZiAobW9kZSA9PT0gJ2NvYXJzZScpIHsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgn6L+b5YWl57KX6LCD5qih5byPJywgJ2luZm8nKTsKICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnZmluZScpIHsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgn6L+b5YWl57K+6LCD5qih5byPJywgJ2luZm8nKTsKICAgICAgfQogICAgfSwKICAgIAoKICAgIHByZXZlbnREZWZhdWx0KGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9LAogICAgZ2V0TG9jYXRpb25Ib3N0TmFtZSgpIHsKICAgICAgY29uc3QgaG9zdG5hbWUgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CiAgICAgIGNvbnN0IHByb3RvY29sID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6JyA6ICd3czonOwogICAgICBjb25zdCBwb3J0ID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICc4NjAxJyA6ICc4NjAwJzsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnbG9jYXRpb24gaG9zdG5hbWU6JyArIGhvc3RuYW1lLCAnaW5mbycpOwogICAgICB0aGlzLldlYlNvY2tldFVybCA9IGAke3Byb3RvY29sfS8vJHtob3N0bmFtZX06JHtwb3J0fWA7CiAgICAgIGNvbnNvbGUubG9nKCdXZWJTb2NrZXRVcmw6JywgdGhpcy5XZWJTb2NrZXRVcmwpOwogICAgfSwKICAgIGdldFFUQ2xpZW50VmVyc2lvbigpIHsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0UVRDbGllbnRWZXJzaW9uJyk7CiAgICB9LAogICAgY29ubmVjdCgpIHsKICAgICAgLy8g5pu/5o2i5Li65L2g55qEIFdlYlNvY2tldCDmnI3liqHlmajlnLDlnYAKICAgICAgLy8gdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCd3czovLzE5Mi4xNjguMi4zMTo4NjAwJyk7ICAvLyBwcm9jZXNzLmVudi5WVUVfQVBQX1dFQlNPQ0tFVAogICAgICAvLyB0aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9XRUJTT0NLRVQpOwogICAgICBjb25zdCB3c09wdGlvbnMgPSB7CiAgICAgICAgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZSAgLy8g56aB55So6K+B5Lmm6aqM6K+BCiAgICAgIH07CiAgICAgIHRoaXMud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldCh0aGlzLldlYlNvY2tldFVybCwgW10sIHdzT3B0aW9ucyk7CgogICAgICB0aGlzLndlYnNvY2tldC5vbm9wZW4gPSAoKSA9PiB7CiAgICAgICAgdGhpcy53ZWJzb2NrZXRTdGF0ZSA9ICdjb25uZWN0ZWQnOwogICAgICAgIHRoaXMubmV0d29ya0Rpc2Nvbm5lY3RlZCA9IGZhbHNlOyAvLyBXZWJTb2NrZXTov57mjqXmiJDlip/ml7bph43nva7nvZHnu5zov57mjqXnirbmgIEKICAgICAgICBpZiAodGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCkgewogICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1dlYlNvY2tldCBjb25uZWN0ZWQnLCAnc3VjY2VzcycpOwogICAgICAgIH0KICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dOZXRTdGF0dXMnLCAndHJ1ZScpOwogICAgICAgIHRoaXMuU3RhdHVzUmVjb3ZlcnkoKTsKICAgICAgICBjb25zb2xlLmxvZygncHJvY2Vzcy5lbnYuTk9ERV9FTlY6JywgcHJvY2Vzcy5lbnYuTk9ERV9FTlYpOwogICAgICB9OwoKICAgICAgdGhpcy53ZWJzb2NrZXQub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHsKICAgICAgICAvLyBjb25zb2xlLmxvZygnUUhZQ0NEIHwgUmVjZWl2ZWQgbWVzc2FnZTonLCBtZXNzYWdlLmRhdGEpOwoKICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShtZXNzYWdlLmRhdGEpOwoKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAnUVRfUmV0dXJuJykgewogICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRhLm1lc3NhZ2Uuc3BsaXQoJzonKTsKICAgICAgICAgIGxldCBtZXNzYWdlVHlwZTsKICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIG1lc3NhZ2VUeXBlID0gcGFydHNbMF07CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCDojrflvpfkv6Hmga8oJyttZXNzYWdlVHlwZSsnKTonLCBwYXJ0cyk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5raI5oGv5qC85byP6ZSZ6K+v77yM5peg5rOV5YiG5YmyOicsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBhY2NlcHRNZXNzYWdlID0gZmFsc2U7CiAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlLnN0YXJ0c1dpdGgoJ1N0YWdpbmdTY2hlZHVsZURhdGE6JykpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpOwogICAgICAgICAgICBhY2NlcHRNZXNzYWdlID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRhLm1lc3NhZ2Uuc3BsaXQoJ1snKTsKCiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BhcnRzLmxlbmd0aDogJywgcGFydHMubGVuZ3RoKTsKICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1N0YWdpbmdTY2hlZHVsZURhdGEnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlLnN0YXJ0c1dpdGgoJ1NlbmREZWJ1Z01lc3NhZ2V8JykpIHsKICAgICAgICAgICAgYWNjZXB0TWVzc2FnZSA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0YS5tZXNzYWdlLnNwbGl0KCd8Jyk7CiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICBjb25zdCB0eXBlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2VuZERlYnVnTWVzc2FnZScsIHR5cGUsIG1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFhY2NlcHRNZXNzYWdlKSB7CiAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZVR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICdBZGREcml2ZXInOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZTsKICAgICAgICAgICAgICAgICAgLy8g5Yib5bu65LiA5Liq6amx5Yqo5a+56LGhCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRyaXZlciA9IHsgdHlwZSwgbGFiZWwsIHZhbHVlIH07CgogICAgICAgICAgICAgICAgICAvLyBpZiAodHlwZSA9PT0gJ01haW5DYW1lcmEnICYmIGxhYmVsID09PSAiUUhZIENDRDIiKSB7CiAgICAgICAgICAgICAgICAgIC8vICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgLy8gaWYgKHR5cGUgPT09ICdHdWlkZXInICYmIGxhYmVsID09PSAiUUhZIENDRCIpIHsKICAgICAgICAgICAgICAgICAgLy8gICBicmVhazsKICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgLy8g5qOA5p+lbGFiZWzmmK/lkKbkuLoiUUhZIENDRCLmiJYiUUZvY3VzZXIi77yM5aaC5p6c5piv77yM5YiZ5o+S5YWl5Yiw5pWw57uE6aaW5L2NCiAgICAgICAgICAgICAgICAgIGlmIChsYWJlbCA9PT0gIlFIWSBDQ0QiIHx8IGxhYmVsID09PSAiUUZvY3VzZXIiIHx8IGxhYmVsID09PSAiUUhZIENDRDIiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcml2ZXJzLnVuc2hpZnQoZHJpdmVyKTsgLy8g5bCG5paw6amx5Yqo5re75Yqg5Yiw5pWw57uE55qE5byA5aeL5L2N572uCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcml2ZXJzLnB1c2goZHJpdmVyKTsgLy8g5bCG5paw6amx5Yqo5re75Yqg5Yiw5pWw57uE55qE5pyr5bC+CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdBZGREZXZpY2UnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUUhZQ0NEIHwgQWRkRGV2aWNlOiAnLCBsYWJlbCk7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHZhbHVlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLmNvbmZpcm1Ecml2ZXJUeXBlOwogICAgICAgICAgICAgICAgICAvLyDliJvlu7rkuIDkuKrpqbHliqjlr7nosaEKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlID0geyB0eXBlLCBsYWJlbCwgbGFiZWwgfTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IEFkZERldmljZTogJywgZGV2aWNlKTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdhZGQtZGV2aWNlJywgZGV2aWNlKTsKICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VzTGlzdC5wdXNoKGRldmljZSk7CgogICAgICAgICAgICAgICAgICB0aGlzLlRvQmVDb25uZWN0RGV2aWNlID0gW107CiAgICAgICAgICAgICAgICAgIHRoaXMuZGV2aWNlc0xpc3QuZm9yRWFjaChkZXZpY2VzTGlzdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZXNMaXN0LnR5cGUgPT09IHRoaXMuQ3VycmVudERyaXZlclR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UucHVzaChkZXZpY2VzTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlbGVjdERyaXZlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZURldmljZXNfJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgTGlzdE51bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGV2aWNlc18oTGlzdE51bSwgbmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ29ubmVjdFN1Y2Nlc3MnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZU5hbWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgY29uc3QgZHJpdmVyTmFtZSA9IHBhcnRzWzNdOwoKICAgICAgICAgICAgICAgICAgaWYgKGRldmljZU5hbWUgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURldmljZXNDb25uZWN0KHR5cGUsIGRldmljZU5hbWUsIGRyaXZlck5hbWUsIHRydWUpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgZGV2aWNlTmFtZSwgZHJpdmVyTmFtZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ29ubmVjdEZhaWxlZCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChyZWFzb24sICdlcnJvcicpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdDb25uZWN0QWxsRGV2aWNlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU2NhbkZhaWxlZCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChyZWFzb24sICdlcnJvcicpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdTZWxlY3REcml2ZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdBZGREZXZpY2VUeXBlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgRGV2aWNlVHlwZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FkZERldmljZVR5cGUnLCBEZXZpY2VUeXBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdEZXZpY2VUb0JlQWxsb2NhdGVkJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgRGV2aWNlVHlwZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBEZXZpY2VJbmRleCA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBEZXZpY2VOYW1lID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnRGV2aWNlVG9CZUFsbG9jYXRlZCcsIERldmljZUluZGV4LCBEZXZpY2VOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTaG93RGV2aWNlQWxsb2NhdGlvbldpbmRvdyc6CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3RvZ2dsZURldmljZUFsbG9jYXRpb25QYW5lbCcpOwogICAgICAgICAgICAgICAgdGhpcy5uYXYgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdFeHBvc3VyZUNvbXBsZXRlZCc6CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0V4cG9zdXJlQ29tcGxldGVkJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU2F2ZUpwZ1N1Y2Nlc3MnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCByb2lfeCA9IHBhcnNlSW50KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgY29uc3Qgcm9pX3kgPSBwYXJzZUludChwYXJ0c1szXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuUk9JX3ggPSByb2lfeDsKICAgICAgICAgICAgICAgICAgdGhpcy5ST0lfeSA9IHJvaV95OwoKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdzaG93Um9pSW1hZ2UnLCBmaWxlTmFtZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JvaUltYWdlKGZpbGVOYW1lLCByb2lfeCwgcm9pX3kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NhdmVCaW5TdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5yZWFkQmluRmlsZSgnaW1nLycgKyBmaWxlTmFtZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuRGV0ZWN0ZWRTdGFyc0ZpbmlzaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdTYXZlR3VpZGVySW1hZ2VTdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQW5kRGlzcGxheUltYWdlKCdpbWcvJyArIGZpbGVOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ0d1aWRlU2l6ZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCJHdWlkZVNpemUiLCBjb2wsIHJvdyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgJ0FkZFNjYXR0ZXJDaGFydERhdGEnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBEYXRhX3ggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgRGF0YV95ID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGFQb2ludCA9IFtEYXRhX3gsIERhdGFfeV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQWRkU2NhdHRlckNoYXJ0RGF0YScsIG5ld0RhdGFQb2ludCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQWRkTGluZUNoYXJ0RGF0YSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IERhdGFfeCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBEYXRhX1JhID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IERhdGFfRGVjID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGFQb2ludF9SYSA9IFtEYXRhX3gsIERhdGFfUmFdOwogICAgICAgICAgICAgICAgICBjb25zdCBuZXdEYXRhUG9pbnRfRGVjID0gW0RhdGFfeCwgRGF0YV9EZWNdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FkZExpbmVDaGFydERhdGEnLCBuZXdEYXRhUG9pbnRfUmEsIG5ld0RhdGFQb2ludF9EZWMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NldExpbmVDaGFydFJhbmdlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWluID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NldExpbmVDaGFydFJhbmdlJywgbWluLCBtYXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0d1aWRlclN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlclN0YXR1cycsIHN0YXR1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnRm9jdXNDaGFuZ2VTcGVlZFN1Y2Nlc3MnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBTcGVlZCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ZvY3VzQ2hhbmdlU3BlZWRTdWNjZXNzJywgU3BlZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdGb2N1c1Bvc2l0aW9uJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgQ3VycmVudFBvc2l0aW9uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IFRhcmdldFBvc2l0aW9uID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnRm9jdXNQb3NpdGlvbicsIEN1cnJlbnRQb3NpdGlvbiwgVGFyZ2V0UG9zaXRpb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0ZvY3VzTW92ZURvbmUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBDdXJyZW50UG9zaXRpb24gPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgSEZSID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnVXBkYXRlSEZSJywgQ3VycmVudFBvc2l0aW9uLCBIRlIpOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2FkZERhdGFfUG9pbnQnLCBDdXJyZW50UG9zaXRpb24sIEhGUik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnYWRkRGF0YV9Qb2ludCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcGFyc2VGbG9hdChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGhmciA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICBjb25zdCBzdGFnZSA9IHBhcnRzWzNdIHx8ICdmaW5lJzsKICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIGlmIChzdGFnZSA9PT0gJ2NsZWFyJyB8fCBwb3NpdGlvbiA9PT0gLTEgfHwgaGZyID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBcHAudnVlIHwg5o6l5pS25Yiw5riF56m65pWw5o2u5raI5oGvJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDbGVhckZpbmVEYXRhJyk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FwcC52dWUgfCDmjqXmlLbliLDmlbDmja7ngrnmtojmga86JywgeyBwb3NpdGlvbiwgaGZyLCBzdGFnZSB9KTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXBwLnZ1ZSB8IOWOn+Wni+a2iOaBrzonLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnYWRkRGF0YV9Qb2ludCcsIHBvc2l0aW9uLCBoZnIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBcHAudnVlIHwg5pWw5o2u54K55raI5oGv5qC85byP6ZSZ6K+vOicsIHBhcnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdBdXRvZm9jdXNGYWlsZWQnOgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FwcC52dWUgfCDmjqXmlLbliLBBdXRvZm9jdXNGYWlsZWTmtojmga8nKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2hvd0F1dG9mb2N1c0ZhaWx1cmVBbGVydCcpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2FkZE1pblBvaW50RGF0YV9Qb2ludCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwYXJzZUludChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdhZGRNaW5Qb2ludERhdGFfUG9pbnQnLCB4LCB5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ2FkZExpbmVEYXRhX1BvaW50JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICBjb25zdCBiID0gcGFyc2VGbG9hdChwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBwYXJzZUZsb2F0KHBhcnRzWzNdKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZExpbmVEYXRhX1BvaW50OicsIGEsIGIsIGMpOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2FkZExpbmVEYXRhX1BvaW50JywgYSwgYiwgYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICdNYWluQ2FtZXJhU2l6ZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFNpemVYID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IFNpemVZID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYVNpemUnLCBTaXplWCwgU2l6ZVkpOwogICAgICAgICAgICAgICAgICB0aGlzLm1haW5DYW1lcmFTaXplWCA9IFNpemVYOwogICAgICAgICAgICAgICAgICB0aGlzLm1haW5DYW1lcmFTaXplWSA9IFNpemVZOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ01haW5DYW1lcmFCaW5uaW5nJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFCaW4gPSBwYXJzZUludChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnQmlubmluZycpLnZhbHVlID0gdGhpcy5jYW1lcmFCaW47CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYUJpbm5pbmcnLCB0aGlzLmNhbWVyYUJpbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZml0UXVhZHJhdGljQ3VydmUnOgogICAgICAgICAgICAgICAgLy8g5paw55qE5pWw5o2u5qC85byPOiAiZml0UXVhZHJhdGljQ3VydmU6YTpiOmM6YmVzdFBvc2l0aW9uOm1pbkhGUiIKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBcHAudnVlIHwg5o6l5pS25YiwZml0UXVhZHJhdGljQ3VydmXmtojmga86JywgZGF0YS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIC8vIOS9v+eUqHNldFRpbWVvdXTnoa7kv53muIXpmaTmk43kvZzlnKjmt7vliqDmlbDmja7kuYvliY3lrozmiJAKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2xlYXJmaXRRdWFkcmF0aWNDdXJ2ZScpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZml0UXVhZHJhdGljQ3VydmUnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2ZpdFF1YWRyYXRpY0N1cnZlX21pblBvaW50JzoKICAgICAgICAgICAgICAgIC8vIOaWsOeahOaVsOaNruagvOW8jzogImZpdFF1YWRyYXRpY0N1cnZlX21pblBvaW50OmJlc3RQb3NpdGlvbjptaW5IRlIiCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXBwLnZ1ZSB8IOaOpeaUtuWIsGZpdFF1YWRyYXRpY0N1cnZlX21pblBvaW505raI5oGvOicsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2ZpdFF1YWRyYXRpY0N1cnZlX21pblBvaW50JywgZGF0YS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlUGFyayc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFN3aXRjaCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50UGFya1N3aXRjaCcsIFN3aXRjaCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlVHJhY2snOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBTd2l0Y2ggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudFRyYWNrU3dpdGNoJywgU3dpdGNoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNb3VudFNldFNwZWVkU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ25ld01vdW50U2xld1JhdGUnLCBudW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdUZWxlc2NvcGVQaWVyU2lkZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFNpZGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCd1cGRhdGVNb3VudFBpZXJTaWRlJywgU2lkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlVG90YWxTbGV3UmF0ZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50VG90YWxTbGV3UmF0ZScsIG51bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ1VwZGF0ZVNjaGVkdWxlUHJvY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFJvd051bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBQcm9jZXNzID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnVXBkYXRlU2NoZWR1bGVQcm9jZXNzJywgUm93TnVtLCBQcm9jZXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdFeHBUaW1lTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnaW5pdEV4cFRpbWVMaXN0JywgcGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdDYW1lcmFJbkV4cG9zdXJpbmcnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDYW1lcmFJbkV4cG9zdXJpbmcnLCBzdGF0dXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0F1dG9Gb2N1c092ZXInOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSA0KSB7CiAgICAgICAgICAgICAgICAgIC8vIOaWsOagvOW8jzogQXV0b0ZvY3VzT3ZlcjpzdWNjZXNzOmJlc3RQb3NpdGlvbjptaW5IRlIKICAgICAgICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHBhcnRzWzFdID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RQb3NpdGlvbiA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICBjb25zdCBtaW5IRlIgPSBwYXJzZUZsb2F0KHBhcnRzWzNdKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBdXRvRm9jdXNPdmVyJywgc3VjY2VzcywgYmVzdFBvc2l0aW9uLCBtaW5IRlIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8g5YW85a655pen5qC85byPOiBBdXRvRm9jdXNPdmVyCiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXV0b0ZvY3VzT3ZlcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1N0YXJEZXRlY3Rpb25SZXN1bHQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBkZXRlY3RlZCA9IHBhcnRzWzFdID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGhmciA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVN0YXJEZXRlY3Rpb25SZXN1bHQoZGV0ZWN0ZWQsIGhmcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQXV0b0ZvY3VzTW9kZUNoYW5nZWQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBtb2RlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGhmciA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUF1dG9Gb2N1c01vZGVDaGFuZ2VkKG1vZGUsIGhmcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ0ZXUG9zaXRpb25NYXgnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NldENGV1Bvc2l0aW9uTWF4JywgcGFydHNbMV0pOwoKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcGFydHNbMV07IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuQ0ZXQ29uZmlnSXRlbXMucHVzaCh7IGRyaXZlclR5cGU6ICdDRlcnLCBsYWJlbDogYENGVyBbJHtpfV1gLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ2dldENGV0xpc3QnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnU2V0Q0ZXUG9zaXRpb25TdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRDRldQb3NpdGlvblN1Y2Nlc3MnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZ2V0Q0ZXTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnaW5pdENGV0xpc3QnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyU3dpdGNoU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJTd2l0Y2hTdGF0dXMnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyTG9vcEV4cFN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyTG9vcEV4cFN0YXR1cycsIHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdUZWxlc2NvcGVSQURFQyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlQ2lyY2xlUG9zKHBhcnRzWzFdLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndXBkYXRlQ3VycmVudExvY2F0aW9uJywgcGFydHNbMV0sIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVUZWxlc2NvcGVTdGF0dXMocGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ01haW5DYW1lcmFTdGF0dXMnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZU1haW5DYW1lcmFTdGF0dXMocGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdNYWluQ2FtZXJhVGVtcGVyYXR1cmUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZU1haW5DYW1lcmFUZW1wZXJhdHVyZShwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ1Nob3dBbGxJbWFnZUZvbGRlcic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2hvd0FsbEltYWdlRm9sZGVyJywgcGFydHNbMV0sIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnSW1hZ2VGaWxlc05hbWUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ltYWdlRmlsZXNOYW1lJywgcGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdVU0JDaGVjayc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFVTQmRhdGEgPSBwYXJ0c1sxXS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVVNCIG5hbWU6ICcsIFVTQmRhdGFbMF0pOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVVNCIHNwYWNlOiAnLCBVU0JkYXRhWzFdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVVNCIG5hbWU6JyArIFVTQmRhdGFbMF0sICdpbmZvJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1VTQiBzcGFjZTonICsgVVNCZGF0YVsxXSwgJ2luZm8nKTsKCiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnVVNCX05hbWVfU2FwY2UnLCBVU0JkYXRhWzBdLCBVU0JkYXRhWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdJbWFnZVNhdmVFcnJvZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEVycm9lID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGlmIChFcnJvZSA9PT0gJ1VTQi1OdWxsJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdObyBVU0IgRHJpdmUgRGV0ZWN0ZWQuJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoRXJyb2UgPT09ICdVU0ItTXVsdGlwbGUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ011bHRpcGxlIFVTQiBkcml2ZXMgZGV0ZWN0ZWQsIHBsZWFzZSByZW1vdmUgZXhjZXNzIFVTQiBkcml2ZXMuJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdEZXRlY3RlZFN0YXJzJzoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEZXRlY3RlZCcsIHBhcnRzLmxlbmd0aCwgJ3N0YXJzLicpOwogICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRGV0ZWN0ZWQgJyArIHBhcnRzLmxlbmd0aCArICcgc3RhcnMuJywgJ2luZm8nKTsKICAgICAgICAgICAgICAgIHRoaXMuRGV0ZWN0ZWRTdGFyc0xpc3QgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IHBhcnRzW2ldOwogICAgICAgICAgICAgICAgICBjb25zdCBiID0gYS5zcGxpdCgnfCcpOwogICAgICAgICAgICAgICAgICBpZiAoYi5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gYlswXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gYlsxXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoZnIgPSBiWzJdOwogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdTdGFycyBhdCgnLCB4LCAnLCcsIHksICcpIHdpdGggSEZSOicsIGhmcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5EZXRlY3RlZFN0YXJzTGlzdC5wdXNoKHsgeDogeCwgeTogeSwgaGZyOiBoZnIgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuRGV0ZWN0ZWRTdGFyc0ZpbmlzaCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU29sdmVJbWFnZVJlc3VsdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuVXBkYXRlQ2lyY2xlUG9zKHBhcnRzWzFdLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTb2x2ZSBJbWFnZSBSZXN1bHQoUkFfRGVncmVlLCBERUNfRGVncmVlLCBBemltdXRoLCBBbHRpdHVkZSk6JywgcGFydHNbMV0sICcsJywgcGFydHNbMl0sICcsJywgcGFydHNbM10sICcsJywgcGFydHNbNF0pOwogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTb2x2ZSBJbWFnZSBSZXN1bHQoUkFfRGVncmVlLCBERUNfRGVncmVlLCBBemltdXRoLCBBbHRpdHVkZSk6JyArIHBhcnRzWzFdICsgJywnICsgcGFydHNbMl0gKyAnLCcgKyBwYXJ0c1szXSArICcsJyArIHBhcnRzWzRdLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICB0aGlzLlNvbHZlUmVzdWx0TWFyayhwYXJ0c1sxXSwgcGFydHNbMl0sIHBhcnRzWzNdLCBwYXJ0c1s0XSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgiSW1hZ2VTb2x2ZUZpbmlzaGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UGFyc2luZ1Byb2dyZXNzJywgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NvbHZlRm92UmVzdWx0JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDkpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgUmFEZWMgPSBbCiAgICAgICAgICAgICAgICAgICAgeyBSYTogcGFydHNbMV0sIERlYzogcGFydHNbMl0gfSwKICAgICAgICAgICAgICAgICAgICB7IFJhOiBwYXJ0c1szXSwgRGVjOiBwYXJ0c1s0XSB9LAogICAgICAgICAgICAgICAgICAgIHsgUmE6IHBhcnRzWzVdLCBEZWM6IHBhcnRzWzZdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBSYTogcGFydHNbN10sIERlYzogcGFydHNbOF0gfSwKICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgdGhpcy5Tb2x2ZUZvdk1hcmsoUmFEZWMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1JlYWxUaW1lU29sdmVJbWFnZVJlc3VsdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTb2x2ZSBJbWFnZSBSZXN1bHQoUkFfRGVncmVlLCBERUNfRGVncmVlLCBBemltdXRoLCBBbHRpdHVkZSk6JywgcGFydHNbMV0sICcsJywgcGFydHNbMl0sICcsJywgcGFydHNbM10sICcsJywgcGFydHNbNF0pOwogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTb2x2ZSBJbWFnZSBSZXN1bHQoUkFfRGVncmVlLCBERUNfRGVncmVlLCBBemltdXRoLCBBbHRpdHVkZSk6JyArIHBhcnRzWzFdICsgJywnICsgcGFydHNbMl0gKyAnLCcgKyBwYXJ0c1szXSArICcsJyArIHBhcnRzWzRdLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLlNvbHZlUmVzdWx0TWFya19SZWFsVGltZShwYXJ0c1sxXSwgcGFydHNbMl0sIHBhcnRzWzNdLCBwYXJ0c1s0XSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTb2x2ZUltYWdlU3VjY2VlZGVkJzoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfop6PmnpDlkIzmraXmiJDlip8nKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgiaGFuZGxlT3BlcmF0aW9uQ29tcGxldGUiLCAic29sdmUiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2hvd01zZ0JveCcsICdTb2x2ZSBpbWFnZSBzdWNjZWVkIScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU29sdmVJbWFnZWZhaWxlZCc6CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnU29sdmUgaW1hZ2UgZmFpbGQuLi4nLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgiSW1hZ2VTb2x2ZUZpbmlzaGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRQYXJzaW5nUHJvZ3Jlc3MnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50T3BlcmF0aW9uQ29tcGxldGUnLCAnc29sdmUnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNYWluQ2FtZXJhT2Zmc2V0UmFuZ2UnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbkNhbWVyYU9mZnNldFJhbmdlOicsIHBhcnRzWzFdLCAnLCcsIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTWFpbkNhbWVyYU9mZnNldFJhbmdlOicgKyBwYXJ0c1sxXSArICcsJyArIHBhcnRzWzJdLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICB0aGlzLk1haW5DYW1lcmFPZmZzZXRNaW4gPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5NYWluQ2FtZXJhT2Zmc2V0TWF4ID0gcGFydHNbMl07CgogICAgICAgICAgICAgICAgICBjb25zdCBPZmZzZXRJdGVtID0gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZChpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdPZmZzZXQnKTsKICAgICAgICAgICAgICAgICAgaWYgKE9mZnNldEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbkNhbWVyYU9mZnNldFJhbmdlOicsIHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYU9mZnNldE1pbiwgMTApLCAnLCcsIHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYU9mZnNldE1heCwgMTApKTsKICAgICAgICAgICAgICAgICAgICBPZmZzZXRJdGVtLmlucHV0TWluID0gcGFyc2VJbnQodGhpcy5NYWluQ2FtZXJhT2Zmc2V0TWluLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgT2Zmc2V0SXRlbS5pbnB1dE1heCA9IHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYU9mZnNldE1heCwgMTApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnTWFpbkNhbWVyYUdhaW5SYW5nZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNYWluQ2FtZXJhR2FpblJhbmdlOicsIHBhcnRzWzFdLCAnLCcsIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTWFpbkNhbWVyYUdhaW5SYW5nZTonICsgcGFydHNbMV0gKyAnLCcgKyBwYXJ0c1syXSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgdGhpcy5NYWluQ2FtZXJhR2Fpbk1pbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLk1haW5DYW1lcmFHYWluTWF4ID0gcGFydHNbMl07CgogICAgICAgICAgICAgICAgICBjb25zdCBnYWluSXRlbSA9IHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnR2FpbicpOwogICAgICAgICAgICAgICAgICBpZiAoZ2Fpbkl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbkNhbWVyYUdhaW5SYW5nZTonLCBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFHYWluTWluLCAxMCksICcsJywgcGFyc2VJbnQodGhpcy5NYWluQ2FtZXJhR2Fpbk1heCwgMTApKTsKICAgICAgICAgICAgICAgICAgICBnYWluSXRlbS5pbnB1dE1pbiA9IHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYUdhaW5NaW4sIDEwKTsKICAgICAgICAgICAgICAgICAgICBnYWluSXRlbS5pbnB1dE1heCA9IHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYUdhaW5NYXgsIDEwKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ091dHB1dFBvd2VyU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludChwYXJ0c1sxXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KHBhcnRzWzJdLCAxMCk7CgogICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLk91dFB1dFBvd2VyXzFfT04gPSB2YWx1ZSA9PT0gMTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuT3V0UHV0UG93ZXJfMl9PTiA9IHZhbHVlID09PSAxOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnUEhEMlN0YXJCb3hWaWV3JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1BIRDJTdGFyQm94VmlldycsIHZpZXcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BIRDJTdGFyQ3Jvc3NWaWV3JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1BIRDJTdGFyQ3Jvc3NWaWV3Jywgdmlldyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnUEhEMlN0YXJCb3hQb3NpdGlvbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFBIRDJJbWFnZVNpemVfWCA9IHBhcnNlSW50KHBhcnRzWzFdLCAxMCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFBIRDJJbWFnZVNpemVfWSA9IHBhcnNlSW50KHBhcnRzWzJdLCAxMCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEJveF9YID0gcGFyc2VJbnQocGFydHNbM10sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgQm94X1kgPSBwYXJzZUludChwYXJ0c1s0XSwgMTApOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdQSEQyQm94KFBIRDJJbWFnZVNpemVfWCwgUEhEMkltYWdlU2l6ZV9ZLCBCb3hfWCwgQm94X1kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BIRDJNdWx0aVN0YXJzUG9zaXRpb24nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkgewogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1ggPSBwYXJzZUludChwYXJ0c1sxXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1kgPSBwYXJzZUludChwYXJ0c1syXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBCb3hfWCA9IHBhcnNlSW50KHBhcnRzWzNdLCAxMCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEJveF9ZID0gcGFyc2VJbnQocGFydHNbNF0sIDEwKTsKICAgICAgICAgICAgICAgICAgdGhpcy5EcmF3UEhEMk11bHRpU3RhcnMoUEhEMkltYWdlU2l6ZV9YLCBQSEQySW1hZ2VTaXplX1ksIEJveF9YLCBCb3hfWSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ2xlYXJQSEQyTXVsdGlTdGFycyc6CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NsZWFyUEhEMk11bHRpU3RhcnMnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdQSEQyU3RhckNyb3NzUG9zaXRpb24nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkgewogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1ggPSBwYXJzZUludChwYXJ0c1sxXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1kgPSBwYXJzZUludChwYXJ0c1syXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBDcm9zc19YID0gcGFyc2VJbnQocGFydHNbM10sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgQ3Jvc3NfWSA9IHBhcnNlSW50KHBhcnRzWzRdLCAxMCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuRHJhd1BIRDJDcm9zcyhQSEQySW1hZ2VTaXplX1gsIFBIRDJJbWFnZVNpemVfWSwgQ3Jvc3NfWCwgQ3Jvc3NfWSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnUVRDbGllbnRWZXJzaW9uJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5RVENsaWVudFZlcnNpb24gPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnQ2FwdHVyZUltYWdlU2F2ZVN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnUmVwZWF0JykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KHRoaXMuJHQoJ1RoZXJlIGlzIG5vIG5lZWQgdG8gc2F2ZSBpdCBhZ2FpbicpLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdTdWNjZXNzJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KHRoaXMuJHQoJ0ltYWdlIHNhdmVkIHN1Y2Nlc3NmdWxseScpLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ051bGwnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3godGhpcy4kdCgnTm8gaW1hZ2VzIHRvIHNhdmUnKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdJTkRJU2VydmVyRGVidWcnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnSU5ESVNlcnZlckRlYnVnJywgbWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnSG90c3BvdE5hbWUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBOYW1lID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnSG90c3BvdE5hbWUnLCBOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ0VkaXRIb3RzcG90TmFtZVN1Y2Nlc3MnOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdFZGl0SG90c3BvdE5hbWVTdWNjZXNzJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnRFNMUnNTZXR1cCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IE5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93RFNMUnNTZXR1cCcsIE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0NvbmZpZ3VyZVJlY292ZXJ5JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgQ29uZmlnTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBDb25maWdWYWx1ZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ29uZmlndXJlOicsIENvbmZpZ05hbWUsICcsJywgQ29uZmlnVmFsdWUpOwogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDb25maWd1cmUgUmVjb3Zlcnk6JyArIHBhcnRzWzFdICsgJywnICsgcGFydHNbMl0sICdpbmZvJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdChDb25maWdOYW1lLCBDb25maWdWYWx1ZSk7CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdGb2NhbExlbmd0aCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRlbGVzY29wZXNDb25maWdJdGVtc1swXS52YWx1ZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuZGV2aWNlcykgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSAnVGVsZXNjb3BlcycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzWzJdID09PSAnJyB8fCBwYXJ0c1syXSA9PT0gTmFOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBwYXJ0c1syXSArICcgbW0nOwogICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ0d1aWRlckZvY2FsTGVuZ3RoJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbMF0udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0d1aWRlckZvY2FsTGVuZ3RoOicgKyBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ0Nvb3JkaW5hdGVzJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtsYXRTdHIsIGxuZ1N0ciwgaXNBdXRvU3RyXSA9IHBhcnRzWzJdLnNwbGl0KCcsJykubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhdCA9IHBhcnNlRmxvYXQobGF0U3RyKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsbmcgPSBwYXJzZUZsb2F0KGxuZ1N0cik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBdXRvID0gaXNBdXRvU3RyID09PSAndHJ1ZScgfHwgaXNBdXRvU3RyID09PSAnMSc7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXRDdXJyZW50TG9jYXRpb24obGF0LCBsbmcsIGlzQXV0byk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ011bHRpU3Rhckd1aWRlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLkd1aWRlckNvbmZpZ0l0ZW1zWzFdLnZhbHVlID0gKHBhcnRzWzJdID09PSAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnTXVsdGlTdGFyR3VpZGVyOicgKyBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ0d1aWRlckdhaW4nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5HdWlkZXJDb25maWdJdGVtc1syXS52YWx1ZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnR3VpZGVyR2FpbjonICsgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdDYWxpYnJhdGlvbkR1cmF0aW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbM10udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NhbGlicmF0aW9uRHVyYXRpb246JyArIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzWzFdID09PSAnUmFBZ2dyZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbNF0udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1JhQWdncmVzc2lvbjonICsgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdEZWNBZ2dyZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbNV0udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0RlY0FnZ3Jlc3Npb246JyArIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdDb25uZWN0RHJpdmVyU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3REcml2ZXJTdWNjZXNzKGRldmljZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ29ubmVjdERyaXZlckZhaWxlZCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0RHJpdmVyRmFpbGVkKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0Rpc2Nvbm5lY3REcml2ZXJTdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdERyaXZlcnN1Y2Nlc3MoZGV2aWNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdEaXNjb25uZWN0RHJpdmVyRmFpbCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRyaXZlciA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3REcml2ZXJGYWlsKGRldmljZSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAnU2VsZWN0ZWREcml2ZXJMaXN0JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2VPYmplY3RzID0gcGFydHMuc2xpY2UoMSkucmVkdWNlKChhY2MsIHBhcnQsIGluZGV4LCBhcnJheSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAlIDIgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKHsgW2FycmF5W2luZGV4XV06IGFycmF5W2luZGV4ICsgMV0gfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7CiAgICAgICAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU2VsZWN0ZWREcml2ZXJMaXN0KGRldmljZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdCaW5kRGV2aWNlTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlT2JqZWN0cyA9IHBhcnRzLnNsaWNlKDEpLnJlZHVjZSgoYWNjLCBwYXJ0LCBpbmRleCwgYXJyYXkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggJSAyID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBhY2MucHVzaCh7IFthcnJheVtpbmRleF1dOiBhcnJheVtpbmRleCArIDFdIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjOwogICAgICAgICAgICAgICAgICB9LCBbXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEJpbmREZXZpY2VMaXN0KGRldmljZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdCaW5kRGV2aWNlVHlwZUxpc3QnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSA1KSB7IC8vIOehruS/neiHs+WwkeacieS6lOS4quWPguaVsOWKoOS4iuWJjee8gAogICAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2VUeXBlT2JqZWN0cyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcnRzLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlVHlwZU9iamVjdCA9IHsKICAgICAgICAgICAgICAgICAgICAgIFR5cGU6IHBhcnRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgRGV2aWNlTmFtZTogcGFydHNbaSArIDFdLAogICAgICAgICAgICAgICAgICAgICAgRHJpdmVyTmFtZTogcGFydHNbaSArIDJdLAogICAgICAgICAgICAgICAgICAgICAgaXNiaW5kOiBwYXJ0c1tpICsgM10gPT0gInRydWUiID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZU9iamVjdHMucHVzaChkZXZpY2VUeXBlT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRCaW5kRGV2aWNlVHlwZUxpc3QoZGV2aWNlVHlwZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZURldmljZUFsbG9jYXRpb25MaXN0JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZURldmljZUFsbG9jYXRpb25MaXN0KGRldmljZU5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZVR5cGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgaWYgKGRldmljZVR5cGUgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCcsIGRldmljZVR5cGUpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2VUeXBlID09ICdDRlcnKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRldmljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRldmljZXNbaV0uZHJpdmVyVHlwZSA9PSAnQ0ZXJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VzW2ldLmRldmljZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uZHJpdmVyTmFtZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uQmF1ZFJhdGUgPSA5NjAwOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NGV0Nvbm5lY3RlZCcsIDApOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BhcnNlSW5mb0VtaXR0ZWQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1BhcnNlSW5mb0VtaXR0ZWQnLCBwcm9ncmVzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyVXBkYXRlU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyVXBkYXRlU3RhdHVzJywgcGFyc2VJbnQoc3RhdHVzLCAxMCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0xvb3BTb2x2ZUltYWdlRmluaXNoZWQnOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdMb29wU29sdmVJbWFnZUZpbmlzaGVkJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZGlzY29ubmVjdERldmljZWhhc29ydGhlcmRldmljZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRyaXZlcm5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0ZGlzY29ubmVjdERyaXZlcihkcml2ZXJuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdnZXRGb2N1c2VyTW92ZVN0YXRlJzoKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZ2V0Rm9jdXNlck1vdmVTdGF0ZScpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0ZvY3VzTW92ZVRvTGltaXQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBlcnJvcmxvZyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChlcnJvcmxvZywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnc3RhcnRGb2N1c0xvb3BGYWlsZWQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc3RhcnRGb2N1c0xvb3BGYWlsZWQnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdzZXRGb2N1c2VyTG9vcGluZ1N0YXRlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldEZvY3VzZXJMb29waW5nU3RhdGUnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZvY3VzTG9vcFNob290aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRm9jdXNMb29wU2hvb3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2ZvY3VzZXJST0lTdGFyc0xpc3QnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCB4ID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgY29uc3QgSEZSID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNlclJPSVN0YXJzTGlzdC5wdXNoKHsgeCwgeSwgSEZSIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIC8vIGNhc2UgJ2NsZWFyRm9jdXNlclJPSVN0YXJzTGlzdCc6CiAgICAgICAgICAgICAgLy8gICB0aGlzLmZvY3VzZXJST0lTdGFyc0xpc3QgPSBbXTsKICAgICAgICAgICAgICAvLyAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdzZXRTZWxlY3RTdGFyUG9zaXRpb24nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFyWCA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFyWSA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFySEZSID0gcGFyc2VGbG9hdChwYXJ0c1szXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU2V0UmVkQm94U3RhdGUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBwYXJzZUludChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuUk9JX3ggPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5ST0lfeSA9IHBhcnNlRmxvYXQocGFydHNbM10pOwoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRSZWRCb3hTdGF0ZShsZW5ndGgsIHRoaXMuUk9JX3gsIHRoaXMuUk9JX3kpOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6K6+572u57qi6ImyUk9J5qGGOiAnLCBsZW5ndGgsIHRoaXMuUk9JX3gsIHRoaXMuUk9JX3kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NldFZpc2libGVBcmVhJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlWCA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGVZID0gcGFyc2VGbG9hdChwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGUgPSBwYXJzZUZsb2F0KHBhcnRzWzNdKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRTY2FsZScsIHRoaXMuc2NhbGUpOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6K6+572u5Y+v6KeB5Yy65Z+fOiAnLCB0aGlzLnZpc2libGVYLCB0aGlzLnZpc2libGVZLCB0aGlzLnNjYWxlKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygndXBkYXRlIFZpc2libGVBcmVhIHg9JyArIHRoaXMudmlzaWJsZVggKyAnLCB5PScgKyB0aGlzLnZpc2libGVZICsgJywgc2NhbGU9JyArIHRoaXMuc2NhbGUsICdpbmZvJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU2V0U2VsZWN0U3RhcnMnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJYID0gcGFyc2VGbG9hdChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0U3RhclkgPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygndXBkYXRlIFNlbGVjdFN0YXJzIHg9JyArIHRoaXMuc2VsZWN0U3RhclggKyAnLCB5PScgKyB0aGlzLnNlbGVjdFN0YXJZLCAnaW5mbycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZUNQVUluZm8nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBsZXQgY3B1VGVtcCA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICBsZXQgY3B1VXNhZ2UgPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5jcHVUZW1wID0gaXNOYU4oY3B1VGVtcCkgPyBudWxsIDogKGNwdVRlbXAgJSAxID09PSAwID8gY3B1VGVtcCA6IGNwdVRlbXAudG9GaXhlZCgxKSk7ICAvLyDlpoLmnpwgY3B1VGVtcCDmmK8gTmFO77yM6K6+572u5Li6IG51bGzvvIzlkKbliJnlpoLmnpwgY3B1VGVtcCDmmK/mlbTmlbDvvIzlsLHkuI3kv53nlZnlsI/mlbDvvIzlkKbliJnkv53nlZnkuIDkvY3lsI/mlbAKICAgICAgICAgICAgICAgICAgdGhpcy5jcHVVc2FnZSA9IGlzTmFOKGNwdVVzYWdlKSA/IG51bGwgOiAoY3B1VXNhZ2UgJSAxID09PSAwID8gY3B1VXNhZ2UgOiBjcHVVc2FnZS50b0ZpeGVkKDEpKTsgIC8vIOWmguaenCBjcHVVc2FnZSDmmK8gTmFO77yM6K6+572u5Li6IG51bGzvvIzlkKbliJnlpoLmnpwgY3B1VXNhZ2Ug5piv5pW05pWw77yM5bCx5LiN5L+d55WZ5bCP5pWw77yM5ZCm5YiZ5L+d55WZ5LiA5L2N5bCP5pWwCiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndXBkYXRlQ1BVSW5mbycsIHRoaXMuY3B1VGVtcCwgdGhpcy5jcHVVc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnVGlhbldlbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdGljZV90eXBlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRlYyA9IHBhcnRzWzNdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1RpYW5XZW4nLCBub3RpY2VfdHlwZSwgcmEsIGRlYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnc2V0TWFpbkNhbWVyYVBhcmFtZXRlcnMnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSAzKSB7CiAgICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXJzID0ge307CiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGFydHMubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXIgPSBwYXJ0c1tpXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnRzW2kgKyAxXTsKICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzW3BhcmFtZXRlcl0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnNldE1haW5DYW1lcmFQYXJhbWV0ZXJzKHBhcmFtZXRlcnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2xvY2FsTWVzc2FnZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhdCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBsb24gPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSBwYXJ0c1szXTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnMi0tLS0tLS0tLS0tLeiOt+W+l+WPguaVsOiuvue9rmxvY2FsTWVzc2FnZTogJyArIGxhdCArICcsJyArIGxvbiArICcsJyArIGxhbmd1YWdlLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICBpZiAobGFuZ3VhZ2UgPT0gJ3poJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2xpZW50TGFuZ3VhZ2UnLCAnY24nKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NsaWVudExhbmd1YWdlJywgJ2VuJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRMb2NhdGlvbkxhdEFuZExvbicsIGxhdCwgbG9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdpc0F1dG9Mb2NhdGlvbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQXV0b0xvY2F0aW9uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnaXNBdXRvTG9jYXRpb24nLCBpc0F1dG9Mb2NhdGlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnc2VuZEdldExvY2F0aW9uJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbGF0ID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxvbiA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdzZW5kR2V0TG9jYXRpb246ICcgKyBsYXQgKyAnLCcgKyBsb24sICdpbmZvJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2VuZEdldExvY2F0aW9uJywgbGF0LCBsb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ01haW5DYW1lcmFDRkEnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnJykgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ251bGwnOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnR1JCRycpIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdHUic7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICdHQlJHJykgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ0dCJzsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ0JHR1InKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnQkcnOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnUkcnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnUkdHQic7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy5JbWFnZUNGQSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygi6I635Y+W5Yiw55qE5Li755u45py65Y+C5pWwICBNYWluQ2FtZXJhQ0ZBOiAiLCB0aGlzLkltYWdlQ0ZBKTsKICAgICAgICAgICAgICAgICAgdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZChpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdJbWFnZUNGQScpLnZhbHVlID0gdGhpcy5JbWFnZUNGQTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdDYW1lcmFOb3RJZGxlJzoKICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdDYW1lcmEgaXMgbm90IGlkbGUnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTW91bnRPcGVyYXRpb25Db21wbGV0ZScsICdzb2x2ZScpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ01haW5DYW1lcmFOb3RDb25uZWN0JzoKICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdNYWluIENhbWVyYSBpcyBub3QgY29ubmVjdCcsICdlcnJvcicpOwogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudE9wZXJhdGlvbkNvbXBsZXRlJywgJ3NvbHZlJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICdTZXJ2ZXJJbml0U3VjY2Vzcyc6CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnU2VydmVyIGluaXQgc3VjY2VzcycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICdQb2xhckFsaWdubWVudFN0YXRlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHsKICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnUG9sYXJBbGlnbm1lbnRTdGF0ZScsIHN0YXRlLCBtZXNzYWdlLCBwZXJjZW50YWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ1BvbGFyQWxpZ25tZW50QWRqdXN0bWVudEd1aWRlRGF0YSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyMSkgeyAgLy8g5LuOMTfmlLnkuLoyMQogICAgICAgICAgICAgICAgICBjb25zdCByYSA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMgPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgLy8g5paw5aKe77ya5Zub5Liq6KeS54K5CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhMCA9IHBhcnNlRmxvYXQocGFydHNbM10pOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMwID0gcGFyc2VGbG9hdChwYXJ0c1s0XSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhMSA9IHBhcnNlRmxvYXQocGFydHNbNV0pOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMxID0gcGFyc2VGbG9hdChwYXJ0c1s2XSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhMiA9IHBhcnNlRmxvYXQocGFydHNbN10pOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMyID0gcGFyc2VGbG9hdChwYXJ0c1s4XSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhMyA9IHBhcnNlRmxvYXQocGFydHNbOV0pOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMzID0gcGFyc2VGbG9hdChwYXJ0c1sxMF0pOwoKICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0cmEgPSBwYXJzZUZsb2F0KHBhcnRzWzExXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldGRlYyA9IHBhcnNlRmxvYXQocGFydHNbMTJdKTsKICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0cmEgPSBwYXJzZUZsb2F0KHBhcnRzWzEzXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldGRlYyA9IHBhcnNlRmxvYXQocGFydHNbMTRdKTsKICAgICAgICAgICAgICAgICAgY29uc3QgYWRqdXN0bWVudHJhID0gcGFydHNbMTVdOwogICAgICAgICAgICAgICAgICBjb25zdCBhZGp1c3RtZW50ZGVjID0gcGFydHNbMTZdOwogICAgICAgICAgICAgICAgICBjb25zdCBmYWtlUG9sYXJSQSA9IHBhcnNlRmxvYXQocGFydHNbMTddKTsKICAgICAgICAgICAgICAgICAgY29uc3QgZmFrZVBvbGFyREVDID0gcGFyc2VGbG9hdChwYXJ0c1sxOF0pOwogICAgICAgICAgICAgICAgICBjb25zdCByZWFsUG9sYXJSQSA9IHBhcnNlRmxvYXQocGFydHNbMTldKTsKICAgICAgICAgICAgICAgICAgY29uc3QgcmVhbFBvbGFyREVDID0gcGFyc2VGbG9hdChwYXJ0c1syMF0pOwoKCiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfoh6rliqjlr7nnhKbnu5jliLbmlbDmja46ICcsIHJhLCBkZWMsIHRhcmdldHJhLCB0YXJnZXRkZWMsIGZha2VQb2xhclJBLCBmYWtlUG9sYXJERUMsIHJlYWxQb2xhclJBLCByZWFsUG9sYXJERUMpOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5Zub6KeS54K55pWw5o2uOiAnLCByYTAsIGRlYzAsIHJhMSwgZGVjMSwgcmEyLCBkZWMyLCByYTMsIGRlYzMpOwoKICAgICAgICAgICAgICAgICAgLy8g546w5pyJ5LqL5Lu25L+d5oyB5LiN5Y+Y77yI5L2/55So6K6h566X55qEbWF4L21pbuWAvOWFvOWuue+8iQogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ZpZWxkRGF0YVVwZGF0ZScsIFtyYSwgZGVjLCByYTAsIGRlYzAsIHJhMSwgZGVjMSwgcmEyLCBkZWMyLCByYTMsIGRlYzMsIHRhcmdldHJhLCB0YXJnZXRkZWMsIGZha2VQb2xhclJBLCBmYWtlUG9sYXJERUMsIHJlYWxQb2xhclJBLCByZWFsUG9sYXJERUNdKTsKCiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfoh6rliqjlr7nnhKbmmL7npLrmm7TmlrDmlbDmja46ICcsIG9mZnNldHJhLCBvZmZzZXRkZWMsIGFkanVzdG1lbnRyYSwgYWRqdXN0bWVudGRlYyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndXBkYXRlQ2FyZEluZm8nLCByYSwgZGVjLCB0YXJnZXRyYSwgdGFyZ2V0ZGVjLCBvZmZzZXRyYSwgb2Zmc2V0ZGVjLCBhZGp1c3RtZW50cmEsIGFkanVzdG1lbnRkZWMsICJkZWciKTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZm9jdXNNb3ZlRmFpbGVkJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChtZXNzYWdlLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdmb2N1c01vdmVGYWlsZWQnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAnZm9jdXNNb3ZlRmFpbGVkJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChtZXNzYWdlLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdmb2N1c01vdmVGYWlsZWQnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNZXJpZGlhbkVUQV9obXMnOiB7CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDQpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgaCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBtID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBwYXJ0c1szXTsKCiAgICAgICAgICAgICAgICAgIGNvbnN0IGhtcyA9IGAke2h9OiR7bX06JHtzfWA7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLk1vdW50Q29uZmlnSXRlbXMuZmluZChpID0+IGkubGFiZWwgPT09ICdGbGlwIEVUQScpOwogICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBobXM7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5kaXNwbGF5VmFsdWUgPSBobXM7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAnQXV0b0ZsaXAnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQXV0b0ZsaXAgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgLy8g5p+l5om+5piv5ZCm5bey5a2Y5ZyoICJBdXRvRmxpcCIg6aG5CiAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLmZpbmQoaSA9PiBpLmxhYmVsID09PSAnQXV0b0ZsaXAnKTsKICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAvLyDlt7LlrZjlnKgg4oaSIOabtOaWsAogICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBpc0F1dG9GbGlwID09ICd0cnVlJzsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyDkuI3lrZjlnKgg4oaSIOaWsOWingogICAgICAgICAgICAgICAgICAgIHRoaXMuTW91bnRDb25maWdJdGVtcy5wdXNoKHsgZHJpdmVyVHlwZTogJ01vdW50JywgbGFiZWw6ICdBdXRvRmxpcCcsIHZhbHVlOiBpc0F1dG9GbGlwID09ICd0cnVlJywgaW5wdXRUeXBlOiAnc3dpdGNoJyB9LCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAvLyBjYXNlICdNaW51dGVzUGFzdE1lcmlkaWFuJzoKICAgICAgICAgICAgICAvLyAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMykgewogICAgICAgICAgICAgIC8vICAgICBjb25zdCBFYXN0TWludXRlc1Bhc3RNZXJpZGlhbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgIC8vICAgICBjb25zdCBXZXN0TWludXRlc1Bhc3RNZXJpZGlhbiA9IHBhcnRzWzJdOwogICAgICAgICAgICAgIC8vICAgICBsZXQgaXRlbSA9IHRoaXMuTW91bnRDb25maWdJdGVtcy5maW5kKGkgPT4gaS5sYWJlbCA9PT0gJ0Vhc3RNaW51dGVzUGFzdE1lcmlkaWFuJyk7CiAgICAgICAgICAgICAgLy8gICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgLy8gICAgICAgaXRlbS52YWx1ZSA9IEVhc3RNaW51dGVzUGFzdE1lcmlkaWFuOwogICAgICAgICAgICAgIC8vICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuTW91bnRDb25maWdJdGVtcy5wdXNoKHsgZHJpdmVyVHlwZTogJ01vdW50JywgbGFiZWw6ICdFYXN0TWludXRlc1Bhc3RNZXJpZGlhbicsIHZhbHVlOiBFYXN0TWludXRlc1Bhc3RNZXJpZGlhbixtaW46LTE4MCxtYXg6MTgwLCBpbnB1dFR5cGU6ICdudW1iZXInIH0sKTsKICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgIC8vICAgICBpdGVtID0gdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLmZpbmQoaSA9PiBpLmxhYmVsID09PSAnV2VzdE1pbnV0ZXNQYXN0TWVyaWRpYW4nKTsKICAgICAgICAgICAgICAvLyAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAvLyAgICAgICBpdGVtLnZhbHVlID0gV2VzdE1pbnV0ZXNQYXN0TWVyaWRpYW47CiAgICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLnB1c2goeyBkcml2ZXJUeXBlOiAnTW91bnQnLCBsYWJlbDogJ1dlc3RNaW51dGVzUGFzdE1lcmlkaWFuJywgdmFsdWU6IFdlc3RNaW51dGVzUGFzdE1lcmlkaWFuLG1pbjotMTgwLG1heDoxODAsIGlucHV0VHlwZTogJ251bWJlcicgfSwpOwogICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gICBicmVhazsKICAgICAgICAgICAgICBjYXNlICdFYXN0TWludXRlc1Bhc3RNZXJpZGlhbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEVhc3RNaW51dGVzUGFzdE1lcmlkaWFuID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLmZpbmQoaSA9PiBpLmxhYmVsID09PSAnRWFzdE1pbnV0ZXNQYXN0TWVyaWRpYW4nKTsKICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLnZhbHVlID0gRWFzdE1pbnV0ZXNQYXN0TWVyaWRpYW47CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLnB1c2goeyBkcml2ZXJUeXBlOiAnTW91bnQnLCBsYWJlbDogJ0Vhc3RNaW51dGVzUGFzdE1lcmlkaWFuJywgdmFsdWU6IEVhc3RNaW51dGVzUGFzdE1lcmlkaWFuLCBtaW46IC0xODAsIG1heDogMTgwLCBpbnB1dFR5cGU6ICdudW1iZXInIH0sKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnV2VzdE1pbnV0ZXNQYXN0TWVyaWRpYW4nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBXZXN0TWludXRlc1Bhc3RNZXJpZGlhbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuTW91bnRDb25maWdJdGVtcy5maW5kKGkgPT4gaS5sYWJlbCA9PT0gJ1dlc3RNaW51dGVzUGFzdE1lcmlkaWFuJyk7CiAgICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IFdlc3RNaW51dGVzUGFzdE1lcmlkaWFuOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuTW91bnRDb25maWdJdGVtcy5wdXNoKHsgZHJpdmVyVHlwZTogJ01vdW50JywgbGFiZWw6ICdXZXN0TWludXRlc1Bhc3RNZXJpZGlhbicsIHZhbHVlOiBXZXN0TWludXRlc1Bhc3RNZXJpZGlhbiwgbWluOiAtMTgwLCBtYXg6IDE4MCwgaW5wdXRUeXBlOiAnbnVtYmVyJyB9LCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ0dvdG9UaGVuU29sdmUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBHb3RvVGhlblNvbHZlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5Nb3VudENvbmZpZ0l0ZW1zLmZpbmQoaSA9PiBpLmxhYmVsID09PSAnR290b1RoZW5Tb2x2ZScpOwogICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBHb3RvVGhlblNvbHZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnYWRkRndobU5vdyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZndobSA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmVjZWl2ZWQgYWRkRndobU5vdzonLCBmd2htKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdhZGRGd2htTm93JywgZndobSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybign5pyq5aSE55CG5ZG95LukOiAnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZGF0YS50eXBlID09PSAnUVRfQ29uZmlybScpIHsKICAgICAgICAgIC8vIOWkhOeQhuehruiupOa2iOaBrwogICAgICAgICAgY29uc3QgbWVzc2FnZUlkID0gZGF0YS5tc2dpZDsKICAgICAgICAgIHRoaXMuaGFuZGxlTWVzc2FnZVJlc3BvbnNlKG1lc3NhZ2VJZCk7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdQcm9jZXNzX0NvbW1hbmQnKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnUHJvY2Vzc19Db21tYW5kOiAnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgLy8g5aSE55CG6L+U5Zue5raI5oGvCiAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGEubWVzc2FnZS5zcGxpdCgnOicpOwogICAgICAgICAgaWYgKHBhcnRzWzBdID09PSAncXRTZXJ2ZXJJc092ZXInKSB7CiAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdRVCBTZXJ2ZXIgaXMgb3ZlcicsICdlcnJvcicpOwogICAgICAgICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdyZXN0YXJ0JywgJ1FUIHNlcnZlciBlbmNvdW50ZXJlZCBhIHNlZ21lbnRhdGlvbiBmYXVsdCBvciBpcyBmcm96ZW4sIHBsZWFzZSByZXN0YXJ0IG9yIGV4aXQhJywgJ3Jlc3RhcnRRdFNlcnZlcicpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAocGFydHNbMF0gPT09ICdjaGVja0hhc05ld1VwZGF0ZVBhY2snKSB7CiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICBjb25zdCB2ZXJzaW9uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6I635Y+W5Yiw5pu05paw5YyF54mI5pysOiAnICsgdmVyc2lvbiwgJ2luZm8nKTsKCiAgICAgICAgICAgICAgdGhpcy5TaG93Q29uZmlybURpYWxvZygnRm9yY2VVcGRhdGUnLCB0aGlzLiR0KCdjaGVja0hhc05ld1VwZGF0ZVBhY2snKSArICc6ICcgKyB2ZXJzaW9uICsgJ++8jCcgKyB0aGlzLiR0KCd1cGRhdGVDb25maXJtJyksICd1cGRhdGVDdXJyZW50Q2xpZW50OicgKyB2ZXJzaW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAocGFydHNbMF0gPT09ICdOb191cGRhdGVfcGFja19mb3VuZCcpIHsKICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3godGhpcy4kdCgnTm9fdXBkYXRlX3BhY2tfZm91bmQnKSwgJ2Vycm9yJyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRzWzBdID09PSAndXBkYXRlX3Byb2dyZXNzJykgewogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3VwZGF0ZV9wcm9ncmVzcycsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRzWzBdID09PSAndXBkYXRlX2Vycm9yJykgewogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3VwZGF0ZV9lcnJvcicsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRzWzBdID09PSAndXBkYXRlX3N1Y2Nlc3MnKSB7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndXBkYXRlX3N1Y2Nlc3MnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgfSBlbHNlIGlmIChwYXJ0c1swXSA9PT0gJ3Rlc3RRdFNlcnZlclByb2Nlc3MnKSB7CgogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybign5pyq5aSE55CG5ZG95LukOiAnLCBkYXRhLm1lc3NhZ2UpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5yZWNlaXZlZE1lc3NhZ2VzLnB1c2goZGF0YS5tZXNzYWdlKTsgLy8g5bCG5o6l5pS25Yiw55qE5raI5oGv5re75Yqg5Yiw5pWw57uE5LitCiAgICAgIH07CgogICAgICB0aGlzLndlYnNvY2tldC5vbmVycm9yID0gKGVycm9yKSA9PiB7CiAgICAgICAgY29uc3QgZXJyb3JEZXRhaWxzID0gewogICAgICAgICAgdHlwZTogZXJyb3IudHlwZSwKICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgdXJsOiB0aGlzLldlYlNvY2tldFVybCwKICAgICAgICAgIHJlYWR5U3RhdGU6IHRoaXMud2Vic29ja2V0LnJlYWR5U3RhdGUsCiAgICAgICAgICBwcm90b2NvbDogdGhpcy53ZWJzb2NrZXQucHJvdG9jb2wsCiAgICAgICAgICBleHRlbnNpb25zOiB0aGlzLndlYnNvY2tldC5leHRlbnNpb25zCiAgICAgICAgfTsKICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgRXJyb3IgRGV0YWlsczonLCBlcnJvckRldGFpbHMpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1dlYlNvY2tldCBFcnJvcjogJyArIEpTT04uc3RyaW5naWZ5KGVycm9yRGV0YWlscyksICdlcnJvcicpOwogICAgICAgIHRoaXMud2Vic29ja2V0U3RhdGUgPSAnZXJyb3InOwogICAgICAgIHRoaXMubmV0d29ya0Rpc2Nvbm5lY3RlZCA9IHRydWU7CiAgICAgIH07CgogICAgICB0aGlzLndlYnNvY2tldC5vbmNsb3NlID0gKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBXZWJTb2NrZXQgZGlzY29ubmVjdGVkJyk7CiAgICAgICAgdGhpcy53ZWJzb2NrZXRTdGF0ZSA9ICdkaXNjb25uZWN0ZWQnOwogICAgICAgIHRoaXMubmV0d29ya0Rpc2Nvbm5lY3RlZCA9IHRydWU7IC8vIFdlYlNvY2tldOi/nuaOpeWFs+mXreaXtuiuvue9rue9kee7nOi/nuaOpeeKtuaAgQogICAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBXZWJTb2NrZXQgZGlzY29ubmVjdGVkJyk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93TmV0U3RhdHVzJywgJ2ZhbHNlJyk7CgogICAgICAgIC8vIOiuvue9ruS4gOS4quWumuaXtuWZqO+8jDHnp5LlkI7mo4Dmn6XnvZHnu5znirbmgIEKICAgICAgICB0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICBpZiAodGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkKSB7IC8vIOWmguaenDHnp5LlkI7ku43nhLbmlq3lvIAKICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1dlYlNvY2tldCBkaXNjb25uZWN0ZWQnLCAnZXJyb3InKTsKICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTAwMCk7IC8vIDHnp5LlkI7miafooYwKCiAgICAgICAgLy8g5ZCv5Yqo6Ieq5Yqo6YeN6L+eCiAgICAgICAgdGhpcy5yZWNvbm5lY3RXZWJTb2NrZXQoKTsKICAgICAgfTsKICAgIH0sCgogICAgLy8g6Ieq5Yqo6YeN6L+eCiAgICByZWNvbm5lY3RXZWJTb2NrZXQoKSB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBXZWJTb2NrZXQgcmVjb25uZWN0ZWQnKTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdXZWJTb2NrZXQgcmVjb25uZWN0ZWQuJywgJ2luZm8nKTsKICAgICAgICB0aGlzLmNvbm5lY3QoKTsKICAgICAgfSwgMjAwMCk7IC8vIDLnp5LlkI7lsJ3or5Xph43mlrDov57mjqUKICAgIH0sCiAgICAvLyDoh6rliqjph43ov54KCiAgICAvL+ebkeWQrOe9kee7nOi/nuaOpeeKtuaAgQogICAgc2V0dXBOZXR3b3JrU3RhdHVzTGlzdGVuZXIoKSB7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCAoKSA9PiB7CiAgICAgICAgLy8g5qOA5p+l5pat5byA6L+e5o6l55qE5a6a5pe25Zmo5piv5ZCm5bey57uP6Kem5Y+RCiAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdFRpbWVvdXRUcmlnZ2VyZWQpIHsKICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdXZWJTb2NrZXQgY29ubmVjdGVkJywgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGlzY29ubmVjdFRpbWVvdXQpOyAvLyDmuIXpmaTmlq3lvIDov57mjqXnmoTlrprml7blmagKICAgICAgICB0aGlzLm5ldHdvcmtEaXNjb25uZWN0ZWQgPSBmYWxzZTsgLy8g572R57uc5oGi5aSN5pe26YeN572u572R57uc6L+e5o6l54q25oCBCiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93TmV0U3RhdHVzJywgJ3RydWUnKTsKICAgICAgICB0aGlzLlN0YXR1c1JlY292ZXJ5KCk7CiAgICAgICAgdGhpcy5yZWNvbm5lY3RXZWJTb2NrZXQoKTsgLy8g572R57uc5oGi5aSN5ZCO6Ieq5Yqo6YeN6L+eV2ViU29ja2V0CiAgICAgIH0pOwoKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCAoKSA9PiB7CiAgICAgICAgdGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkID0gdHJ1ZTsgLy8g572R57uc5pat5byA5pe26K6+572u572R57uc6L+e5o6l54q25oCBCiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93TmV0U3RhdHVzJywgJ2ZhbHNlJyk7CiAgICAgICAgdGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCA9IGZhbHNlOyAvLyDliJ3lp4vljJbmlq3lvIDov57mjqXlrprml7blmajop6blj5HmoIflv5cKICAgICAgICAvLyDorr7nva7kuIDkuKrlrprml7blmajvvIwx56eS5ZCO5qOA5p+l572R57uc54q25oCBCiAgICAgICAgdGhpcy5kaXNjb25uZWN0VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgaWYgKHRoaXMubmV0d29ya0Rpc2Nvbm5lY3RlZCkgeyAvLyDlpoLmnpwx56eS5ZCO5LuN54S25pat5byACiAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdFRpbWVvdXRUcmlnZ2VyZWQgPSB0cnVlOyAvLyDmoIforrDlrprml7blmajlt7Lop6blj5EKICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1dlYlNvY2tldCBkaXNjb25uZWN0ZWQnLCAnZXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwKTsgLy8gMeenkuWQjuaJp+ihjAogICAgICB9KTsKICAgIH0sCiAgICAvL+ebkeWQrOe9kee7nOi/nuaOpeeKtuaAgQoKICAgIHNlbmRNZXNzYWdlKHR5cGUsIG1lc3NhZ2UpIHsKICAgICAgY29uc29sZS5sb2coIlFIWUNDRCB8IHNlbmRNZXNzYWdlOiAiLCBtZXNzYWdlKTsKCiAgICAgIGNvbnN0IG1lc3NhZ2VJZCA9IHRoaXMuZ2VuZXJhdGVNZXNzYWdlSWQoKTsgLy8g55Sf5oiQ5ZSv5LiA55qE5raI5oGvSUQKICAgICAgY29uc3QgbWVzc2FnZU9iaiA9IHsgdHlwZTogdHlwZSwgbXNnaWQ6IG1lc3NhZ2VJZCwgbWVzc2FnZTogbWVzc2FnZSB9OyAvLyDliJvlu7rljIXlkKvnsbvlnovlkozmtojmga/nmoTlr7nosaEKICAgICAgY29uc3QgbWVzc2FnZUpzb24gPSBKU09OLnN0cmluZ2lmeShtZXNzYWdlT2JqKTsgLy8g5bCG5raI5oGv5a+56LGh6L2s5o2i5Li6IEpTT04g5a2X56ym5LiyCiAgICAgIGNvbnN0IG1lc3NhZ2VTdGF0ZSA9IHsgbXNnaWQ6IG1lc3NhZ2VJZCwgdGV4dDogbWVzc2FnZUpzb24sIHN1Y2Nlc3M6IGZhbHNlIH07IC8vIOWIm+W7uuWMheWQq+a2iOaBr+WSjOeKtuaAgeS/oeaBr+eahOWvueixoQoKICAgICAgaWYgKHRoaXMud2Vic29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgdGhpcy53ZWJzb2NrZXQuc2VuZChtZXNzYWdlSnNvbik7CiAgICAgICAgLy8gbWVzc2FnZVN0YXRlLnN1Y2Nlc3MgPSB0cnVlOyAvLyDorr7nva7mtojmga/kuLrmiJDlip8KICAgICAgfQogICAgICB0aGlzLnNlbnRNZXNzYWdlcy5wdXNoKG1lc3NhZ2VTdGF0ZSk7IC8vIOa3u+WKoOa2iOaBr+WvueixoeWIsOW3suWPkemAgeeahOa2iOaBr+aVsOe7hAogICAgfSwKCiAgICBnZW5lcmF0ZU1lc3NhZ2VJZCgpIHsKICAgICAgLy8g5L2/55So5pe26Ze05oiz5ZKM6K6h5pWw5Zmo55Sf5oiQ5ZSv5LiA55qE5raI5oGvSUQKICAgICAgcmV0dXJuIERhdGUubm93KCkgKyAiLSIgKyAodGhpcy5tZXNzYWdlQ291bnRlcisrKTsKICAgIH0sCgogICAgaGFuZGxlTWVzc2FnZVJlc3BvbnNlKG1lc3NhZ2VJZCkgewogICAgICAvLyDmoLnmja7ov5Tlm57nmoTmtojmga9JROabtOaWsOa2iOaBr+WPkemAgeeKtuaAgQogICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IHRoaXMuc2VudE1lc3NhZ2VzW3RoaXMuc2VudE1lc3NhZ2VzLmxlbmd0aCAtIDFdOwogICAgICBpZiAobGFzdE1lc3NhZ2UgJiYgbGFzdE1lc3NhZ2UubXNnaWQgPT09IG1lc3NhZ2VJZCkgewogICAgICAgIGxhc3RNZXNzYWdlLnN1Y2Nlc3MgPSB0cnVlOwogICAgICB9CiAgICB9LAoKICAgIC8vIOa2iOaBr+ahhgogICAgY2FsbFNob3dNZXNzYWdlQm94KG1zZywgdHlwZSkgewogICAgICBjb25zb2xlLmxvZygnUUhZQ0NEIHwgY2FsbFNob3dNZXNzYWdlQm94OicsIG1zZywgdHlwZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2cobXNnLCB0eXBlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzaG93TXNnQm94JywgbXNnLCB0eXBlKTsKICAgIH0sCiAgICAvLyDmtojmga/moYYKCiAgICBsb2NhdGlvbkNsaWNrZWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdWdWVfQ29tbWFuZCcsICdsb2NhbE1lc3NhZ2UnKTsgLy8g6I635Y+W5L2N572u5L+h5oGvCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgndG9nZ2xlQm9vbCcsICdzaG93TG9jYXRpb25EaWFsb2cnKTsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnUmVzZXRUaW1lJyk7CiAgICB9LAoKICAgIFNldEN1cnJlbnRMb2NhdGlvbihsYXQsIGxuZywgaXNBdXRvKSB7CiAgICAgIGNvbnNvbGUubG9nKCdTZXRDdXJyZW50TG9jYXRpb246JywgbGF0LCAnLCcsIGxuZyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2VuZENvbnNvbGVMb2dNc2cnLCAnU2V0IEN1cnJlbnQgTG9jYXRpb246JyArIGxhdCArICcsJyArIGxuZywgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQb2xhclBvaW50QWx0aXR1ZGUnLCBsYXQpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3Jlc2V0TG9jYXRpb24nLCBsYXQsIGxuZywgaXNBdXRvKTsKICAgICAgY29uc3QgbG9jID0gewogICAgICAgIHNob3J0X25hbWU6ICdVbmtub3duJywKICAgICAgICBjb3VudHJ5OiAnVW5rbm93bicsCiAgICAgICAgbG5nOiBsbmcsCiAgICAgICAgbGF0OiBsYXQsCiAgICAgICAgYWx0OiAwLAogICAgICAgIGFjY3VyYWN5OiAwLAogICAgICAgIHN0cmVldF9hZGRyZXNzOiAnJwogICAgICB9CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VycmVudExvY2F0aW9uJywgbG9jKTsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2hvd1Bvc2l0aW9uSW5mbycsIGxhdCwgbG5nKTsKCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnUmVzZXRUaW1lJyk7CiAgICAgIH0sIDEwMDApOwogICAgfSwKICAgIC8vIOeKtuaAgeaBouWkjQogICAgU3RhdHVzUmVjb3ZlcnkoKSB7CiAgICAgIC8vIHRoaXMuc2VuZE1lc3NhZ2UoJ1NlbmRDb25zb2xlTG9nTXNnJywgJ+e9kee7nOi/nuaOpeaBouWkje+8jOaBouWkjeW9k+WJjeeKtuaAgSEnLCAnd2FybmluZycpOwogICAgICB0aGlzLmdldFFUQ2xpZW50VmVyc2lvbigpOyAgICAgICAgICAgICAgICAvLyDojrflj5ZRVENsaWVudOeJiOacrAogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRST0lJbmZvJyk7IC8vIOiOt+WPllJPSeS/oeaBrwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdsb2NhbE1lc3NhZ2UnKTsgLy8g6I635Y+W5L2N572u5L+h5oGvCiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2dldExhc3RTZWxlY3REZXZpY2UnKTsgLy8g6I635Y+W5LiK5LiA5qyh6YCJ5oup55qE6K6+5aSHCiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2dldE1haW5DYW1lcmFQYXJhbWV0ZXJzJyk7IC8vIOiOt+WPluS4u+ebuOacuuWPguaVsAogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRNb3VudFBhcmFtZXRlcnMnKTsgLy8g6I635Y+W6LWk6YGT5LuqVUnkv6Hmga8KICAgICAgdGhpcy5SZWNhbGlicmF0ZVBvbGFyQXhpcygpOyAvLyDph43mlrDmoKHlh4bmnoHovbQKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0U3RhZ2luZ1NvbHZlUmVzdWx0Jyk7IC8vIOiOt+WPluWumuagh+e7k+aenAogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRGb2N1c2VyTG9vcGluZ1N0YXRlJyk7IC8vIOiOt+WPlueEpui3neWZqOW+queOr+eKtuaAgQogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRTdGFnaW5nU2NoZWR1bGVEYXRhJyk7IC8vIOiOt+WPluWumuagh+iuoeWIkuaVsOaNrgogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRTdGFnaW5nU29sdmVSZXN1bHQnKTsgLy8g6I635Y+W5a6a5qCH57uT5p6cCiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2dldEdQSU9zU3RhdHVzJyk7IC8vIOiOt+WPlkdQSU/nirbmgIEKICAgICAgLy8gdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0U3RhZ2luZ0ltYWdlJyk7IC8vIOiOt+WPluacgOWQjuaLjeaRhOeahOWbvuWDjwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRQb2xhckFsaWdubWVudFN0YXRlJyk7IC8vIOiOt+WPluaegei9tOWvuem9kOeKtuaAgQoKCiAgICAgIHRoaXMuZGlzY29ubmVjdFRpbWVvdXRUcmlnZ2VyZWQgPSBmYWxzZTsKICAgIH0sCgogICAgb3BlblBvd2VyTWFuYWdlclBhZ2UoKSB7CiAgICAgIHRoaXMuaXNPcGVuRGV2aWNlUGFnZSA9IGZhbHNlOwogICAgICB0aGlzLmlzT3BlblBvd2VyUGFnZSA9IHRydWU7CgogICAgICB0aGlzLmRyYXdlcl8yID0gdHJ1ZTsKICAgIH0sCgogICAgUXVpdFRvTWFpbkFwcCgpIHsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnQnJvYWRjYXN0X01zZycsICdDbG9zZVdlYlZpZXcnKTsKICAgIH0sCgogICAgc2VsZWN0RGV2aWNlKGRldmljZSkgewogICAgICBpZiAoIXRoaXMuaGF2ZURldmljZUNvbm5lY3QgfHwgKHRoaXMuaGF2ZURldmljZUNvbm5lY3QpIHx8IGRldmljZS5kcml2ZXJUeXBlID09PSAnVGVsZXNjb3BlcycpIHsKICAgICAgICB0aGlzLmlzT3BlbkRldmljZVBhZ2UgPSB0cnVlOwogICAgICAgIHRoaXMuaXNPcGVuUG93ZXJQYWdlID0gZmFsc2U7CgogICAgICAgIGlmIChkZXZpY2UuaXNnZXQgPT09IGZhbHNlKSB7CiAgICAgICAgICAvLyBkZXZpY2UuaXNnZXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2VsZWN0SW5kaURyaXZlcjonICsgZGV2aWNlLnR5cGUgKyAiOiIgKyBkZXZpY2UuTGlzdE51bSk7CiAgICAgICAgICB0aGlzLmRyaXZlcnMgPSBbXTsKICAgICAgICB9CgogICAgICAgIHRoaXMuQ3VycmVudERyaXZlclR5cGUgPSBkZXZpY2UuZHJpdmVyVHlwZTsKICAgICAgICB0aGlzLkRldmljZUlzQ29ubmVjdGVkID0gZGV2aWNlLmlzQ29ubmVjdGVkOwogICAgICAgIHRoaXMuQmF1ZFJhdGVTZWxlY3RlZCA9IGRldmljZS5CYXVkUmF0ZTsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09ICdUZWxlc2NvcGVzJykgewogICAgICAgICAgdGhpcy5EZXZpY2VJc0Nvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmRyYXdlcl8yID0gdHJ1ZTsKCiAgICAgICAgdGhpcy5Ub0JlQ29ubmVjdERldmljZSA9IFtdOwogICAgICAgIHRoaXMuZGV2aWNlc0xpc3QuZm9yRWFjaChkZXZpY2VzTGlzdCA9PiB7CiAgICAgICAgICBpZiAoZGV2aWNlc0xpc3QudHlwZSA9PT0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZSkgewogICAgICAgICAgICB0aGlzLlRvQmVDb25uZWN0RGV2aWNlLnB1c2goZGV2aWNlc0xpc3QpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdUaGUgZGV2aWNlIGlzIG5vdCBjb25uZWN0ZWQuJywgJ2Vycm9yJyk7CiAgICAgIH0KCiAgICB9LAoKICAgIEN1cnJlbnRDb25maWdJdGVtcygpIHsKICAgICAgY29uc29sZS5sb2coJ0N1cnJlbnRDb25maWdJdGVtczogJywgdGhpcy5DdXJyZW50RHJpdmVyVHlwZSArICdDb25maWdJdGVtcycpOwogICAgICBzd2l0Y2ggKHRoaXMuQ3VycmVudERyaXZlclR5cGUpIHsKICAgICAgICBjYXNlICdHdWlkZXInOgogICAgICAgICAgcmV0dXJuIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXM7CiAgICAgICAgY2FzZSAnTWFpbkNhbWVyYSc6CiAgICAgICAgICByZXR1cm4gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXM7CiAgICAgICAgY2FzZSAnTW91bnQnOgogICAgICAgICAgcmV0dXJuIHRoaXMuTW91bnRDb25maWdJdGVtczsKICAgICAgICBjYXNlICdUZWxlc2NvcGVzJzoKICAgICAgICAgIHJldHVybiB0aGlzLlRlbGVzY29wZXNDb25maWdJdGVtczsKICAgICAgICBjYXNlICdGb2N1c2VyJzoKICAgICAgICAgIHJldHVybiB0aGlzLkZvY3VzZXJDb25maWdJdGVtczsKICAgICAgICBjYXNlICdQb2xlQ2FtZXJhJzoKICAgICAgICAgIHJldHVybiB0aGlzLlBvbGVDYW1lcmFDb25maWdJdGVtczsKICAgICAgICBjYXNlICdDRlcnOgogICAgICAgICAgcmV0dXJuIHRoaXMuQ0ZXQ29uZmlnSXRlbXM7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgfSwKCiAgICBjb25maXJtRHJpdmVyKCkgewogICAgICAvLyDnoa7lrprpqbHliqjnmoTpgLvovpEKICAgICAgY29uc29sZS5sb2coIlFIWUNDRCB8IGNvbmZpcm1Ecml2ZXI6ICIsIHRoaXMuc2VsZWN0ZWREcml2ZXIpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDb25maXJtIEluZGkgRHJpdmVyOicgKyB0aGlzLnNlbGVjdGVkRHJpdmVyLCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NvbmZpcm1JbmRpRHJpdmVyOicgKyB0aGlzLnNlbGVjdGVkRHJpdmVyICsgJzonICsgdGhpcy5CYXVkUmF0ZVNlbGVjdGVkKTsKICAgICAgdGhpcy5jb25maXJtRHJpdmVyVHlwZSA9IHRoaXMuQ3VycmVudERyaXZlclR5cGU7CiAgICAgIHRoaXMubG9hZGluZ1NlbGVjdERyaXZlciA9IHRydWU7CgogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZSkgewogICAgICAgICAgZGV2aWNlLmRldmljZSA9IHRoaXMuc2VsZWN0ZWREcml2ZXI7CiAgICAgICAgICBkZXZpY2UuZHJpdmVyTmFtZSA9IHRoaXMuc2VsZWN0ZWREcml2ZXI7CiAgICAgICAgICBkZXZpY2UuQmF1ZFJhdGUgPSB0aGlzLkJhdWRSYXRlU2VsZWN0ZWQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhckRyaXZlcigpIHsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdDbGVhckluZGlEcml2ZXInKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2xlYXIgSW5kaSBEcml2ZXInLCAnaW5mbycpOwogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZSkgewogICAgICAgICAgZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgZGV2aWNlLmRyaXZlck5hbWUgPSAnJzsKICAgICAgICAgIGRldmljZS5CYXVkUmF0ZSA9IDk2MDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zZWxlY3RlZERyaXZlciA9ICcnOwogICAgfSwKICAgIGNvbmZpcm1EZXZpY2UoKSB7CiAgICAgIC8vIOehruWumuiuvuWkh+eahOmAu+i+kQogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NvbmZpcm1JbmRpRGV2aWNlOicgKyB0aGlzLnNlbGVjdGVkRGV2aWNlICsgJzonICsgdGhpcy5zZWxlY3RlZERyaXZlcik7CiAgICAgIC8vIHRoaXMuJGJ1cy4kZW1pdCgnQXBwVXBkYXRlRGV2aWNlcycsIHRoaXMuQ3VycmVudERyaXZlclR5cGUsIHRoaXMuc2VsZWN0ZWREZXZpY2UpOwogICAgICB0aGlzLnVwZGF0ZURldmljZXModGhpcy5DdXJyZW50RHJpdmVyVHlwZSwgdGhpcy5zZWxlY3RlZERldmljZSk7CiAgICB9LAoKICAgIHVwZGF0ZURldmljZXMoZHJpdmVyVHlwZSwgbmV3RGV2aWNlKSB7ICAgIC8vIOaJi+WKqOmAieaLqQogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZHJpdmVyVHlwZSkgewogICAgICAgICAgZGV2aWNlLmRldmljZSA9IG5ld0RldmljZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICB1cGRhdGVEZXZpY2VzXyhMaXN0TnVtLCBuZXdEZXZpY2UpIHsgICAgLy8g5LuO5paH5Lu25a+85YWlCiAgICAgIHRoaXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgaWYgKGRldmljZS5MaXN0TnVtID09PSBMaXN0TnVtKSB7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gbmV3RGV2aWNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMubG9hZGluZ0Nvbm5lY3RBbGxEZXZpY2UgPSBmYWxzZTsKICAgIH0sCgogICAgdXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgRGV2aWNlTmFtZSwgRHJpdmVyTmFtZSwgaXNCaW5kID0gdHJ1ZSkgeyAgICAvLyDov57mjqXmiJDlip8KICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygndXBkYXRlRGV2aWNlc0Nvbm5lY3QnICsgdHlwZSArICcgJyArIERldmljZU5hbWUgKyAnICcgKyBEcml2ZXJOYW1lICsgJyAnICsgaXNCaW5kLCAnaW5mbycpOwogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gdHlwZSkgewogICAgICAgICAgaWYgKGlzQmluZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBEZXZpY2VOYW1lOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGV2aWNlLmRldmljZSA9ICJOb3QgQmluZCBEZXZpY2UiOwogICAgICAgICAgfQogICAgICAgICAgZGV2aWNlLmRyaXZlck5hbWUgPSBEcml2ZXJOYW1lOwogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChEZXZpY2VOYW1lICsgJyBzdWNjZXNzIGNvbm5lY3RlZCcsICdzdWNjZXNzJyk7CiAgICAgIHRoaXMuaGF2ZURldmljZUNvbm5lY3QgPSB0cnVlOwogICAgICB0aGlzLmxvYWRpbmdDb25uZWN0QWxsRGV2aWNlID0gZmFsc2U7CgogICAgICBpZiAodHlwZSA9PT0gJ01haW5DYW1lcmEnKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmEgaXMgQ29ubmVjdGVkLicpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdNb3VudCcpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01vdW50IGlzIENvbm5lY3RlZC4nKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnQ0ZXJykgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01vdW50IGlzIENvbm5lY3RlZC4nKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnRm9jdXNlcicpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ZvY3VzZXJDb25uZWN0ZWQnLCAxKTsKICAgICAgICBjb25zb2xlLmxvZygnRm9jdXNlciBpcyBDb25uZWN0ZWQuJyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ0d1aWRlcicpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDEpOwogICAgICAgIGNvbnNvbGUubG9nKCdHdWlkZXIgaXMgQ29ubmVjdGVkLicpOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVEZXZpY2VzQ29ubmVjdDogJywgdHlwZSwgRGV2aWNlTmFtZSwgRHJpdmVyTmFtZSwgaXNCaW5kKTsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnRGV2aWNlQ29ubmVjdFN1Y2Nlc3MnLCB0eXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc0JpbmQpOwogICAgfSwKICAgIHN0YXJ0Q29ubmVjdEJ0blByZXNzKGV2ZW50KSB7CiAgICAgIC8vIOWmguaenOaYr+inpuaRuOS6i+S7tu+8jOagh+iusOW5tuWkhOeQhgogICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7CiAgICAgICAgdGhpcy5pc1RvdWNoaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcyA9IGZhbHNlOyAvLyDph43nva7plb/mjInmoIforrAKICAgICAgICAvLyB0aGlzLkNvbm5lY3RCdG5QcmVzc1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gICB0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcyA9IHRydWU7IC8vIOagh+iusOS4uumVv+aMiQogICAgICAgIC8vICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuTG9uZ1ByZXNzKCk7CiAgICAgICAgLy8gfSwgdGhpcy5Db25uZWN0QnRubG9uZ1ByZXNzVGhyZXNob2xkKTsKICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RCdG5DbGljaygpOwogICAgICB9CiAgICAgIC8vIOWmguaenOaYr+m8oOagh+S6i+S7tu+8jOS4lOayoeacieato+WcqOi/m+ihjOeahOinpuaRuOS6i+S7tu+8jOWImeWkhOeQhgogICAgICBlbHNlIGlmIChldmVudC50eXBlID09PSAnbW91c2Vkb3duJyAmJiAhdGhpcy5pc1RvdWNoaW5nKSB7CiAgICAgICAgdGhpcy5pc0Nvbm5lY3RCdG5Mb25nUHJlc3MgPSBmYWxzZTsgLy8g6YeN572u6ZW/5oyJ5qCH6K6wCiAgICAgICAgLy8gdGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgdGhpcy5pc0Nvbm5lY3RCdG5Mb25nUHJlc3MgPSB0cnVlOyAvLyDmoIforrDkuLrplb/mjIkKICAgICAgICAvLyAgIHRoaXMuaGFuZGxlQ29ubmVjdEJ0bkxvbmdQcmVzcygpOwogICAgICAgIC8vIH0sIHRoaXMuQ29ubmVjdEJ0bmxvbmdQcmVzc1RocmVzaG9sZCk7CiAgICAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuQ2xpY2soKTsKICAgICAgfQogICAgfSwKICAgIGVuZENvbm5lY3RCdG5QcmVzcyhldmVudCkgewogICAgICAvLyDlpoLmnpzmmK/op6bmkbjkuovku7bvvIzlpITnkIblubbph43nva7moIforrAKICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICd0b3VjaGVuZCcpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lcik7IC8vIOa4hemZpOWumuaXtuWZqAogICAgICAgIC8vIGlmICghdGhpcy5pc0Nvbm5lY3RCdG5Mb25nUHJlc3MpIHsKICAgICAgICAvLyAgIHRoaXMuaGFuZGxlQ29ubmVjdEJ0bkNsaWNrKCk7IC8vIOWmguaenOS4jeaYr+mVv+aMie+8jOWImeinpuWPkeeCueWHu+S6i+S7tgogICAgICAgIC8vIH0KICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RCdG5DbGljaygpOwogICAgICAgIHRoaXMuQ29ubmVjdEJ0blByZXNzVGltZXIgPSBudWxsOyAvLyDph43nva7lrprml7blmagKICAgICAgICB0aGlzLmlzVG91Y2hpbmcgPSBmYWxzZTsgLy8g6YeN572u6Kem5pG45qCH6K6wCiAgICAgIH0KICAgICAgLy8g5aaC5p6c5piv6byg5qCH5LqL5Lu277yM5LiU5rKh5pyJ5q2j5Zyo6L+b6KGM55qE6Kem5pG45LqL5Lu277yM5YiZ5aSE55CGCiAgICAgIGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdtb3VzZXVwJyAmJiAhdGhpcy5pc1RvdWNoaW5nKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuQ29ubmVjdEJ0blByZXNzVGltZXIpOyAvLyDmuIXpmaTlrprml7blmagKICAgICAgICAvLyBpZiAoIXRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzKSB7CiAgICAgICAgLy8gICB0aGlzLmhhbmRsZUNvbm5lY3RCdG5DbGljaygpOyAvLyDlpoLmnpzkuI3mmK/plb/mjInvvIzliJnop6blj5Hngrnlh7vkuovku7YKICAgICAgICAvLyB9CiAgICAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuQ2xpY2soKTsKICAgICAgICB0aGlzLkNvbm5lY3RCdG5QcmVzc1RpbWVyID0gbnVsbDsgLy8g6YeN572u5a6a5pe25ZmoCiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVDb25uZWN0QnRuQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmhhdmVEZXZpY2VDb25uZWN0KSB7CiAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1BsZWFzZSBkaXNjb25uZWN0IGFsbCBkZXZpY2VzIGZpcnN0LicsICdlcnJvcicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIXRoaXMuQ29ubmVjdEJ0bkNhbkNsaWNrKSByZXR1cm47IC8vIOWmguaenOS4jeWPr+eCueWHu++8jOebtOaOpei/lOWbngogICAgICB0aGlzLkNvbm5lY3RCdG5DYW5DbGljayA9IGZhbHNlOyAvLyDorr7nva7kuLrkuI3lj6/ngrnlh7sKICAgICAgY29uc29sZS5sb2coIkNvbm5lY3QgQnV0dG9uIGNsaWNrZWQiKTsKCiAgICAgIHRoaXMuY29ubmVjdEFsbERldmljZSgpOwoKICAgICAgLy8g5oGi5aSN54K55Ye75p2D6ZmQCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuQ29ubmVjdEJ0bkNhbkNsaWNrID0gdHJ1ZTsKICAgICAgfSwgMTAwMCk7IC8vIDHnp5LlkI7mgaLlpI0KICAgIH0sCiAgICBoYW5kbGVDb25uZWN0QnRuTG9uZ1ByZXNzKCkgewogICAgICBpZiAodGhpcy5oYXZlRGV2aWNlQ29ubmVjdCkgewogICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdQbGVhc2UgZGlzY29ubmVjdCBhbGwgZGV2aWNlcyBmaXJzdC4nLCAnZXJyb3InKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g6ZW/5oyJ5LqL5Lu255qE5aSE55CGCiAgICAgIGNvbnNvbGUubG9nKCJDb25uZWN0IEJ1dHRvbiBsb25nIHByZXNzZWQiKTsKCiAgICAgIHRoaXMuYXV0b0Nvbm5lY3RBbGxEZXZpY2UoKTsKICAgIH0sCiAgICBjb25uZWN0QWxsRGV2aWNlKCkgewogICAgICBjb25zb2xlLmxvZygiUUhZQ0NEIHwgY29ubmVjdEFsbERldmljZS4iKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ29ubmVjdCBBbGwgRGV2aWNlJywgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnY29ubmVjdEFsbERldmljZScpOwogICAgICB0aGlzLmxvYWRpbmdDb25uZWN0QWxsRGV2aWNlID0gdHJ1ZTsKICAgIH0sCiAgICBhdXRvQ29ubmVjdEFsbERldmljZSgpIHsKICAgICAgY29uc29sZS5sb2coIlFIWUNDRCB8IGF1dG9Db25uZWN0QWxsRGV2aWNlLiIpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdBdXRvIENvbm5lY3QgQWxsIERldmljZScsICdpbmZvJyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2F1dG9Db25uZWN0QWxsRGV2aWNlJyk7CiAgICAgIHRoaXMubG9hZGluZ0Nvbm5lY3RBbGxEZXZpY2UgPSB0cnVlOwogICAgfSwKCiAgICBkaXNjb25uZWN0QWxsRGV2aWNlKGNvbmZpcm0pIHsKICAgICAgLy8g5qOA5p+l5piv5ZCm5pyJ6K6+5aSH55qEIGlzQ29ubmVjdGVkIOWxnuaAp+S4uiB0cnVlCiAgICAgIC8vIGNvbnN0IGhhc0Nvbm5lY3RlZERldmljZXMgPSB0aGlzLmRldmljZXMuc29tZShkZXZpY2UgPT4gZGV2aWNlLmlzQ29ubmVjdGVkKTsKCiAgICAgIGlmICh0aGlzLmhhdmVEZXZpY2VDb25uZWN0KSB7CiAgICAgICAgaWYgKGNvbmZpcm0gPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdDb25maXJtJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkaXNjb25uZWN0IGFsbCBkZXZpY2VzPycsICdkaXNjb25uZWN0QWxsRGV2aWNlJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0Rpc2Nvbm5lY3QgQWxsIERldmljZScsICdpbmZvJyk7CiAgICAgICAgICB0aGlzLmhhdmVEZXZpY2VDb25uZWN0ID0gZmFsc2U7CiAgICAgICAgICAvLyB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgICAgLy8gICBkZXZpY2UuaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgIC8vICAgLy8gZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgLy8gfSk7CgogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NGV0Nvbm5lY3RlZCcsIDApOwogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdGb2N1c2VyQ29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDApOwogICAgICAgICAgdGhpcy5jbGVhckRldmljZUxpc3QoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ05vIGRldmljZXMgaGF2ZSBiZWVuIGNvbm5lY3RlZC4nLCAnZXJyb3InKTsKICAgICAgfQogICAgICB0aGlzLnNlbGVjdGVkRHJpdmVyID0gJyc7CiAgICB9LAoKICAgIGNsZWFyRGV2aWNlTGlzdCgpIHsKICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICBkZXZpY2UuZGV2aWNlID0gZGV2aWNlLmRyaXZlck5hbWU7CiAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAgICAgZGV2aWNlLkJhdWRSYXRlID0gOTYwMDsKICAgICAgfSk7CiAgICAgIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UgPSBbXTsKICAgICAgdGhpcy5kZXZpY2VzTGlzdCA9IFtdOwogICAgICB0aGlzLmRyaXZlcnMgPSBbXTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdjbGVhckRldmljZUFsbG9jYXRpb25MaXN0Jyk7CiAgICB9LAoKICAgIFN3aXRjaE91dFB1dFBvd2VyKGluZGV4LCBpc1Bvd2VyT04pIHsKICAgICAgaWYgKGlzUG93ZXJPTikgewogICAgICAgIHRoaXMuZHJhd2VyXzIgPSBmYWxzZTsKICAgICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdPdXRwdXQgUG93ZXI6JyArIGluZGV4LCAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHR1cm4gb2ZmIHRoaXMgb3V0cHV0IHBvd2VyPycsICdTd2l0Y2hPdXRQdXRQb3dlcicpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnU3dpdGNoT3V0UHV0UG93ZXI6JyArIGluZGV4KTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTd2l0Y2ggT3V0UHV0UG93ZXInICsgaW5kZXgsICdpbmZvJyk7CiAgICAgIH0KICAgIH0sCgogICAgUmVzdGFydFJhc3BiZXJyeVBpKCkgewogICAgICB0aGlzLmRyYXdlcl8yID0gZmFsc2U7CiAgICAgIHRoaXMuU2hvd0NvbmZpcm1EaWFsb2coJ1Jlc3RhcnQnLCAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlc3RhcnQgdGhlIFJhc3BiZXJyeSBQaT8nLCAnUmVzdGFydFJhc3BiZXJyeVBpJyk7CiAgICB9LAoKICAgIFNodXRkb3duUmFzcGJlcnJ5UGkoKSB7CiAgICAgIHRoaXMuZHJhd2VyXzIgPSBmYWxzZTsKICAgICAgdGhpcy5TaG93Q29uZmlybURpYWxvZygnU2h1dCBEb3duJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBzaHV0IGRvd24gdGhlIFJhc3BiZXJyeSBQaT8nLCAnU2h1dGRvd25SYXNwYmVycnlQaScpOwogICAgfSwKCiAgICBGb3JjZVVwZGF0ZSgpIHsKICAgICAgdGhpcy5kcmF3ZXJfMiA9IGZhbHNlOwogICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdGb3JjZSBVcGRhdGUnLCAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGZvcmNlIHVwZGF0ZSB0aGUgUmFzcGJlcnJ5IFBpPycsICdGb3JjZVVwZGF0ZScpOwogICAgfSwKCiAgICBSZXR1cm5Db25uZWN0ZWREZXZpY2VzKCkgewogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gJ01haW5DYW1lcmEnKSB7CiAgICAgICAgICBpZiAoZGV2aWNlLmlzQ29ubmVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYUNvbm5lY3RlZCcsIDEpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbkNhbWVyYSBpcyBDb25uZWN0ZWQuJyk7CiAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ01haW5DYW1lcmEgaXMgQ29ubmVjdGVkLicsICdpbmZvJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gJ01vdW50JykgewogICAgICAgICAgaWYgKGRldmljZS5pc0Nvbm5lY3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNb3VudCBpcyBDb25uZWN0ZWQuJyk7CiAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ01vdW50IGlzIENvbm5lY3RlZC4nLCAnaW5mbycpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2xvYWRTZWxlY3RlZERyaXZlckxpc3QnKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnbG9hZEJpbmREZXZpY2VMaXN0Jyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2xvYWRCaW5kRGV2aWNlVHlwZUxpc3QnKTsKICAgIH0sCgogICAgT3BlbklhbWdlRm9sZGVyKCkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ0ltYWdlTWFuYWdlclBhbmVsT3BlbicpOwogICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgfSwKCiAgICBPcGVuRGVidWdMb2coKSB7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndG9nZ2xlSU5ESURlYnVnRGlhbG9nJyk7CiAgICAgIHRoaXMubmF2ID0gZmFsc2U7CiAgICB9LAoKICAgIFNlbmRDb25zb2xlTG9nTXNnKG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgaWYgKHR5cGUgPT0gJ2Vycm9yJykgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiAnICsgbWVzc2FnZSk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZW5kQ29uc29sZUxvZycsIHR5cGUsIG1lc3NhZ2UpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ2luZm8nKSB7CiAgICAgICAgY29uc29sZS5sb2coJ0luZm86ICcgKyBtZXNzYWdlKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NlbmRDb25zb2xlTG9nJywgdHlwZSwgbWVzc2FnZSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnd2FybmluZycpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1dhcm5pbmc6ICcgKyBtZXNzYWdlKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NlbmRDb25zb2xlTG9nJywgdHlwZSwgbWVzc2FnZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coJ0RlYnVnOiAnICsgbWVzc2FnZSk7CiAgICAgIH0KICAgIH0sCgogICAgRGV2aWNlQWxsb2NhdGlvbigpIHsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCd0b2dnbGVEZXZpY2VBbGxvY2F0aW9uUGFuZWwnKTsKICAgICAgdGhpcy5uYXYgPSBmYWxzZTsKICAgIH0sCgogICAgLy8gQ3VycmVudEV4cFRpbWVMaXN0KGluZGV4LCB2YWx1ZSkgewogICAgLy8gICBjb25zdCBleHBUaW1lSW5kZXggPSB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnRXhwVGltZSBbJyArIChpbmRleCArIDEpICsgJ10nKTsKICAgIC8vICAgaWYgKGV4cFRpbWVJbmRleCAhPT0gLTEpIHsgLy8g56Gu5L+d5om+5Yiw5LqG5a+55bqU55qE6YWN572u6aG5CiAgICAvLyAgICAgLy8g5pu05pawIEV4cFRpbWUxIOmFjee9rumhueeahOWAvAogICAgLy8gICAgIHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zW2V4cFRpbWVJbmRleF0udmFsdWUgPSB2YWx1ZTsKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICBjb25zb2xlLmVycm9yKCdFeHBUaW1lIFsnICsgaW5kZXggKyAnXSBjb25maWd1cmF0aW9uIGl0ZW0gbm90IGZvdW5kLicpOwogICAgLy8gICB9CiAgICAvLyB9LAoKICAgIEN1cnJlbnRDRldMaXN0KGluZGV4LCB2YWx1ZSkgewogICAgICBjb25zdCBleHBUaW1lSW5kZXggPSB0aGlzLkNGV0NvbmZpZ0l0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdDRlcgWycgKyAoaW5kZXggKyAxKSArICddJyk7CiAgICAgIGlmIChleHBUaW1lSW5kZXggIT09IC0xKSB7IC8vIOehruS/neaJvuWIsOS6huWvueW6lOeahOmFjee9rumhuQogICAgICAgIC8vIOabtOaWsCBFeHBUaW1lMSDphY3nva7pobnnmoTlgLwKICAgICAgICB0aGlzLkNGV0NvbmZpZ0l0ZW1zW2V4cFRpbWVJbmRleF0udmFsdWUgPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdDRlcgWycgKyBpbmRleCArICddIGNvbmZpZ3VyYXRpb24gaXRlbSBub3QgZm91bmQuJyk7CiAgICAgIH0KICAgIH0sCgogICAgY29uZmlybUNvbmZpZ3VyYXRpb24oTGlzdCkgewogICAgICBMaXN0LmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhpdGVtLmxhYmVsLCBpdGVtLnZhbHVlKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coaXRlbS5sYWJlbCArICc6JyArIGl0ZW0udmFsdWUsICdpbmZvJyk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCArICc6JyArIGl0ZW0udmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbS52YWx1ZSA9PSAnJyAmJiBpdGVtLmxhYmVsID09PSAnRm9jYWwgTGVuZ3RoIChtbSknKSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKGl0ZW0ubGFiZWwgKyAnaXMgTlVMTCcsICdpbmZvJyk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCArICc6Jyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ0NvbmZpZ3VyYXRpb24gaGFzIGJlZW4gbW9kaWZpZWQhJywgJ3N1Y2Nlc3MnKTsKICAgIH0sCgogICAgbG9hZEFuZERpc3BsYXlJbWFnZShpbWFnZVBhdGgpIHsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d1aWRlckNhbWVyYS1jYW52YXMnKTsKICAgICAgLy8gY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5DYW1lcmEtY2FudmFzJyk7CiAgICAgIGlmIChjYW52YXMuZ2V0Q29udGV4dCkgewogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOwoKICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgY2FudmFzLndpZHRoID0gaW1nLndpZHRoOwogICAgICAgICAgY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7CiAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7CiAgICAgICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ3Nob3dTb2x2ZUltYWdlJywgaW1nKTsKICAgICAgICB9OwoKICAgICAgICAvLyDmt7vliqDplJnor6/lpITnkIYKICAgICAgICBpbWcub25lcnJvciA9IChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coYOWKoOi9veWbvuWDj+Wksei0pTogJHtpbWFnZVBhdGh9YCk7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKGDliqDovb3lm77lg4/lpLHotKU6ICR7aW1hZ2VQYXRofWAsICdlcnJvcicpOwogICAgICAgIH07CgogICAgICAgIGltZy5zcmMgPSBpbWFnZVBhdGg7CiAgICAgIH0KICAgIH0sCgogICAgSW1hZ2VHYWluU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgZG91YmxlVmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsgLy8g5bCG5YC86L2s5o2i5Li6IGRvdWJsZSDnsbvlnosKCiAgICAgIGlmIChzaWduYWwgPT09ICdJbWFnZUdhaW5SJykgewogICAgICAgIC8vIOWkhOeQhiBJbWFnZUdhaW5SIOS/oeWPtwogICAgICAgIHRoaXMuSW1hZ2VHYWluUiA9IGRvdWJsZVZhbHVlOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0ltYWdlR2FpblIgaXMgc2V0IHRvOicgKyBkb3VibGVWYWx1ZSwgJ2luZm8nKTsKICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdJbWFnZUdhaW5SOicgKyBkb3VibGVWYWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAoc2lnbmFsID09PSAnSW1hZ2VHYWluQicpIHsKICAgICAgICAvLyDlpITnkIYgSW1hZ2VHYWluQiDkv6Hlj7cKICAgICAgICB0aGlzLkltYWdlR2FpbkIgPSBkb3VibGVWYWx1ZTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZUdhaW5CIGlzIHNldCB0bzonICsgZG91YmxlVmFsdWUsICdpbmZvJyk7CiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnSW1hZ2VHYWluQjonICsgZG91YmxlVmFsdWUpOwogICAgICB9CiAgICB9LAoKICAgIEltYWdlT2Zmc2V0U2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgZG91YmxlVmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsgLy8g5bCG5YC86L2s5o2i5Li6IGRvdWJsZSDnsbvlnosKCiAgICAgIHRoaXMuSW1hZ2VPZmZzZXQgPSBkb3VibGVWYWx1ZTsKICAgICAgY29uc29sZS5sb2coJ0ltYWdlIE9mZnNldCBpcyBzZXQgdG86JywgZG91YmxlVmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZSBPZmZzZXQgaXMgc2V0IHRvOicgKyBkb3VibGVWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnSW1hZ2VPZmZzZXQ6JyArIGRvdWJsZVZhbHVlKTsKICAgIH0sCgogICAgQmlubmluZ1NldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogSW50IOexu+WeiwogICAgICB0aGlzLmNhbWVyYUJpbiA9IEludFZhbHVlOwogICAgICBjb25zb2xlLmxvZygnSW1hZ2UgQmlubmluZyBpcyBzZXQgdG86JywgSW50VmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZSBCaW5uaW5nIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ1NldEJpbm5pbmc6JyArIEludFZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRCaW5uaW5nTnVtJywgSW50VmFsdWUpOwogICAgfSwKCiAgICBHYWluU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBJbnQg57G75Z6LCgogICAgICBjb25zb2xlLmxvZygnQ2FtZXJhIEdhaW4gaXMgc2V0IHRvOicsIEludFZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FtZXJhIEdhaW4gaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2V0Q2FtZXJhR2FpbjonICsgSW50VmFsdWUpOwogICAgfSwKCiAgICBPZmZzZXRTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsgLy8g5bCG5YC86L2s5o2i5Li6IEludCDnsbvlnosKCiAgICAgIGNvbnNvbGUubG9nKCdDYW1lcmEgT2Zmc2V0IGlzIHNldCB0bzonLCBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhbWVyYSBPZmZzZXQgaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2V0Q2FtZXJhT2Zmc2V0OicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIEltYWdlQ0ZBU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKCiAgICAgIC8vIGlmIChbJ0dSJywgJ0dCJywgJ0JHJywgJ1JHR0InLCdudWxsJ10uaW5jbHVkZXModmFsdWUpKSB7CiAgICAgIGlmIChbJ0dSJywgJ0dCJywgJ0JHJywgJ1JHJywgJ0dSQkcnLCAnR0JSRycsICdCR0dSJywgJ1JHR0InLCAnbnVsbCcsICcnXS5pbmNsdWRlcyh2YWx1ZSkpIHsKICAgICAgICBpZiAodmFsdWUgPT09ICcnKSB7CiAgICAgICAgICB2YWx1ZSA9ICdudWxsJzsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnR1JCRycpIHsKICAgICAgICAgIHZhbHVlID0gJ0dSJzsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnR0JSRycpIHsKICAgICAgICAgIHZhbHVlID0gJ0dCJzsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnQkdHUicpIHsKICAgICAgICAgIHZhbHVlID0gJ0JHJzsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnUkcnKSB7CiAgICAgICAgICB2YWx1ZSA9ICdSR0dCJzsKICAgICAgICB9CiAgICAgICAgdGhpcy5JbWFnZUNGQSA9IHZhbHVlOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCdJbWFnZUNGQSBpcyBzZXQgdG86JywgdmFsdWUpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0ltYWdlQ0ZBIGlzIHNldCB0bzonICsgdmFsdWUsICdpbmZvJyk7CiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnSW1hZ2VDRkE6JyArIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhgSW52YWxpZCB2YWx1ZSBmb3IgSW1hZ2VDRkE6ICcke3ZhbHVlfScuIFBsZWFzZSBzZXQgaXQgdG8gb25lIG9mICdHUicsICdHQicsICdCRycsICdSR0dCJy5gKTsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChgSW52YWxpZCB2YWx1ZSBmb3IgSW1hZ2VDRkE6ICcke3ZhbHVlfScuIFBsZWFzZSBzZXQgaXQgdG8gb25lIG9mICdHUicsICdHQicsICdCRycsICdSR0dCJy5gLCAnZXJyb3InKTsKICAgICAgfQogICAgfSwKCiAgICBDYW1lcmFUZW1wZXJhdHVyZVNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogSW50IOexu+WeiwoKICAgICAgY29uc29sZS5sb2coJ0NhbWVyYSBUZW1wZXJhdHVyZSBpcyBzZXQgdG86JywgSW50VmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYW1lcmEgVGVtcGVyYXR1cmUgaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2V0Q2FtZXJhVGVtcGVyYXR1cmU6JyArIEludFZhbHVlKTsKICAgIH0sCgogICAgRm9jYWxMZW5ndGhTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAoKICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSAnVGVsZXNjb3BlcycpIHsKCiAgICAgICAgICBpZiAodmFsdWUgPT09ICcnIHx8IHZhbHVlID09PSBOYU4pIHsKICAgICAgICAgICAgZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGb2NhbCBMZW5ndGggaXMgc2V0IHRvOicgKyAwLCAnaW5mbycpOwogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NldEZvY2FsTGVuZ3RoTnVtJywgJycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBJbnQg57G75Z6LCiAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSB2YWx1ZSArICcgbW0nOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGb2NhbCBMZW5ndGggaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRGb2NhbExlbmd0aE51bScsIEludFZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCgogICAgfSwKCiAgICBHdWlkZXJGb2NhbExlbmd0aFNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogSW50IOexu+WeiwoKCiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0d1aWRlciBGb2NhbCBMZW5ndGggaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdHdWlkZXJGb2NhbExlbmd0aDonICsgSW50VmFsdWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NhdmVUb0NvbmZpZ0ZpbGU6R3VpZGVyRm9jYWxMZW5ndGg6JyArIEludFZhbHVlKTsKICAgIH0sCgogICAgTXVsdGlTdGFyR3VpZGVyU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTXVsdGkgU3RhciBHdWlkZXIgaXMgc2V0IHRvOicgKyB2YWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdNdWx0aVN0YXJHdWlkZXI6JyArIHZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzYXZlVG9Db25maWdGaWxlOk11bHRpU3Rhckd1aWRlcjonICsgdmFsdWUpOwogICAgfSwKCiAgICBHdWlkZXJQaXhlbFNpemVTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBkb3VibGVWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdHdWlkZXIgUGl4ZWwgc2l6ZSBpcyBzZXQgdG86JyArIGRvdWJsZVZhbHVlLCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0d1aWRlclBpeGVsU2l6ZTonICsgZG91YmxlVmFsdWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NhdmVUb0NvbmZpZ0ZpbGU6R3VpZGVyUGl4ZWxTaXplOicgKyBkb3VibGVWYWx1ZSk7CiAgICB9LAoKICAgIEd1aWRlckdhaW5TZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnR3VpZGVyIEdhaW4gaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdHdWlkZXJHYWluOicgKyBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2F2ZVRvQ29uZmlnRmlsZTpHdWlkZXJHYWluOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIENhbGlicmF0aW9uRHVyYXRpb25TZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnR3VpZGVyIENhbGlicmF0aW9uIHN0ZXAgaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdDYWxpYnJhdGlvbkR1cmF0aW9uOicgKyBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2F2ZVRvQ29uZmlnRmlsZTpDYWxpYnJhdGlvbkR1cmF0aW9uOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIFJhQWdncmVzc2lvblNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdSYSBBZ2dyZXNzaW9uIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnUmFBZ2dyZXNzaW9uOicgKyBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2F2ZVRvQ29uZmlnRmlsZTpSYUFnZ3Jlc3Npb246JyArIEludFZhbHVlKTsKICAgIH0sCgogICAgRGVjQWdncmVzc2lvblNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdEZWMgQWdncmVzc2lvbiBpcyBzZXQgdG86JyArIEludFZhbHVlLCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0RlY0FnZ3Jlc3Npb246JyArIEludFZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzYXZlVG9Db25maWdGaWxlOkRlY0FnZ3Jlc3Npb246JyArIEludFZhbHVlKTsKICAgIH0sCgogICAgU3luY0ZvY3VzZXJTdGVwKHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1N5bmMgRm9jdXNlciBTdGVwOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdTeW5jRm9jdXNlclN0ZXA6JyArIEludFZhbHVlKTsKICAgIH0sCgogICAgR290b1RoZW5Tb2x2ZShwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEJvb2xlYW5WYWx1ZSA9IEJvb2xlYW4odmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdHb3RvIFRoZW4gU29sdmU6JyArIEJvb2xlYW5WYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdHb3RvVGhlblNvbHZlOicgKyBCb29sZWFuVmFsdWUpOwogICAgfSwKCiAgICBBdXRvRmxpcFNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEJvb2xlYW5WYWx1ZSA9IEJvb2xlYW4odmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdBdXRvIEZsaXA6JyArIEJvb2xlYW5WYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdBdXRvRmxpcDonICsgQm9vbGVhblZhbHVlKTsKICAgIH0sCgogICAgV2VzdE1pbnV0ZXNQYXN0TWVyaWRpYW5TZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBXZXN0TWludXRlc1Bhc3RNZXJpZGlhbiA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdNaW51dGVzIFBhc3QgTWVyaWRpYW46JyArIFdlc3RNaW51dGVzUGFzdE1lcmlkaWFuLCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1dlc3RNaW51dGVzUGFzdE1lcmlkaWFuOicgKyBXZXN0TWludXRlc1Bhc3RNZXJpZGlhbik7CiAgICB9LAoKICAgIEVhc3RNaW51dGVzUGFzdE1lcmlkaWFuU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgRWFzdE1pbnV0ZXNQYXN0TWVyaWRpYW4gPSBwYXJzZUZsb2F0KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTWludXRlcyBQYXN0IE1lcmlkaWFuOicgKyBFYXN0TWludXRlc1Bhc3RNZXJpZGlhbiwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdFYXN0TWludXRlc1Bhc3RNZXJpZGlhbjonICsgRWFzdE1pbnV0ZXNQYXN0TWVyaWRpYW4pOwogICAgfSwKCiAgICBhc3luYyByZWFkQmluRmlsZShmaWxlTmFtZSwgcmV0cnlDb3VudCA9IDEpIHsKICAgICAgd2hpbGUgKHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlKSB7CiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTsKICAgICAgICBpZiAoIXRoaXMuaXNXYWl0aW5nTG9nZ2VkKSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UgaXMgYWxyZWFkeSBiZWluZyBwcm9jZXNzZWQuIFBsZWFzZSB3YWl0IGZvciB0aGUgcHJldmlvdXMgcHJvY2VzcyB0byBjb21wbGV0ZS4nLCAnd2FybmluZycpOwogICAgICAgICAgdGhpcy5pc1dhaXRpbmdMb2dnZWQgPSB0cnVlOyAvLyDnoa7kv53lj6rorrDlvZXkuIDmrKHnrYnlvoXkv6Hmga8KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmlzRG93bmxvYWRpbmdJbWFnZU5hbWUgPT09IGZpbGVOYW1lKSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGlzIGFscmVhZHkgcHJvY2Vzc2VkLicsICdpbmZvJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmlzRG93bmxvYWRpbmdJbWFnZSA9IHRydWU7CiAgICAgIHRoaXMuaXNXYWl0aW5nTG9nZ2VkID0gZmFsc2U7IC8vIOmHjee9ruetieW+heaXpeW/l+agh+W/lwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBSZWFkIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGRhdGEgc3RhcnQuJywgJ2luZm8nKTsKCiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgIHRyeSB7CiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZpbGVOYW1lIGlzIHZhbGlkCiAgICAgICAgaWYgKCFmaWxlTmFtZSB8fCB0eXBlb2YgZmlsZU5hbWUgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZmlsZSBuYW1lIHByb3ZpZGVkJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBGZXRjaCB3aXRoIHByb2dyZXNzIHRyYWNraW5nCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChmaWxlTmFtZSwgeyBjYWNoZTogJ25vLXN0b3JlJyB9KTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5ldHdvcmsgcmVzcG9uc2Ugd2FzIG5vdCBvay4gU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNvbnRlbnRMZW5ndGggPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnKTsKICAgICAgICBpZiAoIWNvbnRlbnRMZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29udGVudC1MZW5ndGggaGVhZGVyIGlzIG1pc3NpbmcnKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY29udGVudExlbmd0aCwgMTApOwogICAgICAgIGlmIChpc05hTih0b3RhbCkgfHwgdG90YWwgPD0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNvbnRlbnQtbGVuZ3RoIHZhbHVlJyk7CiAgICAgICAgfQoKICAgICAgICBsZXQgbG9hZGVkID0gMDsKCiAgICAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKICAgICAgICBjb25zdCBzdHJlYW0gPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgc3RhcnQ6IChjb250cm9sbGVyKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7CiAgICAgICAgICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKCh7IGRvbmUsIHZhbHVlIH0pID0+IHsKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gKGxvYWRlZCAvIHRvdGFsKSAqIDEwMDsKICAgICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHBlcmNlbnQpICUgMTAgPT09IDApIHsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhgUHJvZ3Jlc3M6ICR7TWF0aC5yb3VuZChwZXJjZW50KX0lYCwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYXB0dXJlSW1hZ2VQcm9ncmVzcyhNYXRoLnJvdW5kKHBlcmNlbnQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coYOW9k+WJjei/m+W6pjogJHtNYXRoLnJvdW5kKHBlcmNlbnQpfSVgLCAnaW5mbycpOwogICAgICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHZhbHVlKTsKICAgICAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdHJlYW0gcmVhZGluZyBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTdHJlYW0gcmVhZGluZyBlcnJvcjogJyArIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOwogICAgICAgICAgICAgICAgY29udHJvbGxlci5lcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB1c2goKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgbmV3UmVzcG9uc2UgPSBuZXcgUmVzcG9uc2Uoc3RyZWFtKTsKICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgbmV3UmVzcG9uc2UuYmxvYigpOwoKICAgICAgICAvLyBGaWxlUmVhZGVyIHdpdGggcHJvZ3Jlc3MgdHJhY2tpbmcKICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgIHRoaXMuSW1hZ2VBcnJheUJ1ZmZlciA9IGZpbGVSZWFkZXIucmVzdWx0OwoKICAgICAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgY29uc3QgZWxhcHNlZFRpbWUgPSBlbmRUaW1lLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCk7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBSZWFkIGltYWdlIGRhdGEgZW5kOiAnICsgZWxhcHNlZFRpbWUgKyAnIG1zJywgJ2luZm8nKTsKICAgICAgICAgIGlmICghdGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goYFJlYWQgaW1hZ2UgZGF0YSBlbmQ6ICcke2VsYXBzZWRUaW1lfScgbXMuYCwgJ2luZm8nKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlTmFtZSA9IGZpbGVOYW1lOwogICAgICAgICAgdGhpcy5wcm9jZXNzSW1hZ2UodGhpcy5JbWFnZUFycmF5QnVmZmVyKTsKICAgICAgICB9OwoKICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSAoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbGVSZWFkZXIgZXJyb3I6JywgZXJyb3IpOwogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRmlsZVJlYWRlciBlcnJvcjogJyArIGVycm9yLm1lc3NhZ2UsICdlcnJvcicpOwogICAgICAgIH07CgogICAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignVGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZSBmZXRjaCBvcGVyYXRpb246JywgZXJyb3IpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gd2l0aCB0aGUgZmV0Y2ggb3BlcmF0aW9uOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7CgogICAgICAgIC8vIOS4i+i9veWksei0pe+8jOmHjeivlQogICAgICAgIGlmIChyZXRyeUNvdW50ID4gMCkgewogICAgICAgICAgY29uc29sZS5sb2coJ1JldHJ5aW5nIGRvd25sb2FkLi4uJyk7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdSZXRyeWluZyBkb3dubG9hZC4uLicsICd3YXJuaW5nJyk7CiAgICAgICAgICB0aGlzLmlzRG93bmxvYWRpbmdJbWFnZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy51cGRhdGVDYXB0dXJlSW1hZ2VQcm9ncmVzcygxMDApOwogICAgICAgICAgYXdhaXQgdGhpcy5yZWFkQmluRmlsZShmaWxlTmFtZSwgcmV0cnlDb3VudCAtIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdNYXggcmV0cmllcyByZWFjaGVkLiBEb3dubG9hZCBmYWlsZWQuJywgJ2Vycm9yJyk7CiAgICAgICAgfQogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7IC8vIOehruS/neWcqOS7u+S9leaDheWGteS4i+mDvemHjee9rueKtuaAgQogICAgICB9CiAgICB9LAoKCiAgICAvLyBhc3luYyByZWFkQmluRmlsZShmaWxlTmFtZSwgcmV0cnlDb3VudCA9IDEpIHsKICAgIC8vICAgd2hpbGUgKHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlKSB7CiAgICAvLyAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTsKICAgIC8vICAgICBpZiAoIXRoaXMuaXNXYWl0aW5nTG9nZ2VkKSB7CiAgICAvLyAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UgaXMgYWxyZWFkeSBiZWluZyBwcm9jZXNzZWQuIFBsZWFzZSB3YWl0IGZvciB0aGUgcHJldmlvdXMgcHJvY2VzcyB0byBjb21wbGV0ZS4nLCAnd2FybmluZycpOwogICAgLy8gICAgICAgdGhpcy5pc1dhaXRpbmdMb2dnZWQgPSB0cnVlOyAvLyDnoa7kv53lj6rorrDlvZXkuIDmrKHnrYnlvoXkv6Hmga8KICAgIC8vICAgICB9CiAgICAvLyAgIH0KCiAgICAvLyAgIGlmICh0aGlzLmlzRG93bmxvYWRpbmdJbWFnZU5hbWUgPT09IGZpbGVOYW1lKSB7CiAgICAvLyAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGlzIGFscmVhZHkgcHJvY2Vzc2VkLicsICdpbmZvJyk7CiAgICAvLyAgICAgcmV0dXJuOwogICAgLy8gICB9CgogICAgLy8gICB0aGlzLmlzRG93bmxvYWRpbmdJbWFnZSA9IHRydWU7CiAgICAvLyAgIHRoaXMuaXNXYWl0aW5nTG9nZ2VkID0gZmFsc2U7IC8vIOmHjee9ruetieW+heaXpeW/l+agh+W/lwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBSZWFkIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGRhdGEgc3RhcnQuJywgJ2luZm8nKTsKCiAgICAvLyAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRyeSB7CiAgICAvLyAgICAgLy8gRmV0Y2ggd2l0aCBwcm9ncmVzcyB0cmFja2luZwogICAgLy8gICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZU5hbWUpOwogICAgLy8gICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgIC8vICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJyk7CiAgICAvLyAgICAgfQoKICAgIC8vICAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJyk7CiAgICAvLyAgICAgaWYgKCFjb250ZW50TGVuZ3RoKSB7CiAgICAvLyAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRlbnQtTGVuZ3RoIGhlYWRlciBpcyBtaXNzaW5nJyk7CiAgICAvLyAgICAgfQoKICAgIC8vICAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvbnRlbnRMZW5ndGgsIDEwKTsKICAgIC8vICAgICBsZXQgbG9hZGVkID0gMDsKCiAgICAvLyAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKICAgIC8vICAgICBjb25zdCBzdHJlYW0gPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgLy8gICAgICAgc3RhcnQ6IChjb250cm9sbGVyKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7CiAgICAvLyAgICAgICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKCh7IGRvbmUsIHZhbHVlIH0pID0+IHsKICAgIC8vICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAvLyAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTsKICAgIC8vICAgICAgICAgICAgICAgcmV0dXJuOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAvLyAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gKGxvYWRlZCAvIHRvdGFsKSAqIDEwMDsKICAgIC8vICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHBlcmNlbnQpICUgMTAgPT09IDApIHsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhgUHJvZ3Jlc3M6ICR7TWF0aC5yb3VuZChwZXJjZW50KX0lYCwnaW5mbycpOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKE1hdGgucm91bmQocGVyY2VudCkpOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHZhbHVlKTsKICAgIC8vICAgICAgICAgICAgIHB1c2goKTsKICAgIC8vICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdHJlYW0gcmVhZGluZyBlcnJvcjonLCBlcnJvcik7CiAgICAvLyAgICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKGVycm9yKTsKICAgIC8vICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgfTsKICAgIC8vICAgICAgICAgcHVzaCgpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0pOwoKICAgIC8vICAgICBjb25zdCBuZXdSZXNwb25zZSA9IG5ldyBSZXNwb25zZShzdHJlYW0pOwogICAgLy8gICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBuZXdSZXNwb25zZS5ibG9iKCk7CgogICAgLy8gICAgIC8vIEZpbGVSZWFkZXIgd2l0aCBwcm9ncmVzcyB0cmFja2luZwogICAgLy8gICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgLy8gICAgIGZpbGVSZWFkZXIub25sb2FkID0gKCkgPT4gewogICAgLy8gICAgICAgdGhpcy5JbWFnZUFycmF5QnVmZmVyID0gZmlsZVJlYWRlci5yZXN1bHQ7CgogICAgLy8gICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFJlYWQgaW1hZ2UgZGF0YSBlbmQ6ICcgKyBlbGFwc2VkVGltZSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAgICAgaWYgKCF0aGlzLmlzUG9sYXJBeGlzTW9kZSkgewogICAgLy8gICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChgUmVhZCBpbWFnZSBkYXRhIGVuZDogJyR7ZWxhcHNlZFRpbWV9JyBtcy5gLCAnaW5mbycpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgdGhpcy5pc0Rvd25sb2FkaW5nSW1hZ2VOYW1lID0gZmlsZU5hbWU7CiAgICAvLyAgICAgICB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIpOwogICAgLy8gICAgIH07CgogICAgLy8gICAgIGZpbGVSZWFkZXIub25lcnJvciA9IChlcnJvcikgPT4gewogICAgLy8gICAgICAgY29uc29sZS5lcnJvcignRmlsZVJlYWRlciBlcnJvcjonLCBlcnJvcik7CiAgICAvLyAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGaWxlUmVhZGVyIGVycm9yOicgKyBlcnJvciwgJ2Vycm9yJyk7CiAgICAvLyAgICAgfTsKCiAgICAvLyAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTsKICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIC8vICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHdpdGggdGhlIGZldGNoIG9wZXJhdGlvbjonLCBlcnJvcik7CiAgICAvLyAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZSBmZXRjaCBvcGVyYXRpb246JyArIGVycm9yLCAnZXJyb3InKTsKCiAgICAvLyAgICAgLy8g5LiL6L295aSx6LSl77yM6YeN6K+VCiAgICAvLyAgICAgaWYgKHJldHJ5Q291bnQgPiAwKSB7CiAgICAvLyAgICAgICBjb25zb2xlLmxvZygnUmV0cnlpbmcgZG93bmxvYWQuLi4nKTsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1JldHJ5aW5nIGRvd25sb2FkLi4uJywgJ3dhcm5pbmcnKTsKICAgIC8vICAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7CiAgICAvLyAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKDEwMCk7CiAgICAvLyAgICAgICBhd2FpdCB0aGlzLnJlYWRCaW5GaWxlKGZpbGVOYW1lLCByZXRyeUNvdW50IC0gMSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9IGZpbmFsbHkgewogICAgLy8gICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7IC8vIOehruS/neWcqOS7u+S9leaDheWGteS4i+mDvemHjee9rueKtuaAgQogICAgLy8gICB9CiAgICAvLyB9LAoKICAgIHVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKG51bSkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dDYXB0dXJlSW1hZ2VQcm9ncmVzcycsIG51bSk7CiAgICB9LAoKICAgIHNldEltYWdlUHJvcG9ydGlvbih2YWx1ZSkgewogICAgICB0aGlzLkltYWdlUHJvcG9ydGlvbiA9IHZhbHVlOwogICAgfSwKCiAgICBhc3luYyBwcm9jZXNzSW1hZ2UoaW1nQXJyYXksIGhpc3RvZ3JhbU1pbiA9IC0xLCBoaXN0b2dyYW1NYXggPSAtMSwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIGxldCB7IGNhbGN1bGF0ZUhpc3RvZ3JhbSA9IHRydWUgfSA9IG9wdGlvbnM7CiAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDA7CiAgICAgIHRoaXMucHJvZ3Jlc3NEZXNjcmlwdGlvbiA9IHRoaXMuJGkxOG4ubG9jYWxlID09PSAnY24nID8gJ+W8gOWni+WkhOeQhuWbvuWDjy4uLicgOiAnUHJvY2Vzc2luZyBpbWFnZS4uLic7CiAgICAgIGxldCBtYXQgPSBudWxsOwogICAgICBsZXQgdGFyZ2V0SW1nOCA9IG51bGw7CiAgICAgIGxldCByZXNpemVJbWcgPSBudWxsOwoKICAgICAgLy8g5L2/55Soc2V0VGltZW91dOWSjFByb21pc2XliJvlu7rpnZ7pmLvloZ7lpITnkIYKICAgICAgY29uc3QgcHJvY2Vzc0FzeW5jID0gKGZuKSA9PiB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZuKCk7CiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIShpbWdBcnJheSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZ0FycmF5KSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnB1dCBtdXN0IGJlIEFycmF5QnVmZmVyIG9yIFR5cGVkQXJyYXkiKTsKICAgICAgICB9CiAgICAgICAgbGV0IHVpbnRBcnJheSA9IG5ldyBVaW50MTZBcnJheShpbWdBcnJheSk7CgogICAgICAgIGlmICh1aW50QXJyYXkubGVuZ3RoICE9IHBhcnNlSW50KHRoaXMubWFpbkNhbWVyYVNpemVZKSAqIHBhcnNlSW50KHRoaXMubWFpbkNhbWVyYVNpemVYKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbWFnZSBzaXplIG1pc21hdGNoIik7CiAgICAgICAgfQogICAgICAgIC8vIOWIm+W7uk1hdOWvueixoQogICAgICAgIGF3YWl0IHByb2Nlc3NBc3luYygoKSA9PiB7CiAgICAgICAgICBtYXQgPSBuZXcgY3YuTWF0KHBhcnNlSW50KHRoaXMubWFpbkNhbWVyYVNpemVZKSwgcGFyc2VJbnQodGhpcy5tYWluQ2FtZXJhU2l6ZVgpLCBjdi5DVl8xNlVDMSk7CiAgICAgICAgICBtYXQuZGF0YTE2VS5zZXQodWludEFycmF5KTsKICAgICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDEwOwogICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn5Yib5bu6TWF05a+56LGhLi4uJyA6ICdDcmVhdGluZyBNYXQgb2JqZWN0Li4uJzsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICAvLyDnlKjmiLfoh6rlrprkuYnlj4LmlbAKICAgICAgICBsZXQgQ0ZBID0gdGhpcy5JbWFnZUNGQTsKICAgICAgICBsZXQgaXNDb2xvckNhbWVyYSA9IGZhbHNlOwogICAgICAgIGxldCBtb2RlID0gMTsKICAgICAgICBsZXQgYmxhY2tMZXZlbCwgd2hpdGVMZXZlbDsKCiAgICAgICAgaWYgKGhpc3RvZ3JhbU1pbiA9PSAtMSAmJiBoaXN0b2dyYW1NYXggPT0gLTEpIHsKICAgICAgICAgIC8vIOiOt+WPluiHquWKqOaLieS8uOWPguaVsAogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvY2Vzc0FzeW5jKCgpID0+IHsKICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5HZXRBdXRvU3RyZXRjaChtYXQsIG1vZGUpOwogICAgICAgICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSAyMDsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn6I635Y+W6Ieq5Yqo5ouJ5Ly45Y+C5pWwLi4uJyA6ICdHZXR0aW5nIGF1dG8gc3RyZXRjaCBwYXJhbWV0ZXJzLi4uJzsKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhbGN1bGF0ZUhpc3RvZ3JhbSA9IHRydWU7CiAgICAgICAgICAvLyDku47nu5PmnpzkuK3mj5Dlj5blgLwKICAgICAgICAgIGJsYWNrTGV2ZWwgPSByZXN1bHQuYmxhY2tMZXZlbDsKICAgICAgICAgIHdoaXRlTGV2ZWwgPSByZXN1bHQud2hpdGVMZXZlbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmxhY2tMZXZlbCA9IGhpc3RvZ3JhbU1pbjsgIC8vIOeOsOWcqOWPr+S7peato+W4uOW3peS9nAogICAgICAgICAgd2hpdGVMZXZlbCA9IGhpc3RvZ3JhbU1heDsgIC8vIOeOsOWcqOWPr+S7peato+W4uOW3peS9nAogICAgICAgIH0KCiAgICAgICAgLy8g5qC55o2uQ0ZB6K6+572u6aKc6Imy6L2s5o2i5qih5byPCiAgICAgICAgaWYgKENGQSA9PT0gJ0dSJykgewogICAgICAgICAgaXNDb2xvckNhbWVyYSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChDRkEgPT09ICdHQicpIHsKICAgICAgICAgIGlzQ29sb3JDYW1lcmEgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoQ0ZBID09PSAnQkcnKSB7CiAgICAgICAgICBpc0NvbG9yQ2FtZXJhID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKENGQSA9PT0gJ1JHR0InKSB7CiAgICAgICAgICBpc0NvbG9yQ2FtZXJhID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXNDb2xvckNhbWVyYSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZygi5b2T5YmN5ouN5pGE5Y+C5pWwOmlzQ29sb3JDYW1lcmE6IiwgaXNDb2xvckNhbWVyYSwgIkNGQToiLCBDRkEpOwogICAgICAgIC8vIOiuoeeul+ebtOaWueWbvgogICAgICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgcHJvY2Vzc0FzeW5jKCgpID0+IHsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGlzQ29sb3JDYW1lcmEKICAgICAgICAgICAgPyB0aGlzLmFuYWx5emVJbWFnZVN0YXRpc3RpY3MobWF0LCAnYmF5ZXInLCBDRkEsIHsgY2FsY3VsYXRlR2FpbjogdGhpcy5jYWxjdWxhdGVHYWluLCBjYWxjdWxhdGVIaXN0b2dyYW06IGNhbGN1bGF0ZUhpc3RvZ3JhbSB9KQogICAgICAgICAgICA6IHRoaXMuYW5hbHl6ZUltYWdlU3RhdGlzdGljcyhtYXQsICdncmF5JywgeyBjYWxjdWxhdGVHYWluOiB0aGlzLmNhbGN1bGF0ZUdhaW4sIGNhbGN1bGF0ZUhpc3RvZ3JhbTogY2FsY3VsYXRlSGlzdG9ncmFtIH0pOwoKICAgICAgICAgIGlmICh0aGlzLkltYWdlR2FpblIgIT0gMSB8fCB0aGlzLkltYWdlR2FpbkIgIT0gMSB8fCB0aGlzLkltYWdlT2Zmc2V0ICE9IDApIHsKICAgICAgICAgICAgcmVzdWx0LmdhaW5SID0gdGhpcy5JbWFnZUdhaW5SOwogICAgICAgICAgICByZXN1bHQuZ2FpbkIgPSB0aGlzLkltYWdlR2FpbkI7CiAgICAgICAgICAgIHJlc3VsdC5vZmZzZXQgPSB0aGlzLkltYWdlT2Zmc2V0OwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDQwOwogICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn6K6h566X55u05pa55Zu+Li4uJyA6ICdDYWxjdWxhdGluZyBoaXN0b2dyYW0uLi4nOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGFuYWx5c2lzLmhpc3RvZ3JhbSkgewogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzaG93SGlzdG9ncmFtJywgYW5hbHlzaXMuaGlzdG9ncmFtKTsgIC8vIOabtOaWsCDnm7Tmlrnlm77mlbDmja4KICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2hhbmdlRGlhbFBvc2l0aW9uJywgYmxhY2tMZXZlbCwgd2hpdGVMZXZlbCk7ICAvLyDmm7TmlrDnm7Tmlrnlm77nmoTmmL7npLrovbQKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXV0b0hpc3RvZ3JhbU51bScsIGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zID0gewogICAgICAgICAgYmxhY2tMZXZlbDogYmxhY2tMZXZlbCwKICAgICAgICAgIHdoaXRlTGV2ZWw6IHdoaXRlTGV2ZWwsCiAgICAgICAgICBDRkE6IENGQSwKICAgICAgICAgIGFuYWx5c2lzOiBhbmFseXNpcywKICAgICAgICAgIGlzQ29sb3JDYW1lcmE6IGlzQ29sb3JDYW1lcmEsCiAgICAgICAgfTsKCiAgICAgICAgLy8g5L2/55So5aKe55uK5ZKM5ouJ5Ly477yM5bm26L2s5YyW5Li6OOS9jeWbvuWDjwogICAgICAgIHRhcmdldEltZzggPSBhd2FpdCBwcm9jZXNzQXN5bmMoKCkgPT4gewogICAgICAgICAgY29uc3QgcmVzdWx0ID0gaXNDb2xvckNhbWVyYQogICAgICAgICAgICA/IHRoaXMuYXBwbHlTdHJldGNoQW5kR2FpbihtYXQsIGFuYWx5c2lzLCAnYmF5ZXInLCBDRkEsIGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwpCiAgICAgICAgICAgIDogdGhpcy5hcHBseVN0cmV0Y2hBbmRHYWluKG1hdCwgYW5hbHlzaXMsICdncmF5JywgQ0ZBLCBibGFja0xldmVsLCB3aGl0ZUxldmVsKTsKCiAgICAgICAgICAvLyDph4rmlL5tYXQKICAgICAgICAgIGlmIChtYXQpIHsKICAgICAgICAgICAgbWF0LmRlbGV0ZSgpOwogICAgICAgICAgICBtYXQgPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDYwOwogICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn5qC55o2u5Y+C5pWw5aSE55CGLi4uJyA6ICdQcm9jZXNzaW5nIHdpdGggcGFyYW1ldGVycy4uLic7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0pOwoKICAgICAgICAvLyDmoLnmja7mqKHlvI/lpITnkIblm77lg48KICAgICAgICBpZiAodGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgICAgICAgIGF3YWl0IHByb2Nlc3NBc3luYygoKSA9PiB7CiAgICAgICAgICAgIHJlc2l6ZUltZyA9IG5ldyBjdi5NYXQoKTsKICAgICAgICAgICAgY3YucmVzaXplKHRhcmdldEltZzgsIHJlc2l6ZUltZywgbmV3IGN2LlNpemUodGhpcy5DYW52YXNXaWR0aCwgdGhpcy5DYW52YXNIZWlnaHQpLCAwLCAwLCBjdi5JTlRFUl9MSU5FQVIpOwoKICAgICAgICAgICAgaWYgKHRhcmdldEltZzgpIHsKICAgICAgICAgICAgICB0YXJnZXRJbWc4LmRlbGV0ZSgpOwogICAgICAgICAgICAgIHRhcmdldEltZzggPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDA7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzaG93U29sdmVJbWFnZScsIHJlc2l6ZUltZyk7CgogICAgICAgICAgaWYgKHJlc2l6ZUltZykgewogICAgICAgICAgICByZXNpemVJbWcuZGVsZXRlKCk7CiAgICAgICAgICAgIHJlc2l6ZUltZyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOi9rOaNouS4ukltYWdlRGF0YeWvueixoQogICAgICAgICAgY29uc3QgY29sb3JEYXRhID0gYXdhaXQgcHJvY2Vzc0FzeW5jKCgpID0+IHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBJbWFnZURhdGEoCiAgICAgICAgICAgICAgbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRhcmdldEltZzguZGF0YSksCiAgICAgICAgICAgICAgdGFyZ2V0SW1nOC5jb2xzLAogICAgICAgICAgICAgIHRhcmdldEltZzgucm93cwogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKHRhcmdldEltZzgpIHsKICAgICAgICAgICAgICB0YXJnZXRJbWc4LmRlbGV0ZSgpOwogICAgICAgICAgICAgIHRhcmdldEltZzggPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXNpemVJbWcpIHsKICAgICAgICAgICAgICByZXNpemVJbWcuZGVsZXRlKCk7CiAgICAgICAgICAgICAgcmVzaXplSW1nID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSA4MDsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn6L2s5o2i5Li6SW1hZ2VEYXRh5a+56LGhLi4uJyA6ICdDb252ZXJ0aW5nIHRvIEltYWdlRGF0YSBvYmplY3QuLi4nOwogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuZHJhd0ltZ0RhdGEgPSB0cnVlOwoKICAgICAgICAgIC8vIOiuvue9rue8k+WGsueUu+W4gwogICAgICAgICAgYXdhaXQgcHJvY2Vzc0FzeW5jKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5idWZmZXJDYW52YXMud2lkdGggPSBjb2xvckRhdGEud2lkdGg7CiAgICAgICAgICAgIHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCA9IGNvbG9yRGF0YS5oZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuYnVmZmVyQ3R4LnB1dEltYWdlRGF0YShjb2xvckRhdGEsIDAsIDApOwogICAgICAgICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSA5MDsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn57uY5Yi257yT5Yay55S75biD5Zu+5YOPLi4uJyA6ICdEcmF3aW5nIGJ1ZmZlciBjYW52YXMgaW1hZ2UuLi4nOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIOe7mOWItuS4u+eUu+W4g+WbvuWDjwogICAgICAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gMTAwOwogICAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gdGhpcy4kaTE4bi5sb2NhbGUgPT09ICdjbicgPyAn57uY5Yi25Li755S75biD5Zu+5YOPLi4uJyA6ICdEcmF3aW5nIG1haW4gY2FudmFzIGltYWdlLi4uJzsKICAgICAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aGlzLmhhbmRsZUVycm9yKCdQcm9jZXNzIGltYWdlIGRhdGEgZXJyb3InLCAncHJvY2Vzc0ltYWdlJywgZXJyb3IpOwogICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDA7CiAgICAgICAgdGhpcy5wcm9ncmVzc0Rlc2NyaXB0aW9uID0gJyc7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gMDsKICAgICAgICAvLyDnoa7kv53miYDmnIlNYXTlr7nosaHpg73ooqvph4rmlL4KICAgICAgICBpZiAobWF0KSB7CiAgICAgICAgICBtYXQuZGVsZXRlKCk7CiAgICAgICAgICBtYXQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAodGFyZ2V0SW1nOCkgewogICAgICAgICAgdGFyZ2V0SW1nOC5kZWxldGUoKTsKICAgICAgICAgIHRhcmdldEltZzggPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAocmVzaXplSW1nKSB7CiAgICAgICAgICByZXNpemVJbWcuZGVsZXRlKCk7CiAgICAgICAgICByZXNpemVJbWcgPSBudWxsOwogICAgICAgIH0KICAgICAgICAvLyDlpITnkIblkI7mo4Dmn6XlhoXlrZgKICAgICAgICB0aGlzLmNoZWNrTWVtb3J5VXNhZ2UoKTsKICAgICAgICAvLyDlnKjlpITnkIblrozlpKfph4/mlbDmja7lkI7miYvliqjor7fmsYLlnoPlnL7lm57mlLYKICAgICAgICBpZiAod2luZG93LmdjKSB7CiAgICAgICAgICB0cnkgeyB3aW5kb3cuZ2MoKTsgfSBjYXRjaCAoZSkgeyB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKCiAgICAvKioKICAgICAqIOiOt+WPluiHquWKqOaLieS8uOWPguaVsO+8jOi/lOWbnum7keiJsuWSjOeZveiJsumYiOWAvAogICAgICogQHBhcmFtIHtjdi5NYXR9IGltZ01hdCDovpPlhaXnmoTlm77lg49NYXTlr7nosaEKICAgICAqIEBwYXJhbSB7aW50fSBtb2RlIOaooeW8jwogICAgICogQHJldHVybnMge2ludO+8jGludH0g6buR6Imy5ZKM55m96Imy6ZiI5YC8CiAgICAgKi8KICAgIEdldEF1dG9TdHJldGNoKGltZ01hdCwgbW9kZSkgewogICAgICAvLyDku4XmlK/mjIEgTWF0IOexu+Wei+i+k+WFpe+8jOW5tuWBh+WumuS4ujE25L2N5Zu+5YOPCiAgICAgIC8vIOS9v+eUqCBPcGVuQ1Yg55qEIG1lYW5TdGREZXYg5Ye95pWw55u05o6l6K6h566X5Z2H5YC85ZKM5qCH5YeG5beuCiAgICAgIGNvbnN0IG1lYW5zID0gbmV3IGN2Lk1hdCgpOwogICAgICBjb25zdCBzdGREZXZzID0gbmV3IGN2Lk1hdCgpOwoKICAgICAgLy8g6auY5pWI6K6h566X5Z2H5YC85ZKM5qCH5YeG5beuCiAgICAgIGN2Lm1lYW5TdGREZXYoaW1nTWF0LCBtZWFucywgc3RkRGV2cyk7CgogICAgICAvLyDojrflj5borqHnrpfnu5PmnpwKICAgICAgY29uc3QgbWVhbiA9IG1lYW5zLmRvdWJsZUF0KDAsIDApOwogICAgICBjb25zdCBzdGREZXYgPSBzdGREZXZzLmRvdWJsZUF0KDAsIDApOwoKICAgICAgLy8g6YeK5pS+5Li05pe2IE1hdCDlr7nosaEKICAgICAgbWVhbnMuZGVsZXRlKCk7CiAgICAgIHN0ZERldnMuZGVsZXRlKCk7CgogICAgICAvLyDmoLnmja7mqKHlvI/orr7nva7moIflh4blt67lgI3mlbAKICAgICAgbGV0IGEsIGI7CiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgMDogYSA9IDM7IGIgPSA1OyBicmVhazsKICAgICAgICBjYXNlIDE6IGEgPSAyOyBiID0gNTsgYnJlYWs7CiAgICAgICAgY2FzZSAyOiBhID0gMzsgYiA9IDg7IGJyZWFrOwogICAgICAgIGRlZmF1bHQ6IGEgPSAyOyBiID0gODsKICAgICAgfQoKICAgICAgLy8g5Zu65a6a5Li6MTbkvY3lm77lg4/lpITnkIYKICAgICAgY29uc3QgbWF4VmFsdWUgPSA2NTUzNTsKCiAgICAgIC8vIOiuoeeul+m7keeZveeCuQogICAgICBsZXQgYmxhY2tMZXZlbCA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgbWVhbiAtIHN0ZERldiAqIGEpKTsKICAgICAgbGV0IHdoaXRlTGV2ZWwgPSBNYXRoLnJvdW5kKE1hdGgubWluKG1heFZhbHVlLCBtZWFuICsgc3RkRGV2ICogYikpOwoKICAgICAgLy8g56Gu5L+dIGJsYWNrTGV2ZWwgPCB3aGl0ZUxldmVsCiAgICAgIGlmIChibGFja0xldmVsID49IHdoaXRlTGV2ZWwpIHsKICAgICAgICBibGFja0xldmVsID0gd2hpdGVMZXZlbCAtIDE7CiAgICAgIH0KCiAgICAgIHJldHVybiB7IGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwgfTsKICAgIH0sCgogICAgLyoqCiAgICAgKiDliIbmnpAxNuS9jeWbvuWDj+W5tuiuoeeul+ebtOaWueWbvuWSjOeZveW5s+ihoeWinuebigogICAgICogQHBhcmFtIHtjdi5NYXR9IGltZzE2IC0g6L6T5YWl55qEMTbkvY3lm77lg49NYXTlr7nosaEKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpbWFnZVR5cGUgLSDlm77lg4/nsbvlnos6ICdncmF5JyjngbDluqblm74pIOaIliAnYmF5ZXInKEJheWVy5qC85byPKQogICAgICogQHBhcmFtIHtzdHJpbmd9IGJheWVyUGF0dGVybiAtIEJheWVy5qih5byP77yM5aaC5p6caW1hZ2VUeXBl5Li6J2JheWVyJ+WImemcgOaPkOS+mzogJ1JHR0InLCAnR1InLCAnR0InLCAnQkcnCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIOWPr+mAieWPguaVsAogICAgICogQHBhcmFtIHtudW1iZXJ9IG9wdGlvbnMuYmlucyAtIOebtOaWueWbvueuseaVsO+8jOm7mOiupDI1NgogICAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLmNhbGN1bGF0ZUdhaW4gLSDmmK/lkKborqHnrpfnmb3lubPooaHlop7nm4rlj4LmlbDvvIzpu5jorqR0cnVlCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMudXNlUGVyY2VudGlsZSAtIOaYr+WQpuS9v+eUqOeZvuWIhuS9jeiuoeeul+Winuebiu+8jOm7mOiupHRydWUKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25zLmxvd1BlcmNlbnRpbGUgLSDkuIvmiKrmlq3nmb7liIbkvY3vvIzpu5jorqQxCiAgICAgKiBAcGFyYW0ge251bWJlcn0gb3B0aW9ucy5oaWdoUGVyY2VudGlsZSAtIOS4iuaIquaWreeZvuWIhuS9je+8jOm7mOiupDk5CiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSDnm7Tmlrnlm77mlbDmja7lkozlop7nm4rlj4LmlbAKICAgICAqLwogICAgYW5hbHl6ZUltYWdlU3RhdGlzdGljcyhpbWcxNiwgaW1hZ2VUeXBlLCBiYXllclBhdHRlcm4gPSAnUkdHQicsIG9wdGlvbnMgPSB7fSkgewogICAgICAvLyDpppblhYjmo4Dmn6XovpPlhaVNYXTmmK/lkKbmnInmlYgKICAgICAgaWYgKCFpbWcxNiB8fCBpbWcxNi5yb3dzIDw9IDAgfHwgaW1nMTYuY29scyA8PSAwKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5peg5pWI55qE5Zu+5YOP5pWw5o2uJyk7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CgogICAgICBjb25zdCB7IGNhbGN1bGF0ZUdhaW4gPSB0cnVlLCBjYWxjdWxhdGVIaXN0b2dyYW0gPSB0cnVlIH0gPSBvcHRpb25zOwogICAgICBjb25zdCByZXN1bHQgPSB7fTsKCgogICAgICAvLyDorr7nva7nm7Tmlrnlm77lj4LmlbAKICAgICAgY29uc3Qgc3RlcCA9IDQ7CgogICAgICAvLyDlronlhajorr/pl67lh73mlbAKICAgICAgY29uc3Qgc2FmZVVzaG9ydEF0ID0gKG1hdCwgeSwgeCkgPT4gewogICAgICAgIGlmICh5ID49IDAgJiYgeSA8IG1hdC5yb3dzICYmIHggPj0gMCAmJiB4IDwgbWF0LmNvbHMpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtYXQudXNob3J0QXQoeSwgeCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOiuv+mXruS9jee9rumUmeivrzogKCR7eX0sJHt4fSlgKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9OwoKICAgICAgLy8g5a6J5YWo5o6p56CB6K6+572u77yIc2V0dGVy77yJ77yaT3BlbkNWLmpzIOiuvue9ruWDj+e0oOmcgOS9v+eUqCB1Y2hhclB0ciDov5Tlm57nmoTop4blm77lho3otYvlgLwKICAgICAgY29uc3Qgc2FmZVNldE1hc2sgPSAobWFzaywgeSwgeCwgdmFsdWUpID0+IHsKICAgICAgICBpZiAoeSA+PSAwICYmIHkgPCBtYXNrLnJvd3MgJiYgeCA+PSAwICYmIHggPCBtYXNrLmNvbHMpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHB0ciA9IG1hc2sudWNoYXJQdHIoeSwgeCk7CiAgICAgICAgICAgIGlmIChwdHIgJiYgcHRyLmxlbmd0aCA+IDApIHB0clswXSA9IHZhbHVlOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGDorr7nva7mjqnnoIHplJnor686ICgke3l9LCR7eH0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKGltYWdlVHlwZSA9PT0gJ2dyYXknKSB7CiAgICAgICAgaWYgKGNhbGN1bGF0ZUhpc3RvZ3JhbSkgewogICAgICAgICAgLy8g6K6h566X55u05pa55Zu+CiAgICAgICAgICBjb25zdCBoaXN0RGF0YSA9IEFycmF5KDY1NTM2KS5maWxsKDApOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWcxNi5yb3dzOyBpICs9IHN0ZXApIHsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWcxNi5jb2xzOyBqICs9IHN0ZXApIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaGlzdERhdGFbc2FmZVVzaG9ydEF0KGltZzE2LCBpLCBqKV0rKzsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyDlv73nlaXplJnor6/nu6fnu63miafooYwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdC5oaXN0b2dyYW0gPSBoaXN0RGF0YTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaW1hZ2VUeXBlID09PSAnYmF5ZXInKSB7CiAgICAgICAgLy8g56Gu5L+d5Zu+5YOP5aSn5bCP6Laz5aSf6L+b6KGMQmF5ZXLlpITnkIYKICAgICAgICBpZiAoaW1nMTYucm93cyA8IDIgfHwgaW1nMTYuY29scyA8IDIpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WbvuWDj+WwuuWvuOi/h+Wwj++8jOaXoOazlei/m+ihjEJheWVy5aSE55CGJyk7CiAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfQoKICAgICAgICBjb25zdCByb3dzID0gaW1nMTYucm93czsKICAgICAgICBjb25zdCBjb2xzID0gaW1nMTYuY29sczsKCiAgICAgICAgLy8g5Yib5bu65o6p56CBIC0g5L2/55So56iA55aP6YeH5qC3CiAgICAgICAgY29uc3QgbWFza1IgPSBuZXcgY3YuTWF0KHJvd3MsIGNvbHMsIGN2LkNWXzhVQzEsIG5ldyBjdi5TY2FsYXIoMCkpOwogICAgICAgIGNvbnN0IG1hc2tHID0gbmV3IGN2Lk1hdChyb3dzLCBjb2xzLCBjdi5DVl84VUMxLCBuZXcgY3YuU2NhbGFyKDApKTsKICAgICAgICBjb25zdCBtYXNrQiA9IG5ldyBjdi5NYXQocm93cywgY29scywgY3YuQ1ZfOFVDMSwgbmV3IGN2LlNjYWxhcigwKSk7CgogICAgICAgIC8vIOehruWumumHh+agt+atpemVvyAtIOWkp+WbvuWDj+aXtumHh+eUqOabtOWkp+atpemVvwogICAgICAgIGNvbnN0IHNhbXBsZVN0ZXAgPSBNYXRoLm1heCgyLCBNYXRoLmZsb29yKE1hdGgubWluKHJvd3MsIGNvbHMpIC8gMjAwKSAqIDIpOwoKICAgICAgICAvLyDnoa7lrppCYXllcuaooeW8j+S9jee9rgogICAgICAgIGxldCByT2Zmc2V0cywgZ09mZnNldHMsIGJPZmZzZXRzOwogICAgICAgIHN3aXRjaCAoYmF5ZXJQYXR0ZXJuKSB7CiAgICAgICAgICBjYXNlICdSR0dCJzoKICAgICAgICAgICAgck9mZnNldHMgPSBbeyB5OiAwLCB4OiAwIH1dOwogICAgICAgICAgICBnT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDEgfSwgeyB5OiAxLCB4OiAwIH1dOwogICAgICAgICAgICBiT2Zmc2V0cyA9IFt7IHk6IDEsIHg6IDEgfV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnR1InOgogICAgICAgICAgICBnT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDAgfSwgeyB5OiAxLCB4OiAxIH1dOwogICAgICAgICAgICByT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDEgfV07CiAgICAgICAgICAgIGJPZmZzZXRzID0gW3sgeTogMSwgeDogMCB9XTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdHQic6CiAgICAgICAgICAgIGdPZmZzZXRzID0gW3sgeTogMCwgeDogMCB9LCB7IHk6IDEsIHg6IDEgfV07CiAgICAgICAgICAgIGJPZmZzZXRzID0gW3sgeTogMCwgeDogMSB9XTsKICAgICAgICAgICAgck9mZnNldHMgPSBbeyB5OiAxLCB4OiAwIH1dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0JHJzoKICAgICAgICAgICAgYk9mZnNldHMgPSBbeyB5OiAwLCB4OiAwIH1dOwogICAgICAgICAgICBnT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDEgfSwgeyB5OiAxLCB4OiAwIH1dOwogICAgICAgICAgICByT2Zmc2V0cyA9IFt7IHk6IDEsIHg6IDEgfV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgck9mZnNldHMgPSBbeyB5OiAwLCB4OiAwIH1dOwogICAgICAgICAgICBnT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDEgfSwgeyB5OiAxLCB4OiAwIH1dOwogICAgICAgICAgICBiT2Zmc2V0cyA9IFt7IHk6IDEsIHg6IDEgfV07CiAgICAgICAgfQoKICAgICAgICAvLyDph4fmoLfmlbDmja7nlKjkuo7lop7nm4rorqHnrpcKICAgICAgICBjb25zdCByVmFsdWVzID0gW107CiAgICAgICAgY29uc3QgZ1ZhbHVlcyA9IFtdOwogICAgICAgIGNvbnN0IGJWYWx1ZXMgPSBbXTsKCiAgICAgICAgLy8g6YeH5qC36K6+572u5o6p56CB5ZKM5pS26ZuG6YeH5qC35pWw5o2uCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCByb3dzOyB5ICs9IHNhbXBsZVN0ZXApIHsKICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY29sczsgeCArPSBzYW1wbGVTdGVwKSB7CiAgICAgICAgICAgIC8vIOWkhOeQhue6ouiJsumAmumBkwogICAgICAgICAgICBmb3IgKGNvbnN0IHBvcyBvZiByT2Zmc2V0cykgewogICAgICAgICAgICAgIGNvbnN0IHB5ID0geSArIHBvcy55OwogICAgICAgICAgICAgIGNvbnN0IHB4ID0geCArIHBvcy54OwogICAgICAgICAgICAgIGlmIChweSA8IHJvd3MgJiYgcHggPCBjb2xzICYmIHB5ID49IDAgJiYgcHggPj0gMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgc2FmZVNldE1hc2sobWFza1IsIHB5LCBweCwgMjU1KTsKICAgICAgICAgICAgICAgICAgaWYgKGNhbGN1bGF0ZUdhaW4gJiYgeSAlIChzYW1wbGVTdGVwICogMikgPT09IDAgJiYgeCAlIChzYW1wbGVTdGVwICogMikgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByVmFsdWVzLnB1c2goc2FmZVVzaG9ydEF0KGltZzE2LCBweSwgcHgpKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBS6YCa6YGT6ZSZ6K+v77yaKCR7cHl9LCR7cHh9KWAsIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aSE55CG57u/6Imy6YCa6YGTCiAgICAgICAgICAgIGZvciAoY29uc3QgcG9zIG9mIGdPZmZzZXRzKSB7CiAgICAgICAgICAgICAgY29uc3QgcHkgPSB5ICsgcG9zLnk7CiAgICAgICAgICAgICAgY29uc3QgcHggPSB4ICsgcG9zLng7CiAgICAgICAgICAgICAgaWYgKHB5IDwgcm93cyAmJiBweCA8IGNvbHMgJiYgcHkgPj0gMCAmJiBweCA+PSAwKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBzYWZlU2V0TWFzayhtYXNrRywgcHksIHB4LCAyNTUpOwogICAgICAgICAgICAgICAgICBpZiAoY2FsY3VsYXRlR2FpbiAmJiB5ICUgKHNhbXBsZVN0ZXAgKiAyKSA9PT0gMCAmJiB4ICUgKHNhbXBsZVN0ZXAgKiAyKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGdWYWx1ZXMucHVzaChzYWZlVXNob3J0QXQoaW1nMTYsIHB5LCBweCkpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEfpgJrpgZPplJnor6/vvJooJHtweX0sJHtweH0pYCwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpITnkIbok53oibLpgJrpgZMKICAgICAgICAgICAgZm9yIChjb25zdCBwb3Mgb2YgYk9mZnNldHMpIHsKICAgICAgICAgICAgICBjb25zdCBweSA9IHkgKyBwb3MueTsKICAgICAgICAgICAgICBjb25zdCBweCA9IHggKyBwb3MueDsKICAgICAgICAgICAgICBpZiAocHkgPCByb3dzICYmIHB4IDwgY29scyAmJiBweSA+PSAwICYmIHB4ID49IDApIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHNhZmVTZXRNYXNrKG1hc2tCLCBweSwgcHgsIDI1NSk7CiAgICAgICAgICAgICAgICAgIGlmIChjYWxjdWxhdGVHYWluICYmIHkgJSAoc2FtcGxlU3RlcCAqIDIpID09PSAwICYmIHggJSAoc2FtcGxlU3RlcCAqIDIpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYlZhbHVlcy5wdXNoKHNhZmVVc2hvcnRBdChpbWcxNiwgcHksIHB4KSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQumAmumBk+mUmeivr++8migke3B5fSwke3B4fSlgLCBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjYWxjdWxhdGVIaXN0b2dyYW0pIHsKICAgICAgICAgIC8vIOiuoeeul+S4ieS4qumAmumBk+eahOebtOaWueWbvgogICAgICAgICAgY29uc3QgaGlzdERhdGFSID0gQXJyYXkoNjU1MzYpLmZpbGwoMCk7CiAgICAgICAgICBjb25zdCBoaXN0RGF0YUcgPSBBcnJheSg2NTUzNikuZmlsbCgwKTsKICAgICAgICAgIGNvbnN0IGhpc3REYXRhQiA9IEFycmF5KDY1NTM2KS5maWxsKDApOwoKICAgICAgICAgIC8vIOehruS/neWuieWFqOiuv+mXrgogICAgICAgICAgY29uc3QgbWF4Um93cyA9IHJvd3MgLSAxOwogICAgICAgICAgY29uc3QgbWF4Q29scyA9IGNvbHMgLSAxOwoKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4Um93czsgaSArPSAyKSB7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbWF4Q29sczsgaiArPSAyKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChiYXllclBhdHRlcm4gPT09ICdSR0dCJykgewogICAgICAgICAgICAgICAgICBoaXN0RGF0YVJbc2FmZVVzaG9ydEF0KGltZzE2LCBpLCBqKV0rKzsKICAgICAgICAgICAgICAgICAgY29uc3QgZzEgPSBzYWZlVXNob3J0QXQoaW1nMTYsIGkgKyAxLCBqKTsKICAgICAgICAgICAgICAgICAgY29uc3QgZzIgPSBzYWZlVXNob3J0QXQoaW1nMTYsIGksIGogKyAxKTsKICAgICAgICAgICAgICAgICAgaGlzdERhdGFHW01hdGguZmxvb3IoKGcxICsgZzIpIC8gMildKys7CiAgICAgICAgICAgICAgICAgIGhpc3REYXRhQltzYWZlVXNob3J0QXQoaW1nMTYsIGkgKyAxLCBqICsgMSldKys7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJheWVyUGF0dGVybiA9PT0gJ0dSJykgewogICAgICAgICAgICAgICAgICBjb25zdCBnMSA9IHNhZmVVc2hvcnRBdChpbWcxNiwgaSwgaik7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGcyID0gc2FmZVVzaG9ydEF0KGltZzE2LCBpICsgMSwgaiArIDEpOwogICAgICAgICAgICAgICAgICBoaXN0RGF0YUdbTWF0aC5mbG9vcigoZzEgKyBnMikgLyAyKV0rKzsKICAgICAgICAgICAgICAgICAgaGlzdERhdGFSW3NhZmVVc2hvcnRBdChpbWcxNiwgaSArIDEsIGopXSsrOwogICAgICAgICAgICAgICAgICBoaXN0RGF0YUJbc2FmZVVzaG9ydEF0KGltZzE2LCBpLCBqICsgMSldKys7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJheWVyUGF0dGVybiA9PT0gJ0dCJykgewogICAgICAgICAgICAgICAgICBjb25zdCBnMSA9IHNhZmVVc2hvcnRBdChpbWcxNiwgaSwgaik7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGcyID0gc2FmZVVzaG9ydEF0KGltZzE2LCBpICsgMSwgaiArIDEpOwogICAgICAgICAgICAgICAgICBoaXN0RGF0YUdbTWF0aC5mbG9vcigoZzEgKyBnMikgLyAyKV0rKzsKICAgICAgICAgICAgICAgICAgaGlzdERhdGFCW3NhZmVVc2hvcnRBdChpbWcxNiwgaSArIDEsIGopXSsrOwogICAgICAgICAgICAgICAgICBoaXN0RGF0YVJbc2FmZVVzaG9ydEF0KGltZzE2LCBpLCBqICsgMSldKys7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJheWVyUGF0dGVybiA9PT0gJ0JHJykgewogICAgICAgICAgICAgICAgICBoaXN0RGF0YUJbc2FmZVVzaG9ydEF0KGltZzE2LCBpLCBqKV0rKzsKICAgICAgICAgICAgICAgICAgY29uc3QgZzEgPSBzYWZlVXNob3J0QXQoaW1nMTYsIGkgKyAxLCBqKTsKICAgICAgICAgICAgICAgICAgY29uc3QgZzIgPSBzYWZlVXNob3J0QXQoaW1nMTYsIGksIGogKyAxKTsKICAgICAgICAgICAgICAgICAgaGlzdERhdGFHW01hdGguZmxvb3IoKGcxICsgZzIpIC8gMildKys7CiAgICAgICAgICAgICAgICAgIGhpc3REYXRhUltzYWZlVXNob3J0QXQoaW1nMTYsIGkgKyAxLCBqICsgMSldKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihg55u05pa55Zu+6K6h566X6ZSZ6K+v77yaKCR7aX0sJHtqfSlgLCBlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdC5oaXN0b2dyYW0gPSBbaGlzdERhdGFSLCBoaXN0RGF0YUcsIGhpc3REYXRhQl07CiAgICAgICAgfQoKICAgICAgICAvLyDorqHnrpfnmb3lubPooaHlop7nm4rlj4LmlbAgLSDkvb/nlKjlv6vpgJ/kuK3kvY3mlbDov5HkvLzms5UKICAgICAgICBpZiAoY2FsY3VsYXRlR2FpbiAmJiByVmFsdWVzLmxlbmd0aCA+IDAgJiYgZ1ZhbHVlcy5sZW5ndGggPiAwICYmIGJWYWx1ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g5b+r6YCf6K6h566X5Lit5L2N5pWw6ICM6Z2e5o6S5bqP5YWo6YOo5pWw57uECiAgICAgICAgICAgIGNvbnN0IHJNZWFuID0gdGhpcy50cnVuY2F0ZWRNZWFuKHJWYWx1ZXMpOwogICAgICAgICAgICBjb25zdCBnTWVhbiA9IHRoaXMudHJ1bmNhdGVkTWVhbihnVmFsdWVzKTsKICAgICAgICAgICAgY29uc3QgYk1lYW4gPSB0aGlzLnRydW5jYXRlZE1lYW4oYlZhbHVlcyk7CgogICAgICAgICAgICAvLyDorqHnrpflop7nm4oKICAgICAgICAgICAgY29uc3QgZ2FpblIgPSBNYXRoLm1pbihNYXRoLm1heChnTWVhbiAvIHJNZWFuLCAwLjEpLCAyKTsKICAgICAgICAgICAgY29uc3QgZ2FpbkIgPSBNYXRoLm1pbihNYXRoLm1heChnTWVhbiAvIGJNZWFuLCAwLjEpLCAyKTsKCiAgICAgICAgICAgIHJlc3VsdC53aGl0ZUJhbGFuY2UgPSB7CiAgICAgICAgICAgICAgZ2FpblI6IGdhaW5SLAogICAgICAgICAgICAgIGdhaW5COiBnYWluQgogICAgICAgICAgICB9OwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCLnmb3lubPooaHlop7nm4rorqHnrpfplJnor68iLCBlKTsKICAgICAgICAgICAgcmVzdWx0LndoaXRlQmFsYW5jZSA9IHsgZ2FpblI6IDEuMCwgZ2FpbkI6IDEuMCB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g6YeK5pS+6LWE5rqQCiAgICAgICAgdHJ5IHsKICAgICAgICAgIG1hc2tSLmRlbGV0ZSgpOwogICAgICAgICAgbWFza0cuZGVsZXRlKCk7CiAgICAgICAgICBtYXNrQi5kZWxldGUoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCLph4rmlL7otYTmupDplJnor68iLCBlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKgogICAgICog5L2/55So5oiq5pat5Z2H5YC86K6h566XIC0g5Y676Zmk5LiK5LiL5LiA5a6a5q+U5L6L55qE5p6B5YC85ZCO6K6h566X5bmz5Z2H5YC8CiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnIgLSDovpPlhaXmlbDmja7mlbDnu4QKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsb3dlclBlcmNlbnQgLSDkuIvmiKrmlq3nmb7liIbmr5TvvIzpu5jorqQ1JQogICAgICogQHBhcmFtIHtudW1iZXJ9IHVwcGVyUGVyY2VudCAtIOS4iuaIquaWreeZvuWIhuavlO+8jOm7mOiupDUlCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSDmiKrmlq3lnYflgLwKICAgICAqLwogICAgdHJ1bmNhdGVkTWVhbihhcnIsIGxvd2VyUGVyY2VudCA9IDUsIHVwcGVyUGVyY2VudCA9IDUpIHsKICAgICAgaWYgKGFyci5sZW5ndGggPT09IDApIHJldHVybiAwOwoKICAgICAgLy8g6L+H5ruk5p6B56uv6buR54K55ZKM6L+H6aWx5ZKM54K5CiAgICAgIGNvbnN0IGZpbHRlcmVkID0gYXJyLmZpbHRlcih2ID0+IHYgPiAxMDAgJiYgdiA8IDY1MDAwKTsKICAgICAgaWYgKGZpbHRlcmVkLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGFyci5sZW5ndGggPiAwID8gYXJyWzBdIDogMDsKCiAgICAgIC8vIOWvueS6jueJueWIq+Wkp+eahOaVsOe7hO+8jOmHh+agt+WkhOeQhgogICAgICBsZXQgd29ya2luZ0FycmF5ID0gZmlsdGVyZWQ7CiAgICAgIGlmIChmaWx0ZXJlZC5sZW5ndGggPiAxMDAwMCkgewogICAgICAgIHdvcmtpbmdBcnJheSA9IFtdOwogICAgICAgIGNvbnN0IHN0ZXAgPSBNYXRoLmNlaWwoZmlsdGVyZWQubGVuZ3RoIC8gNTAwMCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJlZC5sZW5ndGg7IGkgKz0gc3RlcCkgewogICAgICAgICAgd29ya2luZ0FycmF5LnB1c2goZmlsdGVyZWRbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5o6S5bqP5pWw57uECiAgICAgIHdvcmtpbmdBcnJheS5zb3J0KChhLCBiKSA9PiBhIC0gYik7CgogICAgICAvLyDorqHnrpfmiKrmlq3ngrkKICAgICAgY29uc3QgbG93ZXJDdXRvZmYgPSBNYXRoLmZsb29yKHdvcmtpbmdBcnJheS5sZW5ndGggKiAobG93ZXJQZXJjZW50IC8gMTAwKSk7CiAgICAgIGNvbnN0IHVwcGVyQ3V0b2ZmID0gTWF0aC5mbG9vcih3b3JraW5nQXJyYXkubGVuZ3RoICogKDEgLSB1cHBlclBlcmNlbnQgLyAxMDApKTsKCiAgICAgIC8vIOiOt+WPluaIquaWreWQjueahOWtkOaVsOe7hAogICAgICBjb25zdCB0cnVuY2F0ZWQgPSB3b3JraW5nQXJyYXkuc2xpY2UobG93ZXJDdXRvZmYsIHVwcGVyQ3V0b2ZmKTsKCiAgICAgIC8vIOiuoeeul+W5s+Wdh+WAvAogICAgICBpZiAodHJ1bmNhdGVkLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHdvcmtpbmdBcnJheVtNYXRoLmZsb29yKHdvcmtpbmdBcnJheS5sZW5ndGggLyAyKV07CgogICAgICBjb25zdCBzdW0gPSB0cnVuY2F0ZWQucmVkdWNlKChhY2MsIHZhbCkgPT4gYWNjICsgdmFsLCAwKTsKICAgICAgcmV0dXJuIHN1bSAvIHRydW5jYXRlZC5sZW5ndGg7CiAgICB9LAogICAgLyoqCiAgICAgKiDlv6vpgJ/orqHnrpfkuK3kvY3mlbAgLSDkvb/nlKjpmo/mnLrpgInmi6nnrpfms5UKICAgICAqLwogICAgcXVpY2tNZWRpYW4oYXJyKSB7CiAgICAgIGlmIChhcnIubGVuZ3RoID09PSAwKSByZXR1cm4gMDsKICAgICAgaWYgKGFyci5sZW5ndGggPCAxMDApIHsKICAgICAgICAvLyDlsI/mlbDnu4Tnm7TmjqXmjpLluo8KICAgICAgICBjb25zdCBzb3J0ZWRBcnIgPSBbLi4uYXJyXS5zb3J0KChhLCBiKSA9PiBhIC0gYik7CiAgICAgICAgcmV0dXJuIHNvcnRlZEFycltNYXRoLmZsb29yKHNvcnRlZEFyci5sZW5ndGggLyAyKV07CiAgICAgIH0KCiAgICAgIC8vIOWkp+aVsOe7hOmaj+acuumHh+agtwogICAgICBjb25zdCBzYW1wbGVzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICBzYW1wbGVzLnB1c2goYXJyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFyci5sZW5ndGgpXSk7CiAgICAgIH0KICAgICAgc2FtcGxlcy5zb3J0KChhLCBiKSA9PiBhIC0gYik7CiAgICAgIHJldHVybiBzYW1wbGVzWzUwXTsgLy8g6L+U5Zue6YeH5qC355qE5Lit5L2N5pWwCiAgICB9LAoKICAgIC8qKgogICAgICog5bqU55So55m95bmz6KGh5ZKM5Lqu5bqm5ouJ5Ly477yM5bCGMTbkvY3lm77lg4/ovazmjaLkuLo45L2N5Zu+5YOPCiAgICAgKiBAcGFyYW0ge2N2Lk1hdH0gaW1nMTYgLSDovpPlhaXnmoQxNuS9jeWbvuWDj01hdOWvueixoQogICAgICogQHBhcmFtIHtPYmplY3R9IGFuYWx5c2lzIC0g5LuOYW5hbHl6ZUltYWdlU3RhdGlzdGljc+iOt+WPlueahOWIhuaekOe7k+aenAogICAgICogQHBhcmFtIHtzdHJpbmd9IGltYWdlVHlwZSAtIOWbvuWDj+exu+WeizogJ2dyYXknKOeBsOW6puWbvikg5oiWICdiYXllcico5b2p6Imy55u45py6KQogICAgICogQHBhcmFtIHtzdHJpbmd9IGJheWVyUGF0dGVybiAtIEJheWVy5qih5byP77yM5LuF5b2TaW1hZ2VUeXBl5Li6J2JheWVyJ+aXtumcgOimgQogICAgICogQHBhcmFtIHtPYmplY3R9IHN0cmV0Y2hQYXJhbXMgLSDmiYvliqjmjIflrprmi4nkvLjlj4LmlbDvvIzlj6/pgIkKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdHJldGNoUGFyYW1zLmJsYWNrTGV2ZWwgLSDpu5HngrnlgLwgCiAgICAgKiBAcGFyYW0ge251bWJlcn0gc3RyZXRjaFBhcmFtcy53aGl0ZUxldmVsIC0g55m954K55YC8CiAgICAgKiBAcmV0dXJucyB7Y3YuTWF0fSDlpITnkIblkI7nmoQ45L2NUkdCQeWbvuWDjwogICAgICovCiAgICBhcHBseVN0cmV0Y2hBbmRHYWluKGltZzE2LCBhbmFseXNpcywgaW1hZ2VUeXBlLCBiYXllclBhdHRlcm4gPSAnUkdHQicsIGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwpIHsKICAgICAgLy8g56Gu5L+d6buR54K55bCP5LqO55m954K5CiAgICAgIGlmIChibGFja0xldmVsID49IHdoaXRlTGV2ZWwpIHsKICAgICAgICBibGFja0xldmVsID0gd2hpdGVMZXZlbCAtIDE7CiAgICAgIH0KCiAgICAgIC8vIOiuoeeul+i9rOaNouavlOS+i+WSjOWBj+enuwogICAgICBjb25zdCBzY2FsZSA9IDI1NS4wIC8gKHdoaXRlTGV2ZWwgLSBibGFja0xldmVsKTsKICAgICAgY29uc3Qgb2Zmc2V0ID0gLWJsYWNrTGV2ZWwgKiBzY2FsZTsKCiAgICAgIGlmIChpbWFnZVR5cGUgPT09ICdncmF5JykgewogICAgICAgIC8vIOWNleiJsuebuOacuiAtIOS4gOatpei9rOaNouWIsDjkvY1SR0JBCiAgICAgICAgY29uc3QgcmdiYUltZyA9IG5ldyBjdi5NYXQoKTsKICAgICAgICBjb25zdCBncmF5OCA9IG5ldyBjdi5NYXQoKTsKCiAgICAgICAgaW1nMTYuY29udmVydFRvKGdyYXk4LCBjdi5DVl84VSwgc2NhbGUsIG9mZnNldCk7CiAgICAgICAgY3YuY3Z0Q29sb3IoZ3JheTgsIHJnYmFJbWcsIGN2LkNPTE9SX0dSQVkyUkdCQSk7CiAgICAgICAgZ3JheTguZGVsZXRlKCk7CgogICAgICAgIHJldHVybiByZ2JhSW1nOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOW9qeiJsuebuOacuuWkhOeQhgogICAgICAgIGxldCBnYWluUiA9IDEuMCwgZ2FpbkIgPSAxLjA7CiAgICAgICAgaWYgKGFuYWx5c2lzICYmIGFuYWx5c2lzLndoaXRlQmFsYW5jZSkgewogICAgICAgICAgZ2FpblIgPSBhbmFseXNpcy53aGl0ZUJhbGFuY2UuZ2FpblI7CiAgICAgICAgICBnYWluQiA9IGFuYWx5c2lzLndoaXRlQmFsYW5jZS5nYWluQjsKICAgICAgICB9CgogICAgICAgIC8vIOS9v+eUqExVVOS8mOWMlueZveW5s+ihoeWSjOaLieS8uAogICAgICAgIC8vIDEuIOWIm+W7uuS4ieS4qkxVVOihqAogICAgICAgIGNvbnN0IHsgbHV0UiwgbHV0RywgbHV0QiB9ID0gdGhpcy5nZXRMVVQoYmxhY2tMZXZlbCwgd2hpdGVMZXZlbCwgZ2FpblIsIGdhaW5CKTsKCiAgICAgICAgLy8gMy4g5Yib5bu6OOS9jei+k+WHuuWbvuWDjwogICAgICAgIGNvbnN0IGltZzggPSBuZXcgY3YuTWF0KGltZzE2LnJvd3MsIGltZzE2LmNvbHMsIGN2LkNWXzhVQzEpOwoKICAgICAgICAvLyA0LiDkvb/nlKhMVVTlupTnlKjnmb3lubPooaHlkozmi4nkvLgKICAgICAgICAvLyDkuLrpgb/lhY3lg4/ntKDpgY3ljobvvIzmiJHku6zkvb/nlKjmm7Tpq5jmlYjnmoTmlrnlvI8KICAgICAgICBjb25zdCByb3dzID0gaW1nMTYucm93czsKICAgICAgICBjb25zdCBjb2xzID0gaW1nMTYuY29sczsKICAgICAgICBjb25zdCBkYXRhOCA9IGltZzguZGF0YTsKCiAgICAgICAgLy8g56Gu5a6aQmF5ZXLmqKHlvI/nmoTkvY3nva4KICAgICAgICBsZXQgck9mZnNldHMsIGdPZmZzZXRzLCBiT2Zmc2V0czsKICAgICAgICBzd2l0Y2ggKGJheWVyUGF0dGVybikgewogICAgICAgICAgY2FzZSAnUkdHQic6CiAgICAgICAgICAgIHJPZmZzZXRzID0gW3sgeTogMCwgeDogMCB9XTsKICAgICAgICAgICAgZ09mZnNldHMgPSBbeyB5OiAwLCB4OiAxIH0sIHsgeTogMSwgeDogMCB9XTsKICAgICAgICAgICAgYk9mZnNldHMgPSBbeyB5OiAxLCB4OiAxIH1dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0dSJzoKICAgICAgICAgICAgZ09mZnNldHMgPSBbeyB5OiAwLCB4OiAwIH0sIHsgeTogMSwgeDogMSB9XTsKICAgICAgICAgICAgck9mZnNldHMgPSBbeyB5OiAwLCB4OiAxIH1dOwogICAgICAgICAgICBiT2Zmc2V0cyA9IFt7IHk6IDEsIHg6IDAgfV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnR0InOgogICAgICAgICAgICBnT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDAgfSwgeyB5OiAxLCB4OiAxIH1dOwogICAgICAgICAgICBiT2Zmc2V0cyA9IFt7IHk6IDAsIHg6IDEgfV07CiAgICAgICAgICAgIHJPZmZzZXRzID0gW3sgeTogMSwgeDogMCB9XTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdCRyc6CiAgICAgICAgICAgIGJPZmZzZXRzID0gW3sgeTogMCwgeDogMCB9XTsKICAgICAgICAgICAgZ09mZnNldHMgPSBbeyB5OiAwLCB4OiAxIH0sIHsgeTogMSwgeDogMCB9XTsKICAgICAgICAgICAgck9mZnNldHMgPSBbeyB5OiAxLCB4OiAxIH1dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJPZmZzZXRzID0gW3sgeTogMCwgeDogMCB9XTsKICAgICAgICAgICAgZ09mZnNldHMgPSBbeyB5OiAwLCB4OiAxIH0sIHsgeTogMSwgeDogMCB9XTsKICAgICAgICAgICAgYk9mZnNldHMgPSBbeyB5OiAxLCB4OiAxIH1dOwogICAgICAgIH0KCiAgICAgICAgLy8g5L2/55SoVHlwZWRBcnJheeaWueW8j+WkhOeQhiAtIOavlOmAkOS4quWDj+e0oOWkhOeQhuabtOW/qwogICAgICAgIGNvbnN0IGRhdGExNlUgPSBpbWcxNi5kYXRhMTZVOwoKICAgICAgICAvLyDkvb/nlKhCYXllcuaOqeeggeWIm+W7uui9rOaNokxVVO+8jOaJuemHj+WkhOeQhgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgcm93czsgeSArPSAyKSB7CiAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGNvbHM7IHggKz0gMikgewogICAgICAgICAgICAvLyDlpITnkIYyeDLlnZcKICAgICAgICAgICAgLy8gUuS9jee9rgogICAgICAgICAgICBmb3IgKGNvbnN0IHBvcyBvZiByT2Zmc2V0cykgewogICAgICAgICAgICAgIGNvbnN0IGlkeCA9ICh5ICsgcG9zLnkpICogY29scyArICh4ICsgcG9zLngpOwogICAgICAgICAgICAgIGlmIChpZHggPCBkYXRhMTZVLmxlbmd0aCkgewogICAgICAgICAgICAgICAgZGF0YThbaWR4XSA9IGx1dFJbZGF0YTE2VVtpZHhdXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEfkvY3nva4KICAgICAgICAgICAgZm9yIChjb25zdCBwb3Mgb2YgZ09mZnNldHMpIHsKICAgICAgICAgICAgICBjb25zdCBpZHggPSAoeSArIHBvcy55KSAqIGNvbHMgKyAoeCArIHBvcy54KTsKICAgICAgICAgICAgICBpZiAoaWR4IDwgZGF0YTE2VS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGRhdGE4W2lkeF0gPSBsdXRHW2RhdGExNlVbaWR4XV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBC5L2N572uCiAgICAgICAgICAgIGZvciAoY29uc3QgcG9zIG9mIGJPZmZzZXRzKSB7CiAgICAgICAgICAgICAgY29uc3QgaWR4ID0gKHkgKyBwb3MueSkgKiBjb2xzICsgKHggKyBwb3MueCk7CiAgICAgICAgICAgICAgaWYgKGlkeCA8IGRhdGExNlUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBkYXRhOFtpZHhdID0gbHV0QltkYXRhMTZVW2lkeF1dOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gNS4g5bCGOOS9jeWNlemAmumBk+i9rOS4ulJHQkEKICAgICAgICBjb25zdCByZ2JhSW1nID0gbmV3IGN2Lk1hdCgpOwogICAgICAgIGxldCBjdm1vZGU7CiAgICAgICAgc3dpdGNoIChiYXllclBhdHRlcm4pIHsKICAgICAgICAgIGNhc2UgJ1JHR0InOiBjdm1vZGUgPSBjdi5DT0xPUl9CYXllclJHMlJHQkE7IGJyZWFrOwogICAgICAgICAgY2FzZSAnR1InOiBjdm1vZGUgPSBjdi5DT0xPUl9CYXllckdSMlJHQkE7IGJyZWFrOwogICAgICAgICAgY2FzZSAnR0InOiBjdm1vZGUgPSBjdi5DT0xPUl9CYXllckdCMlJHQkE7IGJyZWFrOwogICAgICAgICAgY2FzZSAnQkcnOiBjdm1vZGUgPSBjdi5DT0xPUl9CYXllckJHMlJHQkE7IGJyZWFrOwogICAgICAgICAgZGVmYXVsdDogY3Ztb2RlID0gY3YuQ09MT1JfR1JBWTJSR0JBOwogICAgICAgIH0KCiAgICAgICAgY3YuY3Z0Q29sb3IoaW1nOCwgcmdiYUltZywgY3Ztb2RlKTsKICAgICAgICBpbWc4LmRlbGV0ZSgpOwoKICAgICAgICByZXR1cm4gcmdiYUltZzsKICAgICAgfQogICAgfSwKICAgIC8qKgogICAgICog6I635Y+W5oiW6K6h566XTFVU6KGoCiAgICAgKiBAcGFyYW0ge251bWJlcn0gYmxhY2tMZXZlbCAtIOm7keeCueWAvAogICAgICogQHBhcmFtIHtudW1iZXJ9IHdoaXRlTGV2ZWwgLSDnmb3ngrnlgLwKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBnYWluUiAtIOe6ouiJsuWinuebigogICAgICogQHBhcmFtIHtudW1iZXJ9IGdhaW5CIC0g6JOd6Imy5aKe55uKCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSDljIXlkKtMVVTooajnmoRPYmplY3QKICAgICAqLwogICAgZ2V0TFVUKGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwsIGdhaW5SLCBnYWluQikgewogICAgICAvLyDliJvlu7rlvZPliY3lj4LmlbDnmoTlv6vnhacKICAgICAgY29uc3QgY3VycmVudFBhcmFtcyA9IGAke2JsYWNrTGV2ZWx9XyR7d2hpdGVMZXZlbH1fJHtnYWluUn1fJHtnYWluQn1gOwoKICAgICAgLy8g5aaC5p6c5Y+C5pWw5pyq5Y+Y5YyW77yM55u05o6l6L+U5Zue57yT5a2Y55qETFVU6KGoCiAgICAgIGlmICh0aGlzLmx1dENhY2hlLmxhc3RQYXJhbXMgPT09IGN1cnJlbnRQYXJhbXMgJiYKICAgICAgICB0aGlzLmx1dENhY2hlLmx1dFIgJiYgdGhpcy5sdXRDYWNoZS5sdXRHICYmIHRoaXMubHV0Q2FjaGUubHV0QikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsdXRSOiB0aGlzLmx1dENhY2hlLmx1dFIsCiAgICAgICAgICBsdXRHOiB0aGlzLmx1dENhY2hlLmx1dEcsCiAgICAgICAgICBsdXRCOiB0aGlzLmx1dENhY2hlLmx1dEIKICAgICAgICB9OwogICAgICB9CgogICAgICAvLyDlj4LmlbDlj5jljJbvvIzpnIDopoHph43mlrDorqHnrpdMVVTooagKICAgICAgY29uc29sZS5sb2coJ+mHjeaWsOiuoeeul0xVVOihqCcpOwoKICAgICAgLy8g6K6h566X6L2s5o2i5q+U5L6LCiAgICAgIGNvbnN0IHNjYWxlID0gMjU1LjAgLyAod2hpdGVMZXZlbCAtIGJsYWNrTGV2ZWwpOwoKICAgICAgLy8g5Yib5bu6TFVU6KGoCiAgICAgIGNvbnN0IGx1dFIgPSB0aGlzLmx1dENhY2hlLmx1dFIgfHwgbmV3IFVpbnQ4QXJyYXkoNjU1MzYpOwogICAgICBjb25zdCBsdXRHID0gdGhpcy5sdXRDYWNoZS5sdXRHIHx8IG5ldyBVaW50OEFycmF5KDY1NTM2KTsKICAgICAgY29uc3QgbHV0QiA9IHRoaXMubHV0Q2FjaGUubHV0QiB8fCBuZXcgVWludDhBcnJheSg2NTUzNik7CgogICAgICAvLyDorqHnrpdMVVTooagKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2NTUzNjsgaSsrKSB7CiAgICAgICAgbHV0UltpXSA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCgoaSAqIGdhaW5SIC0gYmxhY2tMZXZlbCkgKiBzY2FsZSkpKTsKICAgICAgICBsdXRHW2ldID0gTWF0aC5taW4oMjU1LCBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChpIC0gYmxhY2tMZXZlbCkgKiBzY2FsZSkpKTsKICAgICAgICBsdXRCW2ldID0gTWF0aC5taW4oMjU1LCBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChpICogZ2FpbkIgLSBibGFja0xldmVsKSAqIHNjYWxlKSkpOwogICAgICB9CgogICAgICAvLyDmm7TmlrDnvJPlrZgKICAgICAgdGhpcy5sdXRDYWNoZS5sYXN0UGFyYW1zID0gY3VycmVudFBhcmFtczsKICAgICAgdGhpcy5sdXRDYWNoZS5sdXRSID0gbHV0UjsKICAgICAgdGhpcy5sdXRDYWNoZS5sdXRHID0gbHV0RzsKICAgICAgdGhpcy5sdXRDYWNoZS5sdXRCID0gbHV0QjsKCiAgICAgIHJldHVybiB7IGx1dFIsIGx1dEcsIGx1dEIgfTsKICAgIH0sCiAgICAvLyBjaGVja0ltYWdlRGF0YShpbWcpIHsKICAgIC8vICAgLy8g5qOA5p+l5piv5ZCm5Li6IGN2Lk1hdCDnsbvlnosKICAgIC8vICAgaWYgKCEoaW1nIGluc3RhbmNlb2YgY3YuTWF0KSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBpcyBub3QgYSB2YWxpZCBjdi5NYXQgb2JqZWN0LicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5piv5ZCm5Li656m6CiAgICAvLyAgIGlmIChpbWcuZW1wdHkoKSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBpcyBlbXB0eS4nLCAnZXJyb3InKTsKICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAvLyAgIH0KCiAgICAvLyAgIC8vIOajgOafpeWbvuWDj+a3seW6puaYr+WQpuS4uiA4IOS9jeaIliAxNiDkvY0KICAgIC8vICAgY29uc3QgZGVwdGggPSBpbWcudHlwZSgpICYgY3YuQ1ZfTUFUX0RFUFRIX01BU0s7CiAgICAvLyAgIGlmIChkZXB0aCAhPT0gY3YuQ1ZfOFUgJiYgZGVwdGggIT09IGN2LkNWXzE2VSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBkZXB0aCBpcyBub3QgOC1iaXQgb3IgMTYtYml0LicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5bC65a+45piv5ZCm5ZCI55CGCiAgICAvLyAgIGlmIChpbWcucm93cyA8PSAwIHx8IGltZy5jb2xzIDw9IDApIHsKICAgIC8vICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UgZGltZW5zaW9ucyBhcmUgbm90IHZhbGlkLicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5pWw5o2u5piv5ZCm6LaF5Ye66IyD5Zu05oiW5YWo5Li6MAogICAgLy8gICBjb25zdCBkYXRhID0gaW1nLmRhdGE7CiAgICAvLyAgIGxldCBpc0FsbFplcm8gPSB0cnVlOwogICAgLy8gICBjb25zdCBtYXhWYWx1ZSA9IGRlcHRoID09PSBjdi5DVl84VSA/IDI1NSA6IDY1NTM1OwoKICAgIC8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICAgaWYgKGRhdGFbaV0gPCAwIHx8IGRhdGFbaV0gPiBtYXhWYWx1ZSkgewogICAgLy8gICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlIGltYWdlIGRhdGEgY29udGFpbnMgb3V0LW9mLXJhbmdlIHZhbHVlcy4nLCAnZXJyb3InKTsKICAgIC8vICAgICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgICB9CiAgICAvLyAgICAgaWYgKGRhdGFbaV0gIT09IDApIHsKICAgIC8vICAgICAgIGlzQWxsWmVybyA9IGZhbHNlOwogICAgLy8gICAgIH0KICAgIC8vICAgfQoKICAgIC8vICAgaWYgKGlzQWxsWmVybykgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBkYXRhIGlzIGFsbCB6ZXJvLicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQogICAgLy8gICByZXR1cm4gdHJ1ZTsKICAgIC8vIH0sCgoKICAgIC8vIHByb2Nlc3NJbWFnZShpbWdBcnJheSkgewogICAgLy8gICB0aGlzLnByb2dyZXNzVmFsdWUgPSAwOwogICAgLy8gICB0cnkgewogICAgLy8gICAgIGlmICghKGltZ0FycmF5IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpICYmICFBcnJheUJ1ZmZlci5pc1ZpZXcoaW1nQXJyYXkpKSB7CiAgICAvLyAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklucHV0IG11c3QgYmUgQXJyYXlCdWZmZXIgb3IgVHlwZWRBcnJheSIpOwogICAgLy8gICAgIH0KICAgIC8vICAgICBjb25zdCB0b3RhbFN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7IC8vIOaAu+W8gOWni+aXtumXtAoKICAgIC8vICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBQcm9jZXNzIGltYWdlIGRhdGEgc3RhcnQuJywgJ2luZm8nKTsKICAgIC8vICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgLy8gICAgIGxldCBpbWdfYml0ID0gLTE7CiAgICAvLyAgICAgbGV0IHVpbnRBcnJheTsKICAgIC8vICAgICBpZiAoaW1nQXJyYXkuYnl0ZUxlbmd0aCA9PT0gdGhpcy5tYWluQ2FtZXJhU2l6ZVggKiB0aGlzLm1haW5DYW1lcmFTaXplWSAqIDIgKXsKICAgIC8vICAgICAgIHVpbnRBcnJheSA9IG5ldyBVaW50MTZBcnJheShpbWdBcnJheSk7CiAgICAvLyAgICAgICBpbWdfYml0ID0gMTY7CiAgICAvLyAgICAgfWVsc2UgaWYoaW1nQXJyYXkuYnl0ZUxlbmd0aCA9PT0gdGhpcy5tYWluQ2FtZXJhU2l6ZVggKiB0aGlzLm1haW5DYW1lcmFTaXplWSl7CiAgICAvLyAgICAgICB1aW50QXJyYXkgPSBuZXcgVWludDhBcnJheShpbWdBcnJheSk7CiAgICAvLyAgICAgICBpbWdfYml0ID0gODsKICAgIC8vICAgICB9ZWxzZXsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coYEltYWdlIGRhdGEgaXMgdW5kZXJmaW5kIGJpdGAsICdlcnJvcicpOwogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICAgIH0KCiAgICAvLyAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhgSW1hZ2UgZGF0YSBkZXRlY3RlZCBhcyAke2ltZ19iaXR9LWJpdC5gLCAnaW5mbycpOwoKCgogICAgLy8gICAgIC8vIOiuvue9rueUu+W4g+WuvemrmOW4uOmHjwogICAgLy8gICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gcGFyc2VJbnQodGhpcy5tYWluQ2FtZXJhU2l6ZVgpOwogICAgLy8gICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IHBhcnNlSW50KHRoaXMubWFpbkNhbWVyYVNpemVZKTsKCiAgICAvLyAgICAgLy8g6I635Y+W5Y6f5aeL55S75biD5ZKM5L+u5pS55ZCO55qE55S75biD5Lul5Y+K5a+55bqU5LiK5LiL5paHCiAgICAvLyAgICAgY29uc3QgbW9kaWZpZWRDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNhbWVyYS1jYW52YXMnKTsKICAgIC8vICAgICBjb25zdCBtb2RpZmllZEN0eCA9IG1vZGlmaWVkQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CgoKCiAgICAvLyAgICAgbW9kaWZpZWRDYW52YXMud2lkdGggPSBjYW52YXNXaWR0aDsKICAgIC8vICAgICBtb2RpZmllZENhbnZhcy5oZWlnaHQgPSBjYW52YXNIZWlnaHQ7CgogICAgLy8gICAgIGxldCBtYXQ7CiAgICAvLyAgICAgaWYgKGltZ19iaXQgPT09IDE2KXsKICAgIC8vICAgICAgIG1hdCA9IG5ldyBjdi5NYXQoY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgY3YuQ1ZfMTZVQzEpOwogICAgLy8gICAgICAgbWF0LmRhdGExNlUuc2V0KHVpbnRBcnJheSk7CiAgICAvLyAgICAgfWVsc2V7CiAgICAvLyAgICAgICBtYXQgPSBuZXcgY3YuTWF0KGNhbnZhc0hlaWdodCwgY2FudmFzV2lkdGgsIGN2LkNWXzhVQzEpOwogICAgLy8gICAgICAgbWF0LmRhdGEuc2V0KHVpbnRBcnJheSk7CiAgICAvLyAgICAgfQogICAgLy8gICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDEwOwoKICAgIC8vICAgICBjb25zdCBtYXRFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gbWF0IOe7k+adn+aXtumXtAogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IE1hdCBjcmVhdGlvbiB0aW1lOiAnICsgKG1hdEVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgICAgLy8g55So5oi36Ieq5a6a5LmJ5Y+C5pWwCiAgICAvLyAgICAgbGV0IGdhaW5SID0gdGhpcy5JbWFnZUdhaW5SOwogICAgLy8gICAgIGxldCBnYWluQiA9IHRoaXMuSW1hZ2VHYWluQjsKICAgIC8vICAgICBsZXQgb2Zmc2V0ID0gdGhpcy5JbWFnZU9mZnNldDsKICAgIC8vICAgICBsZXQgQ0ZBID0gdGhpcy5JbWFnZUNGQTsKICAgIC8vICAgICBsZXQgbW9kZSA9IDE7CgogICAgLy8gICAgIC8vIOWPguaVsAogICAgLy8gICAgIGxldCBCID0gMDsKICAgIC8vICAgICBsZXQgVyA9IDY1NTM1OwogICAgLy8gICAgIGxldCBjdm1vZGUgPSAwOwoKICAgIC8vICAgICBjb25zdCB7IGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwgfSA9IHRoaXMuR2V0QXV0b1N0cmV0Y2godWludEFycmF5LCBtb2RlLCBpbWdfYml0KTsKICAgIC8vICAgICBCID0gYmxhY2tMZXZlbDsKICAgIC8vICAgICBXID0gd2hpdGVMZXZlbDsKICAgIC8vICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSAzMDsKICAgIC8vICAgICBjb25zdCBHZXRBdXRvU3RyZXRjaEVuZFRpbWUgPSBuZXcgRGF0ZSgpOyAvLyBHZXRBdXRvU3RyZXRjaCDnu5PmnZ/ml7bpl7QKICAgIC8vICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBHZXRBdXRvU3RyZXRjaCB0aW1lOiAnICsgKEdldEF1dG9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkgLSBtYXRFbmRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgICAgLy8g5qC55o2uQ0ZB6K6+572u6aKc6Imy6L2s5o2i5qih5byPCiAgICAvLyAgICAgaWYgKENGQSA9PT0gJ0dSJykgewogICAgLy8gICAgICAgY3Ztb2RlID0gY3YuQ09MT1JfQmF5ZXJHUjJSR0JBOwogICAgLy8gICAgIH0gZWxzZSBpZiAoQ0ZBID09PSAnR0InKSB7CiAgICAvLyAgICAgICBjdm1vZGUgPSBjdi5DT0xPUl9CYXllckdCMlJHQkE7CiAgICAvLyAgICAgfSBlbHNlIGlmIChDRkEgPT09ICdCRycpIHsKICAgIC8vICAgICAgIGN2bW9kZSA9IGN2LkNPTE9SX0JheWVyQkcyUkdCQTsKICAgIC8vICAgICB9IGVsc2UgaWYgKENGQSA9PT0gJ1JHR0InKSB7CiAgICAvLyAgICAgICBjdm1vZGUgPSBjdi5DT0xPUl9CYXllclJHMlJHQkE7CiAgICAvLyAgICAgfWVsc2V7CiAgICAvLyAgICAgICBjdm1vZGUgPSBjdi5DT0xPUl9HUkFZMlJHQkEKICAgIC8vICAgICB9CgogICAgLy8gICAgIC8vIOWvueebruagh+WbvuWDj+i/m+ihjOminOiJsui9rOaNogogICAgLy8gICAgIGxldCBkc3QgPSBuZXcgY3YuTWF0KCk7CgogICAgLy8gICAgIHRyeSB7CiAgICAvLyAgICAgICBjdi5jdnRDb2xvcihtYXQsIGRzdCwgY3Ztb2RlKTsKICAgIC8vICAgICB9IGNhdGNoIChlcnJvcikgewogICAgLy8gICAgICAgdGhpcy5oYW5kbGVFcnJvcignY3Z0Q29sb3Ig5Ye66ZSZJywgJ2N2dENvbG9yJywgZXJyb3IpOwogICAgLy8gICAgICAgbWF0LmRlbGV0ZSgpOwogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICAgIH0KCiAgICAvLyAgICAgdGhpcy5wcm9ncmVzc1ZhbHVlID0gNTA7CgogICAgLy8gICAgIGNvbnN0IGN2dENvbG9yRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIGN2dENvbG9yIOe7k+adn+aXtumXtAogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IGN2dENvbG9yIHRpbWU6ICcgKyAoY3Z0Q29sb3JFbmRUaW1lLmdldFRpbWUoKSAtIEdldEF1dG9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgLy8gICAgIG1hdC5kZWxldGUoKTsKCiAgICAvLyAgICAgLy8g6LCD5pW05Zu+5YOP5aSn5bCPCiAgICAvLyAgICAgLy8gY3YucmVzaXplKGRzdCwgcmVzaXplSW1nLCBuZXcgY3YuU2l6ZSh0aGlzLkNhbnZhc1dpZHRoLCB0aGlzLkNhbnZhc0hlaWdodCksIDAsIDAsIGN2LklOVEVSX0xJTkVBUik7CiAgICAvLyAgICAgLy8gZHN0LmRlbGV0ZSgpOwoKICAgIC8vICAgICAvLyBsZXQgb3JpZ2luYWxJbWc4ID0gdGhpcy5CaXQxNlRvOF9TdHJldGNoKHJlc2l6ZUltZywgQiwgVyk7CiAgICAvLyAgICAgLy8gcmVzaXplSW1nLmRlbGV0ZSgpOwoKICAgIC8vICAgICBsZXQgcmVzaXplSW1nID0gbmV3IGN2Lk1hdCgpOyAvLyDnlKjmnaXlrZjlgqjosIPmlbTlkI7nmoTlm77lg48KICAgIC8vICAgICBpZiAodGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgIC8vICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDA7CiAgICAvLyAgICAgICAvLyDosIPmlbTlm77lg4/lpKflsI8KICAgIC8vICAgICAgIGN2LnJlc2l6ZShkc3QsIHJlc2l6ZUltZywgbmV3IGN2LlNpemUodGhpcy5DYW52YXNXaWR0aCwgdGhpcy5DYW52YXNIZWlnaHQpLCAwLCAwLCBjdi5JTlRFUl9MSU5FQVIpOwogICAgLy8gICAgICAgZHN0LmRlbGV0ZSgpOwoKICAgIC8vICAgICAgIGxldCBvcmlnaW5hbEltZzg7CiAgICAvLyAgICAgICBpZiAoaW1nX2JpdCA9PT0gMTYpewogICAgLy8gICAgICAgICBvcmlnaW5hbEltZzggPSB0aGlzLkJpdDE2VG84X1N0cmV0Y2gocmVzaXplSW1nLCBCLCBXKTsKICAgIC8vICAgICAgIH1lbHNlewogICAgLy8gICAgICAgICBvcmlnaW5hbEltZzggPSByZXNpemVJbWc7CiAgICAvLyAgICAgICB9CgogICAgLy8gICAgICAgcmVzaXplSW1nLmRlbGV0ZSgpOwoKICAgIC8vICAgICAgIGNvbnN0IEJpdDE2VG84X1N0cmV0Y2hFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gQml0MTZUbzhfU3RyZXRjaCDnu5PmnZ/ml7bpl7QKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IEJpdDE2VG84X1N0cmV0Y2ggdGltZTogJyArIChCaXQxNlRvOF9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkgLSBHZXRBdXRvU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgIC8vICAgICAgIGxldCB0YXJnZXRJbWc4ID0gdGhpcy5JbWFnZVNvZnRBV0Iob3JpZ2luYWxJbWc4LCBnYWluUiwgZ2FpbkIsIG9mZnNldCk7CiAgICAvLyAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dTb2x2ZUltYWdlJywgdGFyZ2V0SW1nOCk7CgogICAgLy8gICAgICAgY29uc3QgSW1hZ2VTb2Z0QVdCRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIEltYWdlU29mdEFXQiDnu5PmnZ/ml7bpl7QKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IEltYWdlU29mdEFXQiB0aW1lOiAnICsgKEltYWdlU29mdEFXQkVuZFRpbWUuZ2V0VGltZSgpIC0gQml0MTZUbzhfU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICBtb2RpZmllZEN0eC5jbGVhclJlY3QoMCwgMCwgbW9kaWZpZWRDYW52YXMud2lkdGgsIG1vZGlmaWVkQ2FudmFzLmhlaWdodCk7CiAgICAvLyAgICAgICBjdi5yZXNpemUoZHN0LCByZXNpemVJbWcsIG5ldyBjdi5TaXplKHRoaXMuQ2FudmFzV2lkdGgsIHRoaXMuQ2FudmFzSGVpZ2h0KSwgMCwgMCwgY3YuSU5URVJfTElORUFSKTsKICAgIC8vICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDcwOwogICAgLy8gICAgICAgbGV0IG9yaWdpbmFsUmVzaXplSW1nOCA9IHRoaXMuQml0MTZUbzhfU3RyZXRjaChyZXNpemVJbWcsIEIsIFcpOwogICAgLy8gICAgICAgdGhpcy5PcmlnaW5hbEltYWdlID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkob3JpZ2luYWxSZXNpemVJbWc4LmRhdGEpLCBvcmlnaW5hbFJlc2l6ZUltZzguY29scywgb3JpZ2luYWxSZXNpemVJbWc4LnJvd3MpOwogICAgLy8gICAgICAgcmVzaXplSW1nLmRlbGV0ZSgpOwogICAgLy8gICAgICAgb3JpZ2luYWxSZXNpemVJbWc4LmRlbGV0ZSgpOwogICAgLy8gICAgICAgY29uc29sZS5sb2coJ2RzdC5kYXRhLmxlbmd0aDogJywgZHN0LmRhdGEubGVuZ3RoKTsKICAgIC8vICAgICAgIGNvbnNvbGUubG9nKCdkc3QuY29sczogJywgZHN0LmNvbHMpOwogICAgLy8gICAgICAgY29uc29sZS5sb2coJ2RzdC5yb3dzOiAnLCBkc3Qucm93cyk7CiAgICAvLyAgICAgICBsZXQgb3JpZ2luYWxJbWc4ID0gdGhpcy5CaXQxNlRvOF9TdHJldGNoKGRzdCwgQiwgVyk7CiAgICAvLyAgICAgICBkc3QuZGVsZXRlKCk7CiAgICAvLyAgICAgICB0aGlzLnByb2dyZXNzVmFsdWUgPSA4MDsKCiAgICAvLyAgICAgICBjb25zdCBCaXQxNlRvOF9TdHJldGNoRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIEJpdDE2VG84X1N0cmV0Y2gg57uT5p2f5pe26Ze0CiAgICAvLyAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBCaXQxNlRvOF9TdHJldGNoIHRpbWU6ICcgKyAoQml0MTZUbzhfU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpIC0gR2V0QXV0b1N0cmV0Y2hFbmRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgICAgICAvLyBsZXQgdGFyZ2V0SW1nOCA9IHRoaXMuSW1hZ2VTb2Z0QVdCKG9yaWdpbmFsSW1nOCwgZ2FpblIsIGdhaW5CLCBvZmZzZXQpOwoKICAgIC8vICAgICAgIC8vIGNvbnN0IEltYWdlU29mdEFXQkVuZFRpbWUgPSBuZXcgRGF0ZSgpOyAvLyBJbWFnZVNvZnRBV0Ig57uT5p2f5pe26Ze0CiAgICAvLyAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBJbWFnZVNvZnRBV0IgdGltZTogJyArIChJbWFnZVNvZnRBV0JFbmRUaW1lLmdldFRpbWUoKSAtIEJpdDE2VG84X1N0cmV0Y2hFbmRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgICAgICAvLyBvcmlnaW5hbEltZzguZGVsZXRlKCk7CgogICAgLy8gICAgICAgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zID0gewogICAgLy8gICAgICAgICBnYWluUjogZ2FpblIsCiAgICAvLyAgICAgICAgIGdhaW5COiBnYWluQiwKICAgIC8vICAgICAgICAgb2Zmc2V0OiBvZmZzZXQsCiAgICAvLyAgICAgICAgIENGQTogQ0ZBLAogICAgLy8gICAgICAgICBtb2RlOiBtb2RlLAogICAgLy8gICAgICAgICBCOiBCLAogICAgLy8gICAgICAgICBXOiBXLAogICAgLy8gICAgICAgICBjdm1vZGU6IGN2bW9kZSwKICAgIC8vICAgICAgIH07CgogICAgLy8gICAgICAgbW9kaWZpZWRDYW52YXMud2lkdGggPSB0aGlzLkNhbnZhc1dpZHRoOwogICAgLy8gICAgICAgbW9kaWZpZWRDYW52YXMuaGVpZ2h0ID0gdGhpcy5DYW52YXNIZWlnaHQ7CiAgICAvLyAgICAgICBsZXQgY29sb3JEYXRhID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkob3JpZ2luYWxJbWc4LmRhdGEpLCBvcmlnaW5hbEltZzguY29scywgb3JpZ2luYWxJbWc4LnJvd3MpOwogICAgLy8gICAgICAgb3JpZ2luYWxJbWc4LmRlbGV0ZSgpOwogICAgLy8gICAgICAgdGhpcy5kcmF3SW1nRGF0YSA9IGNvbG9yRGF0YTsKICAgIC8vICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDkwOwogICAgLy8gICAgICAgLy8g6K6+572u57yT5Yay55S75biD5a696auYCiAgICAvLyAgICAgICB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCA9IGNvbG9yRGF0YS53aWR0aDsKICAgIC8vICAgICAgIHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCA9IGNvbG9yRGF0YS5oZWlnaHQ7CiAgICAvLyAgICAgICAvLyDnu5jliLbnvJPlrZjnlLvluIPlm77lg48KICAgIC8vICAgICAgIHRoaXMuYnVmZmVyQ3R4LnB1dEltYWdlRGF0YShjb2xvckRhdGEsIDAsIDApOwogICAgLy8gICAgICAgLy8g57uY5Yi25Li755S75biD5Zu+5YOPCiAgICAvLyAgICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgIC8vICAgICAgIHRoaXMucHJvZ3Jlc3NWYWx1ZSA9IDEwMDsKICAgIC8vICAgICAgIGNvbnN0IERyYXdJbWFnZURhdGFFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gRHJhd0ltYWdlRGF0YSDnu5PmnZ/ml7bpl7QKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IERyYXdJbWFnZURhdGEgdGltZTogJyArIChEcmF3SW1hZ2VEYXRhRW5kVGltZS5nZXRUaW1lKCkgLSBCaXQxNlRvOF9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgLy8gICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFByb2Nlc3MgaW1hZ2UgZGF0YSBlbmQ6JyArIGVsYXBzZWRUaW1lICsgJyBtaWxsaXNlY29uZHMnLCAnaW5mbycpOwoKICAgIC8vICAgICAgIGNvbnN0IHRvdGFsRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIOaAu+e7k+adn+aXtumXtAogICAgLy8gICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FwdHVyZVRlc3RUaW1lIHwgVG90YWwgcHJvY2VzcyBpbWFnZSBkYXRhIHRpbWU6ICcgKyAodG90YWxFbmRUaW1lLmdldFRpbWUoKSAtIHRvdGFsU3RhcnRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dDYXB0dXJlSW1hZ2UnKTsKICAgIC8vICAgICAgIHRoaXMuTWFrZUhpc3RvZ3JhbShjb2xvckRhdGEpOwogICAgLy8gICAgICAgdGhpcy5oaXN0b2dyYW1JbWFnZSA9IGNvbG9yRGF0YTsKCiAgICAvLyAgICAgICBjb25zdCBjaGVja0RldGVjdGVkU3RhcnNGaW5pc2ggPSAoKSA9PiB7CiAgICAvLyAgICAgICAgIGlmICh0aGlzLkRldGVjdGVkU3RhcnNGaW5pc2gpIHsKICAgIC8vICAgICAgICAgICB0aGlzLmRldGVjdFN0YXJzSW1nID0gdGhpcy5EcmF3RGV0ZWN0U3RhcnModGFyZ2V0SW1nOCwgdGhpcy5EZXRlY3RlZFN0YXJzTGlzdCk7CiAgICAvLyAgICAgICAgICAgdGFyZ2V0SW1nOC5kZWxldGUoKTsKICAgIC8vICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9OwoKICAgIC8vICAgICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbChjaGVja0RldGVjdGVkU3RhcnNGaW5pc2gsIDEwMDApOwogICAgLy8gICAgIH0KCiAgICAvLyAgICAgLy8gaWYgKHRoaXMuaXNOb3REcmF3U3RhcnMpIHsKICAgIC8vICAgICAvLyAgIHRoaXMuZHJhd0ltYWdlRGF0YSh0aGlzLmRyYXdJbWdEYXRhKTsKICAgIC8vICAgICAvLyB9IGVsc2UgewogICAgLy8gICAgIC8vICAgaWYgKHRoaXMuZGV0ZWN0U3RhcnNJbWcgIT0gbnVsbCkgewogICAgLy8gICAgIC8vICAgICB0aGlzLmRyYXdJbWFnZURhdGEodGhpcy5kZXRlY3RTdGFyc0ltZyk7CiAgICAvLyAgICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIC8vICAgICB0aGlzLmRyYXdJbWFnZURhdGEodGhpcy5kcmF3SW1nRGF0YSk7CiAgICAvLyAgICAgLy8gICB9CiAgICAvLyAgICAgLy8gfQoKICAgIC8vICAgICAvLyBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwogICAgLy8gICAgIC8vIGNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKCiAgICAvLyAgICAgLy8gY29uc3QgbWluVHJhbnNsYXRlWCA9IHRoaXMuaW1hZ2VXaWR0aCAtIHRoaXMuQ2FudmFzV2lkdGg7CiAgICAvLyAgICAgLy8gY29uc3QgbWluVHJhbnNsYXRlWSA9IHRoaXMuaW1hZ2VIZWlnaHQgLSB0aGlzLkNhbnZhc0hlaWdodDsKCiAgICAvLyAgICAgLy8g6K6h566X5Yid5aeL55qEIFNjYWxlSW1hZ2VTaXplX1gg5ZKMIFNjYWxlSW1hZ2VTaXplX1kKICAgIC8vICAgICAvLyB0aGlzLlNjYWxlSW1hZ2VTaXplX1ggPSBNYXRoLmZsb29yKG1pblRyYW5zbGF0ZVggLyB0aGlzLkNhbnZhc1dpZHRoICogd2luZG93V2lkdGggKyB3aW5kb3dXaWR0aCk7CiAgICAvLyAgICAgLy8gdGhpcy5TY2FsZUltYWdlU2l6ZV9ZID0gTWF0aC5mbG9vcihtaW5UcmFuc2xhdGVZIC8gdGhpcy5DYW52YXNIZWlnaHQgKiB3aW5kb3dIZWlnaHQgKyB3aW5kb3dIZWlnaHQpOwoKICAgIC8vICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ1NjYWxlSW1hZ2VTaXplJywgdGhpcy5TY2FsZUltYWdlU2l6ZV9YLCB0aGlzLlNjYWxlSW1hZ2VTaXplX1kpOwoKICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIC8vICAgICB0aGlzLmhhbmRsZUVycm9yKCdQcm9jZXNzIGltYWdlIGRhdGEgZXJyb3InLCAncHJvY2Vzc0ltYWdlJywgZXJyb3IpOwogICAgLy8gICAgIGlmIChtYXQpIHsKICAgIC8vICAgICAgIG1hdC5kZWxldGUoKTsKICAgIC8vICAgICB9CiAgICAvLyAgICAgaWYgKHJlc2l6ZUltZykgewogICAgLy8gICAgICAgcmVzaXplSW1nLmRlbGV0ZSgpOwogICAgLy8gICAgIH0KICAgIC8vICAgICBpZiAob3JpZ2luYWxJbWc4KSB7CiAgICAvLyAgICAgICBvcmlnaW5hbEltZzguZGVsZXRlKCk7CiAgICAvLyAgICAgfQogICAgLy8gICAgIGlmICh0YXJnZXRJbWc4KSB7CiAgICAvLyAgICAgICB0YXJnZXRJbWc4LmRlbGV0ZSgpOwogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gfSwKCiAgICAvLyBoaXN0b2dyYW1TdHJldGNoKGltYWdlRGF0YSwgbWluLCBtYXgpIHsKICAgIC8vICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgIC8vICAgLy8gQ29udmVydCBJbWFnZURhdGEgdG8gY3YuTWF0CiAgICAvLyAgIGNvbnN0IGltYWdlID0gY3YubWF0RnJvbUltYWdlRGF0YShpbWFnZURhdGEpOwogICAgLy8gICBsZXQgVGltZTEgPSBuZXcgRGF0ZSgpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdoaXN0b2dyYW1TdHJldGNoIHwg6L2s5o2i5Zu+5YOP5pWw5o2u5pe26Ze0OiAnICsgKFRpbWUxLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIFBlcmZvcm0gdGhlIGhpc3RvZ3JhbSBzdHJldGNoCiAgICAvLyAgIGNvbnN0IGNoYW5uZWxzID0gbmV3IGN2Lk1hdFZlY3RvcigpOwogICAgLy8gICBjdi5zcGxpdChpbWFnZSwgY2hhbm5lbHMpOyAvLyBTcGxpdCBjaGFubmVscyAoQkdSKSBpbnRvIHNlcGFyYXRlIE1hdCBvYmplY3RzCiAgICAvLyAgIGxldCBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDliIblibLpgJrpgZPml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBDYWxjdWxhdGUgYWxwaGEgYW5kIGJldGEgZm9yIGVhY2ggY2hhbm5lbAogICAgLy8gICBsZXQgYWxwaGEgPSAyNTUuMCAvIChtYXggLSBtaW4pOwogICAgLy8gICBsZXQgYmV0YSA9IC1taW4gKiBhbHBoYTsKCiAgICAvLyAgIGlmIChhbHBoYSA8IDApIHsKICAgIC8vICAgICBhbHBoYSA9IDA7CiAgICAvLyAgICAgYmV0YSA9IDA7CiAgICAvLyAgIH0gZWxzZSBpZiAoYWxwaGEgPiAyNTUpIHsKICAgIC8vICAgICBhbHBoYSA9IDI1NTsKICAgIC8vICAgICBiZXRhID0gMDsKICAgIC8vICAgfQogICAgLy8gICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDorqHnrpdhbHBoYeWSjGJldGHml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBJdGVyYXRlIG92ZXIgZWFjaCBjaGFubmVsIGFuZCBhcHBseSBoaXN0b2dyYW0gc3RyZXRjaGluZwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYW5uZWxzLnNpemUoKTsgaSsrKSB7CiAgICAvLyAgICAgbGV0IGNoYW5uZWwgPSBjaGFubmVscy5nZXQoaSk7CgoKICAgIC8vICAgICAvLyBBcHBseSBoaXN0b2dyYW0gc3RyZXRjaGluZyB0byB0aGUgY2hhbm5lbAogICAgLy8gICAgIGNoYW5uZWwuY29udmVydFRvKGNoYW5uZWwsIC0xLCBhbHBoYSwgYmV0YSk7CgogICAgLy8gICAgIC8vIFJlbGVhc2UgdGhlIG1lbW9yeSBvZiBjaGFubmVsCiAgICAvLyAgICAgY2hhbm5lbC5kZWxldGUoKTsKICAgIC8vICAgfQogICAgLy8gICBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDlkITpgJrpgZPmi4nkvLjml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBNZXJnZSB0aGUgY2hhbm5lbHMgYmFjayBpbnRvIGEgc2luZ2xlIGltYWdlCiAgICAvLyAgIGNvbnN0IHN0cmV0Y2hJbWFnZSA9IG5ldyBjdi5NYXQoKTsKICAgIC8vICAgY3YubWVyZ2UoY2hhbm5lbHMsIHN0cmV0Y2hJbWFnZSk7CiAgICAvLyAgIFRpbWUxID0gbmV3IERhdGUoKTsKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnaGlzdG9ncmFtU3RyZXRjaCB8IOWQiOW5tumAmumBk+aXtumXtDogJyArIChUaW1lMS5nZXRUaW1lKCkgLSBUaW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIFJlbGVhc2UgdGhlIG1lbW9yeSBvZiBjaGFubmVscyBhbmQgTWF0VmVjdG9yCiAgICAvLyAgIGNoYW5uZWxzLmRlbGV0ZSgpOwoKICAgIC8vICAgLy8gQ29udmVydCBjdi5NYXQgYmFjayB0byBJbWFnZURhdGEKICAgIC8vICAgY29uc3Qgc3RyZXRjaGVkSW1hZ2VEYXRhID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoc3RyZXRjaEltYWdlLmRhdGEpLCBzdHJldGNoSW1hZ2UuY29scywgc3RyZXRjaEltYWdlLnJvd3MpOwogICAgLy8gICBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDovazmjaLlm77lg4/mlbDmja7ml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBDbGVhbiB1cAogICAgLy8gICBpbWFnZS5kZWxldGUoKTsKICAgIC8vICAgc3RyZXRjaEltYWdlLmRlbGV0ZSgpOwogICAgLy8gICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDph4rmlL7lhoXlrZjml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdoaXN0b2dyYW1TdHJldGNoIHwg5oC75pe26Ze0OiAnICsgKFRpbWUxLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIHJldHVybiBzdHJldGNoZWRJbWFnZURhdGE7CiAgICAvLyB9LAoKICAgIGhpc3RvZ3JhbVN0cmV0Y2goaW1hZ2VEYXRhLCBtaW4sIG1heCkgewogICAgICBpZiAobWF4IDwgbWluKSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnaGlzdG9ncmFtU3RyZXRjaCB8IG1heCA8IG1pbiwgcmV0dXJuIG9yaWdpbmFsIGltYWdlRGF0YScsICd3YXJuaW5nJyk7CiAgICAgICAgbWF4ID0gbWluOwogICAgICB9CiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgIC8vIENhbGN1bGF0ZSBhbHBoYSBhbmQgYmV0YQogICAgICBsZXQgYWxwaGEgPSAyNTUuMCAvIChtYXggLSBtaW4pOwogICAgICBsZXQgYmV0YSA9IC1taW4gKiBhbHBoYTsKCiAgICAgIGlmIChhbHBoYSA8IDApIHsKICAgICAgICBhbHBoYSA9IDA7CiAgICAgICAgYmV0YSA9IDA7CiAgICAgIH0gZWxzZSBpZiAoYWxwaGEgPiAyNTUpIHsKICAgICAgICBhbHBoYSA9IDI1NTsKICAgICAgICBiZXRhID0gMDsKICAgICAgfQoKICAgICAgLy8gQXBwbHkgaGlzdG9ncmFtIHN0cmV0Y2hpbmcgZGlyZWN0bHkgb24gSW1hZ2VEYXRhCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgeyAvLyBGb3IgZWFjaCBjb2xvciBjaGFubmVsCiAgICAgICAgICBsZXQgdmFsdWUgPSBpbWFnZURhdGEuZGF0YVtpICsgal07CiAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogYWxwaGEgKyBiZXRhOwogICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIGpdID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMjU1LCB2YWx1ZSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDmgLvml7bpl7Q6ICcgKyAoZW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICByZXR1cm4gaW1hZ2VEYXRhOwogICAgfSwKICAgIGxvY2FsV2hpdGVCYWxhbmNlQWRqdXN0bWVudChpbWFnZURhdGEsIGdhaW5SLCBnYWluQiwgb2Zmc2V0KSB7CiAgICAgIC8vIOWIhuemu+mAmumBkwogICAgICBsZXQgdmFsdWU7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgeyAvLyBGb3IgZWFjaCBjb2xvciBjaGFubmVsCiAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgIHZhbHVlID0gaW1hZ2VEYXRhLmRhdGFbaSArIGpdOwogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogZ2FpbkIgKyBvZmZzZXQ7CiAgICAgICAgICB9IGVsc2UgaWYgKGogPT0gMikgewogICAgICAgICAgICB2YWx1ZSA9IGltYWdlRGF0YS5kYXRhW2kgKyBqXTsKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSAqIGdhaW5SICsgb2Zmc2V0OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsdWUgPSBpbWFnZURhdGEuZGF0YVtpICsgal07CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiAxICsgb2Zmc2V0OwogICAgICAgICAgfQogICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIGpdID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMjU1LCB2YWx1ZSkpOwogICAgICAgIH0KICAgICAgfQoKCiAgICAgIHJldHVybiBpbWFnZURhdGE7CiAgICB9LAoKICAgIGluaXRDYW52YXMoKSB7CiAgICAgIHRoaXMuYnVmZmVyQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIHRoaXMuYnVmZmVyQ3R4ID0gdGhpcy5idWZmZXJDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgIHRoaXMudGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICB0aGlzLnRlbXBDdHggPSB0aGlzLnRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIH0sCgogICAgLy8qLyovKi8qLyovKi8qLyovKi8qLyovCiAgICBTd2l0Y2hJbWFnZVRvU2hvdyhpc09yaWdpbmFsKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdTaG93IE9yaWdpbmFsIEltYWdlOiAnLCBpc09yaWdpbmFsKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU2hvdyBPcmlnaW5hbCBJbWFnZTonICsgaXNPcmlnaW5hbCwgJ2luZm8nKTsKICAgICAgdGhpcy5pc05vdERyYXdTdGFycyA9IGlzT3JpZ2luYWw7CiAgICAgIGlmIChpc09yaWdpbmFsKSB7CiAgICAgICAgLy8gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZVRvdWNoT3JNb3VzZURvd24pOwogICAgICAgIHRoaXMuZW5hYmxlTWFpbkNhbnZhc0NsaWNrID0gZmFsc2U7CiAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZVRvdWNoT3JNb3VzZURvd24pOwogICAgICAgIHRoaXMuZW5hYmxlTWFpbkNhbnZhc0NsaWNrID0gdHJ1ZTsKICAgICAgICAvLyB0aGlzLmRyYXdJbWFnZURhdGEodGhpcy5kZXRlY3RTdGFyc0ltZyk7CiAgICAgIH0KICAgIH0sCgoKCiAgICBkcmF3SW1hZ2VEYXRhKCkgewogICAgICBpZiAodGhpcy5idWZmZXJDYW52YXMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgZXJyb3I6IGJ1ZmZlckNhbnZhcyBpcyBudWxsIG9yIHVuZGVmaW5lZC4nLCAnZXJyb3InKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmRyYXdJbWdEYXRhKSByZXR1cm47CgogICAgICAvLyDlj6/nlKjnm7jlhbPlj4LmlbAKICAgICAgLy8gd2luZG93LmlubmVyV2lkdGg7IC8vIOeql+WPo+WuveW6pgogICAgICAvLyB3aW5kb3cuaW5uZXJIZWlnaHQ7IC8vIOeql+WPo+mrmOW6pgogICAgICAvLyB0aGlzLnNjYWxlIOe8qeaUvuavlOS+iwogICAgICAvLyB0aGlzLnRyYW5zbGF0ZVgg5bmz56e7eOWdkOaghwogICAgICAvLyB0aGlzLnRyYW5zbGF0ZVkg5bmz56e7eeWdkOaghwogICAgICAvLyB0aGlzLkNhbnZhc1dpZHRoIOS4u+eUu+W4g+WuveW6piAxOTIwCiAgICAgIC8vIHRoaXMuQ2FudmFzSGVpZ2h0IOS4u+eUu+W4g+mrmOW6piAxMDgwCiAgICAgIC8vIHRoaXMubWFpbkNhbWVyYVNpemVYIOWOn+Wni+WbvuWDj+WuveW6pgogICAgICAvLyB0aGlzLm1haW5DYW1lcmFTaXplWSDljp/lp4vlm77lg4/pq5jluqYKICAgICAgLy8gdGhpcy5idWZmZXJDYW52YXMud2lkdGgg57yT5Yay55S75biD5a695bqmCiAgICAgIC8vIHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCDnvJPlhrLnlLvluIPpq5jluqYKICAgICAgLy8gdGhpcy5JbWFnZVByb3BvcnRpb24g5Zu+5YOP5q+U5L6LCiAgICAgIC8vIHRoaXMuUk9JX3ggUk9J55qEeOWdkOaghwogICAgICAvLyB0aGlzLlJPSV95IFJPSeeahHnlnZDmoIcKICAgICAgLy8gdGhpcy5ST0lfbGVuZ3RoIFJPSeeahOmVv+W6pgoKICAgICAgLy8gY29uc29sZS5sb2coJ+W9k+WJjeeUu+W4g+WPguaVsDpcbiBidWZmZXJDYW52YXMud2lkdGg6ICcsIHRoaXMuYnVmZmVyQ2FudmFzLndpZHRoLCAnXG4gYnVmZmVyQ2FudmFzLmhlaWdodDogJywgdGhpcy5idWZmZXJDYW52YXMuaGVpZ2h0LCAnXG4gSW1hZ2VQcm9wb3J0aW9uOiAnLCB0aGlzLkltYWdlUHJvcG9ydGlvbiwgJ1xuIHNjYWxlOiAnLCB0aGlzLnNjYWxlLCAnXG4gdmlzaWJsZVg6ICcsIHRoaXMudmlzaWJsZVgsICdcbiB2aXNpYmxlWTogJywgdGhpcy52aXNpYmxlWSwgJ1xuIHZpc2libGVXaWR0aDogJywgdGhpcy52aXNpYmxlV2lkdGgsICdcbiB2aXNpYmxlSGVpZ2h0OiAnLCB0aGlzLnZpc2libGVIZWlnaHQsICdcbiBST0lfeDogJywgdGhpcy5ST0lfeCwgJ1xuIFJPSV95OiAnLCB0aGlzLlJPSV95LCAnXG4gUk9JX2xlbmd0aDogJywgdGhpcy5ST0lfbGVuZ3RoKTsKCgogICAgICAvLyDorqHnrpflj6/op4HljLrln58KICAgICAgY29uc3QgbmV3VmlzaWJsZVdpZHRoID0gdGhpcy5idWZmZXJDYW52YXMud2lkdGggKiB0aGlzLnNjYWxlOwogICAgICBjb25zdCBuZXdWaXNpYmxlSGVpZ2h0ID0gbmV3VmlzaWJsZVdpZHRoIC8gdGhpcy5JbWFnZVByb3BvcnRpb247CgogICAgICAvLyDorqHnrpflj6/op4HljLrln5945Z2Q5qCHCiAgICAgIGxldCBuZXdWaXNpYmxlWCA9IHRoaXMudmlzaWJsZVg7CiAgICAgIC8vIOiuoeeul+WPr+ingeWMuuWfn3nlnZDmoIcKICAgICAgbGV0IG5ld1Zpc2libGVZID0gdGhpcy52aXNpYmxlWTsKCiAgICAgIC8vIOmBv+WFjeWbvuWDj+i2iueVjAogICAgICBpZiAobmV3VmlzaWJsZVggLSBuZXdWaXNpYmxlV2lkdGggLyAyIDwgMCkgewogICAgICAgIG5ld1Zpc2libGVYID0gbmV3VmlzaWJsZVdpZHRoIC8gMjsKICAgICAgfSBlbHNlIGlmIChuZXdWaXNpYmxlWCArIG5ld1Zpc2libGVXaWR0aCAvIDIgPiB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCkgewogICAgICAgIG5ld1Zpc2libGVYID0gdGhpcy5idWZmZXJDYW52YXMud2lkdGggLSBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgICB9CgogICAgICBpZiAobmV3VmlzaWJsZVkgLSBuZXdWaXNpYmxlSGVpZ2h0IC8gMiA8IDApIHsKICAgICAgICBuZXdWaXNpYmxlWSA9IG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICB9IGVsc2UgaWYgKG5ld1Zpc2libGVZICsgbmV3VmlzaWJsZUhlaWdodCAvIDIgPiB0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQpIHsKICAgICAgICBuZXdWaXNpYmxlWSA9IHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCAtIG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICB9CgogICAgICAvLyDmm7TmlrBST0nljLrln58KICAgICAgLy8g6K6h566X5Y+v6KeB5Yy65Z+f55qE6L6555WMCiAgICAgIGNvbnN0IHZpc2libGVMZWZ0ID0gbmV3VmlzaWJsZVggLSBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgICBjb25zdCB2aXNpYmxlUmlnaHQgPSBuZXdWaXNpYmxlWCArIG5ld1Zpc2libGVXaWR0aCAvIDI7CiAgICAgIGNvbnN0IHZpc2libGVUb3AgPSBuZXdWaXNpYmxlWSAtIG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICBjb25zdCB2aXNpYmxlQm90dG9tID0gbmV3VmlzaWJsZVkgKyBuZXdWaXNpYmxlSGVpZ2h0IC8gMjsKCiAgICAgIC8vIOiuoeeulyBST0kg5Yy65Z+f55qE6L6555WMCiAgICAgIGNvbnN0IHJvaUxlZnQgPSB0aGlzLlJPSV94OwogICAgICBjb25zdCByb2lSaWdodCA9IHRoaXMuUk9JX3ggKyB0aGlzLlJPSV9sZW5ndGg7CiAgICAgIGNvbnN0IHJvaVRvcCA9IHRoaXMuUk9JX3k7CiAgICAgIGNvbnN0IHJvaUJvdHRvbSA9IHRoaXMuUk9JX3kgKyB0aGlzLlJPSV9sZW5ndGg7CgogICAgICAvLyDliKTmlq0gUk9JIOWMuuWfn+aYr+WQpuWcqOWPr+ingeWMuuWfn+WGhQogICAgICBjb25zdCBpc1JvaUluVmlzaWJsZSA9IHJvaVJpZ2h0ID49IHZpc2libGVMZWZ0ICYmIHJvaUxlZnQgPD0gdmlzaWJsZVJpZ2h0ICYmIHJvaUJvdHRvbSA+PSB2aXNpYmxlVG9wICYmIHJvaVRvcCA8PSB2aXNpYmxlQm90dG9tOwoKICAgICAgLy8g6K6h566XIFJPSSDljLrln5/lnKjlsY/luZXkuIrnmoTkvY3nva7vvIzkuK3lv4PngrnlnZDmoIcKICAgICAgY29uc3Qgcm9pU2NyZWVuWCA9ICh0aGlzLlJPSV94IC0gdmlzaWJsZUxlZnQpICogKHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoKSArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoIC8gMjsKICAgICAgY29uc3Qgcm9pU2NyZWVuWSA9ICh0aGlzLlJPSV95IC0gdmlzaWJsZVRvcCkgKiAod2luZG93LmlubmVySGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodCkgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0IC8gMjsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnUk9JIOWMuuWfn+WcqOWxj+W5leS4iueahOS9jee9rjogJyArIHJvaVNjcmVlblggKyAnKicgKyByb2lTY3JlZW5ZICsgJ+mVv+W6piAnICsgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGggKyAnKicgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0LCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFJlZEJveExlbmd0aCcsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoLCB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRSZWRCb3hQb3NpdGlvbicsIHJvaVNjcmVlblgsIHJvaVNjcmVlblkpOwoKCiAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuJHJlZnMubWFpbkNhbnZhczsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMuQ2FudmFzV2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLkNhbnZhc0hlaWdodDsKCiAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5idWZmZXJDYW52YXMsIHZpc2libGVMZWZ0LCB2aXNpYmxlVG9wLCBuZXdWaXNpYmxlV2lkdGgsIG5ld1Zpc2libGVIZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgICB0aGlzLnZpc2libGVYID0gbmV3VmlzaWJsZVg7CiAgICAgIHRoaXMudmlzaWJsZVkgPSBuZXdWaXNpYmxlWTsKICAgICAgdGhpcy52aXNpYmxlV2lkdGggPSBuZXdWaXNpYmxlV2lkdGg7CiAgICAgIHRoaXMudmlzaWJsZUhlaWdodCA9IG5ld1Zpc2libGVIZWlnaHQ7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldEN1cnJlbnRNYWluQ2FudmFzSGFzSW1hZ2UnLCB0cnVlKTsgLy8g5Y+R6YCB57uZ55S16LCD77yM55So5LqO5Yik5pat5piv5ZCm5Y+v5Lul6L+b6KGM5b6q546v5ouN5pGECiAgICAgIC8vIOWPkemAgea2iOaBr+e7mVFU5a6i5oi356uv77yM55So5LqO5L+h5oGv5Zu+5qCHCiAgICAgIC8vIOe7n+S4gOWdkOagh++8muWPkemAgee7mSBRVCDnmoQgUk9JIOWdkOagh+mHh+eUqOS8oOaEn+WZqOWDj+e0oOWdkOagh++8iOS4jeWGjeaMiSBiaW4g5pS+5aSn77yJ77yM6YG/5YWN5Zyo5Zue546v5Lit6KKr6YeN5aSN5LmY5LulIGJpbiDlr7zoh7TmjIfmlbDnuqflop7plb8KICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzZW5kVmlzaWJsZUFyZWE6JyArIHRoaXMudmlzaWJsZVggKyAnOicgKyB0aGlzLnZpc2libGVZICsgJzonICsgdGhpcy5zY2FsZSk7CgogICAgICAvLyDlpoLmnpzpgInmi6nkuobmmJ/ngrnvvIzliJnmoLnmja7pgInmi6nkvY3nva7vvIzlnKhST0nljLrln5/kuK3nu5jliLbkuIDkuKrlnIYKICAgICAgaWYgKHRoaXMuRHJhd1NlbGVjdFN0YXJYICE9IC0xICYmIHRoaXMuRHJhd1NlbGVjdFN0YXJZICE9IC0xICYmIHRoaXMuc2hvd1NlbGVjdFN0YXIpIHsKICAgICAgICBsZXQgcmFkaXVzLCBjYW52YXNTdGFyWCwgY2FudmFzU3RhclksIGNvbG9yOwogICAgICAgIC8vIOWmguaenOacieaYn+eCuQogICAgICAgIGlmICh0aGlzLkRyYXdTZWxlY3RTdGFySEZSICE9IC0xKSB7CiAgICAgICAgICByYWRpdXMgPSB0aGlzLkRyYXdTZWxlY3RTdGFySEZSIC8gdGhpcy5zY2FsZSAqIDI7CiAgICAgICAgICBpZiAocmFkaXVzIDw9IDEpIHJhZGl1cyA9IDE7CiAgICAgICAgICBjYW52YXNTdGFyWCA9ICh0aGlzLkRyYXdTZWxlY3RTdGFyWCAvIHRoaXMuY2FtZXJhQmluICsgdGhpcy5ST0lfeCAtIHZpc2libGVMZWZ0KSAqIGN0eC5jYW52YXMud2lkdGggLyBuZXdWaXNpYmxlV2lkdGg7CiAgICAgICAgICBjYW52YXNTdGFyWSA9ICh0aGlzLkRyYXdTZWxlY3RTdGFyWSAvIHRoaXMuY2FtZXJhQmluICsgdGhpcy5ST0lfeSAtIHZpc2libGVUb3ApICogY3R4LmNhbnZhcy5oZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0OwogICAgICAgICAgY29sb3IgPSAnZ3JlZW4nOyAvLyDmnInmmJ/ngrnvvIznu5jliLbnu7/oibLnmoTlnIYKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5ZCm5YiZ77yM5Zyo6YCJ5oup55qE5L2N572u57uY5Yi25LiA5Liq5ZyGCiAgICAgICAgICByYWRpdXMgPSAxMCAvIHRoaXMuc2NhbGU7IC8vIOS9oOWPr+S7peagueaNrumcgOimgeiwg+aVtOi/meS4quWAvAogICAgICAgICAgY2FudmFzU3RhclggPSAodGhpcy5EcmF3U2VsZWN0U3RhclggLyB0aGlzLmNhbWVyYUJpbiArIHRoaXMuUk9JX3ggLSB2aXNpYmxlTGVmdCkgKiBjdHguY2FudmFzLndpZHRoIC8gbmV3VmlzaWJsZVdpZHRoOwogICAgICAgICAgY2FudmFzU3RhclkgPSAodGhpcy5EcmF3U2VsZWN0U3RhclkgLyB0aGlzLmNhbWVyYUJpbiArIHRoaXMuUk9JX3kgLSB2aXNpYmxlVG9wKSAqIGN0eC5jYW52YXMuaGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodDsKICAgICAgICAgIGNvbG9yID0gJ3JlZCc7IC8vIOaXoOaYn+eCue+8jOe7mOWItue6ouiJsueahOWchgogICAgICAgIH0KCiAgICAgICAgLy8g6I635Y+W57uY5Yi25ZyG55qE5L2N572u55qE5Zu+5YOP5pWw5o2uCiAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YShjYW52YXNTdGFyWCAtIHJhZGl1cywgY2FudmFzU3RhclkgLSByYWRpdXMsIDIgKiByYWRpdXMsIDIgKiByYWRpdXMpOwogICAgICAgIC8vIOWPkemAgeWbvuWDj+aVsOaNrue7meaYvuekuuahhgogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2VsZWN0U3RhckltYWdlJywgaW1hZ2VEYXRhKTsKICAgICAgICBjb25zb2xlLmxvZygn57uY5Yi25pif54K555qE5L2N572u5ZKM5aSn5bCPOiB4ID0nLCBjYW52YXNTdGFyWCwgJ3kgPScsIGNhbnZhc1N0YXJZLCAncmFkaXVzID0nLCByYWRpdXMpOwogICAgICAgIC8vIOWcqOaMh+WumuS9jee9ruW8gOWni+e7mOWItuWchgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHguYXJjKGNhbnZhc1N0YXJYLCBjYW52YXNTdGFyWSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDM7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgfQoKICAgIH0sCgogICAgYWRkRXZlbnRMaXN0ZW5lcnMoKSB7CgogICAgfSwKCiAgICAvLyDoioLmtYHlh73mlbAKICAgIHRocm90dGxlKGZ1bmMsIGRlbGF5KSB7CiAgICAgIGxldCBsYXN0RXhlY3V0ZWQgPSAwOwogICAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHsKICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgICAgIGlmIChub3cgLSBsYXN0RXhlY3V0ZWQgPj0gZGVsYXkpIHsKICAgICAgICAgIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgICBsYXN0RXhlY3V0ZWQgPSBub3c7CiAgICAgICAgfQogICAgICB9OwogICAgfSwKCiAgICBCaXQxNlRvOF9TdHJldGNoKGltZzE2LCBCLCBXKSB7CiAgICAgIGNvbnNvbGUubG9nKCdCaXQxNlRvOF9TdHJldGNoIHwgQiA9ICcgKyBCICsgJywgVyA9ICcgKyBXKTsKICAgICAgbGV0IGltZzggPSBuZXcgY3YuTWF0KGltZzE2LnJvd3MsIGltZzE2LmNvbHMsIGN2LkNWXzhVQzQpOwogICAgICBpbWcxNi5jb252ZXJ0VG8oaW1nOCwgY3YuQ1ZfOFUsIDI1NS4wIC8gKFcgLSBCKSwgLUIgKiAyNTUuMCAvIChXIC0gQikpOwogICAgICByZXR1cm4gaW1nODsKICAgIH0sCgogICAgRHJhd0RldGVjdFN0YXJzKGltYWdlLCBTdGFycykgewogICAgICBjb25zb2xlLmxvZygnRHJhdyBjaXJjbGUgb24gdGhlIENhcHR1cmUgSW1hZ2UoJywgaW1hZ2UuY29scywgJywnLCBpbWFnZS5yb3dzLCAnKS4nKTsKICAgICAgaWYgKCEoaW1hZ2UgaW5zdGFuY2VvZiBjdi5NYXQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGltYWdlIGRhdGEnKTsKICAgICAgfQogICAgICBTdGFycy5mb3JFYWNoKHN0YXIgPT4gewogICAgICAgIGxldCBjZW50ZXJYID0gTWF0aC5yb3VuZChzdGFyLnggLyAodGhpcy5tYWluQ2FtZXJhU2l6ZVggLyBpbWFnZS5jb2xzKSk7CiAgICAgICAgbGV0IGNlbnRlclkgPSBNYXRoLnJvdW5kKHN0YXIueSAvICh0aGlzLm1haW5DYW1lcmFTaXplWSAvIGltYWdlLnJvd3MpKTsKICAgICAgICBsZXQgcmFkaXVzID0gTWF0aC5yb3VuZChzdGFyLmhmcik7CgogICAgICAgIGNvbnNvbGUubG9nKCdEcmF3IGNpcmNsZSBhdCgnLCBjZW50ZXJYLCAnLCcsIGNlbnRlclksICcpIHdpdGggcmFkaXVzOicsIHJhZGl1cyk7CgogICAgICAgIGxldCBjZW50ZXIgPSBuZXcgY3YuUG9pbnQoY2VudGVyWCwgY2VudGVyWSk7CiAgICAgICAgbGV0IGNvbG9yID0gbmV3IGN2LlNjYWxhcigyNTUsIDAsIDAsIDI1NSk7CiAgICAgICAgbGV0IHRoaWNrbmVzcyA9IDI7IC8vIOWchuWciOWOmuW6pgoKICAgICAgICBjdi5jaXJjbGUoaW1hZ2UsIGNlbnRlciwgcmFkaXVzLCBjb2xvciwgdGhpY2tuZXNzKTsKCiAgICAgICAgLy8g5re75YqgIGhmciDlgLzliLDlnIbnmoTkuIrmlrkKICAgICAgICAvLyDnoa7kv50gc3Rhci5oZnIg5piv5LiA5Liq5pWw5a2XCiAgICAgICAgbGV0IGhmclZhbHVlID0gcGFyc2VGbG9hdChzdGFyLmhmcik7CiAgICAgICAgaWYgKGlzTmFOKGhmclZhbHVlKSkgewogICAgICAgICAgaGZyVmFsdWUgPSAwOyAvLyDlpoLmnpwgc3Rhci5oZnIg5LiN6IO96L2s5o2i5Li65pWw5a2X77yM5YiZ6buY6K6k5YC86K6+5Li6MAogICAgICAgIH0KCiAgICAgICAgLy8g5L+d55WZ5Yiw5bCP5pWw54K55ZCOMuS9jQogICAgICAgIGxldCB0ZXh0ID0gaGZyVmFsdWUudG9GaXhlZCgyKTsKICAgICAgICBsZXQgZm9udEZhY2UgPSBjdi5GT05UX0hFUlNIRVlfU0lNUExFWDsKICAgICAgICBsZXQgZm9udFNjYWxlID0gMTsKICAgICAgICBsZXQgdGV4dENvbG9yID0gbmV3IGN2LlNjYWxhcigyNTUsIDAsIDAsIDI1NSk7CiAgICAgICAgbGV0IHRleHRUaGlja25lc3MgPSAyOwoKICAgICAgICAvLyDmiYvliqjorr7nva7mlofmnKznmoTkvY3nva7vvIzlgYforr7lrZfkvZPpq5jluqblpKfnuqbkuLoxMOWDj+e0oAogICAgICAgIGxldCB0ZXh0WCA9IGNlbnRlclggLSAodGV4dC5sZW5ndGggKiAxMCk7IC8vIOS8sOeul+avj+S4quWtl+espuWuveW6puS4ujXlg4/ntKAKICAgICAgICBsZXQgdGV4dFkgPSBjZW50ZXJZIC0gcmFkaXVzIC0gMzsgLy8g5ZyG55qE5LiK5pa5IDMg5YOP57SgCgogICAgICAgIC8vIOWcqOWbvuWDj+S4iue7mOWItuaWh+acrAogICAgICAgIGN2LnB1dFRleHQoaW1hZ2UsIHRleHQsIG5ldyBjdi5Qb2ludCh0ZXh0WCwgdGV4dFkpLCBmb250RmFjZSwgZm9udFNjYWxlLCB0ZXh0Q29sb3IsIHRleHRUaGlja25lc3MpOwogICAgICB9KTsKCiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlLmRhdGEpLCBpbWFnZS5jb2xzLCBpbWFnZS5yb3dzKTsKCiAgICAgIHJldHVybiBpbWFnZURhdGE7CiAgICB9LAoKICAgIERyYXdQSEQyQm94KFBIRDJJbWFnZVNpemVfWCwgUEhEMkltYWdlU2l6ZV9ZLCBCb3hfWCwgQm94X1kpIHsKICAgICAgY29uc3QgcmF0aW9ab29tWCA9IFBIRDJJbWFnZVNpemVfWCAvIHdpbmRvdy5pbm5lcldpZHRoOwogICAgICBjb25zdCByYXRpb1pvb21ZID0gUEhEMkltYWdlU2l6ZV9ZIC8gd2luZG93LmlubmVySGVpZ2h0OwoKICAgICAgY29uc3QgQm94V2lkdGggPSAyMCAvIHJhdGlvWm9vbVg7CiAgICAgIGNvbnN0IEJveEhlaWdodCA9IDIwIC8gcmF0aW9ab29tWTsKCiAgICAgIGNvbnN0IEJveFN0YXJ0WCA9IEJveF9YIC8gcmF0aW9ab29tWCAtIEJveFdpZHRoIC8gMjsKICAgICAgY29uc3QgQm94U3RhcnRZID0gQm94X1kgLyByYXRpb1pvb21ZIC0gQm94SGVpZ2h0IC8gMjsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnUEhEMkJveFBvc2l0aW9uJywgQm94U3RhcnRYLCBCb3hTdGFydFksIEJveFdpZHRoLCBCb3hIZWlnaHQpOwogICAgfSwKCiAgICBEcmF3UEhEMkNyb3NzKFBIRDJJbWFnZVNpemVfWCwgUEhEMkltYWdlU2l6ZV9ZLCBDcm9zc19YLCBDcm9zc19ZKSB7CiAgICAgIGNvbnN0IHJhdGlvWm9vbVggPSBQSEQySW1hZ2VTaXplX1ggLyB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgY29uc3QgcmF0aW9ab29tWSA9IFBIRDJJbWFnZVNpemVfWSAvIHdpbmRvdy5pbm5lckhlaWdodDsKCiAgICAgIGNvbnN0IENyb3NzU3RhcnRYID0gQ3Jvc3NfWCAvIHJhdGlvWm9vbVg7CiAgICAgIGNvbnN0IENyb3NzU3RhcnRZID0gQ3Jvc3NfWSAvIHJhdGlvWm9vbVk7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ1BIRDJDcm9zc1Bvc2l0aW9uJywgQ3Jvc3NTdGFydFgsIENyb3NzU3RhcnRZKTsKICAgIH0sCgogICAgRHJhd1BIRDJNdWx0aVN0YXJzKFBIRDJJbWFnZVNpemVfWCwgUEhEMkltYWdlU2l6ZV9ZLCBTdGFyX1gsIFN0YXJfWSkgewogICAgICBjb25zdCByYXRpb1pvb21YID0gUEhEMkltYWdlU2l6ZV9YIC8gd2luZG93LmlubmVyV2lkdGg7CiAgICAgIGNvbnN0IHJhdGlvWm9vbVkgPSBQSEQySW1hZ2VTaXplX1kgLyB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogICAgICBjb25zdCBTdGFyU3RhcnRYID0gU3Rhcl9YIC8gcmF0aW9ab29tWCAtIDEyIC8gMjsKICAgICAgY29uc3QgU3RhclN0YXJ0WSA9IFN0YXJfWSAvIHJhdGlvWm9vbVkgLSAxMiAvIDI7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ1BIRDJNdWx0aVN0YXJzUG9zaXRpb24nLCBTdGFyU3RhcnRYLCBTdGFyU3RhcnRZKTsKICAgIH0sCgogICAgY2FsY3VsYXRlSGlzdG9ncmFtKGltYWdlRGF0YSkgewogICAgICBjb25zb2xlLmxvZygnUUhZQ0NEIHwgY2FsY3VsYXRlSGlzdG9ncmFtJyk7CiAgICAgIGNvbnN0IGhpc3RvZ3JhbSA9IFsKICAgICAgICBBcnJheSgyNTYpLmZpbGwoMCksIC8vIOWtmOWCqOiTneiJsumAmumBk+ebtOaWueWbvgogICAgICAgIEFycmF5KDI1NikuZmlsbCgwKSwgLy8g5a2Y5YKo57u/6Imy6YCa6YGT55u05pa55Zu+CiAgICAgICAgQXJyYXkoMjU2KS5maWxsKDApICAvLyDlrZjlgqjnuqLoibLpgJrpgZPnm7Tmlrnlm74KICAgICAgXTsKCiAgICAgIC8vIOWIhuWIq+iuoeeul+S4ieS4qumAmumBk+eahOebtOaWueWbvgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgY29uc3QgciA9IGltYWdlRGF0YS5kYXRhW2ldOwogICAgICAgIGNvbnN0IGcgPSBpbWFnZURhdGEuZGF0YVtpICsgMV07CiAgICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhW2kgKyAyXTsKCiAgICAgICAgLy8g5pu05paw5q+P5Liq6YCa6YGT55qE55u05pa55Zu+CiAgICAgICAgaGlzdG9ncmFtWzBdW2JdKys7CiAgICAgICAgaGlzdG9ncmFtWzFdW2ddKys7CiAgICAgICAgaGlzdG9ncmFtWzJdW3JdKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBoaXN0b2dyYW07CiAgICB9LAoKICAgIGFwcGx5SGlzdFN0cmV0Y2goTWluLCBNYXgpIHsKICAgICAgdGhpcy5jdXJyZW50SGlzdG9ncmFtTWluID0gTWluOwogICAgICB0aGlzLmN1cnJlbnRIaXN0b2dyYW1NYXggPSBNYXg7CiAgICAgIGlmICh0aGlzLkltYWdlQXJyYXlCdWZmZXIpIHsKICAgICAgICB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIsIE1pbiwgTWF4LCB7IGNhbGN1bGF0ZUhpc3RvZ3JhbTogZmFsc2UgfSk7CiAgICAgIH0KICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDaGFuZ2VEaWFsUG9zaXRpb24nLCBNaW4sIE1heCk7CiAgICB9LAoKCiAgICBjYWxjV2hpdGVCYWxhbmNlR2FpbnMoKSB7CiAgICAgIC8vIGNvbnN0IEdhaW5zID0gdGhpcy5jYWxjdWxhdGVXaGl0ZUJhbGFuY2VHYWlucyh0aGlzLmhpc3RvZ3JhbURhdGEsIHRoaXMuSW1hZ2VPZmZzZXQpOwogICAgICB0aGlzLmNhbGN1bGF0ZUdhaW4gPSB0cnVlOwogICAgICB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIsIHRoaXMuY3VycmVudEhpc3RvZ3JhbU1pbiwgdGhpcy5jdXJyZW50SGlzdG9ncmFtTWF4LCB7IGNhbGN1bGF0ZUhpc3RvZ3JhbTogZmFsc2UgfSk7CgogICAgICB0aGlzLkltYWdlR2FpblIgPSBHYWlucy5HYWluUjsKICAgICAgdGhpcy5JbWFnZUdhaW5CID0gR2FpbnMuR2FpbkI7CgogICAgICBjb25zdCBHYWluUkluZGV4ID0gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ0ltYWdlR2FpblInKTsKICAgICAgaWYgKEdhaW5SSW5kZXggIT09IC0xKSB7IC8vIOehruS/neaJvuWIsOS6huWvueW6lOeahOmFjee9rumhuQogICAgICAgIC8vIOabtOaWsCBFeHBUaW1lMSDphY3nva7pobnnmoTlgLwKICAgICAgICB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtc1tHYWluUkluZGV4XS52YWx1ZSA9IHRoaXMuSW1hZ2VHYWluUjsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZUdhaW5SIGNvbmZpZ3VyYXRpb24gaXRlbSBub3QgZm91bmQuJyk7CiAgICAgIH0KCiAgICAgIGNvbnN0IEdhaW5CSW5kZXggPSB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnSW1hZ2VHYWluQicpOwogICAgICBpZiAoR2FpbkJJbmRleCAhPT0gLTEpIHsgLy8g56Gu5L+d5om+5Yiw5LqG5a+55bqU55qE6YWN572u6aG5CiAgICAgICAgLy8g5pu05pawIEV4cFRpbWUxIOmFjee9rumhueeahOWAvAogICAgICAgIHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zW0dhaW5CSW5kZXhdLnZhbHVlID0gdGhpcy5JbWFnZUdhaW5COwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ltYWdlR2FpbkIgY29uZmlndXJhdGlvbiBpdGVtIG5vdCBmb3VuZC4nKTsKICAgICAgfQoKICAgIH0sCgoKICAgIGNhbGN1bGF0ZVdoaXRlQmFsYW5jZUdhaW5zKCkgewogICAgICBpZiAoISh0aGlzLk9yaWdpbmFsSW1hZ2UgaW5zdGFuY2VvZiBJbWFnZURhdGEpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGltYWdlIGRhdGEnKTsKICAgICAgfQoKICAgICAgLy8g5Yib5bu6IGN2Lk1hdCDlr7nosaEKICAgICAgY29uc3QgaW1nOCA9IGN2Lm1hdEZyb21JbWFnZURhdGEodGhpcy5PcmlnaW5hbEltYWdlKTsKCiAgICAgIC8vIOWIhuWJsumAmumBkwogICAgICBjb25zdCBjaGFubmVscyA9IG5ldyBjdi5NYXRWZWN0b3IoKTsKICAgICAgY3Yuc3BsaXQoaW1nOCwgY2hhbm5lbHMpOwoKICAgICAgLy8g6I635Y+W5ZCE6YCa6YGTCiAgICAgIGNvbnN0IGIgPSBjaGFubmVscy5nZXQoMCk7CiAgICAgIGNvbnN0IGcgPSBjaGFubmVscy5nZXQoMSk7CiAgICAgIGNvbnN0IHIgPSBjaGFubmVscy5nZXQoMik7CgogICAgICAvLyDorqHnrpfkuK3kvY3mlbAKICAgICAgY29uc3QgbWVkaWFuQiA9IG5ldyBjdi5NYXQoKTsKICAgICAgY29uc3QgbWVkaWFuRyA9IG5ldyBjdi5NYXQoKTsKICAgICAgY29uc3QgbWVkaWFuUiA9IG5ldyBjdi5NYXQoKTsKICAgICAgY3YubWVkaWFuQmx1cihiLCBtZWRpYW5CLCA1KTsKICAgICAgY3YubWVkaWFuQmx1cihnLCBtZWRpYW5HLCA1KTsKICAgICAgY3YubWVkaWFuQmx1cihyLCBtZWRpYW5SLCA1KTsKCiAgICAgIC8vIOiuoeeul+W5s+Wdh+S6ruW6pgogICAgICBjb25zdCBhdmdCID0gY3YubWVhbihtZWRpYW5CKVswXTsKICAgICAgY29uc3QgYXZnRyA9IGN2Lm1lYW4obWVkaWFuRylbMF07CiAgICAgIGNvbnN0IGF2Z1IgPSBjdi5tZWFuKG1lZGlhblIpWzBdOwoKICAgICAgLy8g6K6h566X5aKe55uKCiAgICAgIGNvbnN0IGdhaW5SID0gTWF0aC5taW4oTWF0aC5tYXgoYXZnRyAvIGF2Z1IsIDAuMSksIDMpOwogICAgICBjb25zdCBnYWluQiA9IE1hdGgubWluKE1hdGgubWF4KGF2Z0cgLyBhdmdCLCAwLjEpLCAzKTsKCiAgICAgIC8vIOmHiuaUvuWGheWtmAogICAgICBiLmRlbGV0ZSgpOwogICAgICBnLmRlbGV0ZSgpOwogICAgICByLmRlbGV0ZSgpOwogICAgICBtZWRpYW5CLmRlbGV0ZSgpOwogICAgICBtZWRpYW5HLmRlbGV0ZSgpOwogICAgICBtZWRpYW5SLmRlbGV0ZSgpOwogICAgICBjaGFubmVscy5kZWxldGUoKTsKICAgICAgaW1nOC5kZWxldGUoKTsKCiAgICAgIHJldHVybiB7IEdhaW5SOiBnYWluUiwgR2FpbkI6IGdhaW5CIH07CiAgICB9LAoKICAgIGxvYWRPcGVuQ3YoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgaWYgKHR5cGVvZiBjdiA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIC8vIOWmguaenCBjdiDmnKrlrprkuYnvvIzlsJ3or5XliqDovb0gT3BlbkNWLmpzCiAgICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgIHNjcmlwdC5zcmMgPSAnL29wZW5jdi5qcyc7IC8vIOS9v+eUqCBwdWJsaWMg5paH5Lu25aS55Lit55qE6Lev5b6ECiAgICAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlOwogICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfTsKICAgICAgICAgIHNjcmlwdC5vbmVycm9yID0gKGVycm9yKSA9PiB7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICB9OwogICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDlpoLmnpwgY3Yg5bey5a6a5LmJ77yM55u05o6l6Kej5p6QCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgoKICAgIG9uQ3ZSZWFkeSgpIHsKCiAgICAgIC8vIFRlc3QgaWYgc29tZSBvZiBvcGVuY3YgbWV0aG9kIGNhbiB3b3JrLgogICAgICBpZiAoY3YpIHsKICAgICAgICBjb25zb2xlLmxvZygiUUhZQ0NEIHwgT3BlbkNWLmpzIGlzIHJlYWR5LiIpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ09wZW5DVi5qcyBpcyByZWFkeS4nLCAnaW5mbycpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJRSFlDQ0QgfCBGYWlsZWQgdG8gbG9hZCBPcGVuQ1YuanMiKTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGYWlsZWQgdG8gbG9hZCBPcGVuQ1YuanMuJywgJ2Vycm9yJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3ZSZWFkeSA9IHRydWU7CiAgICB9LAoKCiAgICBsb2FkSW1hZ2VUb0NhbnZhc01haW5DYW1lcmE6IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5DYW1lcmEtY2FudmFzJyk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpOwogICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgLy8g6I635Y+W6K6+5aSH5YOP57Sg5q+UCiAgICAgICAgY29uc3QgZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CgogICAgICAgIC8vIOiwg+aVtOeUu+W4g+WwuuWvuOS7pemAguW6lOmrmOa4heaYvuekugogICAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0ICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICBjdHguc2NhbGUoZGV2aWNlUGl4ZWxSYXRpbywgZGV2aWNlUGl4ZWxSYXRpbyk7IC8vIOe8qeaUvmN0eOS7pemAguW6lOmrmOa4heeUu+W4gwoKICAgICAgICAvLyDnu5jliLblm77lg48KICAgICAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKICAgICAgfTsKICAgICAgaW1hZ2Uuc3JjID0gQmFja2dyb3VuZEltYWdlOwogICAgfSwKICAgIGxvYWRJbWFnZVRvQ2FudmFzR3VpZGVyQ2FtZXJhOiBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWlkZXJDYW1lcmEtY2FudmFzJyk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpOwogICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgLy8g6I635Y+W6K6+5aSH5YOP57Sg5q+UCiAgICAgICAgY29uc3QgZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CgogICAgICAgIC8vIOiwg+aVtOeUu+W4g+WwuuWvuOS7pemAguW6lOmrmOa4heaYvuekugogICAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0ICogZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICBjdHguc2NhbGUoZGV2aWNlUGl4ZWxSYXRpbywgZGV2aWNlUGl4ZWxSYXRpbyk7IC8vIOe8qeaUvmN0eOS7pemAguW6lOmrmOa4heeUu+W4gwoKICAgICAgICAvLyDnu5jliLblm77lg48KICAgICAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKICAgICAgfTsKICAgICAgaW1hZ2Uuc3JjID0gQmFja2dyb3VuZEltYWdlOwogICAgfSwKCgogICAgc2hvd0d1aWRlckNhbWVyYUNhbnZhcygpIHsKICAgICAgLy8g5Yqo5oCB5pu05pawei1pbmRleAogICAgICB0aGlzLmNhbnZhc1pJbmRleFN0ZWwgPSAtMTA7CiAgICAgIHRoaXMuY2FudmFzWkluZGV4TWFpbkNhbWVyYSA9IC0xMTsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhHdWlkZXJDYW1lcmEgPSAwOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFBhcnNpbmdQcm9ncmVzcycsIGZhbHNlKTsKCiAgICAgIC8vIHRoaXMuY29udmVydFRvR3JheXNjYWxlKCk7CiAgICB9LAoKICAgIHNob3dTdGVsQ2FudmFzKCkgewogICAgICBpZiAodGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFBhcnNpbmdQcm9ncmVzcycsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UGFyc2luZ1Byb2dyZXNzJywgZmFsc2UpOwogICAgICB9CiAgICAgIHRoaXMuY2FudmFzWkluZGV4U3RlbCA9IDA7CiAgICAgIHRoaXMuY2FudmFzWkluZGV4TWFpbkNhbWVyYSA9IC0xMDsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhHdWlkZXJDYW1lcmEgPSAtMTE7CiAgICB9LAoKICAgIHNob3dNYWluQ2FtZXJhQ2FudmFzKCkgewogICAgICB0aGlzLmNhbnZhc1pJbmRleFN0ZWwgPSAtMTA7CiAgICAgIHRoaXMuY2FudmFzWkluZGV4TWFpbkNhbWVyYSA9IDA7CiAgICAgIHRoaXMuY2FudmFzWkluZGV4R3VpZGVyQ2FtZXJhID0gLTExOwoKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRQYXJzaW5nUHJvZ3Jlc3MnLCBmYWxzZSk7CiAgICB9LAoKCiAgICBoYW5kbGVCdXR0b25UZXN0Q2xpY2soKSB7CiAgICAgIC8vIHRoaXMuY2hhbmdlT3JkZXIoKTsKICAgICAgaWYgKHRoaXMuY3VycmVudGNhbnZhcyA9PT0gJ1N0ZWwnKSB7CiAgICAgICAgdGhpcy5jdXJyZW50Y2FudmFzID0gJ01haW5DYW1lcmEnOwogICAgICAgIHRoaXMuc2hvd01haW5DYW1lcmFDYW52YXMoKTsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGlzLmN1cnJlbnRjYW52YXMgPT09ICdNYWluQ2FtZXJhJykgewogICAgICAgIHRoaXMuY3VycmVudGNhbnZhcyA9ICdHdWlkZXJDYW1lcmEnOwogICAgICAgIHRoaXMuc2hvd0d1aWRlckNhbWVyYUNhbnZhcygpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoaXMuY3VycmVudGNhbnZhcyA9PT0gJ0d1aWRlckNhbWVyYScpIHsKICAgICAgICB0aGlzLmN1cnJlbnRjYW52YXMgPSAnU3RlbCc7CiAgICAgICAgdGhpcy5zaG93U3RlbENhbnZhcygpOwogICAgICB9CiAgICB9LAoKICAgIGdldFBsdWdpbnNNZW51SXRlbXM6IGZ1bmN0aW9uICgpIHsKICAgICAgbGV0IHJlcyA9IFtdCiAgICAgIGZvciAoY29uc3QgaSBpbiB0aGlzLiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpKSB7CiAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy4kc3RlbGxhcml1bVdlYlBsdWdpbnMoKVtpXQogICAgICAgIGlmIChwbHVnaW4ubWVudUl0ZW1zKSB7CiAgICAgICAgICByZXMgPSByZXMuY29uY2F0KHBsdWdpbi5tZW51SXRlbXMpCiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXMKICAgIH0sCiAgICBnZXRQbHVnaW5zTWVudUNvbXBvbmVudHM6IGZ1bmN0aW9uICgpIHsKICAgICAgbGV0IHJlcyA9IFtdCiAgICAgIGZvciAoY29uc3QgaSBpbiB0aGlzLiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpKSB7CiAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy4kc3RlbGxhcml1bVdlYlBsdWdpbnMoKVtpXQogICAgICAgIGlmIChwbHVnaW4ubWVudUNvbXBvbmVudHMpIHsKICAgICAgICAgIHJlcyA9IHJlcy5jb25jYXQocGx1Z2luLm1lbnVDb21wb25lbnRzKQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9LAogICAgdG9nZ2xlU3RvcmVWYWx1ZTogZnVuY3Rpb24gKHN0b3JlVmFyTmFtZSkgewogICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3RvZ2dsZUJvb2wnLCBzdG9yZVZhck5hbWUpCiAgICB9LAogICAgZ2V0U3RvcmVWYWx1ZTogZnVuY3Rpb24gKHN0b3JlVmFyTmFtZSkgewogICAgICByZXR1cm4gXy5nZXQodGhpcy4kc3RvcmUuc3RhdGUsIHN0b3JlVmFyTmFtZSkKICAgIH0sCiAgICBzZXRTdGF0ZUZyb21RdWVyeUFyZ3M6IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgb2JzZXJ2aW5nIHBhbmVsIG11c3QgYmUgZGlzcGxheWVkCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0VmFsdWUnLCB7IHZhck5hbWU6ICdzaG93U2lkZVBhbmVsJywgbmV3VmFsdWU6IHRoaXMuJHJvdXRlLnBhdGguc3RhcnRzV2l0aCgnL3AvJykgfSkKCiAgICAgIC8vIFNldCB0aGUgY29yZSdzIHN0YXRlIGZyb20gVVJMIHF1ZXJ5IGFyZ3VtZW50cyBzdWNoCiAgICAgIC8vIGFzIGRhdGUsIGxvY2F0aW9uLCB2aWV3IGRpcmVjdGlvbiAmIGZvdgogICAgICBsZXQgdGhhdCA9IHRoaXMKCiAgICAgIGlmICghdGhpcy5pbml0RG9uZSkgewogICAgICAgIHRoaXMuJHN0ZWwuY29yZS50aW1lX3NwZWVkID0gMQogICAgICAgIGxldCBkID0gbmV3IERhdGUoKQogICAgICAgIGlmICh0aGlzLiRyb3V0ZS5xdWVyeS5kYXRlKSB7CiAgICAgICAgICBkID0gbmV3IE1vbWVudCh0aGlzLiRyb3V0ZS5xdWVyeS5kYXRlKS50b0RhdGUoKQogICAgICAgICAgdGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLnV0YyA9IGQuZ2V0TUpEKCkKICAgICAgICAgIHRoaXMuc3RhcnRUaW1lSXNTZXQgPSB0cnVlCiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkubG5nICYmIHRoaXMuJHJvdXRlLnF1ZXJ5LmxhdCkgewogICAgICAgICAgY29uc3QgcG9zID0geyBsYXQ6IE51bWJlcih0aGlzLiRyb3V0ZS5xdWVyeS5sYXQpLCBsbmc6IE51bWJlcih0aGlzLiRyb3V0ZS5xdWVyeS5sbmcpLCBhbHQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LmVsZXYgPyBOdW1iZXIodGhpcy4kcm91dGUucXVlcnkuZWxldikgOiAwLCBhY2N1cmFjeTogMSB9CiAgICAgICAgICBzd2guZ2VvQ29kZVBvc2l0aW9uKHBvcywgdGhhdCkudGhlbigobG9jKSA9PiB7CiAgICAgICAgICAgIHRoYXQuJHN0b3JlLmNvbW1pdCgnc2V0Q3VycmVudExvY2F0aW9uJywgbG9jKQogICAgICAgICAgfSwgKGVycm9yKSA9PiB7IGNvbnNvbGUubG9nKGVycm9yKSB9KQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLnlhdyA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmF6ID8gTnVtYmVyKHRoaXMuJHJvdXRlLnF1ZXJ5LmF6KSAqIE1hdGguUEkgLyAxODAgOiAwCiAgICAgICAgdGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLnBpdGNoID0gdGhpcy4kcm91dGUucXVlcnkuYWx0ID8gTnVtYmVyKHRoaXMuJHJvdXRlLnF1ZXJ5LmFsdCkgKiBNYXRoLlBJIC8gMTgwIDogMzAgKiBNYXRoLlBJIC8gMTgwCiAgICAgICAgdGhpcy4kc3RlbC5jb3JlLmZvdiA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmZvdiA/IE51bWJlcih0aGlzLiRyb3V0ZS5xdWVyeS5mb3YpICogTWF0aC5QSSAvIDE4MCA6IDEyMCAqIE1hdGguUEkgLyAxODAKCiAgICAgICAgdGhpcy5pbml0RG9uZSA9IHRydWUKICAgICAgfQoKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhdGguc3RhcnRzV2l0aCgnL3NreXNvdXJjZS8nKSkgewogICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQodGhpcy4kcm91dGUucGF0aC5zdWJzdHJpbmcoMTEpKQogICAgICAgIGNvbnNvbGUubG9nKCdXaWxsIHNlbGVjdCBvYmplY3Q6ICcgKyBuYW1lKQogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1dpbGwgc2VsZWN0IG9iamVjdDogJyArIG5hbWUsICdpbmZvJyk7CiAgICAgICAgcmV0dXJuIHN3aC5sb29rdXBTa3lTb3VyY2VCeU5hbWUobmFtZSkudGhlbihzcyA9PiB7CiAgICAgICAgICBpZiAoIXNzKSB7CiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgfQogICAgICAgICAgbGV0IG9iaiA9IHN3aC5za3lTb3VyY2UyU3dlT2JqKHNzKQogICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgb2JqID0gdGhpcy4kc3RlbC5jcmVhdGVPYmooc3MubW9kZWwsIHNzKQogICAgICAgICAgICB0aGlzLiRzZWxlY3Rpb25MYXllci5hZGQob2JqKQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgY29uc29sZS53YXJuaW5nKCJDYW4ndCBmaW5kIG9iamVjdCBpbiBTV0U6ICIgKyBzcy5uYW1lc1swXSkKICAgICAgICAgIH0KICAgICAgICAgIHN3aC5zZXRTd2VPYmpBc1NlbGVjdGlvbihvYmopCiAgICAgICAgfSwgZXJyID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycikKICAgICAgICAgIGNvbnNvbGUubG9nKCJDb3VsZG4ndCBmaW5kIHNreXNvdXJjZSBmb3IgbmFtZTogIiArIG5hbWUpCiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCJDb3VsZG4ndCBmaW5kIHNreXNvdXJjZSBmb3IgbmFtZTogIiArIG5hbWUsICdlcnJvcicpOwogICAgICAgIH0pCiAgICAgIH0KICAgIH0sCgogICAgbG9va2F0Y2lyY2xlKCkgewogICAgICAvLyBnbFN0ZWwuY29yZS5zZWxlY3Rpb24gPSBnbFRlc3RDaXJjbGU7CiAgICAgIGdsU3RlbC5wb2ludEFuZExvY2soZ2xUZXN0Q2lyY2xlKTsKICAgIH0sCgogICAgc2V0R2xvYWJhbFN0ZWw6IGZ1bmN0aW9uIChzdGVsKSB7CiAgICAgIHJldHVybiBzdGVsOwogICAgfSwKCiAgICBzZXRHbG9iYWxMYXllcjogZnVuY3Rpb24gKHN0ZWwpIHsKICAgICAgcmV0dXJuIHN0ZWwuY3JlYXRlTGF5ZXIoeyBpZDogJ3Rlc3RMYXllclN0YXJzJywgejogNywgdmlzaWJsZTogdHJ1ZSB9KTsKICAgIH0sCgogICAgLy8g5Z2Q5qCH6aqM6K+B5pa55rOVCiAgICBpc1ZhbGlkQ29vcmRpbmF0ZTogZnVuY3Rpb24gKGNvb3JkKSB7CiAgICAgIC8vIOWmguaenOaYr+Wtl+espuS4su+8jOWwneivlei9rOaNouS4uuaVsOWtlwogICAgICBpZiAodHlwZW9mIGNvb3JkID09PSAnc3RyaW5nJykgewogICAgICAgIGNvb3JkID0gcGFyc2VGbG9hdChjb29yZCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0eXBlb2YgY29vcmQgPT09ICdudW1iZXInICYmCiAgICAgICAgIWlzTmFOKGNvb3JkKSAmJgogICAgICAgIGlzRmluaXRlKGNvb3JkKSAmJgogICAgICAgIGNvb3JkID49IC0zNjAgJiYKICAgICAgICBjb29yZCA8PSAzNjA7CiAgICB9LAoKICAgIHZlYzNfZnJvbV9zcGhlOiBmdW5jdGlvbiAocmFfZGVncmVlLCBkZWNfZGVncmVlLCBvdXQpIHsKICAgICAgLy8g56Gu5L+d5Z2Q5qCH5piv5pWw5a2X57G75Z6LCiAgICAgIGxldCByYSA9IHJhX2RlZ3JlZTsKICAgICAgbGV0IGRlYyA9IGRlY19kZWdyZWU7CgogICAgICBpZiAodHlwZW9mIHJhID09PSAnc3RyaW5nJykgewogICAgICAgIHJhID0gcGFyc2VGbG9hdChyYSk7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBkZWMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgZGVjID0gcGFyc2VGbG9hdChkZWMpOwogICAgICB9CgogICAgICAvLyDmt7vliqDlnZDmoIfpqozor4EKICAgICAgaWYgKCF0aGlzLmlzVmFsaWRDb29yZGluYXRlKHJhKSB8fCAhdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZShkZWMpKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5peg5pWI55qE5Z2Q5qCH6L6T5YWlOicsIHsgcmFfZGVncmVlLCBkZWNfZGVncmVlLCBjb252ZXJ0ZWQ6IHsgcmEsIGRlYyB9IH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBjcCA9IE1hdGguY29zKGRlYyAqIE1hdGguUEkgLyAxODApOwogICAgICAgIG91dFswXSA9IE1hdGguY29zKHJhICogTWF0aC5QSSAvIDE4MCkgKiBjcDsKICAgICAgICBvdXRbMV0gPSBNYXRoLnNpbihyYSAqIE1hdGguUEkgLyAxODApICogY3A7CiAgICAgICAgb3V0WzJdID0gTWF0aC5zaW4oZGVjICogTWF0aC5QSSAvIDE4MCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Z2Q5qCH6L2s5o2i5Ye66ZSZOicsIGVycm9yLCB7IHJhX2RlZ3JlZSwgZGVjX2RlZ3JlZSwgY29udmVydGVkOiB7IHJhLCBkZWMgfSB9KTsKICAgICAgfQogICAgfSwKCiAgICB0ZXN0QWRkQ2lyY2xlOiBmdW5jdGlvbiAoc3RlbCwgbGF5ZXIpIHsKICAgICAgY29uc29sZS5sb2coIkFkZCBhIGNpcmNsZSBzdGFyIG5lYXIgcG9sYXJpcyIpOwoKICAgICAgLy8g5Li65Li05pe25a+56LGh5Yib5bu65bim5pyJ5ZCN56ew55qE6YWN572uCiAgICAgIGNvbnN0IGNpcmNsZUNvbmZpZyA9IHsKICAgICAgICBpZDogJ3Rlc3RfY2lyY2xlXycgKyBEYXRlLm5vdygpLAogICAgICAgIG1vZGVsX2RhdGE6IHt9LAogICAgICAgIG5hbWVzOiBbJ1Rlc3QgQ2lyY2xlJ10sICAvLyDmt7vliqDlkI3np7AKICAgICAgICB0eXBlczogWydUZW1wb3JhcnknXSwKICAgICAgICBtb2RlbDogJ3RlbXBvcmFyeScKICAgICAgfTsKCiAgICAgIGxldCBjaXJjbGUgPSBzdGVsLmNyZWF0ZU9iaignY2lyY2xlJywgY2lyY2xlQ29uZmlnKTsKCiAgICAgIGNpcmNsZS51cGRhdGUoKTsKICAgICAgbGF5ZXIuYWRkKGNpcmNsZSk7CgogICAgICAvLyDnjrDlnKjlj6/ku6XlronlhajlnLDpgInmi6nlr7nosaHvvIzlm6DkuLrlroPmnInlkI3np7AKICAgICAgc3RlbC5jb3JlLnNlbGVjdGlvbiA9IGNpcmNsZTsKICAgICAgc3RlbC5wb2ludEFuZExvY2soY2lyY2xlKTsKCiAgICAgIC8vIENpcmNsZSBQcm9wZXJ0eQogICAgICBsZXQgbW0gPSBjaXJjbGUucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKDIuNTI5NzEsIDg5LjI2NDEsIG1tKTsKICAgICAgY2lyY2xlLnBvcyA9IG1tOwogICAgICBjb25zb2xlLmxvZygiY2lyY2xlIHBvczoiICsgbW0pOwogICAgICBjaXJjbGUubGFiZWwgPSAiIjsKICAgICAgY2lyY2xlLmZyYW1lID0gMTsKICAgICAgY2lyY2xlLnNpemUgPSBbMC4wNSwgMC4wNV07CiAgICAgIGNpcmNsZS5jb2xvciA9IFswLCAxLCAwLCAwLjI1XTsKICAgICAgY2lyY2xlLmJvcmRlcl9jb2xvciA9IFswLCAxLCAwLCAxXTsKCiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9LAoKICAgIFVwZGF0ZUNpcmNsZVBvcyhSYV9kZWdyZWUsIERlY19kZWdyZWUpIHsKICAgICAgLy8g5re75Yqg5a6J5YWo5qOA5p+lCiAgICAgIGlmICghZ2xUZXN0Q2lyY2xlIHx8ICFnbFRlc3RDaXJjbGUucG9zKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdnbFRlc3RDaXJjbGUg5pyq5Yid5aeL5YyW77yM6Lez6L+H5L2N572u5pu05pawJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIAogICAgICBsZXQgbW0gPSBnbFRlc3RDaXJjbGUucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKFJhX2RlZ3JlZSwgRGVjX2RlZ3JlZSwgbW0pOwogICAgICBnbFRlc3RDaXJjbGUucG9zID0gbW07CiAgICAgIC8vIGNvbnNvbGUubG9nKCLotaTpgZPku6rkvY3nva7mm7TmlrDkuLo6IitSYV9kZWdyZWUrIisiK0RlY19kZWdyZWUpOwogICAgfSwKCiAgICBVcGRhdGVUZWxlc2NvcGVTdGF0dXMoc3RhdHVzKSB7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTW91bnRTdGF0dXMnLCBzdGF0dXMpOwogICAgICAKICAgICAgLy8g5re75Yqg5a6J5YWo5qOA5p+lCiAgICAgIGlmICghZ2xUZXN0Q2lyY2xlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdnbFRlc3RDaXJjbGUg5pyq5Yid5aeL5YyW77yM6Lez6L+H54q25oCB5pu05pawJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIAogICAgICBpZiAoc3RhdHVzID09PSAnTW92aW5nJykgewogICAgICAgIGdsVGVzdENpcmNsZS5jb2xvciA9IFsxLCAwLCAwLCAwLjI1XTsKICAgICAgICBnbFRlc3RDaXJjbGUuYm9yZGVyX2NvbG9yID0gWzEsIDAsIDAsIDFdOwogICAgICB9IGVsc2UgewogICAgICAgIGdsVGVzdENpcmNsZS5jb2xvciA9IFswLCAxLCAwLCAwLjI1XTsKICAgICAgICBnbFRlc3RDaXJjbGUuYm9yZGVyX2NvbG9yID0gWzAsIDEsIDAsIDFdOwogICAgICB9CiAgICB9LAoKICAgIFVwZGF0ZU1haW5DYW1lcmFTdGF0dXMoc3RhdHVzKSB7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYVN0YXR1cycsIHN0YXR1cyk7CiAgICB9LAoKICAgIC8vIOe7mOWItuinhuWcuuWkmui+ueW9ou+8iOWfuuS6juS6lOS4qlJBL0RFQ+WdkOagh+eahOmXreeOr++8iQogICAgQWRkRmllbGRPZlZpZXdQb2x5Z29uOiBmdW5jdGlvbiAoc3RlbCwgbGF5ZXIsIGNvb3JkaW5hdGVzLCBjb2xvciwgbmFtZSkgewogICAgICBjb25zb2xlLmxvZyhg5byA5aeL5Yib5bu66KeG5Zy65aSa6L655b2iOiAke25hbWV9YCwgeyBjb29yZGluYXRlcywgY29sb3IgfSk7CgogICAgICB0cnkgewogICAgICAgIC8vIOmqjOivgei+k+WFpeWPguaVsAogICAgICAgIGlmICghY29vcmRpbmF0ZXMgfHwgIUFycmF5LmlzQXJyYXkoY29vcmRpbmF0ZXMpKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfop4blnLrlnZDmoIflv4XpobvmmK/mlbDnu4QnKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCAhPT0gNSkgewogICAgICAgICAgY29uc29sZS5lcnJvcihg6KeG5Zy65Z2Q5qCH5b+F6aG75pivNeS4queCue+8jOW9k+WJjeaciSR7Y29vcmRpbmF0ZXMubGVuZ3RofeS4queCuWApOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyDpqozor4Hmr4/kuKrlnZDmoIfngrkKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3JkaW5hdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjb29yZCA9IGNvb3JkaW5hdGVzW2ldOwogICAgICAgICAgaWYgKCFjb29yZCB8fCB0eXBlb2YgY29vcmQucmEgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBjb29yZC5kZWMgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOWdkOagh+eCuSR7aX3moLzlvI/plJnor6/vvIzpnIDopoHljIXlkKtyYeWSjGRlY+WxnuaApzpgLCBjb29yZCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOmqjOivgeWdkOagh+WAvAogICAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWRDb29yZGluYXRlKGNvb3JkLnJhKSB8fCAhdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZShjb29yZC5kZWMpKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOWdkOagh+eCuSR7aX3nmoTlgLzml6DmlYg6YCwgY29vcmQpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOiuvue9rum7mOiupOminOiJsgogICAgICAgIGNvbnN0IGRlZmF1bHRDb2xvciA9IHsKICAgICAgICAgIHN0cm9rZTogIiNGRkZGRkYiLAogICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMSwKICAgICAgICAgIGZpbGw6ICIjMUU5MEZGIiwKICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLjI1CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZmluYWxDb2xvciA9IHsgLi4uZGVmYXVsdENvbG9yLCAuLi5jb2xvciB9OwogICAgICAgIGNvbnNvbGUubG9nKCfmnIDnu4jpopzoibLphY3nva46JywgZmluYWxDb2xvcik7CgogICAgICAgIC8vIOWIm+W7uuWkmui+ueW9ouWvueixoQogICAgICAgIGNvbnN0IHBvbHlnb25Db25maWcgPSB7CiAgICAgICAgICBpZDogJ2ZpZWxkX29mX3ZpZXdfJyArIERhdGUubm93KCksCiAgICAgICAgICBtb2RlbF9kYXRhOiB7fSwKICAgICAgICAgIG5hbWVzOiBbbmFtZSB8fCAnRmllbGQgb2YgVmlldyddLAogICAgICAgICAgdHlwZXM6IFsnRmllbGRPZlZpZXcnXSwKICAgICAgICAgIG1vZGVsOiAnZmllbGRfb2ZfdmlldycKICAgICAgICB9OwoKICAgICAgICBjb25zb2xlLmxvZygn5Yib5bu6R2VvSlNPTuWkmui+ueW9ouWvueixoScpOwogICAgICAgIGxldCBwb2x5Z29uID0gc3RlbC5jcmVhdGVPYmooJ2dlb2pzb24nLCB7CiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICJ0eXBlIjogIkZlYXR1cmVDb2xsZWN0aW9uIiwKICAgICAgICAgICAgImZlYXR1cmVzIjogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIkZlYXR1cmUiLAogICAgICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAgICAgICAgICJzdHJva2UiOiBmaW5hbENvbG9yLnN0cm9rZSwKICAgICAgICAgICAgICAgICAgInN0cm9rZS1vcGFjaXR5IjogZmluYWxDb2xvci5zdHJva2VPcGFjaXR5LAogICAgICAgICAgICAgICAgICAiZmlsbCI6IGZpbmFsQ29sb3IuZmlsbCwKICAgICAgICAgICAgICAgICAgImZpbGwtb3BhY2l0eSI6IGZpbmFsQ29sb3IuZmlsbE9wYWNpdHksCiAgICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSB8fCAnRmllbGQgb2YgVmlldycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiZ2VvbWV0cnkiOiB7CiAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlBvbHlnb24iLAogICAgICAgICAgICAgICAgICAiY29vcmRpbmF0ZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgLy8g5LqU5Liq5Z2Q5qCH54K577yM5b2i5oiQ6Zet546vCiAgICAgICAgICAgICAgICAgICAgICBbY29vcmRpbmF0ZXNbMF0ucmEsIGNvb3JkaW5hdGVzWzBdLmRlY10sCiAgICAgICAgICAgICAgICAgICAgICBbY29vcmRpbmF0ZXNbMV0ucmEsIGNvb3JkaW5hdGVzWzFdLmRlY10sCiAgICAgICAgICAgICAgICAgICAgICBbY29vcmRpbmF0ZXNbMl0ucmEsIGNvb3JkaW5hdGVzWzJdLmRlY10sCiAgICAgICAgICAgICAgICAgICAgICBbY29vcmRpbmF0ZXNbM10ucmEsIGNvb3JkaW5hdGVzWzNdLmRlY10sCiAgICAgICAgICAgICAgICAgICAgICBbY29vcmRpbmF0ZXNbMF0ucmEsIGNvb3JkaW5hdGVzWzBdLmRlY10gIC8vIOmXreWQiOWkmui+ueW9ogogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoIXBvbHlnb24pIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dlb0pTT07lpJrovrnlvaLlr7nosaHliJvlu7rlpLHotKUnKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc29sZS5sb2coJ+Wkmui+ueW9ouWvueixoeWIm+W7uuaIkOWKn++8jOW8gOWni+abtOaWsOWSjOa3u+WKoOWIsOWbvuWxgicpOwoKICAgICAgICAvLyDorr7nva7lr7nosaHlsZ7mgKcKICAgICAgICBwb2x5Z29uLnVwZGF0ZSgpOwogICAgICAgIGxheWVyLmFkZChwb2x5Z29uKTsKCiAgICAgICAgY29uc29sZS5sb2coJ+Wkmui+ueW9ouW3sua3u+WKoOWIsOWbvuWxgicpOwoKICAgICAgICAvLyAvLyDmt7vliqDmoIfnrb7vvIjlj6/pgInvvIkKICAgICAgICAvLyBpZiAobmFtZSkgewogICAgICAgIC8vICAgY29uc29sZS5sb2coJ+a3u+WKoOWkmui+ueW9ouagh+etvicpOwogICAgICAgIC8vICAgLy8g6K6h566X6KeG5Zy65Lit5b+D54K5CiAgICAgICAgLy8gICBjb25zdCBjZW50ZXJSYSA9IGNvb3JkaW5hdGVzLnJlZHVjZSgoc3VtLCBjb29yZCkgPT4gc3VtICsgY29vcmQucmEsIDApIC8gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgIC8vICAgY29uc3QgY2VudGVyRGVjID0gY29vcmRpbmF0ZXMucmVkdWNlKChzdW0sIGNvb3JkKSA9PiBzdW0gKyBjb29yZC5kZWMsIDApIC8gY29vcmRpbmF0ZXMubGVuZ3RoOwoKICAgICAgICAvLyAgIGxldCBsYWJlbENpcmNsZSA9IHRoaXMuQWRkTWFya0NpcmNsZShzdGVsLCBsYXllciwgNCwgbmFtZSk7CiAgICAgICAgLy8gICBpZiAobGFiZWxDaXJjbGUpIHsKICAgICAgICAvLyAgICAgbGV0IGxhYmVsTW0gPSBsYWJlbENpcmNsZS5wb3M7CiAgICAgICAgLy8gICAgIHRoaXMudmVjM19mcm9tX3NwaGUoY2VudGVyUmEsIGNlbnRlckRlYyArIDAuMDIsIGxhYmVsTW0pOyAvLyDlnKjop4blnLrkuIrmlrnmmL7npLrlkI3np7AKICAgICAgICAvLyAgICAgbGFiZWxDaXJjbGUucG9zID0gbGFiZWxNbTsKICAgICAgICAvLyAgICAgbGFiZWxDaXJjbGUuY29sb3IgPSBbMSwgMSwgMSwgMC44XTsgIC8vIOeZveiJsu+8jOWNiumAj+aYjgogICAgICAgIC8vICAgICBsYWJlbENpcmNsZS5ib3JkZXJfY29sb3IgPSBbMCwgMCwgMCwgMC41XTsgIC8vIOm7keiJsui+ueahhu+8jOWNiumAj+aYjgogICAgICAgIC8vICAgICBsYWJlbENpcmNsZS5zaXplID0gWzAuMDEsIDAuMDFdOyAgLy8g5b6I5bCP55qE5ZyG5ZyI5L2c5Li65ZCN56ew5qCH562+CgogICAgICAgIC8vICAgICAvLyDlsIbmoIfnrb7kuI7lpJrovrnlvaLlhbPogZQKICAgICAgICAvLyAgICAgcG9seWdvbi5sYWJlbENpcmNsZSA9IGxhYmVsQ2lyY2xlOwogICAgICAgIC8vICAgICBjb25zb2xlLmxvZygn5qCH562+5bey5re75Yqg5Yiw5aSa6L655b2iJyk7CiAgICAgICAgLy8gICB9IGVsc2UgewogICAgICAgIC8vICAgICBjb25zb2xlLndhcm4oJ+agh+etvuWIm+W7uuWksei0pScpOwogICAgICAgIC8vICAgfQogICAgICAgIC8vIH0KCiAgICAgICAgY29uc29sZS5sb2coYOinhuWcuuWkmui+ueW9ouWIm+W7uuWujOaIkDogJHtuYW1lIHx8ICdGaWVsZCBvZiBWaWV3J31gLCB7CiAgICAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXMsCiAgICAgICAgICBjb2xvcjogZmluYWxDb2xvciwKICAgICAgICAgIHBvbHlnb246IHBvbHlnb24KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHBvbHlnb247CgogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuinhuWcuuWkmui+ueW9ouaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgICAgY29uc29sZS5lcnJvcign6ZSZ6K+v5aCG5qCIOicsIGVycm9yLnN0YWNrKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKCiAgICAvLyDliKDpmaTmjIflrprnmoTop4blnLrlpJrovrnlvaIKICAgIFJlbW92ZUZpZWxkT2ZWaWV3UG9seWdvbjogZnVuY3Rpb24gKHBvbHlnb24pIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIXBvbHlnb24pIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign6KaB5Yig6Zmk55qE5aSa6L655b2i5a+56LGh5Li656m6Jyk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyDliKDpmaTlhbPogZTnmoTmoIfnrb4KICAgICAgICBpZiAocG9seWdvbi5sYWJlbENpcmNsZSkgewogICAgICAgICAgZ2xMYXllci5yZW1vdmUocG9seWdvbi5sYWJlbENpcmNsZSk7CiAgICAgICAgfQoKICAgICAgICAvLyDliKDpmaTlpJrovrnlvaIKICAgICAgICBnbExheWVyLnJlbW92ZShwb2x5Z29uKTsKCiAgICAgICAgY29uc29sZS5sb2coJ+inhuWcuuWkmui+ueW9ouW3suWIoOmZpDonLCBwb2x5Z29uKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yig6Zmk6KeG5Zy65aSa6L655b2i5pe25Ye66ZSZOicsIGVycm9yKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgLy8g5Yig6Zmk5omA5pyJ6KeG5Zy65aSa6L655b2iCiAgICBSZW1vdmVBbGxGaWVsZE9mVmlld1BvbHlnb25zOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5aaC5p6c5pyJ5aSa6L655b2i5pWw57uE77yM6YGN5Y6G5Yig6ZmkCiAgICAgICAgaWYgKHRoaXMuZmllbGRPZlZpZXdQb2x5Z29ucyAmJiBBcnJheS5pc0FycmF5KHRoaXMuZmllbGRPZlZpZXdQb2x5Z29ucykpIHsKICAgICAgICAgIHRoaXMuZmllbGRPZlZpZXdQb2x5Z29ucy5mb3JFYWNoKHBvbHlnb24gPT4gewogICAgICAgICAgICB0aGlzLlJlbW92ZUZpZWxkT2ZWaWV3UG9seWdvbihwb2x5Z29uKTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5maWVsZE9mVmlld1BvbHlnb25zID0gW107CiAgICAgICAgfQoKICAgICAgICBjb25zb2xlLmxvZygn5omA5pyJ6KeG5Zy65aSa6L655b2i5bey5Yig6ZmkJyk7CiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIoOmZpOaJgOacieinhuWcuuWkmui+ueW9ouaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIC8vIOabtOaWsOinhuWcuuWkmui+ueW9oueahOS9jee9rgogICAgVXBkYXRlRmllbGRPZlZpZXdQb2x5Z29uUG9zaXRpb246IGZ1bmN0aW9uIChwb2x5Z29uLCBuZXdDb29yZGluYXRlcykgewogICAgICB0cnkgewogICAgICAgIGlmICghcG9seWdvbiB8fCAhbmV3Q29vcmRpbmF0ZXMgfHwgIUFycmF5LmlzQXJyYXkobmV3Q29vcmRpbmF0ZXMpIHx8IG5ld0Nvb3JkaW5hdGVzLmxlbmd0aCAhPT0gNSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign5pu05paw6KeG5Zy65aSa6L655b2i5L2N572u5pe25Y+C5pWw5peg5pWIJyk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyDpqozor4HmlrDlnZDmoIcKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld0Nvb3JkaW5hdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjb29yZCA9IG5ld0Nvb3JkaW5hdGVzW2ldOwogICAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWRDb29yZGluYXRlKGNvb3JkLnJhKSB8fCAhdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZShjb29yZC5kZWMpKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOaWsOWdkOagh+eCuSR7aX3nmoTlgLzml6DmlYg6YCwgY29vcmQpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDmm7TmlrDlpJrovrnlvaLmlbDmja4KICAgICAgICBwb2x5Z29uLmRhdGEuZmVhdHVyZXNbMF0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0gPSBbCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbMF0ucmEsIG5ld0Nvb3JkaW5hdGVzWzBdLmRlY10sCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbMV0ucmEsIG5ld0Nvb3JkaW5hdGVzWzFdLmRlY10sCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbMl0ucmEsIG5ld0Nvb3JkaW5hdGVzWzJdLmRlY10sCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbM10ucmEsIG5ld0Nvb3JkaW5hdGVzWzNdLmRlY10sCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbNF0ucmEsIG5ld0Nvb3JkaW5hdGVzWzRdLmRlY10sCiAgICAgICAgICBbbmV3Q29vcmRpbmF0ZXNbMF0ucmEsIG5ld0Nvb3JkaW5hdGVzWzBdLmRlY10gIC8vIOmXreWQiAogICAgICAgIF07CgogICAgICAgIHBvbHlnb24udXBkYXRlKCk7CgogICAgICAgIC8vIOabtOaWsOagh+etvuS9jee9ru+8iOWmguaenOWtmOWcqO+8iQogICAgICAgIGlmIChwb2x5Z29uLmxhYmVsQ2lyY2xlKSB7CiAgICAgICAgICBjb25zdCBjZW50ZXJSYSA9IG5ld0Nvb3JkaW5hdGVzLnJlZHVjZSgoc3VtLCBjb29yZCkgPT4gc3VtICsgY29vcmQucmEsIDApIC8gbmV3Q29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgICAgY29uc3QgY2VudGVyRGVjID0gbmV3Q29vcmRpbmF0ZXMucmVkdWNlKChzdW0sIGNvb3JkKSA9PiBzdW0gKyBjb29yZC5kZWMsIDApIC8gbmV3Q29vcmRpbmF0ZXMubGVuZ3RoOwoKICAgICAgICAgIGxldCBsYWJlbE1tID0gcG9seWdvbi5sYWJlbENpcmNsZS5wb3M7CiAgICAgICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKGNlbnRlclJhLCBjZW50ZXJEZWMgKyAwLjAyLCBsYWJlbE1tKTsKICAgICAgICAgIHBvbHlnb24ubGFiZWxDaXJjbGUucG9zID0gbGFiZWxNbTsKICAgICAgICB9CgogICAgICAgIGNvbnNvbGUubG9nKCfop4blnLrlpJrovrnlvaLkvY3nva7lt7Lmm7TmlrA6JywgbmV3Q29vcmRpbmF0ZXMpOwogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfmm7TmlrDop4blnLrlpJrovrnlvaLkvY3nva7ml7blh7rplJk6JywgZXJyb3IpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBVcGRhdGVNYWluQ2FtZXJhVGVtcGVyYXR1cmUodmFsdWUpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ01haW4gQ2FtZXJhIFRlbXBlcmF0dXJlOicsIHZhbHVlICsgJ8KwJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYVRlbXBlcmF0dXJlJywgdmFsdWUpOwogICAgfSwKCiAgICBzZXRQb2xhclBvaW50QWx0aXR1ZGUoQWx0aXR1ZGUpIHsKICAgICAgdGhpcy5Qb2xhclBvaW50X0FsdGl0dWRlID0gQWx0aXR1ZGU7CiAgICAgIGNvbnNvbGUubG9nKCdQb2xhciBQb2ludCBBbHRpdHVkZTonLCB0aGlzLlBvbGFyUG9pbnRfQWx0aXR1ZGUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdQb2xhciBQb2ludCBBbHRpdHVkZTonICsgdGhpcy5Qb2xhclBvaW50X0FsdGl0dWRlLCAnaW5mbycpOwogICAgfSwKCiAgICBBZGRNYXJrQ2lyY2xlOiBmdW5jdGlvbiAoc3RlbCwgbGF5ZXIsIGZyYW1lLCBsYWJlbCkgewogICAgICBjb25zb2xlLmxvZyhg5byA5aeL5Yib5bu65qCH6K6w5ZyG5ZyIOiAke2xhYmVsfWApOwoKICAgICAgdHJ5IHsKICAgICAgICAvLyDkuLrkuLTml7blr7nosaHliJvlu7rluKbmnInlkI3np7DnmoTphY3nva4KICAgICAgICBjb25zdCBjaXJjbGVDb25maWcgPSB7CiAgICAgICAgICBpZDogJ3RlbXBfY2lyY2xlXycgKyBEYXRlLm5vdygpLAogICAgICAgICAgbW9kZWxfZGF0YToge30sCiAgICAgICAgICBuYW1lczogW2xhYmVsIHx8ICdUZW1wb3JhcnkgTWFya2VyJ10sICAvLyDmt7vliqDlkI3np7AKICAgICAgICAgIHR5cGVzOiBbJ1RlbXBvcmFyeSddLAogICAgICAgICAgbW9kZWw6ICd0ZW1wb3JhcnknCiAgICAgICAgfTsKCiAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuWchuW9ouWvueixoScpOwogICAgICAgIGxldCBjaXJjbGUgPSBzdGVsLmNyZWF0ZU9iaignY2lyY2xlJywgY2lyY2xlQ29uZmlnKTsKCiAgICAgICAgaWYgKCFjaXJjbGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WchuW9ouWvueixoeWIm+W7uuWksei0pScpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBjb25zb2xlLmxvZygn5ZyG5b2i5a+56LGh5Yib5bu65oiQ5Yqf77yM5byA5aeL6K6+572u5bGe5oCnJyk7CiAgICAgICAgY2lyY2xlLnVwZGF0ZSgpOwogICAgICAgIGxheWVyLmFkZChjaXJjbGUpOwoKICAgICAgICAvLyDorr7nva7pu5jorqTkvY3nva7vvIjljJfmnoHmmJ/pmYTov5HvvIkKICAgICAgICBsZXQgbW0gPSBjaXJjbGUucG9zOwogICAgICAgIHRoaXMudmVjM19mcm9tX3NwaGUoMi41Mjk3MSwgODkuMjY0MSwgbW0pOwogICAgICAgIGNpcmNsZS5wb3MgPSBtbTsKCiAgICAgICAgLy8g6K6+572u5ZyG5b2i5bGe5oCnCiAgICAgICAgY2lyY2xlLmxhYmVsID0gbGFiZWw7CiAgICAgICAgY2lyY2xlLmZyYW1lID0gZnJhbWU7CiAgICAgICAgY2lyY2xlLnNpemUgPSBbMC4wNCwgMC4wNF07CiAgICAgICAgY2lyY2xlLmNvbG9yID0gWzEsIDEsIDEsIDAuNV07CiAgICAgICAgY2lyY2xlLmJvcmRlcl9jb2xvciA9IFsxLCAxLCAxLCAxXTsKCiAgICAgICAgY29uc29sZS5sb2coYOagh+iusOWchuWciOWIm+W7uuWujOaIkDogJHtsYWJlbH1gLCB7CiAgICAgICAgICBwb3M6IG1tLAogICAgICAgICAgc2l6ZTogY2lyY2xlLnNpemUsCiAgICAgICAgICBjb2xvcjogY2lyY2xlLmNvbG9yLAogICAgICAgICAgYm9yZGVyX2NvbG9yOiBjaXJjbGUuYm9yZGVyX2NvbG9yCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBjaXJjbGU7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yib5bu65qCH6K6w5ZyG5ZyI5pe25Ye66ZSZOicsIGVycm9yKTsKICAgICAgICBjb25zb2xlLmVycm9yKCfplJnor6/loIbmoIg6JywgZXJyb3Iuc3RhY2spOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAoKICAgIEFkZE1hcmtSZWN0YW5nbGU6IGZ1bmN0aW9uIChzdGVsLCBsYXllciwgUmFEZWMpIHsKICAgICAgbGV0IGxpbmUgPSBzdGVsLmNyZWF0ZU9iaignZ2VvanNvbicsIHsKICAgICAgICBkYXRhOiB7CiAgICAgICAgICAidHlwZSI6ICJGZWF0dXJlQ29sbGVjdGlvbiIsCiAgICAgICAgICAiZmVhdHVyZXMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAidHlwZSI6ICJGZWF0dXJlIiwKICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAgICJzdHJva2UiOiAiI0ZGRkZGRiIsCiAgICAgICAgICAgICAgICAic3Ryb2tlLW9wYWNpdHkiOiAxLAogICAgICAgICAgICAgICAgImZpbGwiOiAiIzFFOTBGRiIsCiAgICAgICAgICAgICAgICAiZmlsbC1vcGFjaXR5IjogMC4yNQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgImdlb21ldHJ5IjogewogICAgICAgICAgICAgICAgInR5cGUiOiAiUG9seWdvbiIsCiAgICAgICAgICAgICAgICAiY29vcmRpbmF0ZXMiOiBbCiAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAvLyBbMTM5Ljc2LCAzNS41Ml0sIFsxMzkuMzIsIDMzLjQxXSwgWzE0MC45MiwgMzMuMDhdLCBbMTQxLjM1LCAzNS4xOV0sIFsxMzkuNzYsIDM1LjUyXQogICAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KFJhRGVjWzBdLlJhKSwgcGFyc2VGbG9hdChSYURlY1swXS5EZWMpXSwgW3BhcnNlRmxvYXQoUmFEZWNbMV0uUmEpLCBwYXJzZUZsb2F0KFJhRGVjWzFdLkRlYyldLAogICAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KFJhRGVjWzJdLlJhKSwgcGFyc2VGbG9hdChSYURlY1syXS5EZWMpXSwgW3BhcnNlRmxvYXQoUmFEZWNbM10uUmEpLCBwYXJzZUZsb2F0KFJhRGVjWzNdLkRlYyldLAogICAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KFJhRGVjWzBdLlJhKSwgcGFyc2VGbG9hdChSYURlY1swXS5EZWMpXQogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgXQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBsaW5lLnVwZGF0ZSgpOwogICAgICBsYXllci5hZGQobGluZSk7CiAgICAgIHJldHVybiBsaW5lOwogICAgfSwKCgoKICAgIC8vIOi+heWKqeaWueazle+8muWwhuWNgeWFrei/m+WItuminOiJsui9rOaNouS4ulJHQgogICAgaGV4VG9SZ2I6IGZ1bmN0aW9uIChoZXgpIHsKICAgICAgLy8g56e76ZmkI+WPtwogICAgICBoZXggPSBoZXgucmVwbGFjZSgnIycsICcnKTsKCiAgICAgIC8vIOino+aekFJHQuWAvAogICAgICBjb25zdCByID0gcGFyc2VJbnQoaGV4LnN1YnN0cigwLCAyKSwgMTYpOwogICAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cigyLCAyKSwgMTYpOwogICAgICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnN1YnN0cig0LCAyKSwgMTYpOwoKICAgICAgcmV0dXJuIHsgciwgZywgYiB9OwogICAgfSwKCiAgICAvLyDmm7TmlrDop4blnLrmlrnms5UKICAgIHVwZGF0ZUZpZWxkT2ZWaWV3OiBmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgaWYgKCFmaWVsZCB8fCAhZmllbGQuZmllbGRJbmZvKSByZXR1cm47CgogICAgICBjb25zdCBpbmZvID0gZmllbGQuZmllbGRJbmZvOwoKICAgICAgLy8g6K6h566X6KeG5Zy655qE5Zub5Liq6KeS54K5CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbCiAgICAgICAgeyBSYTogaW5mby5tYXhSYSwgRGVjOiBpbmZvLm1heERlYyB9LAogICAgICAgIHsgUmE6IGluZm8ubWluUmEsIERlYzogaW5mby5tYXhEZWMgfSwKICAgICAgICB7IFJhOiBpbmZvLm1pblJhLCBEZWM6IGluZm8ubWluRGVjIH0sCiAgICAgICAgeyBSYTogaW5mby5tYXhSYSwgRGVjOiBpbmZvLm1pbkRlYyB9LAogICAgICAgIHsgUmE6IGluZm8ubWF4UmEsIERlYzogaW5mby5tYXhEZWMgfSAgLy8g6Zet5ZCI5aSa6L655b2iCiAgICAgIF07CgogICAgICAvLyDmm7TmlrBHZW9KU09O5pWw5o2uCiAgICAgIGZpZWxkLmRhdGEgPSB7CiAgICAgICAgInR5cGUiOiAiRmVhdHVyZUNvbGxlY3Rpb24iLAogICAgICAgICJmZWF0dXJlcyI6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgInR5cGUiOiAiRmVhdHVyZSIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICJzdHJva2UiOiBpbmZvLmNvbG9yLAogICAgICAgICAgICAgICJzdHJva2VPcGFjaXR5IjogMC44LAogICAgICAgICAgICAgICJmaWxsIjogaW5mby5jb2xvciwKICAgICAgICAgICAgICAiZmlsbE9wYWNpdHkiOiAwLjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImdlb21ldHJ5IjogewogICAgICAgICAgICAgICJ0eXBlIjogIlBvbHlnb24iLAogICAgICAgICAgICAgICJjb29yZGluYXRlcyI6CiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KGNvcm5lcnNbMF0uUmEpLCBwYXJzZUZsb2F0KGNvcm5lcnNbMF0uRGVjKV0sCiAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KGNvcm5lcnNbMV0uUmEpLCBwYXJzZUZsb2F0KGNvcm5lcnNbMV0uRGVjKV0sCiAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KGNvcm5lcnNbMl0uUmEpLCBwYXJzZUZsb2F0KGNvcm5lcnNbMl0uRGVjKV0sCiAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KGNvcm5lcnNbM10uUmEpLCBwYXJzZUZsb2F0KGNvcm5lcnNbM10uRGVjKV0sCiAgICAgICAgICAgICAgICAgIFtwYXJzZUZsb2F0KGNvcm5lcnNbNF0uUmEpLCBwYXJzZUZsb2F0KGNvcm5lcnNbNF0uRGVjKV0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfTsKCiAgICAgIGZpZWxkLnVwZGF0ZSgpOwogICAgfSwKCiAgICAvLyDlkK/liqjop4blnLrmm7TmlrDlrprml7blmagKICAgIHN0YXJ0RmllbGRVcGRhdGVUaW1lcjogZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5maWVsZFVwZGF0ZVRpbWVyKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmZpZWxkVXBkYXRlVGltZXIpOwogICAgICB9CgogICAgICB0aGlzLmZpZWxkVXBkYXRlVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgLy8g5pu05paw5qCh5YeG54K56KeG5Zy6CiAgICAgICAgaWYgKHRoaXMuY2FsaWJyYXRpb25DaXJjbGVzKSB7CiAgICAgICAgICB0aGlzLmNhbGlicmF0aW9uQ2lyY2xlcy5mb3JFYWNoKGZpZWxkID0+IHsKICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkSW5mbykgewogICAgICAgICAgICAgIHRoaXMudXBkYXRlRmllbGRPZlZpZXcoZmllbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIOabtOaWsOiwg+aVtOeCueinhuWcugogICAgICAgIGlmICh0aGlzLmFkanVzdG1lbnRDaXJjbGVzKSB7CiAgICAgICAgICB0aGlzLmFkanVzdG1lbnRDaXJjbGVzLmZvckVhY2goZmllbGQgPT4gewogICAgICAgICAgICBpZiAoZmllbGQuZmllbGRJbmZvKSB7CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVGaWVsZE9mVmlldyhmaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgMzAwMCk7IC8vIOavjzPnp5Lmm7TmlrDkuIDmrKEKICAgIH0sCgogICAgLy8g5YGc5q2i6KeG5Zy65pu05paw5a6a5pe25ZmoCiAgICBzdG9wRmllbGRVcGRhdGVUaW1lcjogZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5maWVsZFVwZGF0ZVRpbWVyKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmZpZWxkVXBkYXRlVGltZXIpOwogICAgICAgIHRoaXMuZmllbGRVcGRhdGVUaW1lciA9IG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgZ2V0Q2llY2xlQXpBbHQoQ2lyY2xlKSB7CiAgICAgIGxldCBvYnMgPSB0aGlzLiRzdGVsLmNvcmUub2JzZXJ2ZXI7CiAgICAgIGxldCBjaXJzID0gdGhpcy4kc3RlbC5jb252ZXJ0RnJhbWUob2JzLCAnSUNSRicsICdDSVJTJywgQ2lyY2xlLmdldEluZm8oJ3JhZGVjJykpOwogICAgICBsZXQgb2JzZXJ2ZWQgPSB0aGlzLiRzdGVsLmNvbnZlcnRGcmFtZShvYnMsICdDSVJTJywgJ09CU0VSVkVEJywgY2lycyk7CiAgICAgIC8vIGNvbnN0IGF6YWx0ID0gdGhpcy4kc3RlbC5jMnModGhpcy4kc3RlbC5jb252ZXJ0RnJhbWUodGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLCAnSUNSRicsICdPQlNFUlZFRCcsIG9iai5nZXRJbmZvKCdyYWRlYycpKSkKICAgICAgbGV0IGF6YWx0ID0gdGhpcy4kc3RlbC5jMnMob2JzZXJ2ZWQpOwogICAgICBsZXQgYXogPSB0aGlzLiRzdGVsLmFucChhemFsdFswXSk7CiAgICAgIGxldCBhbHQgPSB0aGlzLiRzdGVsLmFucChhemFsdFsxXSk7CgogICAgICBjb25zdCBhel9yYWYgPSB0aGlzLiRzdGVsLmEyYWYoYXosIDEpOwogICAgICBjb25zdCBBel9kZWdyZWUgPSAoYXpfcmFmLmRlZ3JlZXMgPCAwID8gYXpfcmFmLmRlZ3JlZXMgKyAxODAgOiBhel9yYWYuZGVncmVlcykgKyBhel9yYWYuYXJjbWludXRlcyAvIDYwICsgYXpfcmFmLmFyY3NlY29uZHMgLyAzNjAwOwoKICAgICAgY29uc3QgYWx0X3JhZiA9IHRoaXMuJHN0ZWwuYTJhZihhbHQsIDEpOwogICAgICBjb25zdCBBbHRfZGVncmVlID0gYWx0X3JhZi5kZWdyZWVzICsgYWx0X3JhZi5hcmNtaW51dGVzIC8gNjAgKyBhbHRfcmFmLmFyY3NlY29uZHMgLyAzNjAwOwoKICAgICAgY29uc29sZS5sb2coJ0F6QWx0OicsIEF6X2RlZ3JlZSwgQWx0X2RlZ3JlZSk7CgogICAgICByZXR1cm4geyBBel9kZWdyZWUsIEFsdF9kZWdyZWUgfTsKICAgIH0sCgogICAgU29sdmVSZXN1bHRNYXJrKFJhRGVncmVlLCBEZWNEZWdyZWUsIEF6aW11dGgsIEFsdGl0dWRlKSB7CiAgICAgIGxldCBNYXJrQ2lyY2xlX1JhRGVjID0gdGhpcy5BZGRNYXJrQ2lyY2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIDEsICJSYURlYyIpOwogICAgICBsZXQgbW0gPSBNYXJrQ2lyY2xlX1JhRGVjLnBvczsKICAgICAgdGhpcy52ZWMzX2Zyb21fc3BoZShSYURlZ3JlZSwgRGVjRGVncmVlLCBtbSk7CiAgICAgIE1hcmtDaXJjbGVfUmFEZWMucG9zID0gbW07CiAgICAgIGNvbnNvbGUubG9nKCJSYURlYyBjaXJjbGUgY29vcmRpbmF0ZXM6IiArIG1tKTsKCiAgICAgIGNvbnN0IEF6QWx0ID0gdGhpcy5nZXRDaWVjbGVBekFsdChNYXJrQ2lyY2xlX1JhRGVjKTsKICAgICAgZ2xMYXllci5yZW1vdmUoTWFya0NpcmNsZV9SYURlYyk7CgogICAgICB0aGlzLk1hcmtDaXJjbGVOdW0rKzsKICAgICAgbGV0IExhYmVsID0gIkF6QWx0X1Z1ZV8iICsgdGhpcy5NYXJrQ2lyY2xlTnVtOwoKICAgICAgbGV0IE1hcmtDaXJjbGVfQWx0QXogPSB0aGlzLkFkZE1hcmtDaXJjbGUodGhpcy4kc3RlbCwgZ2xMYXllciwgNCwgTGFiZWwpOwogICAgICBtbSA9IE1hcmtDaXJjbGVfQWx0QXoucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKEF6QWx0LkF6X2RlZ3JlZSwgQXpBbHQuQWx0X2RlZ3JlZSwgbW0pOwogICAgICBNYXJrQ2lyY2xlX0FsdEF6LnBvcyA9IG1tOwogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSBjb29yZGluYXRlczoiICsgbW0pOwoKICAgICAgY29uc29sZS5sb2coIkF6QWx0X1Z1ZSBjaXJjbGUgeDoiICsgbW1bMF0pOwogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSB5OiIgKyBtbVsxXSk7CiAgICAgIGNvbnNvbGUubG9nKCJBekFsdF9WdWUgY2lyY2xlIHo6IiArIG1tWzJdKTsKCiAgICAgIHRoaXMuTGFzdFBvaW50X0F6QWx0ID0gdGhpcy5nZXRDaWVjbGVBekFsdChNYXJrQ2lyY2xlX0FsdEF6KTsKCiAgICAgIHRoaXMuQ2FsY3VsYXRpb25Qb2xhclBvaW50KG1tKTsKCiAgICAgIC8vIOWwhuWIm+W7uueahOWchuWtmOWCqOWIsOaVsOe7hOS4rQogICAgICAvLyB0aGlzLkNpcmNsZXMucHVzaChNYXJrQ2lyY2xlX1JhRGVjKTsKICAgICAgdGhpcy5DaXJjbGVzLnB1c2goTWFya0NpcmNsZV9BbHRBeik7CgogICAgfSwKCiAgICBSZW1vdmVBbGxDaXJjbGVzKCkgewogICAgICB0aGlzLkNpcmNsZXMuZm9yRWFjaChjaXJjbGUgPT4gewogICAgICAgIGdsTGF5ZXIucmVtb3ZlKGNpcmNsZSk7CiAgICAgIH0pOwogICAgICB0aGlzLkNpcmNsZXMgPSBbXTsKICAgIH0sCgogICAgU29sdmVSZXN1bHRNYXJrX1JlYWxUaW1lKFJhRGVncmVlLCBEZWNEZWdyZWUsIEF6aW11dGgsIEFsdGl0dWRlKSB7CiAgICAgIHRoaXMuTGFzdENpcmNsZV9SYURlYyA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCAxLCAiUmFEZWMiKTsKICAgICAgbGV0IG1tID0gdGhpcy5MYXN0Q2lyY2xlX1JhRGVjLnBvczsKICAgICAgdGhpcy52ZWMzX2Zyb21fc3BoZShSYURlZ3JlZSwgRGVjRGVncmVlLCBtbSk7CiAgICAgIHRoaXMuTGFzdENpcmNsZV9SYURlYy5wb3MgPSBtbTsKICAgICAgY29uc29sZS5sb2coIlJhRGVjIGNpcmNsZSBjb29yZGluYXRlczoiICsgbW0pOwoKICAgICAgY29uc3QgQXpBbHQgPSB0aGlzLmdldENpZWNsZUF6QWx0KHRoaXMuTGFzdENpcmNsZV9SYURlYyk7CiAgICAgIGdsTGF5ZXIucmVtb3ZlKHRoaXMuTGFzdENpcmNsZV9SYURlYyk7CgogICAgICBpZiAodGhpcy5MYXN0Q2lyY2xlX0F6QWx0ICE9PSBudWxsICYmIHRoaXMuTGFzdENpcmNsZV9BekFsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZ2xMYXllci5yZW1vdmUodGhpcy5MYXN0Q2lyY2xlX0F6QWx0KTsKICAgICAgfQogICAgICB0aGlzLkxhc3RDaXJjbGVfQXpBbHQgPSB0aGlzLkFkZE1hcmtDaXJjbGUodGhpcy4kc3RlbCwgZ2xMYXllciwgNCwgJ0N1cnJlbnQnKTsKICAgICAgbW0gPSB0aGlzLkxhc3RDaXJjbGVfQXpBbHQucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKEF6QWx0LkF6X2RlZ3JlZSwgQXpBbHQuQWx0X2RlZ3JlZSwgbW0pOwogICAgICB0aGlzLkxhc3RDaXJjbGVfQXpBbHQucG9zID0gbW07CiAgICAgIHRoaXMuTGFzdENpcmNsZV9BekFsdC5jb2xvciA9IFswLCAxLCAxLCAwLjI1XTsKICAgICAgY29uc29sZS5sb2coIkF6QWx0X1Z1ZSBjaXJjbGUgY29vcmRpbmF0ZXM6IiArIG1tKTsKCiAgICAgIGNvbnNvbGUubG9nKCJBekFsdF9WdWUgY2lyY2xlIHg6IiArIG1tWzBdKTsKICAgICAgY29uc29sZS5sb2coIkF6QWx0X1Z1ZSBjaXJjbGUgeToiICsgbW1bMV0pOwogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSB6OiIgKyBtbVsyXSk7CgogICAgICB0aGlzLkN1cnJlbnRfQXpBbHQgPSB0aGlzLmdldENpZWNsZUF6QWx0KHRoaXMuTGFzdENpcmNsZV9BekFsdCk7CiAgICAgIGNvbnNvbGUubG9nKCJDdXJyZW50IEF6QWx0OiIsIHRoaXMuQ3VycmVudF9BekFsdC5Bel9kZWdyZWUsIHRoaXMuQ3VycmVudF9BekFsdC5BbHRfZGVncmVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93Q3VycmVudEF6QWx0VGV4dCcsIHRoaXMuQ3VycmVudF9BekFsdC5Bel9kZWdyZWUsIHRoaXMuQ3VycmVudF9BekFsdC5BbHRfZGVncmVlKTsKICAgIH0sCgoKICAgIENhbGN1bGF0aW9uUG9sYXJQb2ludChjb29yZGluYXRlKSB7CiAgICAgIHRoaXMuQ2FydGVzaWFuTGlzdC5wdXNoKGNvb3JkaW5hdGUpOwoKICAgICAgaWYgKHRoaXMuQ2FydGVzaWFuTGlzdC5sZW5ndGggPCAzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ0hpZGVTaW5nbGVTb2x2ZUJ0bicpOwoKICAgICAgLy8g6I635Y+W5LiJ5Liq54K555qE5Z2Q5qCHCiAgICAgIGNvbnN0IHAxID0gdGhpcy5DYXJ0ZXNpYW5MaXN0WzBdOwogICAgICBjb25zdCBwMiA9IHRoaXMuQ2FydGVzaWFuTGlzdFsxXTsKICAgICAgY29uc3QgcDMgPSB0aGlzLkNhcnRlc2lhbkxpc3RbMl07CgogICAgICAvLyDorqHnrpfkuKTkuKrlkJHph48KICAgICAgY29uc3QgdjEgPSBbCiAgICAgICAgcDJbMF0gLSBwMVswXSwKICAgICAgICBwMlsxXSAtIHAxWzFdLAogICAgICAgIHAyWzJdIC0gcDFbMl0KICAgICAgXTsKCiAgICAgIGNvbnN0IHYyID0gWwogICAgICAgIHAzWzBdIC0gcDFbMF0sCiAgICAgICAgcDNbMV0gLSBwMVsxXSwKICAgICAgICBwM1syXSAtIHAxWzJdCiAgICAgIF07CgogICAgICAvLyDorqHnrpfms5XlkJHph48KICAgICAgY29uc3Qgbm9ybWFsID0gWwogICAgICAgIHYxWzFdICogdjJbMl0gLSB2MVsyXSAqIHYyWzFdLAogICAgICAgIHYxWzJdICogdjJbMF0gLSB2MVswXSAqIHYyWzJdLAogICAgICAgIHYxWzBdICogdjJbMV0gLSB2MVsxXSAqIHYyWzBdCiAgICAgIF07CgogICAgICAvLyDorqHnrpfms5XlkJHph4/nmoTplb/luqYKICAgICAgY29uc3Qgbm9ybWFsTGVuZ3RoID0gTWF0aC5zcXJ0KG5vcm1hbFswXSAqKiAyICsgbm9ybWFsWzFdICoqIDIgKyBub3JtYWxbMl0gKiogMik7CgogICAgICAvLyDlvZLkuIDljJbms5XlkJHph48KICAgICAgY29uc3QgdW5pdE5vcm1hbCA9IFsKICAgICAgICBub3JtYWxbMF0gLyBub3JtYWxMZW5ndGgsCiAgICAgICAgbm9ybWFsWzFdIC8gbm9ybWFsTGVuZ3RoLAogICAgICAgIG5vcm1hbFsyXSAvIG5vcm1hbExlbmd0aAogICAgICBdOwoKICAgICAgLy8g5YGH6K6+55CD55qE5Y2K5b6E5Li6cu+8jOWchuW/g+S4uigwLCAwLCAwKQogICAgICBjb25zdCByID0gMTsgLy8g5qC55o2u5L2g55qE5a6e6ZmF5oOF5Ya16LCD5pW0CgogICAgICAvLyDorqHnrpfkuI7nkIPpnaLnmoTkuqTngrkKICAgICAgY29uc3QgaW50ZXJzZWN0aW9uMSA9IFsKICAgICAgICB1bml0Tm9ybWFsWzBdICogciwKICAgICAgICB1bml0Tm9ybWFsWzFdICogciwKICAgICAgICB1bml0Tm9ybWFsWzJdICogcgogICAgICBdOwoKICAgICAgY29uc3QgaW50ZXJzZWN0aW9uMiA9IFsKICAgICAgICAtdW5pdE5vcm1hbFswXSAqIHIsCiAgICAgICAgLXVuaXROb3JtYWxbMV0gKiByLAogICAgICAgIC11bml0Tm9ybWFsWzJdICogcgogICAgICBdOwoKICAgICAgY29uc29sZS5sb2coJ0ludGVyc2VjdGlvbiBQb2ludHM6JywgaW50ZXJzZWN0aW9uMSwgaW50ZXJzZWN0aW9uMik7CgogICAgICAvLyDpgInmi6nnprsoMCwwLDEp5pu06L+R55qE5Lqk54K5CiAgICAgIGNvbnN0IGNsb3NlckludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjFbMl0gPiAwID8gaW50ZXJzZWN0aW9uMSA6IGludGVyc2VjdGlvbjI7CgogICAgICBsZXQgTWFya0NpcmNsZV9GYWtlUG9sYXJQb2ludCA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCA0LCAiRmFrZVBvbGFyUG9pbnQiKTsKICAgICAgbGV0IG1tID0gTWFya0NpcmNsZV9GYWtlUG9sYXJQb2ludC5wb3M7CiAgICAgIG1tWzBdID0gY2xvc2VySW50ZXJzZWN0aW9uWzBdOwogICAgICBtbVsxXSA9IGNsb3NlckludGVyc2VjdGlvblsxXTsKICAgICAgbW1bMl0gPSBjbG9zZXJJbnRlcnNlY3Rpb25bMl07CiAgICAgIE1hcmtDaXJjbGVfRmFrZVBvbGFyUG9pbnQucG9zID0gbW07CiAgICAgIGNvbnNvbGUubG9nKCJGYWtlUG9sYXJQb2ludCBjaXJjbGUgY29vcmRpbmF0ZXM6IiArIG1tKTsKCiAgICAgIGNvbnN0IEF6QWx0X0Zha2VQb2xhclBvaW50ID0gdGhpcy5nZXRDaWVjbGVBekFsdChNYXJrQ2lyY2xlX0Zha2VQb2xhclBvaW50KTsKCiAgICAgIGNvbnNvbGUubG9nKCJGYWtlIFBvbGFyIFBvaW50IEF6QWx0OiIsIEF6QWx0X0Zha2VQb2xhclBvaW50LkF6X2RlZ3JlZSwgJywnLCBBekFsdF9GYWtlUG9sYXJQb2ludC5BbHRfZGVncmVlKTsKCiAgICAgIHRoaXMuQ2lyY2xlcy5wdXNoKE1hcmtDaXJjbGVfRmFrZVBvbGFyUG9pbnQpOwoKICAgICAgbGV0IEF6QWx0X1BvbGFyUG9pbnQgPSB7CiAgICAgICAgQXpfZGVncmVlOiAwLAogICAgICAgIEFsdF9kZWdyZWU6IHRoaXMuUG9sYXJQb2ludF9BbHRpdHVkZQogICAgICB9OwoKICAgICAgLy8gY29uc29sZS5sb2coIlJlYWwgUG9sYXIgUG9pbnQgQXpBbHQ6IiwgQXpBbHRfUG9sYXJQb2ludC5Bel9kZWdyZWUsICcsJywgQXpBbHRfUG9sYXJQb2ludC5BbHRfZGVncmVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnUmVhbCBQb2xhciBQb2ludCBBekFsdDonICsgQXpBbHRfUG9sYXJQb2ludC5Bel9kZWdyZWUgKyAnLCcgKyBBekFsdF9Qb2xhclBvaW50LkFsdF9kZWdyZWUsICdpbmZvJyk7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJMYXN0IFBvaW50IEF6QWx0OiIsIHRoaXMuTGFzdFBvaW50X0F6QWx0LkF6X2RlZ3JlZSwgdGhpcy5MYXN0UG9pbnRfQXpBbHQuQWx0X2RlZ3JlZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0xhc3QgUG9pbnQgQXpBbHQ6JyArIHRoaXMuTGFzdFBvaW50X0F6QWx0LkF6X2RlZ3JlZSArICcsJyArIHRoaXMuTGFzdFBvaW50X0F6QWx0LkFsdF9kZWdyZWUsICdpbmZvJyk7CgogICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgIC8vIC8vIOWwhueQg+WdkOagh+i9rOaNouS4uuesm+WNoeWwlOWdkOaghwogICAgICAvLyBsZXQgZmFrZVBvbGFyUG9pbnQgPSB0aGlzLnNwaGVyaWNhbFRvQ2FydGVzaWFuKEF6QWx0X0Zha2VQb2xhclBvaW50LkF6X2RlZ3JlZSwgQXpBbHRfRmFrZVBvbGFyUG9pbnQuQWx0X2RlZ3JlZSk7CiAgICAgIC8vIGxldCBwb2xhclBvaW50ID0gdGhpcy5zcGhlcmljYWxUb0NhcnRlc2lhbihBekFsdF9Qb2xhclBvaW50LkF6X2RlZ3JlZSwgQXpBbHRfUG9sYXJQb2ludC5BbHRfZGVncmVlKTsKICAgICAgLy8gbGV0IGxhc3RQb2ludCA9IHRoaXMuc3BoZXJpY2FsVG9DYXJ0ZXNpYW4odGhpcy5MYXN0UG9pbnRfQXpBbHQuQXpfZGVncmVlLCB0aGlzLkxhc3RQb2ludF9BekFsdC5BbHRfZGVncmVlKTsKCiAgICAgIC8vIC8vIOiuoeeul+aXi+i9rOWbm+WFg+aVsAogICAgICAvLyBsZXQgcXVhdGVybmlvbiA9IHRoaXMuY29tcHV0ZVF1YXRlcm5pb24oZmFrZVBvbGFyUG9pbnQsIHBvbGFyUG9pbnQpOwoKICAgICAgLy8gLy8g5bqU55So5peL6L2sCiAgICAgIC8vIGxldCBmb3VydGhQb2ludCA9IHRoaXMuYXBwbHlRdWF0ZXJuaW9uKGxhc3RQb2ludCwgcXVhdGVybmlvbik7CgogICAgICAvLyAvLyDlsIbnu5PmnpzovazmjaLlm57nkIPlnZDmoIcKICAgICAgLy8gbGV0IGZvdXJ0aFBvaW50QXpBbHQgPSB0aGlzLmNhcnRlc2lhblRvU3BoZXJpY2FsKGZvdXJ0aFBvaW50KTsKICAgICAgLy8gY29uc29sZS5sb2coIkZvdXJ0aCBQb2ludCBBekFsdDoiLCBmb3VydGhQb2ludEF6QWx0LkF6X2RlZ3JlZSwgJywnLCBmb3VydGhQb2ludEF6QWx0LkFsdF9kZWdyZWUpOwoKICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAvLyDorqHnrpfop5Lluqblt67lgLzvvIzogIPomZHop5LluqbnmoTlvqrnjq/mgKfotKgKICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlQW5nbGVEaWZmZXJlbmNlKGFuZ2xlMSwgYW5nbGUyKSB7CiAgICAgICAgbGV0IGRpZmZlcmVuY2UgPSBhbmdsZTIgLSBhbmdsZTE7CiAgICAgICAgd2hpbGUgKGRpZmZlcmVuY2UgPiAxODApIGRpZmZlcmVuY2UgLT0gMzYwOwogICAgICAgIHdoaWxlIChkaWZmZXJlbmNlIDwgLTE4MCkgZGlmZmVyZW5jZSArPSAzNjA7CiAgICAgICAgcmV0dXJuIGRpZmZlcmVuY2U7CiAgICAgIH0KCiAgICAgIGxldCBhemltdXRoRGlmZmVyZW5jZSA9IGNhbGN1bGF0ZUFuZ2xlRGlmZmVyZW5jZShBekFsdF9GYWtlUG9sYXJQb2ludC5Bel9kZWdyZWUsIEF6QWx0X1BvbGFyUG9pbnQuQXpfZGVncmVlKTsKICAgICAgbGV0IGFsdGl0dWRlRGlmZmVyZW5jZSA9IEF6QWx0X1BvbGFyUG9pbnQuQWx0X2RlZ3JlZSAtIEF6QWx0X0Zha2VQb2xhclBvaW50LkFsdF9kZWdyZWU7CgogICAgICAvLyDlupTnlKjlt67lgLzliLBMYXN0UG9pbnQKICAgICAgbGV0IGZvdXJ0aFBvaW50QXpBbHQgPSB7CiAgICAgICAgQXpfZGVncmVlOiB0aGlzLkxhc3RQb2ludF9BekFsdC5Bel9kZWdyZWUgKyBhemltdXRoRGlmZmVyZW5jZSwKICAgICAgICBBbHRfZGVncmVlOiB0aGlzLkxhc3RQb2ludF9BekFsdC5BbHRfZGVncmVlICsgYWx0aXR1ZGVEaWZmZXJlbmNlCiAgICAgIH07CgogICAgICAvLyDnoa7kv53mlrnkvY3op5LlnKgw5YiwMzYw5bqm5LmL6Ze0CiAgICAgIGZvdXJ0aFBvaW50QXpBbHQuQXpfZGVncmVlID0gKGZvdXJ0aFBvaW50QXpBbHQuQXpfZGVncmVlICsgMzYwKSAlIDM2MDsKCiAgICAgIC8vIOehruS/nemrmOW6puinkuWcqC05MOWIsDkw5bqm5LmL6Ze0CiAgICAgIGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSA9IE1hdGgubWF4KE1hdGgubWluKGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSwgOTApLCAtOTApOwoKICAgICAgY29uc29sZS5sb2coIkZvdXJ0aCBQb2ludCBBekFsdDoiLCBmb3VydGhQb2ludEF6QWx0LkF6X2RlZ3JlZSwgJywnLCBmb3VydGhQb2ludEF6QWx0LkFsdF9kZWdyZWUpOwoKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTaG93QXpBbHRUZXh0JywgYXppbXV0aERpZmZlcmVuY2UsIGFsdGl0dWRlRGlmZmVyZW5jZSwgZm91cnRoUG9pbnRBekFsdC5Bel9kZWdyZWUsIGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSk7CgogICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgIC8vIOWwhuinkuW6pui9rOaNouS4uuW8p+W6pgogICAgICBmdW5jdGlvbiBkZWdyZWVzVG9SYWRpYW5zKGRlZ3JlZXMpIHsKICAgICAgICByZXR1cm4gZGVncmVlcyAqIE1hdGguUEkgLyAxODA7CiAgICAgIH0KCiAgICAgIC8vIOWwhueQg+WdkOagh+i9rOaNouS4uuesm+WNoeWwlOWdkOaghwogICAgICBmdW5jdGlvbiBzcGhlcmljYWxUb0NhcnRlc2lhbihhemltdXRoLCBhbHRpdHVkZSkgewogICAgICAgIGxldCBheiA9IGRlZ3JlZXNUb1JhZGlhbnMoYXppbXV0aCk7CiAgICAgICAgbGV0IGFsdCA9IGRlZ3JlZXNUb1JhZGlhbnMoYWx0aXR1ZGUpOwogICAgICAgIGxldCB4ID0gTWF0aC5jb3MoYWx0KSAqIE1hdGguY29zKGF6KTsKICAgICAgICBsZXQgeSA9IE1hdGguY29zKGFsdCkgKiBNYXRoLnNpbihheik7CiAgICAgICAgbGV0IHogPSBNYXRoLnNpbihhbHQpOwogICAgICAgIHJldHVybiB7IHg6IHgsIHk6IHksIHo6IHogfTsKICAgICAgfQoKICAgICAgLy8g5bCG56ys5Zub5Liq54K56L2s5o2i5Li656yb5Y2h5bCU5Z2Q5qCHCiAgICAgIGxldCBmb3VydGhQb2ludENhcnRlc2lhbiA9IHNwaGVyaWNhbFRvQ2FydGVzaWFuKGZvdXJ0aFBvaW50QXpBbHQuQXpfZGVncmVlLCBmb3VydGhQb2ludEF6QWx0LkFsdF9kZWdyZWUpOwogICAgICBjb25zb2xlLmxvZygiRm91cnRoIFBvaW50IENhcnRlc2lhbjoiLCBmb3VydGhQb2ludENhcnRlc2lhbi54LCAnLCcsIGZvdXJ0aFBvaW50Q2FydGVzaWFuLnksICcsJywgZm91cnRoUG9pbnRDYXJ0ZXNpYW4ueik7CgogICAgICBsZXQgTWFya0NpcmNsZV9mb3VydGhQb2ludCA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCA0LCAiVGFyZ2V0IFBvaW50Iik7CiAgICAgIG1tID0gTWFya0NpcmNsZV9mb3VydGhQb2ludC5wb3M7CiAgICAgIG1tWzBdID0gZm91cnRoUG9pbnRDYXJ0ZXNpYW4ueDsKICAgICAgbW1bMV0gPSBmb3VydGhQb2ludENhcnRlc2lhbi55OwogICAgICBtbVsyXSA9IGZvdXJ0aFBvaW50Q2FydGVzaWFuLno7CiAgICAgIE1hcmtDaXJjbGVfZm91cnRoUG9pbnQucG9zID0gbW07CiAgICAgIE1hcmtDaXJjbGVfZm91cnRoUG9pbnQuY29sb3IgPSBbMSwgMCwgMCwgMC4yNV07CgogICAgICB0aGlzLkNpcmNsZXMucHVzaChNYXJrQ2lyY2xlX2ZvdXJ0aFBvaW50KTsKCiAgICAgIC8vIOa4heepuuWIl+ihqO+8jOWHhuWkh+S4i+asoeiuoeeulwogICAgICB0aGlzLkNhcnRlc2lhbkxpc3QgPSBbXTsKICAgICAgdGhpcy5NYXJrQ2lyY2xlTnVtID0gMDsKICAgIH0sCgogICAgLy8g5bCG6KeS5bqm6L2s5o2i5Li65byn5bqmCiAgICBkZWdyZWVzVG9SYWRpYW5zKGRlZ3JlZXMpIHsKICAgICAgcmV0dXJuIGRlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwOwogICAgfSwKCiAgICAvLyDlsIbnkIPlnZDmoIfovazmjaLkuLrnrJvljaHlsJTlnZDmoIcKICAgIHNwaGVyaWNhbFRvQ2FydGVzaWFuKGF6aW11dGgsIGFsdGl0dWRlKSB7CiAgICAgIGxldCBheiA9IHRoaXMuZGVncmVlc1RvUmFkaWFucyhhemltdXRoKTsKICAgICAgbGV0IGFsdCA9IHRoaXMuZGVncmVlc1RvUmFkaWFucyhhbHRpdHVkZSk7CiAgICAgIGxldCB4ID0gTWF0aC5jb3MoYWx0KSAqIE1hdGguY29zKGF6KTsKICAgICAgbGV0IHkgPSBNYXRoLmNvcyhhbHQpICogTWF0aC5zaW4oYXopOwogICAgICBsZXQgeiA9IE1hdGguc2luKGFsdCk7CiAgICAgIHJldHVybiB7IHg6IHgsIHk6IHksIHo6IHogfTsKICAgIH0sCgogICAgLy8g6K6h566X5peL6L2s5Zub5YWD5pWwCiAgICBjb21wdXRlUXVhdGVybmlvbihmcm9tLCB0bykgewogICAgICBsZXQgdyA9IGZyb20ueCAqIHRvLnggKyBmcm9tLnkgKiB0by55ICsgZnJvbS56ICogdG8ueiArIDE7CiAgICAgIGxldCB4ID0gZnJvbS55ICogdG8ueiAtIGZyb20ueiAqIHRvLnk7CiAgICAgIGxldCB5ID0gZnJvbS56ICogdG8ueCAtIGZyb20ueCAqIHRvLno7CiAgICAgIGxldCB6ID0gZnJvbS54ICogdG8ueSAtIGZyb20ueSAqIHRvLng7CgogICAgICBsZXQgbm9ybSA9IE1hdGguc3FydCh3ICogdyArIHggKiB4ICsgeSAqIHkgKyB6ICogeik7CiAgICAgIHJldHVybiB7IHc6IHcgLyBub3JtLCB4OiB4IC8gbm9ybSwgeTogeSAvIG5vcm0sIHo6IHogLyBub3JtIH07CiAgICB9LAoKICAgIC8vIOW6lOeUqOWbm+WFg+aVsOaXi+i9rAogICAgYXBwbHlRdWF0ZXJuaW9uKHBvaW50LCBxdWF0KSB7CiAgICAgIGxldCB4ID0gcXVhdC53ICogcXVhdC53ICogcG9pbnQueCArIDIgKiBxdWF0LnkgKiBxdWF0LncgKiBwb2ludC56IC0gMiAqIHF1YXQueiAqIHF1YXQudyAqIHBvaW50LnkgKyBxdWF0LnggKiBxdWF0LnggKiBwb2ludC54ICsgMiAqIHF1YXQueSAqIHF1YXQueCAqIHBvaW50LnkgKyAyICogcXVhdC56ICogcXVhdC54ICogcG9pbnQueiAtIHF1YXQueiAqIHF1YXQueiAqIHBvaW50LnggLSBxdWF0LnkgKiBxdWF0LnkgKiBwb2ludC54OwogICAgICBsZXQgeSA9IDIgKiBxdWF0LnggKiBxdWF0LnkgKiBwb2ludC54ICsgcXVhdC55ICogcXVhdC55ICogcG9pbnQueSArIDIgKiBxdWF0LnogKiBxdWF0LnkgKiBwb2ludC56ICsgMiAqIHF1YXQudyAqIHF1YXQueiAqIHBvaW50LnggLSBxdWF0LnogKiBxdWF0LnogKiBwb2ludC55ICsgcXVhdC53ICogcXVhdC53ICogcG9pbnQueSAtIDIgKiBxdWF0LnggKiBxdWF0LncgKiBwb2ludC56IC0gcXVhdC54ICogcXVhdC54ICogcG9pbnQueTsKICAgICAgbGV0IHogPSAyICogcXVhdC54ICogcXVhdC56ICogcG9pbnQueCArIDIgKiBxdWF0LnkgKiBxdWF0LnogKiBwb2ludC55ICsgcXVhdC56ICogcXVhdC56ICogcG9pbnQueiAtIDIgKiBxdWF0LncgKiBxdWF0LnkgKiBwb2ludC54IC0gcXVhdC55ICogcXVhdC55ICogcG9pbnQueiArIDIgKiBxdWF0LncgKiBxdWF0LnggKiBwb2ludC55IC0gcXVhdC54ICogcXVhdC54ICogcG9pbnQueiArIHF1YXQudyAqIHF1YXQudyAqIHBvaW50Lno7CiAgICAgIHJldHVybiB7IHg6IHgsIHk6IHksIHo6IHogfTsKICAgIH0sCgogICAgLy8g5bCG56yb5Y2h5bCU5Z2Q5qCH6L2s5o2i5Zue55CD5Z2Q5qCHCiAgICBjYXJ0ZXNpYW5Ub1NwaGVyaWNhbChjYXJ0ZXNpYW4pIHsKICAgICAgbGV0IHIgPSBNYXRoLnNxcnQoY2FydGVzaWFuLnggKiogMiArIGNhcnRlc2lhbi55ICoqIDIgKyBjYXJ0ZXNpYW4ueiAqKiAyKTsKICAgICAgbGV0IGF6aW11dGggPSBNYXRoLmF0YW4yKGNhcnRlc2lhbi55LCBjYXJ0ZXNpYW4ueCk7CiAgICAgIGxldCBhbHRpdHVkZSA9IE1hdGguYXNpbihjYXJ0ZXNpYW4ueiAvIHIpOwogICAgICByZXR1cm4gewogICAgICAgIEF6X2RlZ3JlZTogYXppbXV0aCAqIDE4MCAvIE1hdGguUEksCiAgICAgICAgQWx0X2RlZ3JlZTogYWx0aXR1ZGUgKiAxODAgLyBNYXRoLlBJCiAgICAgIH07CiAgICB9LAoKICAgIFNvbHZlRm92TWFyayhSYURlYykgewogICAgICBjb25zb2xlLmxvZygnUmFEZWNbNF06JywgUmFEZWMpOwoKICAgICAgLy8gbGV0IHJlY3RhbmdsZSA9IHRoaXMuQWRkTWFya1JlY3RhbmdsZSh0aGlzLiRzdGVsLCBnbExheWVyLCBSYURlYyk7CgogICAgICB0aGlzLkNpcmNsZXMucHVzaChyZWN0YW5nbGUpOwoKICAgIH0sCgogICAgQ2FsaWJyYXRlUG9sYXJBeGlzKCkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ0NhbGlicmF0ZVBvbGFyQXhpc01vZGUnKTsKICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdTdGFydExvb3BDYXB0dXJlJyk7CiAgICAgIHRoaXMubmF2ID0gZmFsc2U7CiAgICB9LAoKICAgIFJlY2FsaWJyYXRlUG9sYXJBeGlzKCkgewogICAgICAvLyDmuIXnqbrliJfooajvvIzlh4blpIfkuIvmrKHorqHnrpcKICAgICAgdGhpcy5DYXJ0ZXNpYW5MaXN0ID0gW107CiAgICAgIHRoaXMuTWFya0NpcmNsZU51bSA9IDA7CiAgICAgIHRoaXMuUmVtb3ZlQWxsQ2lyY2xlcygpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NsZWFyU2xvdmVSZXN1bHRMaXN0Jyk7CiAgICB9LAoKCgogICAgLy8g5L2/55So5paw55qE5aSa6L655b2i5pa55byP57uY5Yi25qCh5YeG54K5CiAgICBkcmF3Q2FsaWJyYXRpb25Qb2ludFBvbHlnb24oY29vcmRpbmF0ZXMsIGNvbG9yLCBuYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKGDnu5jliLbmoKHlh4bngrnlpJrovrnlvaI6ICR7bmFtZX1gLCBjb29yZGluYXRlcyk7CgogICAgICB0cnkgewogICAgICAgIC8vIOmqjOivgei+k+WFpeWPguaVsAogICAgICAgIGlmICghY29vcmRpbmF0ZXMgfHwgIUFycmF5LmlzQXJyYXkoY29vcmRpbmF0ZXMpKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfmoKHlh4bngrnlnZDmoIflv4XpobvmmK/mlbDnu4QnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChjb29yZGluYXRlcy5sZW5ndGggIT09IDUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOagoeWHhueCueWdkOagh+W/hemhu+aYrzXkuKrngrnvvIzlvZPliY3mnIkke2Nvb3JkaW5hdGVzLmxlbmd0aH3kuKrngrlgKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOmqjOivgeavj+S4quWdkOagh+eCuQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRpbmF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGNvb3JkID0gY29vcmRpbmF0ZXNbaV07CiAgICAgICAgICBpZiAoIWNvb3JkIHx8IHR5cGVvZiBjb29yZC5yYSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGNvb3JkLmRlYyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihg5qCh5YeG54K55Z2Q5qCHJHtpfeagvOW8j+mUmeivr++8mmAsIGNvb3JkKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZShjb29yZC5yYSkgfHwgIXRoaXMuaXNWYWxpZENvb3JkaW5hdGUoY29vcmQuZGVjKSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGDmoKHlh4bngrnlnZDmoIcke2l95YC85peg5pWI77yaYCwgY29vcmQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDkvb/nlKjmlrDnmoTlpJrovrnlvaLnu5jliLbmlrnms5UKICAgICAgICBsZXQgY2FsaWJyYXRpb25Qb2x5Z29uID0gdGhpcy5BZGRGaWVsZE9mVmlld1BvbHlnb24oCiAgICAgICAgICB0aGlzLiRzdGVsLAogICAgICAgICAgZ2xMYXllciwKICAgICAgICAgIGNvb3JkaW5hdGVzLAogICAgICAgICAgY29sb3IsCiAgICAgICAgICBuYW1lCiAgICAgICAgKTsKCiAgICAgICAgaWYgKGNhbGlicmF0aW9uUG9seWdvbikgewogICAgICAgICAgLy8g5re75Yqg5Yiw5qCh5YeG54K55pWw57uECiAgICAgICAgICBpZiAoIXRoaXMuY2FsaWJyYXRpb25DaXJjbGVzKSB7CiAgICAgICAgICAgIHRoaXMuY2FsaWJyYXRpb25DaXJjbGVzID0gW107CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmNhbGlicmF0aW9uQ2lyY2xlcy5wdXNoKGNhbGlicmF0aW9uUG9seWdvbik7CgogICAgICAgICAgY29uc29sZS5sb2coYOagoeWHhueCueWkmui+ueW9ouWIm+W7uuaIkOWKnzogJHtuYW1lfWAsIGNhbGlicmF0aW9uUG9seWdvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOagoeWHhueCueWkmui+ueW9ouWIm+W7uuWksei0pTogJHtuYW1lfWApOwogICAgICAgIH0KCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign57uY5Yi25qCh5YeG54K55aSa6L655b2i5pe25Ye66ZSZOicsIGVycm9yKTsKICAgICAgfQogICAgfSwKCiAgICAvLyDmuIXpmaTmiYDmnInmoKHlh4bngrkKICAgIGNsZWFyQ2FsaWJyYXRpb25Qb2ludHMoKSB7CiAgICAgIGNvbnNvbGUubG9nKCfmuIXpmaTmiYDmnInmoKHlh4bngrknKTsKCiAgICAgIC8vIOehruS/neaVsOe7hOWtmOWcqAogICAgICBpZiAoIXRoaXMuY2FsaWJyYXRpb25DaXJjbGVzKSB7CiAgICAgICAgdGhpcy5jYWxpYnJhdGlvbkNpcmNsZXMgPSBbXTsKICAgICAgfQogICAgICBpZiAoIXRoaXMuYWRqdXN0bWVudENpcmNsZXMpIHsKICAgICAgICB0aGlzLmFkanVzdG1lbnRDaXJjbGVzID0gW107CiAgICAgIH0KCiAgICAgIC8vIOa4hemZpOagoeWHhueCuQogICAgICBpZiAodGhpcy5jYWxpYnJhdGlvbkNpcmNsZXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnNvbGUubG9nKGDmuIXpmaQgJHt0aGlzLmNhbGlicmF0aW9uQ2lyY2xlcy5sZW5ndGh9IOS4quagoeWHhueCuWApOwogICAgICAgIHRoaXMuY2FsaWJyYXRpb25DaXJjbGVzLmZvckVhY2goKGNpcmNsZSwgaW5kZXgpID0+IHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjaXJjbGUgJiYgZ2xMYXllcikgewogICAgICAgICAgICAgIGdsTGF5ZXIucmVtb3ZlKGNpcmNsZSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYOaIkOWKn+a4hemZpOagoeWHhueCuSAke2luZGV4ICsgMX1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGDmuIXpmaTmoKHlh4bngrkgJHtpbmRleCArIDF9IOaXtuWHuumUmTpgLCBlcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5jYWxpYnJhdGlvbkNpcmNsZXMgPSBbXTsKICAgICAgfQoKICAgICAgLy8g5riF6Zmk6LCD5pW054K5CiAgICAgIGlmICh0aGlzLmFkanVzdG1lbnRDaXJjbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zb2xlLmxvZyhg5riF6ZmkICR7dGhpcy5hZGp1c3RtZW50Q2lyY2xlcy5sZW5ndGh9IOS4quiwg+aVtOeCuWApOwogICAgICAgIHRoaXMuYWRqdXN0bWVudENpcmNsZXMuZm9yRWFjaCgoY2lyY2xlLCBpbmRleCkgPT4gewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNpcmNsZSAmJiBnbExheWVyKSB7CiAgICAgICAgICAgICAgZ2xMYXllci5yZW1vdmUoY2lyY2xlKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg5oiQ5Yqf5riF6Zmk6LCD5pW054K5ICR7aW5kZXggKyAxfWApOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLndhcm4oYOa4hemZpOiwg+aVtOeCuSAke2luZGV4ICsgMX0g5pe25Ye66ZSZOmAsIGVycm9yKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmFkanVzdG1lbnRDaXJjbGVzID0gW107CiAgICAgIH0KCiAgICAgIC8vIOa4hemZpOS4iuS4gOasoeS9jee9rgogICAgICB0aGlzLmxhc3RQb3NpdGlvbiA9IG51bGw7CgogICAgICAvLyDmuIXpmaTnm67moIfngrkKICAgICAgaWYgKHRoaXMudGFyZ2V0UG9pbnRDaXJjbGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKGdsTGF5ZXIpIHsKICAgICAgICAgICAgZ2xMYXllci5yZW1vdmUodGhpcy50YXJnZXRQb2ludENpcmNsZSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmiJDlip/muIXpmaTnm67moIfngrknKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudGFyZ2V0UG9pbnRDaXJjbGUgPSBudWxsOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ+a4hemZpOebruagh+eCueaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zb2xlLmxvZygn5omA5pyJ5qCh5YeG55u45YWz5YWD57Sg5riF6Zmk5a6M5oiQJyk7CiAgICB9LAoKCiAgICAvLyDkvb/nlKjmlrDnmoTlpJrovrnlvaLmlrnlvI/nu5jliLbosIPmlbTngrkKICAgIC8vIOS9v+eUqOaWsOeahOWkmui+ueW9ouaWueW8j+e7mOWItuiwg+aVtOeCue+8iOS4jeWcqOatpOWkhOeUu+Wchu+8iQogICAgZHJhd0FkanVzdG1lbnRQb2ludHNQb2x5Z29uKGN1cnJlbnRDb29yZGluYXRlcywgdGFyZ2V0Q29vcmRpbmF0ZXMsIGN1cnJlbnRDb2xvciwgdGFyZ2V0Q29sb3IsIGlzVGltZXJVcGRhdGUpIHsKICAgICAgaWYgKGlzVGltZXJVcGRhdGUgPT09IHVuZGVmaW5lZCkgaXNUaW1lclVwZGF0ZSA9IGZhbHNlOwogICAgICBjb25zb2xlLmxvZygn57uY5Yi26LCD5pW054K55aSa6L655b2iJywgeyBjdXJyZW50Q29vcmRpbmF0ZXMsIHRhcmdldENvb3JkaW5hdGVzIH0pOwoKICAgICAgdHJ5IHsKICAgICAgICAvLyAxKSDmuIXpmaTkuYvliY3nmoTosIPmlbTngrkKICAgICAgICBpZiAodGhpcy5hZGp1c3RtZW50Q2lyY2xlcykgewogICAgICAgICAgdGhpcy5hZGp1c3RtZW50Q2lyY2xlcy5mb3JFYWNoKG9iaiA9PiB7CiAgICAgICAgICAgIHRyeSB7IGdsTGF5ZXIucmVtb3ZlKG9iaik7IH0gY2F0Y2ggKGUpIHsgY29uc29sZS53YXJuKCfmuIXpmaTosIPmlbTngrnml7blh7rplJk6JywgZSk7IH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB0aGlzLmFkanVzdG1lbnRDaXJjbGVzID0gW107CgogICAgICAgIC8vIDIpIOe7mOWItuW9k+WJjeS9jee9ruinhuWcuuWkmui+ueW9ogogICAgICAgIGlmIChjdXJyZW50Q29vcmRpbmF0ZXMgJiYgQXJyYXkuaXNBcnJheShjdXJyZW50Q29vcmRpbmF0ZXMpICYmIGN1cnJlbnRDb29yZGluYXRlcy5sZW5ndGggPT09IDUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfnu5jliLblvZPliY3kvY3nva7lpJrovrnlvaInKTsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRQb2x5Z29uID0gdGhpcy5BZGRGaWVsZE9mVmlld1BvbHlnb24oCiAgICAgICAgICAgIHRoaXMuJHN0ZWwsCiAgICAgICAgICAgIGdsTGF5ZXIsCiAgICAgICAgICAgIGN1cnJlbnRDb29yZGluYXRlcywKICAgICAgICAgICAgY3VycmVudENvbG9yLAogICAgICAgICAgICAnQ3VycmVudCcKICAgICAgICAgICk7CiAgICAgICAgICBpZiAoY3VycmVudFBvbHlnb24pIHsKICAgICAgICAgICAgdGhpcy5hZGp1c3RtZW50Q2lyY2xlcy5wdXNoKGN1cnJlbnRQb2x5Z29uKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+W9k+WJjeS9jee9ruWkmui+ueW9ouWIm+W7uuaIkOWKnycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5b2T5YmN5L2N572u5aSa6L655b2i5Yib5bu65aSx6LSlJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign5b2T5YmN5L2N572u5Z2Q5qCH5peg5pWI77yM6Lez6L+H57uY5Yi2Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyAzKSDop4bop5LovazlkJHvvIjlj6/pgInvvJvkuI3liJvlu7rlnIbvvIkKICAgICAgICBpZiAoIWlzVGltZXJVcGRhdGUgJiYgdGFyZ2V0Q29vcmRpbmF0ZXMgJiYgQXJyYXkuaXNBcnJheSh0YXJnZXRDb29yZGluYXRlcykgJiYgdGFyZ2V0Q29vcmRpbmF0ZXMubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBjZW50ZXJSYSA9IHRhcmdldENvb3JkaW5hdGVzLnJlZHVjZSgocywgYykgPT4gcyArIGMucmEsIDApIC8gdGFyZ2V0Q29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgICAgICBjb25zdCBjZW50ZXJEZWMgPSB0YXJnZXRDb29yZGluYXRlcy5yZWR1Y2UoKHMsIGMpID0+IHMgKyBjLmRlYywgMCkgLyB0YXJnZXRDb29yZGluYXRlcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDop4bop5LovazlkJHnm67moIc6IFJBPSR7Y2VudGVyUmF9LCBERUM9JHtjZW50ZXJEZWN9YCk7CgogICAgICAgICAgICAvLyDnlKjkuLTml7blr7nosaHlj6rlgZrmjIflkJHvvIzkuI3liqDlhaUgbGF5ZXIKICAgICAgICAgICAgY29uc3QgdGFyZ2V0T2JqQ29uZmlnID0gewogICAgICAgICAgICAgIGlkOiAndGVtcF90YXJnZXRfJyArIERhdGUubm93KCksCiAgICAgICAgICAgICAgbW9kZWxfZGF0YToge30sCiAgICAgICAgICAgICAgbmFtZXM6IFsnVGFyZ2V0IFBvc2l0aW9uJ10sCiAgICAgICAgICAgICAgdHlwZXM6IFsnVGVtcG9yYXJ5J10sCiAgICAgICAgICAgICAgbW9kZWw6ICd0ZW1wb3JhcnknCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IHRhcmdldE9iaiA9IHRoaXMuJHN0ZWwuY3JlYXRlT2JqKCdjaXJjbGUnLCB0YXJnZXRPYmpDb25maWcpOwogICAgICAgICAgICBsZXQgbW0gPSB0YXJnZXRPYmoucG9zOwogICAgICAgICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKGNlbnRlclJhLCBjZW50ZXJEZWMsIG1tKTsKICAgICAgICAgICAgdGFyZ2V0T2JqLnBvcyA9IG1tOwogICAgICAgICAgICBpZiAodHlwZW9mIHRhcmdldE9iai51cGRhdGUgPT09ICdmdW5jdGlvbicpIHRhcmdldE9iai51cGRhdGUoKTsKCiAgICAgICAgICAgIHRoaXMuJHN0ZWwucG9pbnRBbmRMb2NrKHRhcmdldE9iaiwgMS4wKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+inhuinkui9rOWQkeWujOaIkCcpOwoKICAgICAgICAgICAgLy8g5riF55CG5Li05pe25a+56LGh77yI5pyq5Yqg5YWlIGxheWVy77yM5peg6ZyAIHJlbW92Ze+8iQogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgdHJ5IHsgLyogbm8tb3AgKi8gfSBjYXRjaCAoXykgeyB9IH0sIDApOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign6KeG6KeS6L2s5ZCR5Ye66ZSZOicsIGVycm9yKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+e7mOWItuiwg+aVtOeCueWkmui+ueW9ouaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0sCgoKICAgIC8vIOe7mOWItuebruagh+eCueWchuW9ou+8iOWdkOagh++8mlJBL0RlY++8jOWNleS9je+8muW6pu+8iQogICAgZHJhd1RhcmdldFBvaW50Q2lyY2xlKHRhcmdldFJhLCB0YXJnZXREZWMsIGNvbG9yLCBuYW1lLCB0ZXh0LCBjbGVhcmxhc3QpIHsKICAgICAgaWYgKGNsZWFybGFzdCA9PT0gdW5kZWZpbmVkKSBjbGVhcmxhc3QgPSB0cnVlOyAvLyDlhoXpg6jorr7nva7pu5jorqTlgLwKICAgICAgY29uc29sZS5sb2coJ+e7mOWItuebruagh+eCueWchuW9oicsIHsgdGFyZ2V0UmEsIHRhcmdldERlYywgY29sb3IgfSk7CgogICAgICB0cnkgewogICAgICAgIC8vIDEpIOagoemqjAogICAgICAgIGlmICghdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZSh0YXJnZXRSYSkgfHwgIXRoaXMuaXNWYWxpZENvb3JkaW5hdGUodGFyZ2V0RGVjKSkgewogICAgICAgICAgY29uc29sZS5lcnJvcih0ZXh0ICsgJ+WdkOagh+aXoOaViDonLCB7IHRhcmdldFJhLCB0YXJnZXREZWMgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyAyKSDmuIXpmaTkuYvliY3nmoTnm67moIfngrkKICAgICAgICBpZiAodGhpcy50YXJnZXRQb2ludENpcmNsZSAmJiBjbGVhcmxhc3QpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChnbExheWVyKSB7CiAgICAgICAgICAgICAgZ2xMYXllci5yZW1vdmUodGhpcy50YXJnZXRQb2ludENpcmNsZSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+aIkOWKn+a4hemZpOS5i+WJjeeahCcgKyBuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCfmuIXpmaTkuYvliY3nmoQnICsgdGV4dCArICfml7blh7rplJk6JywgZXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gMykg5Yib5bu65ZyG5a+56LGhCiAgICAgICAgY29uc3QgY2lyY2xlID0gdGhpcy5BZGRNYXJrQ2lyY2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIDQsIG5hbWUpOyAvLyBmcmFtZT0077ya6LWk6YGT57O7CiAgICAgICAgaWYgKCFjaXJjbGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGV4dCArICflnIblvaLliJvlu7rlpLHotKUnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIDQpIOS9jee9ru+8iFJBL0RlYyDluqYg4oaSIDNEIOWNleS9jeWQkemHj++8iQogICAgICAgIGNvbnN0IG1tID0gY2lyY2xlLnBvczsKICAgICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKHRhcmdldFJhLCB0YXJnZXREZWMsIG1tKTsKICAgICAgICBjaXJjbGUucG9zID0gbW07CgogICAgICAgIC8vIDUpIOagt+W8jwogICAgICAgIGlmIChjb2xvcikgewogICAgICAgICAgY29uc3QgcmdiID0gdGhpcy5oZXhUb1JnYihjb2xvci5zdHJva2UgfHwgY29sb3IuZmlsbCB8fCAnI0ZGOEMwMCcpOwogICAgICAgICAgY29uc3QgYWxwaGEgPSAoY29sb3IuZmlsbE9wYWNpdHkgfHwgMC4zKTsKICAgICAgICAgIGNvbnN0IGJvcmRlckFscGhhID0gKGNvbG9yLnN0cm9rZU9wYWNpdHkgfHwgMS4wKTsKICAgICAgICAgIGNpcmNsZS5jb2xvciA9IFtyZ2IuciAvIDI1NSwgcmdiLmcgLyAyNTUsIHJnYi5iIC8gMjU1LCBhbHBoYV07CiAgICAgICAgICBjaXJjbGUuYm9yZGVyX2NvbG9yID0gW3JnYi5yIC8gMjU1LCByZ2IuZyAvIDI1NSwgcmdiLmIgLyAyNTUsIGJvcmRlckFscGhhXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2lyY2xlLmNvbG9yID0gWzEsIDAuNTUsIDAsIDAuM107CiAgICAgICAgICBjaXJjbGUuYm9yZGVyX2NvbG9yID0gWzEsIDAuNTUsIDAsIDFdOwogICAgICAgIH0KICAgICAgICBjb25zdCBzaXplID0gMC4wMjsKICAgICAgICBjaXJjbGUuc2l6ZSA9IFtzaXplLCBzaXplXTsKCiAgICAgICAgLy8gNikg5pu05pawICYg5L+d5a2Y5byV55SoCiAgICAgICAgaWYgKHR5cGVvZiBjaXJjbGUudXBkYXRlID09PSAnZnVuY3Rpb24nKSBjaXJjbGUudXBkYXRlKCk7CiAgICAgICAgdGhpcy50YXJnZXRQb2ludENpcmNsZSA9IGNpcmNsZTsKCiAgICAgICAgY29uc29sZS5sb2codGV4dCArICflnIblvaLliJvlu7rmiJDlip8nLCBjaXJjbGUpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+e7mOWIticgKyB0ZXh0ICsgJ+WchuW9ouaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0sCgoKICAgIC8vIOe7mOWItuWBh+aegei9tOWchuW9ogogICAgRHJhd0Zha2VQb2xhckF4aXNDaXJjbGUodGFyZ2V0UmEsIHRhcmdldERlYywgY29sb3IsIG5hbWUsIHRleHQpIHsKICAgICAgY29uc29sZS5sb2coJ+e7mOWItuebruagh+eCueWchuW9oicsIHsgdGFyZ2V0UmEsIHRhcmdldERlYywgY29sb3IgfSk7CgogICAgICB0cnkgewogICAgICAgIC8vIOmqjOivgei+k+WFpeWPguaVsAogICAgICAgIGlmICghdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZSh0YXJnZXRSYSkgfHwgIXRoaXMuaXNWYWxpZENvb3JkaW5hdGUodGFyZ2V0RGVjKSkgewogICAgICAgICAgY29uc29sZS5lcnJvcih0ZXh0ICsgJ+WdkOagh+aXoOaViDonLCB7IHRhcmdldFJhLCB0YXJnZXREZWMgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDmuIXpmaTkuYvliY3nmoTnm67moIfngrkKICAgICAgICBpZiAodGhpcy5mYWtlUG9sYXJBeGlzQ2lyY2xlKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoZ2xMYXllcikgewogICAgICAgICAgICAgIGdsTGF5ZXIucmVtb3ZlKHRoaXMuZmFrZVBvbGFyQXhpc0NpcmNsZSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+aIkOWKn+a4hemZpOS5i+WJjeeahCcgKyBuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCfmuIXpmaTkuYvliY3nmoQnICsgdGV4dCArICfml7blh7rplJk6JywgZXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5Yib5bu655uu5qCH54K55ZyG5b2iCiAgICAgICAgbGV0IHRhcmdldENpcmNsZSA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCA0LCBuYW1lKTsKICAgICAgICBpZiAodGFyZ2V0Q2lyY2xlKSB7CiAgICAgICAgICAvLyDorr7nva7nm67moIfngrnkvY3nva4KICAgICAgICAgIGxldCB0YXJnZXRNbSA9IHRhcmdldENpcmNsZS5wb3M7CiAgICAgICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKHRhcmdldFJhLCB0YXJnZXREZWMsIHRhcmdldE1tKTsKICAgICAgICAgIHRhcmdldENpcmNsZS5wb3MgPSB0YXJnZXRNbTsKCiAgICAgICAgICAvLyDorr7nva7nm67moIfngrnpopzoibLlkozmoLflvI8KICAgICAgICAgIGlmIChjb2xvcikgewogICAgICAgICAgICAvLyDlsIbljYHlha3ov5vliLbpopzoibLovazmjaLkuLpSR0LmlbDnu4QKICAgICAgICAgICAgY29uc3QgcmdiID0gdGhpcy5oZXhUb1JnYihjb2xvci5zdHJva2UgfHwgY29sb3IuZmlsbCB8fCAnI0ZGOEMwMCcpOwogICAgICAgICAgICBjb25zdCBhbHBoYSA9IChjb2xvci5maWxsT3BhY2l0eSB8fCAwLjMpOwogICAgICAgICAgICBjb25zdCBib3JkZXJBbHBoYSA9IChjb2xvci5zdHJva2VPcGFjaXR5IHx8IDEuMCk7CgogICAgICAgICAgICB0YXJnZXRDaXJjbGUuY29sb3IgPSBbcmdiLnIgLyAyNTUsIHJnYi5nIC8gMjU1LCByZ2IuYiAvIDI1NSwgYWxwaGFdOwogICAgICAgICAgICB0YXJnZXRDaXJjbGUuYm9yZGVyX2NvbG9yID0gW3JnYi5yIC8gMjU1LCByZ2IuZyAvIDI1NSwgcmdiLmIgLyAyNTUsIGJvcmRlckFscGhhXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOm7mOiupOapmeiJsgogICAgICAgICAgICB0YXJnZXRDaXJjbGUuY29sb3IgPSBbMSwgMC41NSwgMCwgMC4zXTsgIC8vIOapmeiJsu+8jOWNiumAj+aYjgogICAgICAgICAgICB0YXJnZXRDaXJjbGUuYm9yZGVyX2NvbG9yID0gWzEsIDAuNTUsIDAsIDFdOyAgLy8g5qmZ6Imy6L655qGGCiAgICAgICAgICB9CgogICAgICAgICAgLy8g6K6+572u55uu5qCH54K55aSn5bCPCiAgICAgICAgICBjb25zdCB0YXJnZXRTaXplID0gMC4wMjsgLy8g5Zu65a6a5bCP5bC65a+4CiAgICAgICAgICB0YXJnZXRDaXJjbGUuc2l6ZSA9IFt0YXJnZXRTaXplLCB0YXJnZXRTaXplXTsKCiAgICAgICAgICAvLyDkv53lrZjnm67moIfngrnlvJXnlKjvvIznlKjkuo7lkI7nu63muIXpmaQKICAgICAgICAgIHRoaXMuZmFrZVBvbGFyQXhpc0NpcmNsZSA9IHRhcmdldENpcmNsZTsKCiAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0ICsgJ+WchuW9ouWIm+W7uuaIkOWKnycsIHRhcmdldENpcmNsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGV4dCArICflnIblvaLliJvlu7rlpLHotKUnKTsKICAgICAgICB9CgogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+e7mOWIticgKyB0ZXh0ICsgJ+WchuW9ouaXtuWHuumUmTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0sCgogICAgU2hvd0NvbmZpcm1EaWFsb2coVGl0bGUsIFRleHQsIFRvRG8pIHsKICAgICAgLy8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dDb25maXJtRGlhbG9nJywgVGl0bGUsIFRleHQsIFRvRG8pOwogICAgfSwKCiAgICBkZWNyZW1lbnQoaXRlbSkgewogICAgICBjb25zb2xlLmxvZygnZGVjcmVtZW50OicsIGl0ZW0udmFsdWUpOwogICAgICBpZiAoaXRlbS52YWx1ZSA+IGl0ZW0uaW5wdXRNaW4pIHsKICAgICAgICBpdGVtLnZhbHVlIC09IGl0ZW0uaW5wdXRTdGVwOwogICAgICB9CiAgICB9LAoKICAgIGluY3JlbWVudChpdGVtKSB7CiAgICAgIGNvbnNvbGUubG9nKCdpbmNyZW1lbnQ6JywgaXRlbS52YWx1ZSk7CiAgICAgIGlmIChpdGVtLnZhbHVlIDwgaXRlbS5pbnB1dE1heCkgewogICAgICAgIGl0ZW0udmFsdWUgKz0gaXRlbS5pbnB1dFN0ZXA7CiAgICAgIH0KICAgIH0sCgogICAgUG9sYXJBeGlzTW9kZShib29sKSB7CiAgICAgIHRoaXMuaXNQb2xhckF4aXNNb2RlID0gYm9vbDsKICAgIH0sCgogICAgaGFuZGxlR3VpZGVyQ2FudmFzQ2xpY2soZXZlbnQpIHsKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5ndWlkZXJDYW52YXM7CiAgICAgIGNvbnN0IHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIGNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OyAvLyDngrnlh7vlnZDmoIdYCiAgICAgIGNvbnN0IHkgPSBldmVudC5jbGllbnRZIC0gcmVjdC50b3A7ICAvLyDngrnlh7vlnZDmoIdZCiAgICAgIGNvbnNvbGUubG9nKGBDbGlja2VkIGF0OiAoJHt4fSwgJHt5fSlgKTsKICAgICAgY29uc3QgQ2FudmFzV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgY29uc3QgQ2FudmFzSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0d1aWRlckNhbnZhc0NsaWNrOicgKyBDYW52YXNXaWR0aCArICc6JyArIENhbnZhc0hlaWdodCArICc6JyArIHggKyAnOicgKyB5KTsKICAgIH0sCiAgICBjb25uZWN0RHJpdmVyKCkgewogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IHRydWU7CiAgICAgIC8vIHRoaXMuaXNPcGVuRGV2aWNlUGFnZSA9IGZhbHNlOwogICAgICB0aGlzLnN0YXJ0TG9hZGluZygpOwogICAgICBjb25zdCBEZXZpY2VUeXBlID0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZTsKICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBEZXZpY2VUeXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCA9PSBmYWxzZSkgewogICAgICAgICAgY29uc3QgRHJpdmVyTmFtZSA9IGRldmljZS5kcml2ZXJOYW1lOwogICAgICAgICAgaWYgKERyaXZlck5hbWUgPT0gJycpIHsKICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTm8gZHJpdmVyIHNlbGVjdGVkJywgJ3dhcm5pbmcnKTsKICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdDb25uZWN0RHJpdmVyOicgKyBEcml2ZXJOYW1lICsgJzonICsgRGV2aWNlVHlwZSk7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTdGFydCBDb25uZWN0aW5nIGRyaXZlcjonICsgRGV2aWNlVHlwZSArICcgJyArIERyaXZlck5hbWUsICdpbmZvJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY29ubmVjdERyaXZlclN1Y2Nlc3MoZGV2aWNldHlwZSkgewogICAgICBjb25zb2xlLmxvZygnY29ubmVjdERyaXZlclN1Y2Nlc3M6JywgZGV2aWNldHlwZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coImNvbm5lY3REcml2ZXJTdWNjZXNzOiIgKyBkZXZpY2V0eXBlLCAnaW5mbycpOwogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IGZhbHNlOwogICAgICBpZiAodGhpcy5kcmF3ZXJfMiA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5kcmF3ZXJfMiA9IGZhbHNlCiAgICAgIH0KCiAgICAgIHRoaXMuc3RvcExvYWRpbmcoKTsKICAgIH0sCiAgICBjb25uZWN0RHJpdmVyRmFpbGVkKG1lc3NhZ2UpIHsKICAgICAgY29uc29sZS5sb2coJ2Nvbm5lY3REcml2ZXJGYWlsZWQ6JywgbWVzc2FnZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coImNvbm5lY3REcml2ZXJGYWlsZWQ6IiArIG1lc3NhZ2UsICdlcnJvcicpOwogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IGZhbHNlOwogICAgICB0aGlzLnN0b3BMb2FkaW5nKCk7CiAgICB9LAogICAgZGlzY29ubmVjdERyaXZlcigpIHsKICAgICAgY29uc3QgRGV2aWNlVHlwZSA9IHRoaXMuQ3VycmVudERyaXZlclR5cGU7CiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuZGV2aWNlcykgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gRGV2aWNlVHlwZSAmJiBkZXZpY2UuaXNDb25uZWN0ZWQpIHsKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnRGlzY29ubmVjdERldmljZTonICsgZGV2aWNlLmRldmljZSArICI6IiArIERldmljZVR5cGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRpc2Nvbm5lY3REcml2ZXJzdWNjZXNzKGRldmljZXR5cGUpIHsKICAgICAgY29uc29sZS5sb2coJ2Rpc2Nvbm5lY3REZXZpY2VzdWNjZXNzOicsIGRldmljZXR5cGUpOwogICAgICB0aGlzLmRyYXdlcl8yID0gZmFsc2UKICAgICAgaWYgKGRldmljZXR5cGUgPT0gImFsbCIpIHsKICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdkaXNjb25uZWN0QWxsRGV2aWNlJyk7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRGlzY29ubmVjdCBBbGwgRGV2aWNlJywgJ2luZm8nKTsKICAgICAgICB0aGlzLmhhdmVEZXZpY2VDb25uZWN0ID0gZmFsc2U7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudENvbm5lY3RlZCcsIDApOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLmNsZWFyRGV2aWNlTGlzdCgpOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZGVsZXRlRGV2aWNlVHlwZUFsbG9jYXRpb25MaXN0JywgJ2FsbCcpOwogICAgICAgIHJldHVybjsKICAgICAgfTsKCiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuZGV2aWNlcykgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZGV2aWNldHlwZSAmJiBkZXZpY2UuaXNDb25uZWN0ZWQpIHsKICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gZGV2aWNlLmRyaXZlck5hbWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UpIHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09IGRldmljZXR5cGUpIHsKICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gZGV2aWNlLmRyaXZlck5hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCcsIGRldmljZXR5cGUpOwogICAgICBpZiAoZGV2aWNldHlwZSA9PSAiTWFpbkNhbWVyYSIpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJNb3VudCIpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgIH0gZWxzZSBpZiAoZGV2aWNldHlwZSA9PSAiQ0ZXIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMCk7CiAgICAgIH0gZWxzZSBpZiAoZGV2aWNldHlwZSA9PSAiR3VpZGVyIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyQ29ubmVjdGVkJywgMCk7CiAgICAgIH0KICAgIH0sCgogICAgZGlzY29ubmVjdERyaXZlckZhaWwoZGV2aWNldHlwZSkgewogICAgICBjb25zb2xlLmxvZygnZGlzY29ubmVjdERldmljZUZhaWw6JywgZGV2aWNldHlwZSk7CiAgICAgIHRoaXMuZHJhd2VyXzIgPSBmYWxzZQogICAgICBpZiAoZGV2aWNldHlwZSA9PSAiYWxsIikgewogICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdEaXNjb25uZWN0IEFsbCBEZXZpY2UnLCAnaW5mbycpOwogICAgICAgIHRoaXMuaGF2ZURldmljZUNvbm5lY3QgPSBmYWxzZTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDRldDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDApOwogICAgICAgIHRoaXMuY2xlYXJEZXZpY2VMaXN0KCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdkZWxldGVEZXZpY2VUeXBlQWxsb2NhdGlvbkxpc3QnLCAnYWxsJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9OwoKICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBkZXZpY2V0eXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCkgewogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuaXNnZXQgPSBmYWxzZTsKICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkZXZpY2UuZHJpdmVyTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5Ub0JlQ29ubmVjdERldmljZSkgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZGV2aWNldHlwZSkgewogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuaXNnZXQgPSBmYWxzZTsKICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkZXZpY2UuZHJpdmVyTmFtZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZGVsZXRlRGV2aWNlVHlwZUFsbG9jYXRpb25MaXN0JywgZGV2aWNldHlwZSk7CiAgICAgIGlmIChkZXZpY2V0eXBlID09ICJNYWluQ2FtZXJhIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYUNvbm5lY3RlZCcsIDApOwogICAgICB9IGVsc2UgaWYgKGRldmljZXR5cGUgPT0gIk1vdW50IikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTW91bnRDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJDRlciKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDRldDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJHdWlkZXIiKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJDb25uZWN0ZWQnLCAwKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRTZWxlY3RlZERyaXZlckxpc3QoZGV2aWNlT2JqZWN0KSB7CiAgICAgIGNvbnNvbGUubG9nKCdsb2FkU2VsZWN0ZWREcml2ZXJMaXN0OicsIGRldmljZU9iamVjdCk7CiAgICAgIGRldmljZU9iamVjdC5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgLy8g5YGH6K6+5L2g5oOz6KaB5omT5Y2w5q+P5Liq6K6+5aSH5a+56LGh55qE6ZSu5YC85a+5CiAgICAgICAgZm9yIChjb25zdCBbZHJpdmVyVHlwZSwgZHJpdmVyTmFtZV0gb2YgT2JqZWN0LmVudHJpZXMoZGV2aWNlKSkgewogICAgICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBkcml2ZXJUeXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCA9PSBmYWxzZSkgewogICAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkcml2ZXJOYW1lOwogICAgICAgICAgICAgIGRldmljZS5kcml2ZXJOYW1lID0gZHJpdmVyTmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBsb2FkQmluZERldmljZUxpc3QoZGV2aWNlT2JqZWN0KSB7CiAgICAgIGNvbnNvbGUubG9nKCdsb2FkQmluZERldmljZUxpc3Q6JywgZGV2aWNlT2JqZWN0KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdsb2FkQmluZERldmljZUxpc3QnLCBkZXZpY2VPYmplY3QpOwoKICAgIH0sCiAgICBsb2FkQmluZERldmljZVR5cGVMaXN0KGRldmljZVR5cGVPYmplY3QpIHsKICAgICAgY29uc29sZS5sb2coJ2xvYWRCaW5kRGV2aWNlVHlwZUxpc3Q6JywgZGV2aWNlVHlwZU9iamVjdCk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnbG9hZEJpbmREZXZpY2VUeXBlTGlzdCcsIGRldmljZVR5cGVPYmplY3QpOwogICAgICBkZXZpY2VUeXBlT2JqZWN0LmZvckVhY2goZGV2aWNlVHlwZSA9PiB7CiAgICAgICAgY29uc3QgeyBUeXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc2JpbmQgfSA9IGRldmljZVR5cGU7CiAgICAgICAgdGhpcy51cGRhdGVEZXZpY2VzQ29ubmVjdChUeXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc2JpbmQpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTZWxlY3RlZERyaXZlcihkcml2ZXJUeXBlKSB7CgogICAgICB0aGlzLnNlbGVjdGVkRHJpdmVyID0gbnVsbDsKICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09IGRyaXZlclR5cGUpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWREcml2ZXIgPSBkZXZpY2UuZHJpdmVyTmFtZQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IGRyaXZlcnM6JywgdGhpcy5zZWxlY3RlZERyaXZlcik7CiAgICB9LAogICAgc3RhcnRMb2FkaW5nKCkgewogICAgICB0aGlzLmxvYWRpbmdEZXZpY2VTZWxlY3Rpb24gPSB0cnVlOwogICAgfSwKICAgIHN0b3BMb2FkaW5nKCkgewogICAgICB0aGlzLmxvYWRpbmdEZXZpY2VTZWxlY3Rpb24gPSBmYWxzZTsKICAgIH0sCiAgICBkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdChkZXZpY2VOYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKCdkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdDonLCBkZXZpY2VOYW1lKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdCcsIGRldmljZU5hbWUpOwogICAgfSwKICAgIFVuQmluZGluZ0RldmljZSh0eXBlLCBuYW1lLCBkcml2ZXJOYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKCdVbkJpbmRpbmdEZXZpY2U6JywgdHlwZSwgbmFtZSwgZHJpdmVyTmFtZSk7CiAgICAgIHRoaXMudXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgbmFtZSwgZHJpdmVyTmFtZSwgZmFsc2UpOwogICAgfSwKCiAgICBkaXNwbGF5RXJyb3JJbWFnZSgpIHsKICAgICAgY29uc29sZS5lcnJvcigiaW1hZ2UgaXMgZXJyb3IsIGxvYWQgZXJyb3JJbWFnZS5zdmciKTsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5DYW1lcmEtY2FudmFzJyk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpOwoKICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4gewogICAgICAgIC8vIOiOt+WPluiuvuWkh+WDj+e0oOavlAogICAgICAgIGNvbnN0IGRldmljZVBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwoKICAgICAgICAvLyDosIPmlbTnlLvluIPlsLrlr7jku6XpgILlupTpq5jmuIXmmL7npLoKICAgICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aCAqIGRldmljZVBpeGVsUmF0aW87CiAgICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodCAqIGRldmljZVBpeGVsUmF0aW87CiAgICAgICAgY3R4LnNjYWxlKGRldmljZVBpeGVsUmF0aW8sIGRldmljZVBpeGVsUmF0aW8pOyAvLyDnvKnmlL5jdHjku6XpgILlupTpq5jmuIXnlLvluIMKCiAgICAgICAgLy8g57uY5Yi25Zu+5YOPCiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIH07CgogICAgICBpbWFnZS5vbmVycm9yID0gKCkgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIGltYWdlIGZyb20gIiArIGltYWdlLnNyYyk7CiAgICAgICAgLy8g5Y+v5Lul5Zyo6L+Z6YeM5re75Yqg5aSH55So5Zu+5YOP5oiW5YW25LuW6ZSZ6K+v5aSE55CG6YC76L6RCiAgICAgIH07CgogICAgICAvLyDnoa7kv51FcnJvckltYWdl5piv5pyJ5pWI55qEVVJMCiAgICAgIGltYWdlLnNyYyA9IEVycm9ySW1hZ2U7IC8vIOivt+abv+aNouS4uuWunumZheeahOWbvuWDj+i3r+W+hAogICAgfSwKICAgIGhhbmRsZUVycm9yKG1lc3NhZ2UsIGxvY2F0aW9uLCBlcnJvciA9IG51bGwpIHsKICAgICAgY29uc3QgZXJyb3JNc2cgPSBlcnJvciA/IGAke21lc3NhZ2V9IGF0ICR7bG9jYXRpb259OiAke2Vycm9yfWAgOiBgJHttZXNzYWdlfSBhdCAke2xvY2F0aW9ufWA7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNc2cpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKGVycm9yTXNnLCAnZXJyb3InKTsKICAgICAgdGhpcy5kaXNwbGF5RXJyb3JJbWFnZSgpOyAvLyDmmL7npLrplJnor6/lm77lg48KICAgIH0sCiAgICBzaG93U2VsZWN0ZGlzY29ubmVjdERyaXZlcihkcml2ZXJuYW1lKSB7CiAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3REaWFsb2cgPSB0cnVlOwogICAgICB0aGlzLmN1cnJlbnREaXNjb25uZWN0RHJpdmVyTmFtZSA9IGRyaXZlcm5hbWU7CiAgICB9LAogICAgY29uZmlybURpc2Nvbm5lY3QoKSB7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RTZWxlY3REcml2ZXI6JyArIHRoaXMuY3VycmVudERpc2Nvbm5lY3REcml2ZXJOYW1lKTsKICAgICAgdGhpcy5zaG93RGlzY29ubmVjdERpYWxvZyA9IGZhbHNlOwogICAgfSwKCiAgICAvLyDkuLvnlLvluIPngrnlh7vkuovku7YKICAgIGhhbmRsZU1haW5DYW52YXNDbGljayhldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HpvKDmoIfngrnlh7vkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKCF0aGlzLmVuYWJsZU1haW5DYW52YXNDbGljayB8fCB0aGlzLmlzRHJhZ2dpbmcgfHwgdGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47IC8vIOWmguaenOeUu+W4g+S4jeWPr+eCueWHu++8jOWImeS4jeWkhOeQhueCueWHu+S6i+S7tgogICAgICAvLyBjb25zb2xlLmxvZygn6Kem5Y+R6byg5qCH54K55Ye75LqL5Lu2OicsIGV2ZW50KTsKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5tYWluQ2FudmFzOwogICAgICBpZiAoIWNhbnZhcykgcmV0dXJuOyAvLyDnoa7kv50gY2FudmFzIOWFg+e0oOWtmOWcqAogICAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOy8vIOiOt+WPliBjYW52YXMg5YWD57Sg55qE6L6555WM55+p5b2iCiAgICAgIGNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OwogICAgICBjb25zdCB5ID0gZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wOwogICAgICBjb25zb2xlLmxvZygnTW91c2UgY2xpY2tlZCBhdDonLCB4LCB5KTsKICAgICAgaWYgKCF0aGlzLmlzRm9jdXNMb29wU2hvb3RpbmcpIHsKICAgICAgICAvLyDmnJ/mnJvkuK3lv4PvvIjnlLvluIPlnZDmoIcg4oaSIOS8oOaEn+WZqOWDj+e0oOWdkOagh++8iQogICAgICAgIGNvbnN0IGRlc2lyZWRDZW50ZXJYID0gKHggLyB3aW5kb3cuaW5uZXJXaWR0aCAqIHRoaXMudmlzaWJsZVdpZHRoKSArIHRoaXMudmlzaWJsZVggLSB0aGlzLnZpc2libGVXaWR0aCAvIDI7CiAgICAgICAgY29uc3QgZGVzaXJlZENlbnRlclkgPSAoeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodCkgKyB0aGlzLnZpc2libGVZIC0gdGhpcy52aXNpYmxlSGVpZ2h0IC8gMjsKCiAgICAgICAgLy8gUk9JIOi+uemVv++8iOWDj+e0oO+8jOWBtuaVsOWMlu+8ie+8jOadpea6kOS6juWbuuWumiBSZWRCb3hTaWRlTGVuZ3RoCiAgICAgICAgbGV0IHNpZGUgPSB0aGlzLlJlZEJveFNpZGVMZW5ndGggLyB0aGlzLmNhbWVyYUJpbjsKICAgICAgICBzaWRlID0gTWF0aC5tYXgoMiwgTWF0aC5mbG9vcihzaWRlKSk7CiAgICAgICAgaWYgKHNpZGUgJSAyICE9PSAwKSBzaWRlICs9IDE7IC8vIOW8uuWItuWBtuaVsAoKICAgICAgICAvLyDlsIYgUk9JIOW3puS4iuinkuaMieS4reW/g+WPjeaOqO+8jOW5tue6puadn+WcqOWbvuWDj+iMg+WbtOWGhQogICAgICAgIGNvbnN0IGhhbGYgPSBzaWRlIC8gMjsKICAgICAgICBjb25zdCBpbWdXID0gdGhpcy5tYWluQ2FtZXJhU2l6ZVg7CiAgICAgICAgY29uc3QgaW1nSCA9IHRoaXMubWFpbkNhbWVyYVNpemVZOwoKICAgICAgICBsZXQgcm9pWCA9IGRlc2lyZWRDZW50ZXJYIC0gaGFsZjsKICAgICAgICBsZXQgcm9pWSA9IGRlc2lyZWRDZW50ZXJZIC0gaGFsZjsKCiAgICAgICAgLy8g6L6555WM57qm5p2fCiAgICAgICAgY29uc3QgbWF4WCA9IE1hdGgubWF4KDAsIGltZ1cgLSBzaWRlKTsKICAgICAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoMCwgaW1nSCAtIHNpZGUpOwogICAgICAgIHJvaVggPSBNYXRoLm1pbihNYXRoLm1heCgwLCByb2lYKSwgbWF4WCk7CiAgICAgICAgcm9pWSA9IE1hdGgubWluKE1hdGgubWF4KDAsIHJvaVkpLCBtYXhZKTsKCiAgICAgICAgLy8g5YG25pWw5a+56b2Q5L2N572uCiAgICAgICAgcm9pWCA9IE1hdGguZmxvb3Iocm9pWCk7CiAgICAgICAgcm9pWSA9IE1hdGguZmxvb3Iocm9pWSk7CiAgICAgICAgaWYgKHJvaVggJSAyICE9PSAwKSByb2lYICs9IDE7CiAgICAgICAgaWYgKHJvaVkgJSAyICE9PSAwKSByb2lZICs9IDE7CgogICAgICAgIHRoaXMuUk9JX3ggPSByb2lYOwogICAgICAgIHRoaXMuUk9JX3kgPSByb2lZOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2VuZFJlZEJveFN0YXRlOicgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKyAnOicgKyB0aGlzLlJPSV94ICsgJzonICsgdGhpcy5ST0lfeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWxlY3RTdGFyWCA9ICgoeCAvIHdpbmRvdy5pbm5lcldpZHRoICogdGhpcy52aXNpYmxlV2lkdGgpICsgdGhpcy52aXNpYmxlWCAtIHRoaXMudmlzaWJsZVdpZHRoIC8gMiAtIHRoaXMuUk9JX3gpICogdGhpcy5jYW1lcmFCaW47IC8vIOiuoeeul+mAieaLqeS9jee9rueahHjlnZDmoIcKICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID0gKCh5IC8gd2luZG93LmlubmVySGVpZ2h0ICogdGhpcy52aXNpYmxlSGVpZ2h0KSArIHRoaXMudmlzaWJsZVkgLSB0aGlzLnZpc2libGVIZWlnaHQgLyAyIC0gdGhpcy5ST0lfeSkgKiB0aGlzLmNhbWVyYUJpbjsgLy8g6K6h566X6YCJ5oup5L2N572u55qEeeWdkOaghwoKICAgICAgICBpZiAodGhpcy5zZWxlY3RTdGFyWCA+PSAwICYmIHRoaXMuc2VsZWN0U3RhclggPCB0aGlzLlJlZEJveFNpZGVMZW5ndGggJiYKICAgICAgICAgIHRoaXMuc2VsZWN0U3RhclkgPj0gMCAmJiB0aGlzLnNlbGVjdFN0YXJZIDwgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTZWxlY3QgU3RhciBpcyBpbiBST0knLCAnaW5mbycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTZWxlY3QgU3RhciBpcyBub3QgaW4gUk9JJywgJ2Vycm9yJyk7CiAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJYID0gLTE7CiAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID0gLTE7CiAgICAgICAgfQogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2VuZFNlbGVjdFN0YXJzOicgKyB0aGlzLnNlbGVjdFN0YXJYICsgJzonICsgdGhpcy5zZWxlY3RTdGFyWSk7CiAgICAgIH0KICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICB9LAoKICAgIC8vIOS4u+eUu+W4g+aLluWKqAogICAgaGFuZGxlTW91c2VEb3duKGV2ZW50KSB7CiAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkem8oOagh+aMieS4i+S6i+S7tjonLCAnaW5mbycpOwogICAgICBpZiAodGhpcy5pc0RyYWdnaW5nIHx8IHRoaXMuZHJhd0ltZ0RhdGEgPT0gbnVsbCkgcmV0dXJuOwogICAgICB0aGlzLmlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICB0aGlzLnN0YXJ0WCA9IGV2ZW50LmNsaWVudFg7CiAgICAgIHRoaXMuc3RhcnRZID0gZXZlbnQuY2xpZW50WTsKICAgICAgdGhpcy5jdXJyZW50WCA9IGV2ZW50LmNsaWVudFg7CiAgICAgIHRoaXMuY3VycmVudFkgPSBldmVudC5jbGllbnRZOwoKICAgICAgLy8g6K6+572u5LiA5Liq5a6a5pe25Zmo77yM5q+PMTAwbXPmiafooYzkuIDmrKHpvKDmoIfnp7vliqjnmoTpgLvovpEKICAgICAgdGhpcy5tb3ZlSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICBpZiAoIXRoaXMuaXNEcmFnZ2luZykgcmV0dXJuOwoKICAgICAgICBjb25zdCBkeCA9IHRoaXMuc3RhcnRYIC0gdGhpcy5jdXJyZW50WDsKICAgICAgICBjb25zdCBkeSA9IHRoaXMuc3RhcnRZIC0gdGhpcy5jdXJyZW50WTsKICAgICAgICBpZiAoaXNOYU4oZHgpIHx8IGlzTmFOKGR5KSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgbmV3VmlzaWJsZVggPSB0aGlzLnZpc2libGVYICsgZHggLyB3aW5kb3cuaW5uZXJXaWR0aCAqIHRoaXMudmlzaWJsZVdpZHRoOwogICAgICAgIGxldCBuZXdWaXNpYmxlWSA9IHRoaXMudmlzaWJsZVkgKyBkeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodDsKICAgICAgICBpZiAobmV3VmlzaWJsZVggPCAwKSB7CiAgICAgICAgICBuZXdWaXNpYmxlWCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChuZXdWaXNpYmxlWSA8IDApIHsKICAgICAgICAgIG5ld1Zpc2libGVZID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKG5ld1Zpc2libGVYID4gdGhpcy5tYWluQ2FtZXJhU2l6ZVgpIHsKICAgICAgICAgIG5ld1Zpc2libGVYID0gdGhpcy5tYWluQ2FtZXJhU2l6ZVg7CiAgICAgICAgfQogICAgICAgIGlmIChuZXdWaXNpYmxlWSA+IHRoaXMubWFpbkNhbWVyYVNpemVZKSB7CiAgICAgICAgICBuZXdWaXNpYmxlWSA9IHRoaXMubWFpbkNhbWVyYVNpemVZOwogICAgICAgIH0KCiAgICAgICAgdGhpcy52aXNpYmxlWCA9IG5ld1Zpc2libGVYOwogICAgICAgIHRoaXMudmlzaWJsZVkgPSBuZXdWaXNpYmxlWTsKCiAgICAgICAgdGhpcy5zdGFydFggPSB0aGlzLmN1cnJlbnRYOwogICAgICAgIHRoaXMuc3RhcnRZID0gdGhpcy5jdXJyZW50WTsKICAgICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfmi5bliqjkuovku7Ys5ouW5Yqo6Led56a7OicgKyBkeCArICcsJyArIGR5LCAnaW5mbycpOwogICAgICB9LCAxMDApOwogICAgfSwKICAgIGhhbmRsZU1vdXNlTW92ZShldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HpvKDmoIfnp7vliqjkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcpIHJldHVybjsKICAgICAgdGhpcy5jdXJyZW50WCA9IGV2ZW50LmNsaWVudFg7CiAgICAgIHRoaXMuY3VycmVudFkgPSBldmVudC5jbGllbnRZOwogICAgfSwKICAgIGhhbmRsZU1vdXNlVXAoZXZlbnQpIHsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R6byg5qCH5oqs6LW35LqL5Lu2OicsICdpbmZvJyk7CiAgICAgIHRoaXMuaXNEcmFnZ2luZyA9IGZhbHNlOwoKICAgICAgLy8g5riF6Zmk5a6a5pe25ZmoCiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb3ZlSW50ZXJ2YWxJZCk7CiAgICAgIHRoaXMubW92ZUludGVydmFsSWQgPSBudWxsOwogICAgfSwKICAgIGhhbmRsZVdoZWVsKGV2ZW50KSB7CiAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkem8oOagh+a7mui9ruS6i+S7tjonLCAnaW5mbycpOwogICAgICBpZiAodGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47CiAgICAgIGNvbnN0IHNjYWxlQ2hhbmdlID0gZXZlbnQuZGVsdGFZID4gMCA/IDAuMSA6IC0wLjE7IC8vIOagueaNrua7mui9rueahOa7muWKqOaWueWQke+8jOiuoeeul+e8qeaUvuavlOS+i+eahOWPmOWMlumHjwogICAgICBsZXQgbmV3U2NhbGUgPSB0aGlzLnNjYWxlICsgc2NhbGVDaGFuZ2U7IC8vIOabtOaWsOe8qeaUvuavlOS+iwogICAgICBpZiAobmV3U2NhbGUgPCAwLjEpIHsKICAgICAgICBuZXdTY2FsZSA9IDAuMTsKICAgICAgfQogICAgICBpZiAobmV3U2NhbGUgPiAxKSB7CiAgICAgICAgbmV3U2NhbGUgPSAxOwogICAgICB9CgogICAgICAvLyDlpoLmnpzlt7Lnu4/mnInkuIDkuKrlvoXmiafooYznmoTnvKnmlL7mk43kvZzvvIzliJnnm7TmjqXov5Tlm54KICAgICAgaWYgKHRoaXMucGVuZGluZ1NjYWxlQ2hhbmdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyDmoIforrDmnInkuIDkuKrlvoXmiafooYznmoTnvKnmlL7mk43kvZwKICAgICAgdGhpcy5wZW5kaW5nU2NhbGVDaGFuZ2UgPSB0cnVlOwoKICAgICAgLy8g5L2/55SoIHJlcXVlc3RBbmltYXRpb25GcmFtZSDmnaXmjqfliLbnvKnmlL7mk43kvZznmoTmiafooYzpopHnjocKICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsKICAgICAgICBpZiAobmV3U2NhbGUgIT0gdGhpcy5zY2FsZSkgewogICAgICAgICAgdGhpcy5zY2FsZSA9IG5ld1NjYWxlOyAvLyDmm7TmlrDnvKnmlL7mr5TkvosKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0U2NhbGUnLCB0aGlzLnNjYWxlKTsKICAgICAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn57yp5pS+5q+U5L6L5Y+Y5YyWLOe8qeaUvuavlOS+izonICsgbmV3U2NhbGUsICdpbmZvJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+e8qeaUvuavlOS+i+ayoeacieWPmOWMliznvKnmlL7mr5Tkvos6JyArIHRoaXMuc2NhbGUsICdpbmZvJyk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGVuZGluZ1NjYWxlQ2hhbmdlID0gZmFsc2U7IC8vIOa4hemZpOW+heaJp+ihjOeahOe8qeaUvuaTjeS9nOagh+iusAogICAgICB9KTsKICAgIH0sCgogICAgaGFuZGxlTWFpbkNhbnZhc1RvdWNoKGV2ZW50KSB7CiAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeinpuaRuOS6i+S7tjonLCAnaW5mbycpOwogICAgICBpZiAoIXRoaXMuZW5hYmxlTWFpbkNhbnZhc0NsaWNrIHx8IHRoaXMuaXNEcmFnZ2luZyB8fCB0aGlzLmRyYXdJbWdEYXRhID09IG51bGwpIHJldHVybjsgLy8g5aaC5p6c55S75biD5LiN5Y+v54K55Ye777yM5YiZ5LiN5aSE55CG54K55Ye75LqL5Lu2CiAgICAgIC8vIGNvbnNvbGUubG9nKCfop6blj5Hop6bmkbjkuovku7Y6JywgZXZlbnQpOwogICAgICBpZiAoIXRoaXMuZW5hYmxlTWFpbkNhbnZhc0NsaWNrIHx8ICFldmVudC50b3VjaGVzIHx8IGV2ZW50LnRvdWNoZXMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuJHJlZnMubWFpbkNhbnZhczsKICAgICAgaWYgKCFjYW52YXMpIHJldHVybjsgLy8g56Gu5L+dIGNhbnZhcyDlhYPntKDlrZjlnKgKICAgICAgY29uc3QgdG91Y2ggPSBldmVudC50b3VjaGVzWzBdOwogICAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOy8vIOiOt+WPliBjYW52YXMg5YWD57Sg55qE6L6555WM55+p5b2iCiAgICAgIGNvbnN0IHggPSB0b3VjaC5jbGllbnRYIC0gcmVjdC5sZWZ0OwogICAgICBjb25zdCB5ID0gdG91Y2guY2xpZW50WSAtIHJlY3QudG9wOwogICAgICBjb25zb2xlLmxvZygnVG91Y2ggYXQ6JywgeCwgeSk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7Ly8g6Zi75q2i6buY6K6k5LqL5Lu277yM5aaC6aG16Z2i5rua5YqoCiAgICAgIGlmICghdGhpcy5pc0ZvY3VzTG9vcFNob290aW5nKSB7CiAgICAgICAgLy8g5pyf5pyb5Lit5b+D77yI55S75biD5Z2Q5qCHIOKGkiDkvKDmhJ/lmajlg4/ntKDlnZDmoIfvvIkKICAgICAgICBjb25zdCBkZXNpcmVkQ2VudGVyWCA9ICh4IC8gd2luZG93LmlubmVyV2lkdGggKiB0aGlzLnZpc2libGVXaWR0aCkgKyB0aGlzLnZpc2libGVYIC0gdGhpcy52aXNpYmxlV2lkdGggLyAyOwogICAgICAgIGNvbnN0IGRlc2lyZWRDZW50ZXJZID0gKHkgLyB3aW5kb3cuaW5uZXJIZWlnaHQgKiB0aGlzLnZpc2libGVIZWlnaHQpICsgdGhpcy52aXNpYmxlWSAtIHRoaXMudmlzaWJsZUhlaWdodCAvIDI7CgogICAgICAgIC8vIFJPSSDovrnplb/vvIjlg4/ntKDvvIzlgbbmlbDljJbvvInvvIzmnaXmupDkuo7lm7rlrpogUmVkQm94U2lkZUxlbmd0aAogICAgICAgIGxldCBzaWRlID0gdGhpcy5SZWRCb3hTaWRlTGVuZ3RoIC8gdGhpcy5jYW1lcmFCaW47CiAgICAgICAgc2lkZSA9IE1hdGgubWF4KDIsIE1hdGguZmxvb3Ioc2lkZSkpOwogICAgICAgIGlmIChzaWRlICUgMiAhPT0gMCkgc2lkZSArPSAxOyAvLyDlvLrliLblgbbmlbAKCiAgICAgICAgLy8g5bCGIFJPSSDlt6bkuIrop5LmjInkuK3lv4Plj43mjqjvvIzlubbnuqbmnZ/lnKjlm77lg4/ojIPlm7TlhoUKICAgICAgICBjb25zdCBoYWxmID0gc2lkZSAvIDI7CiAgICAgICAgY29uc3QgaW1nVyA9IHRoaXMubWFpbkNhbWVyYVNpemVYOwogICAgICAgIGNvbnN0IGltZ0ggPSB0aGlzLm1haW5DYW1lcmFTaXplWTsKCiAgICAgICAgbGV0IHJvaVggPSBkZXNpcmVkQ2VudGVyWCAtIGhhbGY7CiAgICAgICAgbGV0IHJvaVkgPSBkZXNpcmVkQ2VudGVyWSAtIGhhbGY7CgogICAgICAgIC8vIOi+ueeVjOe6puadnwogICAgICAgIGNvbnN0IG1heFggPSBNYXRoLm1heCgwLCBpbWdXIC0gc2lkZSk7CiAgICAgICAgY29uc3QgbWF4WSA9IE1hdGgubWF4KDAsIGltZ0ggLSBzaWRlKTsKICAgICAgICByb2lYID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcm9pWCksIG1heFgpOwogICAgICAgIHJvaVkgPSBNYXRoLm1pbihNYXRoLm1heCgwLCByb2lZKSwgbWF4WSk7CgogICAgICAgIC8vIOWBtuaVsOWvuem9kOS9jee9rgogICAgICAgIHJvaVggPSBNYXRoLmZsb29yKHJvaVgpOwogICAgICAgIHJvaVkgPSBNYXRoLmZsb29yKHJvaVkpOwogICAgICAgIGlmIChyb2lYICUgMiAhPT0gMCkgcm9pWCArPSAxOwogICAgICAgIGlmIChyb2lZICUgMiAhPT0gMCkgcm9pWSArPSAxOwoKICAgICAgICB0aGlzLlJPSV94ID0gcm9pWDsKICAgICAgICB0aGlzLlJPSV95ID0gcm9pWTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NlbmRSZWRCb3hTdGF0ZTonICsgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICsgJzonICsgdGhpcy5ST0lfeCArICc6JyArIHRoaXMuUk9JX3kpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VsZWN0U3RhclggPSAoKHggLyB3aW5kb3cuaW5uZXJXaWR0aCAqIHRoaXMudmlzaWJsZVdpZHRoKSArIHRoaXMudmlzaWJsZVggLSB0aGlzLnZpc2libGVXaWR0aCAvIDIgLSB0aGlzLlJPSV94KSAqIHRoaXMuY2FtZXJhQmluOyAvLyDorqHnrpfpgInmi6nkvY3nva7nmoR45Z2Q5qCHCiAgICAgICAgdGhpcy5zZWxlY3RTdGFyWSA9ICgoeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodCkgKyB0aGlzLnZpc2libGVZIC0gdGhpcy52aXNpYmxlSGVpZ2h0IC8gMiAtIHRoaXMuUk9JX3kpICogdGhpcy5jYW1lcmFCaW47IC8vIOiuoeeul+mAieaLqeS9jee9rueahHnlnZDmoIcKCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0U3RhclggPj0gMCAmJiB0aGlzLnNlbGVjdFN0YXJYIDwgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICYmCiAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID49IDAgJiYgdGhpcy5zZWxlY3RTdGFyWSA8IHRoaXMuUmVkQm94U2lkZUxlbmd0aCkgewogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU2VsZWN0IFN0YXIgaXMgaW4gUk9JJywgJ2luZm8nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU2VsZWN0IFN0YXIgaXMgbm90IGluIFJPSScsICdlcnJvcicpOwogICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWCA9IC0xOwogICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWSA9IC0xOwogICAgICAgIH0KICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NlbmRTZWxlY3RTdGFyczonICsgdGhpcy5zZWxlY3RTdGFyWCArICc6JyArIHRoaXMuc2VsZWN0U3RhclkpOwogICAgICB9CiAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgfSwKICAgIGhhbmRsZVRvdWNoU3RhcnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuZHJhd0ltZ0RhdGEgPT0gbnVsbCkgcmV0dXJuOwogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5Hop6bmkbjlvIDlp4vkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKGV2ZW50LnRvdWNoZXMubGVuZ3RoID09PSAxKSB7IC8vIOWNleaMh+inpuaRuO+8jOW8gOWni+aLluWKqAogICAgICAgIHRoaXMuaXNPbmVUb3VjaCA9IHRydWU7CiAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R5Y2V5oyH6Kem5pG45LqL5Lu2JywgJ2luZm8nKTsKICAgICAgICB0aGlzLmlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMuc3RhcnRUb3VjaFhbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7CiAgICAgICAgdGhpcy5zdGFydFRvdWNoWVswXSA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WTsKICAgICAgICB0aGlzLmN1cnJlbnRUb3VjaFhbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7CiAgICAgICAgdGhpcy5jdXJyZW50VG91Y2hZWzBdID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRZOwogICAgICAgIC8vIOa4hemZpOWPr+iDveWtmOWcqOeahOWPjOaMh+inpuaRuOeahOWumuaXtuWZqAogICAgICAgIGlmICh0aGlzLnpvb21JbnRlcnZhbElkKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuem9vbUludGVydmFsSWQpOwogICAgICAgICAgdGhpcy56b29tSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgfQoKCiAgICAgICAgdGhpcy5oYW5kbGVNYWluQ2FudmFzVG91Y2goZXZlbnQpOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LnRvdWNoZXMubGVuZ3RoID49IDIpIHsgLy8g5Y+M5oyH6Kem5pG477yM5byA5aeL57yp5pS+CiAgICAgICAgdGhpcy5pc09uZVRvdWNoID0gZmFsc2U7CiAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R5Y+M5oyH6Kem5pG45LqL5Lu2JywgJ2luZm8nKTsKICAgICAgICB0aGlzLmlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgIC8vIOiuoeeul+S4pOS4quinpuaRuOeCueS5i+mXtOeahOi3neemuwogICAgICAgIGNvbnN0IGR4ID0gdGhpcy5jdXJyZW50VG91Y2hYWzBdIC0gdGhpcy5jdXJyZW50VG91Y2hYWzFdOwogICAgICAgIGNvbnN0IGR5ID0gdGhpcy5jdXJyZW50VG91Y2hZWzBdIC0gdGhpcy5jdXJyZW50VG91Y2hZWzFdOwogICAgICAgIHRoaXMuc3RhcnRUb3VjaERpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAvLyDmuIXpmaTlj6/og73lrZjlnKjnmoTljZXmjIfop6bmkbjnmoTlrprml7blmagKICAgICAgICBpZiAodGhpcy5tb3ZlSW50ZXJ2YWxJZCkgewogICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vdmVJbnRlcnZhbElkKTsKICAgICAgICAgIHRoaXMubW92ZUludGVydmFsSWQgPSBudWxsOwogICAgICAgIH0KCgogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeWkmuaMh+inpuaRuOS6i+S7tu+8jOiOt+WPluW9k+WJjeinpuaRuOeCueaVsOmHjzonICsgZXZlbnQudG91Y2hlcy5sZW5ndGgsICdpbmZvJyk7CiAgICAgIH0KCiAgICB9LAoKICAgIGhhbmRsZVRvdWNoTW92ZShldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5Hop6bmkbjnp7vliqjkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcgfHwgdGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47CiAgICAgIGlmIChldmVudC50b3VjaGVzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgdGhpcy5jdXJyZW50VG91Y2hYWzBdID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYOwogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWVswXSA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WTsKICAgICAgICBpZiAodGhpcy56b29tSW50ZXJ2YWxJZCkgewogICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnpvb21JbnRlcnZhbElkKTsKICAgICAgICAgIHRoaXMuem9vbUludGVydmFsSWQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5tb3ZlSW50ZXJ2YWxJZCAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIOiuvue9ruS4gOS4quWumuaXtuWZqO+8jOavjzEwMG1z5omn6KGM5LiA5qyh6Kem5pG456e75Yqo55qE6YC76L6RCiAgICAgICAgdGhpcy5tb3ZlSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmiafooYzop6bmkbjnp7vliqghJyk7CiAgICAgICAgICBpZiAoIXRoaXMuaXNEcmFnZ2luZyB8fCAhdGhpcy5pc09uZVRvdWNoKSByZXR1cm47CgogICAgICAgICAgY29uc3QgZHggPSB0aGlzLnN0YXJ0VG91Y2hYWzBdIC0gdGhpcy5jdXJyZW50VG91Y2hYWzBdOwogICAgICAgICAgY29uc3QgZHkgPSB0aGlzLnN0YXJ0VG91Y2hZWzBdIC0gdGhpcy5jdXJyZW50VG91Y2hZWzBdOwogICAgICAgICAgaWYgKGlzTmFOKGR4KSB8fCBpc05hTihkeSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGR4ID09IDAgJiYgZHkgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IG5ld1Zpc2libGVYID0gdGhpcy52aXNpYmxlWCArIGR4IC8gd2luZG93LmlubmVyV2lkdGggKiB0aGlzLnZpc2libGVXaWR0aDsKICAgICAgICAgIGxldCBuZXdWaXNpYmxlWSA9IHRoaXMudmlzaWJsZVkgKyBkeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodDsKICAgICAgICAgIGlmIChuZXdWaXNpYmxlWCA8IDApIHsKICAgICAgICAgICAgbmV3VmlzaWJsZVggPSAwOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5ld1Zpc2libGVZIDwgMCkgewogICAgICAgICAgICBuZXdWaXNpYmxlWSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmV3VmlzaWJsZVggPiB0aGlzLm1haW5DYW1lcmFTaXplWCkgewogICAgICAgICAgICBuZXdWaXNpYmxlWCA9IHRoaXMubWFpbkNhbWVyYVNpemVYOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5ld1Zpc2libGVZID4gdGhpcy5tYWluQ2FtZXJhU2l6ZVkpIHsKICAgICAgICAgICAgbmV3VmlzaWJsZVkgPSB0aGlzLm1haW5DYW1lcmFTaXplWTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnZpc2libGVYID0gbmV3VmlzaWJsZVg7CiAgICAgICAgICB0aGlzLnZpc2libGVZID0gbmV3VmlzaWJsZVk7CgogICAgICAgICAgdGhpcy5zdGFydFRvdWNoWFswXSA9IHRoaXMuY3VycmVudFRvdWNoWFswXTsKICAgICAgICAgIHRoaXMuc3RhcnRUb3VjaFlbMF0gPSB0aGlzLmN1cnJlbnRUb3VjaFlbMF07CgogICAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgICAgfSwgMTAwKTsKCiAgICAgIH0gZWxzZSBpZiAoZXZlbnQudG91Y2hlcy5sZW5ndGggPj0gMikgewogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWFswXSA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICB0aGlzLmN1cnJlbnRUb3VjaFlbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgdGhpcy5jdXJyZW50VG91Y2hYWzFdID0gZXZlbnQudG91Y2hlc1sxXS5jbGllbnRYOwogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWVsxXSA9IGV2ZW50LnRvdWNoZXNbMV0uY2xpZW50WTsKCiAgICAgICAgLy8g5riF6Zmk5Y+v6IO95a2Y5Zyo55qE5Y2V5oyH6Kem5pG455qE5a6a5pe25ZmoCiAgICAgICAgaWYgKHRoaXMubW92ZUludGVydmFsSWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb3ZlSW50ZXJ2YWxJZCk7CiAgICAgICAgICB0aGlzLm1vdmVJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuem9vbUludGVydmFsSWQgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyDorr7nva7kuIDkuKrlrprml7blmajvvIzmr48xMDBtc+aJp+ihjOS4gOasoee8qeaUvumAu+i+kQogICAgICAgIHRoaXMuem9vbUludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICBpZiAoIXRoaXMuaXNEcmFnZ2luZyB8fCAhdGhpcy5pc09uZVRvdWNoKSByZXR1cm47CiAgICAgICAgICBjb25zdCBkeCA9IHRoaXMuY3VycmVudFRvdWNoWFswXSAtIHRoaXMuY3VycmVudFRvdWNoWFsxXTsKICAgICAgICAgIGNvbnN0IGR5ID0gdGhpcy5jdXJyZW50VG91Y2hZWzBdIC0gdGhpcy5jdXJyZW50VG91Y2hZWzFdOwogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Led56a75Y+Y5YyWIGRpc3RhbmNlOicgKyBkaXN0YW5jZSwgJ2luZm8nKTsKICAgICAgICAgIGlmICh0aGlzLnN0YXJ0VG91Y2hEaXN0YW5jZSA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuc3RhcnRUb3VjaERpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgICAgICB9CiAgICAgICAgICAvLyDorqHnrpfnvKnmlL7mr5TkvovnmoTlj5jljJbph48KICAgICAgICAgIGNvbnN0IHNjYWxlQ2hhbmdlID0gZGlzdGFuY2UgLyB0aGlzLnN0YXJ0VG91Y2hEaXN0YW5jZTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+i3neemu+WPmOWMluavlOS+iyBzY2FsZUNoYW5nZTonICsgc2NhbGVDaGFuZ2UsICdpbmZvJyk7CiAgICAgICAgICBsZXQgbmV3U2NhbGUgPSB0aGlzLnNjYWxlICogc2NhbGVDaGFuZ2U7IC8vIOabtOaWsOe8qeaUvuavlOS+iwogICAgICAgICAgaWYgKG5ld1NjYWxlIDwgMC4xKSB7CiAgICAgICAgICAgIG5ld1NjYWxlID0gMC4xOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5ld1NjYWxlID4gMSkgewogICAgICAgICAgICBuZXdTY2FsZSA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmV3U2NhbGUgIT0gdGhpcy5zY2FsZSkgewogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnvKnmlL7mr5Tkvovlj5jljJYs57yp5pS+5q+U5L6LOicgKyBuZXdTY2FsZSwgJ2luZm8nKTsKICAgICAgICAgICAgdGhpcy5zY2FsZSA9IG5ld1NjYWxlOyAvLyDmm7TmlrDnvKnmlL7mr5TkvosKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRTY2FsZScsIHRoaXMuc2NhbGUpOwogICAgICAgICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+e8qeaUvuavlOS+i+ayoeacieWPmOWMliznvKnmlL7mr5Tkvos6JyArIHRoaXMuc2NhbGUsICdpbmZvJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnN0YXJ0VG91Y2hEaXN0YW5jZSA9IGRpc3RhbmNlOyAvLyDmm7TmlrDkuKTkuKrop6bmkbjngrnkuYvpl7TnmoTot53nprsKICAgICAgICB9LCAxMDApOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeWkmuaMh+inpuaRuOS6i+S7tu+8jOiOt+WPluW9k+WJjeinpuaRuOeCueaVsOmHjzonICsgZXZlbnQudG91Y2hlcy5sZW5ndGgsICdpbmZvJyk7CiAgICAgIH0KICAgIH0sCgogICAgaGFuZGxlVG91Y2hFbmQoZXZlbnQpIHsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R6Kem5pG457uT5p2f5LqL5Lu2OicsICdpbmZvJyk7CiAgICAgIHRoaXMuaXNEcmFnZ2luZyA9IGZhbHNlOyAvLyDlgZzmraLmi5bliqgKICAgICAgLy8g5riF6Zmk5a6a5pe25ZmoCiAgICAgIGlmICh0aGlzLm1vdmVJbnRlcnZhbElkKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vdmVJbnRlcnZhbElkKTsKICAgICAgICB0aGlzLm1vdmVJbnRlcnZhbElkID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodGhpcy56b29tSW50ZXJ2YWxJZCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy56b29tSW50ZXJ2YWxJZCk7CiAgICAgICAgdGhpcy56b29tSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgU2NhbGVDaGFuZ2UodHlwZSkgewogICAgICBpZiAodGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47CiAgICAgIGlmICh0eXBlID09ICcrJykgewogICAgICAgIHRoaXMuc2NhbGUgLT0gMC4xOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJy0nKSB7CiAgICAgICAgdGhpcy5zY2FsZSArPSAwLjE7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc2NhbGUgPCAwLjEpIHsKICAgICAgICB0aGlzLnNjYWxlID0gMC4xOwogICAgICB9CiAgICAgIGlmICh0aGlzLnNjYWxlID4gMSkgewogICAgICAgIHRoaXMuc2NhbGUgPSAxOwogICAgICB9CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0U2NhbGUnLCB0aGlzLnNjYWxlKTsKICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICB9LAoKICAgIC8vIOaYvuekulJPSeWbvuWDjwogICAgc2hvd1JvaUltYWdlKGZpbGVOYW1lLCBkZXN0WCwgZGVzdFkpIHsKICAgICAgaWYgKHRoaXMuUmVkQm94U2lkZUxlbmd0aCA9PSAwIHx8IHRoaXMuUmVkQm94U2lkZUxlbmd0aCA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnUmVkQm94U2lkZUxlbmd0aCBpcyAwIG9yIG51bGwnLCAnZXJyb3InKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuaXNQcm9jZXNzaW5nSW1hZ2UpIHsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZSBpcyBiZWluZyB0cmFuc21pdHRlZCwgY3VycmVudCBwcm9jZXNzaW5nIGlzIHNsb3csIHNraXBwaW5nIG9uZSBmcmFtZS4nLCAnd2FybmluZycpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmlzUHJvY2Vzc2luZ0ltYWdlID0gdHJ1ZTsKICAgICAgY29uc3QgaW1hZ2VQYXRoID0gJ2ltZy8nICsgZmlsZU5hbWU7CiAgICAgIC8vIOWIm+W7uuS4gOS4qkFib3J0Q29udHJvbGxlcuWunuS+i+adpeWPlua2iGZldGNo6K+35rGCCiAgICAgIGNvbnN0IGZldGNoQ29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgY29uc3QgZmV0Y2hTaWduYWwgPSBmZXRjaENvbnRyb2xsZXIuc2lnbmFsOwoKICAgICAgLy8gY29uc3Qgc3RhcnREb3dubG9hZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsKCiAgICAgIC8vIOS9v+eUqCBmZXRjaCBBUEkg6I635Y+W5LqM6L+b5Yi25pWw5o2uCiAgICAgIGZldGNoKGltYWdlUGF0aCwgeyBjYWNoZTogJ25vLXN0b3JlJywgc2lnbmFsOiBmZXRjaFNpZ25hbCB9KQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpCiAgICAgICAgLnRoZW4oYnVmZmVyID0+IHsKICAgICAgICAgIC8vIGNvbnN0IGVuZERvd25sb2FkVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgLy8gY29uc3QgZG93bmxvYWRUaW1lID0gZW5kRG93bmxvYWRUaW1lIC0gc3RhcnREb3dubG9hZFRpbWU7CiAgICAgICAgICBpZiAodGhpcy5pc0ZvY3VzTG9vcFNob290aW5nKSB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3Nob3dSb2lJbWFnZVN1Y2Nlc3M6dHJ1ZScpOwogICAgICAgICAgZWxzZSB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3Nob3dSb2lJbWFnZVN1Y2Nlc3M6ZmFsc2UnKTsKICAgICAgICAgIGxldCB0aW1lMSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgbGV0IHNyYywgaW1nRGF0YSwgdGFyZ2V0SW1nODsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHVpbnQxNkFycmF5ID0gbmV3IFVpbnQxNkFycmF5KGJ1ZmZlcik7CiAgICAgICAgICAgIGxldCBuZXdXaWR0aCA9IHBhcnNlSW50KHRoaXMuUmVkQm94U2lkZUxlbmd0aCAvIHRoaXMuY2FtZXJhQmluKTsKICAgICAgICAgICAgbGV0IG5ld0hlaWdodCA9IHBhcnNlSW50KHRoaXMuUmVkQm94U2lkZUxlbmd0aCAvIHRoaXMuY2FtZXJhQmluKTsKICAgICAgICAgICAgaWYgKG5ld1dpZHRoICUgMiAhPSAwKSB7CiAgICAgICAgICAgICAgbmV3V2lkdGggPSBuZXdXaWR0aCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAlIDIgIT0gMCkgewogICAgICAgICAgICAgIG5ld0hlaWdodCA9IG5ld0hlaWdodCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVpbnQxNkFycmF5Lmxlbmd0aCAhPT0gbmV3V2lkdGggKiBuZXdIZWlnaHQpIHsKICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCd1aW50MTZBcnJheS5sZW5ndGggKCcgKyB1aW50MTZBcnJheS5sZW5ndGggKyAnKSAhPT0gbmV3V2lkdGggKiBuZXdIZWlnaHQgKCcgKyBuZXdXaWR0aCAqIG5ld0hlaWdodCArICcpJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOWIm+W7uuS4gOS4quepuueahCBNYXQg5a+56LGhCiAgICAgICAgICAgIHNyYyA9IG5ldyBjdi5NYXQobmV3SGVpZ2h0LCBuZXdXaWR0aCwgY3YuQ1ZfMTZVQzEpOwogICAgICAgICAgICBzcmMuZGF0YTE2VS5zZXQodWludDE2QXJyYXkpOwogICAgICAgICAgICBsZXQgdGltZTIgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn5Yib5bu6bWF05a+56LGh5pe26Ze0OiAnICsgKHRpbWUyIC0gdGltZTEpLnRvRml4ZWQoMCkgKyAnbXMnLCAnaW5mbycpOwogICAgICAgICAgICBpZiAodGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zLmlzQ29sb3JDYW1lcmEgPT0gJ3RydWUnIHx8IHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy5pc0NvbG9yQ2FtZXJhID09ICdUcnVlJyB8fCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMuaXNDb2xvckNhbWVyYSkgewogICAgICAgICAgICAgIHRhcmdldEltZzggPSB0aGlzLmFwcGx5U3RyZXRjaEFuZEdhaW4oc3JjLCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMuYW5hbHlzaXMsICdiYXllcicsIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy5DRkEsIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy5ibGFja0xldmVsLCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMud2hpdGVMZXZlbCk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRhcmdldEltZzggPSB0aGlzLmFwcGx5U3RyZXRjaEFuZEdhaW4oc3JjLCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMuYW5hbHlzaXMsICdncmF5JywgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zLkNGQSwgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zLmJsYWNrTGV2ZWwsIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy53aGl0ZUxldmVsKTsKICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICB0aW1lMSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdhcHBseVN0cmV0Y2hBbmRHYWlu5pe26Ze0OiAnICsgKHRpbWUxIC0gdGltZTIpLnRvRml4ZWQoMCkgKyAnbXMnLCAnaW5mbycpOwogICAgICAgICAgICBzcmMuZGVsZXRlKCk7CiAgICAgICAgICAgIHNyYyA9IG51bGw7CgogICAgICAgICAgICAvLyDlsIYgTWF0IOWvueixoei9rOaNouWbniBJbWFnZURhdGEg5a+56LGhCiAgICAgICAgICAgIGltZ0RhdGEgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheSh0YXJnZXRJbWc4LmRhdGEpLCB0YXJnZXRJbWc4LmNvbHMsIHRhcmdldEltZzgucm93cyk7CiAgICAgICAgICAgIHRhcmdldEltZzguZGVsZXRlKCk7CiAgICAgICAgICAgIHRhcmdldEltZzggPSBudWxsOwogICAgICAgICAgICAvLyDlnKjmjIflrprkvY3nva7lvIDlp4vnu5jliLblm77lg48KICAgICAgICAgICAgLy8gdGhpcy5idWZmZXJDdHguY2xlYXJSZWN0KHRoaXMuUk9JX3gsIHRoaXMuUk9JX3ksIHRhcmdldEltZzguY29scywgdGFyZ2V0SW1nOC5yb3dzKTsKICAgICAgICAgICAgdGhpcy5idWZmZXJDdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIHRoaXMuUk9JX3gsIHRoaXMuUk9JX3kpOwogICAgICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnu5jliLbkuIDmrKFST0nmlbDmja46JyArIGZpbGVOYW1lICsgJzonICsgdGhpcy5ST0lfeCArICc6JyArIHRoaXMuUk9JX3ksICdpbmZvJyk7CiAgICAgICAgICAgIC8vIOagh+azqOivhuWIq+WIsOeahOaYn+eCueS9jee9rgogICAgICAgICAgICAvLyB0aW1lMiA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnu5jliLblnKjnvJPlrZjnlLvluIPogJfml7Y6ICcgKyAodGltZTIgLSB0aW1lMSkudG9GaXhlZCgwKSArICdtcycsICdpbmZvJyk7CiAgICAgICAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgICAgICAgICAvLyB0aW1lMSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdkcmF3SW1hZ2VEYXRh5pe26Ze0OiAnICsgKHRpbWUxIC0gdGltZTIpLnRvRml4ZWQoMCkgKyAnbXMnLCAnaW5mbycpOwogICAgICAgICAgICB0aGlzLmZvY3VzZXJQaWN0dXJlRmlsZU5hbWUgPSBmaWxlTmFtZTsKICAgICAgICAgICAgLy8gY29uc3QgcHJvY2Vzc1RpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGRvd25sb2FkVGltZTsKICAgICAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhgUk9J55qE5omn6KGM5pe26Ze0IOS4i+i9vTogJHtkb3dubG9hZFRpbWUudG9GaXhlZCgwKX1tcywg5aSE55CGOiAke3Byb2Nlc3NUaW1lLnRvRml4ZWQoMCl9bXNgLCAnaW5mbycpOwoKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOWkhOeQhuWbvuWDj+Wksei0pTogJHtpbWFnZVBhdGh9YCwgZXJyb3IpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8g56Gu5L+dIE1hdCDlr7nosaHlkowgSW1hZ2VEYXRhIOWvueixoeiiq+WIoOmZpAogICAgICAgICAgICBpZiAoc3JjICYmICFzcmMuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICBzcmMuZGVsZXRlKCk7CiAgICAgICAgICAgICAgc3JjID0gbnVsbDsgLy8g5re75Yqg6L+Z6KGM5Luj56CB77yM56Gu5L+dIHNyYyDlr7nosaHooqvmuIXnkIYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGFyZ2V0SW1nOCAmJiAhdGFyZ2V0SW1nOC5pc0RlbGV0ZWQoKSkgewogICAgICAgICAgICAgIHRhcmdldEltZzguZGVsZXRlKCk7CiAgICAgICAgICAgICAgdGFyZ2V0SW1nOCA9IG51bGw7IC8vIOa3u+WKoOi/meihjOS7o+egge+8jOehruS/nSBvcmlnaW5hbEltZzgg5a+56LGh6KKr5riF55CGCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g56Gu5L+dIGJ1ZmZlciDooqvmuIXnkIYKICAgICAgICAgICAgYnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5pc1Byb2Nlc3NpbmdJbWFnZSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgIGlmIChlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIHJlcXVlc3QgY2FuY2VsbGVkJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGDojrflj5blm77lg4/lpLHotKU6ICR7aW1hZ2VQYXRofWAsIGVycm9yKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaXNQcm9jZXNzaW5nSW1hZ2UgPSBmYWxzZTsKICAgICAgICB9KTsKCiAgICAgIC8vIOWcqOe7hOS7tuWNuOi9veaXtuWPlua2iCBmZXRjaCDor7fmsYIKICAgICAgdGhpcy4kb25jZSgnaG9vazpiZWZvcmVEZXN0cm95JywgKCkgPT4gewogICAgICAgIGZldGNoQ29udHJvbGxlci5hYm9ydCgpOwogICAgICB9KTsKICAgIH0sCiAgICBzZXRSZWRCb3hTdGF0ZShsZW5ndGgsIHgsIHkpIHsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnc2V0UmVkQm94U3RhdGU6JyArIGxlbmd0aCArICcsJyArIHggKyAnLCcgKyB5LCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFJlZEJveFBvc2l0aW9uJywgeCwgeSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UmVkQm94U2lkZUxlbmd0aCcsIGxlbmd0aCk7CiAgICB9LAogICAgc2V0Rm9jdXNlclN0YXRlKHN0YXRlKSB7CiAgICAgIGlmIChzdGF0ZSA9PT0gJ3NlbGVjdHN0YXJzJykgewogICAgICAgIHRoaXMuaXNGb2N1c0xvb3BTaG9vdGluZyA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0ZvY3VzTG9vcFNob290aW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBzZXRTaG93U2VsZWN0U3RhcihzdGF0ZSkgewogICAgICB0aGlzLnNob3dTZWxlY3RTdGFyID0gc3RhdGU7CiAgICB9LAogICAgUmVkQm94U2l6ZUNoYW5nZShsZW5ndGgpIHsKICAgICAgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoID0gcGFyc2VJbnQobGVuZ3RoKTsKICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzZW5kUmVkQm94U3RhdGU6JyArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCArICc6JyArIHRoaXMuUk9JX3ggKyAnOicgKyB0aGlzLlJPSV95KTsKICAgIH0sCiAgICBzZXRNYWluQ2FtZXJhUGFyYW1ldGVycyhwYXJhbWV0ZXJzKSB7CiAgICAgIGZvciAoY29uc3QgcGFyYW1ldGVyIGluIHBhcmFtZXRlcnMpIHsKICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZChpdGVtID0+IGl0ZW0ubGFiZWwgPT09IHBhcmFtZXRlcik7CiAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgIGl0ZW0udmFsdWUgPSBwYXJhbWV0ZXJzW3BhcmFtZXRlcl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYXJhbWV0ZXIgPT0gJ1JlZEJveFNpemUnKSB7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UmVkQm94U2lkZUxlbmd0aCcsIHBhcmFtZXRlcnNbcGFyYW1ldGVyXSk7CiAgICAgICAgICAgIHRoaXMuUmVkQm94U2lkZUxlbmd0aCA9IHBhcnNlSW50KHBhcmFtZXRlcnNbcGFyYW1ldGVyXSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlciA9PSAnUk9JX3gnKSB7CiAgICAgICAgICAgIHRoaXMuUk9JX3ggPSBwYXJzZUZsb2F0KHBhcmFtZXRlcnNbcGFyYW1ldGVyXSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlciA9PSAnUk9JX3knKSB7CiAgICAgICAgICAgIHRoaXMuUk9JX3kgPSBwYXJzZUZsb2F0KHBhcmFtZXRlcnNbcGFyYW1ldGVyXSk7CiAgICAgICAgICB9IAogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOacquaJvuWIsOWPguaVsO+8miR7cGFyYW1ldGVyfWApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmNvbmZpcm1Db25maWd1cmF0aW9uKHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zKTsKICAgIH0sCiAgICBzaG93Q2FudmFzKGNhbnZhcykgewogICAgICBpZiAoY2FudmFzID09PSAnU3RlbCcpIHsKICAgICAgICB0aGlzLmN1cnJlbnRjYW52YXMgPSAnU3RlbCc7CiAgICAgICAgdGhpcy5zaG93U3RlbENhbnZhcygpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGNhbnZhcyA9PT0gJ01haW5DYW1lcmEnKSB7CgogICAgICAgIHRoaXMuY3VycmVudGNhbnZhcyA9ICdNYWluQ2FtZXJhJzsKICAgICAgICB0aGlzLnNob3dNYWluQ2FtZXJhQ2FudmFzKCk7CiAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCkKICAgICAgfQogICAgICBlbHNlIGlmIChjYW52YXMgPT09ICdHdWlkZXJDYW1lcmEnKSB7CiAgICAgICAgdGhpcy5jdXJyZW50Y2FudmFzID0gJ0d1aWRlckNhbWVyYSc7CiAgICAgICAgdGhpcy5zaG93R3VpZGVyQ2FtZXJhQ2FudmFzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygidW5rbm93biBjYW52YXM6ICIgKyBjYW52YXMsICdlcnJvcicpOwogICAgICB9CiAgICB9LAogICAgLy8g546w5pyJ55qE5Yqg5YeP5Ye95pWw6ZyA6KaB5L+u5pS5CiAgICBkZWNyZW1lbnRBbmROb3RpZnkoaXRlbSkgewogICAgICBpZiAoaXRlbS52YWx1ZSA+IGl0ZW0uaW5wdXRNaW4pIHsKICAgICAgICBpdGVtLnZhbHVlIC09IGl0ZW0uaW5wdXRTdGVwOwogICAgICAgIHRoaXMuaGFuZGxlQ29uZmlnQ2hhbmdlKGl0ZW0ubGFiZWwsIGl0ZW0udmFsdWUpOwogICAgICB9CiAgICB9LAoKICAgIGluY3JlbWVudEFuZE5vdGlmeShpdGVtKSB7CiAgICAgIGlmIChpdGVtLnZhbHVlIDwgaXRlbS5pbnB1dE1heCkgewogICAgICAgIGl0ZW0udmFsdWUgKz0gaXRlbS5pbnB1dFN0ZXA7CiAgICAgICAgdGhpcy5oYW5kbGVDb25maWdDaGFuZ2UoaXRlbS5sYWJlbCwgaXRlbS52YWx1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLy8g6YCa55So55qE6YWN572u5pu05pS55aSE55CG5Ye95pWwCiAgICBoYW5kbGVDb25maWdDaGFuZ2UobGFiZWwsIHZhbHVlKSB7CiAgICAgIGNvbnNvbGUubG9nKGDphY3nva7lt7Lmm7TmlLk6ICR7bGFiZWx9ID0gJHt2YWx1ZX1gKTsKICAgICAgaWYgKHZhbHVlICE9PSAnJykgewogICAgICAgIC8vIGNvbnNvbGUubG9nKGl0ZW0ubGFiZWwsIGl0ZW0udmFsdWUpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2cobGFiZWwgKyAnOicgKyB2YWx1ZSwgJ2luZm8nKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQobGFiZWwsIGxhYmVsICsgJzonICsgdmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICcnICYmIGxhYmVsID09PSAnRm9jYWwgTGVuZ3RoIChtbSknKSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhsYWJlbCArICdpcyBOVUxMJywgJ2luZm8nKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCArICc6Jyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmoKHlh4bnm7jlhbPmlrnms5UKICAgIHN0YXJ0Q2FsaWJyYXRpb25Qcm9jZXNzKCkgewogICAgICB0aGlzLmNhbGlicmF0aW9uSW5mby5pc0NhbGlicmF0aW5nID0gdHJ1ZTsKICAgICAgdGhpcy5jYWxpYnJhdGlvbkluZm8uY2FsaWJyYXRpb25TdGF0ZSA9ICdydW5uaW5nJzsKICAgICAgdGhpcy5jYWxpYnJhdGlvbkluZm8uY2FsaWJyYXRpb25TdGVwID0gMDsKICAgICAgdGhpcy5jYWxpYnJhdGlvbkluZm8uY2FsaWJyYXRpb25NZXNzYWdlID0gdGhpcy4kdCgnUHJlcGFyaW5nIHRvIHN0YXJ0IGZvY3VzZXIgdHJhdmVsIGNhbGlicmF0aW9uLi4uJyk7CiAgICAgIGNvbnNvbGUubG9nKCdBcHA6IENhbGlicmF0aW9uIHN0YXJ0ZWQ6JywgdGhpcy5jYWxpYnJhdGlvbkluZm8pOwogICAgfSwKCiAgICB1cGRhdGVDYWxpYnJhdGlvbkluZm8oc3RlcCwgbWVzc2FnZSwgc3RhdGUpIHsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLmNhbGlicmF0aW9uSW5mby5jYWxpYnJhdGlvblN0ZXAgPSBzdGVwOwogICAgICAgIC8vIOWmguaenOa2iOaBr+aYr+WbvemZheWMlumUru+8jOWImee/u+ivkeWugwogICAgICAgIGlmIChtZXNzYWdlICYmIHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJykgewogICAgICAgICAgdGhpcy5jYWxpYnJhdGlvbkluZm8uY2FsaWJyYXRpb25NZXNzYWdlID0gdGhpcy4kdChtZXNzYWdlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jYWxpYnJhdGlvbkluZm8uY2FsaWJyYXRpb25NZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlKSB7CiAgICAgICAgICB0aGlzLmNhbGlicmF0aW9uSW5mby5jYWxpYnJhdGlvblN0YXRlID0gc3RhdGU7CiAgICAgICAgfQogICAgICAgIGlmIChzdGVwID09PSAwKSB7CiAgICAgICAgICB0aGlzLmNhbGlicmF0aW9uSW5mby5pc0NhbGlicmF0aW5nID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ0FwcDogQ2FsaWJyYXRpb24gaW5mbyB1cGRhdGVkOicsIHRoaXMuY2FsaWJyYXRpb25JbmZvKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVDYWxpYnJhdGlvbkluZm86JywgZXJyb3IpOwogICAgICB9CiAgICB9LAoKICAgIGVuZENhbGlicmF0aW9uKCkgewogICAgICB0aGlzLmNhbGlicmF0aW9uSW5mby5pc0NhbGlicmF0aW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY2FsaWJyYXRpb25JbmZvLmNhbGlicmF0aW9uU3RhdGUgPSAnaWRsZSc7CiAgICAgIHRoaXMuY2FsaWJyYXRpb25JbmZvLmNhbGlicmF0aW9uU3RlcCA9IDA7CiAgICAgIHRoaXMuY2FsaWJyYXRpb25JbmZvLmNhbGlicmF0aW9uTWVzc2FnZSA9ICcnOwogICAgICBjb25zb2xlLmxvZygnQXBwOiBDYWxpYnJhdGlvbiBlbmRlZCcpOwogICAgfSwKICB9LAogIGNvbXB1dGVkOiB7CiAgICBuYXY6IHsKICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ25hdjonLCB0aGlzLiRzdG9yZS5zdGF0ZS5zaG93TmF2aWdhdGlvbkRyYXdlcik7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnNob3dOYXZpZ2F0aW9uRHJhd2VyCiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gKHYpIHsKICAgICAgICBpZiAodGhpcy4kc3RvcmUuc3RhdGUuc2hvd05hdmlnYXRpb25EcmF3ZXIgIT09IHYpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCduYXY6JywgdGhpcy4kc3RvcmUuc3RhdGUuc2hvd05hdmlnYXRpb25EcmF3ZXIpOwogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCd0b2dnbGVCb29sJywgJ3Nob3dOYXZpZ2F0aW9uRHJhd2VyJykKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdG9yZUN1cnJlbnRMb2NhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudExvY2F0aW9uCiAgICB9LAogICAgZ2V0UVRDbGllbnRWZXJzaW9uQ29sb3IoKSB7CiAgICAgIGlmICh0aGlzLlFUQ2xpZW50VmVyc2lvbiA9PT0gJ05vdCBjb25uZWN0ZWQnKSB7CiAgICAgICAgcmV0dXJuICdyZ2JhKDI1NSwgMCwgMCwgMC41KSc7IC8vIOe6ouiJsu+8jOmAj+aYjuW6piAwLjUKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC41KSc7IC8vIOm7mOiupOeZveiJsu+8jOmAj+aYjuW6piAwLjUKICAgICAgfQogICAgfSwKICAgIGlzTW9iaWxlKCkgewogICAgICB2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50IHx8ICcnOwogICAgICB2YXIgdG91Y2ggPSAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB8fCAobmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID4gMCk7CiAgICAgIHZhciB1YURhdGFNb2JpbGUgPSBudWxsOwogICAgICAvLyDlhbzlrrnogIHmtY/op4jlmajvvJrpgb/lhY3lj6/pgInpk74KICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnREYXRhICYmIHR5cGVvZiBuYXZpZ2F0b3IudXNlckFnZW50RGF0YS5tb2JpbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgdWFEYXRhTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudERhdGEubW9iaWxlOwogICAgICB9CiAgICAgIHZhciBtb2JpbGVMaWtlID0gL0FuZHJvaWR8aVBob25lfGlQYWR8aVBvZHxNb2JpbGV8VGFibGV0L2kudGVzdCh1YSk7CiAgICAgIHJldHVybiAodWFEYXRhTW9iaWxlICE9PSBudWxsID8gdWFEYXRhTW9iaWxlIDogbW9iaWxlTGlrZSkgJiYgISF0b3VjaDsKICAgIH0sCiAgICBpc0Rlc2t0b3AoKSB7CiAgICAgIHJldHVybiAhdGhpcy5pc01vYmlsZTsKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgc3RvcmVDdXJyZW50TG9jYXRpb246IGZ1bmN0aW9uIChsb2MpIHsKICAgICAgY29uc3QgREQyUiA9IE1hdGguUEkgLyAxODAKICAgICAgdGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLmxhdGl0dWRlID0gbG9jLmxhdCAqIEREMlIKICAgICAgdGhpcy4kc3RlbC5jb3JlLm9ic2VydmVyLmxvbmdpdHVkZSA9IGxvYy5sbmcgKiBERDJSCiAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci5lbGV2YXRpb24gPSBsb2MuYWx0CgogICAgICAvLyBBdCBzdGFydHVwLCB3ZSBuZWVkIHRvIHdhaXQgZm9yIHRoZSBsb2NhdGlvbiB0byBiZSBzZXQgYmVmb3JlIGRlY2lkaW5nIHdoaWNoCiAgICAgIC8vIHN0YXJ0dXAgdGltZSB0byBzZXQgc28gdGhhdCBpdCdzIG5pZ2h0IHRpbWUuCiAgICAgIGlmICghdGhpcy5zdGFydFRpbWVJc1NldCkgewogICAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci51dGMgPSBzd2guZ2V0VGltZUFmdGVyU3Vuc2V0KHRoaXMuJHN0ZWwpCiAgICAgICAgdGhpcy5zdGFydFRpbWVJc1NldCA9IHRydWUKICAgICAgfQogICAgICAvLyBJbml0IG9mIHRpbWUgYW5kIGRhdGUgaXMgY29tcGxldGUKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRWYWx1ZScsIHsgdmFyTmFtZTogJ2luaXRDb21wbGV0ZScsIG5ld1ZhbHVlOiB0cnVlIH0pCiAgICB9LAogICAgJHJvdXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHJlYWN0IHRvIHJvdXRlIGNoYW5nZXMuLi4KICAgICAgdGhpcy5zZXRTdGF0ZUZyb21RdWVyeUFyZ3MoKQogICAgfSwKICAgIEN1cnJlbnREcml2ZXJUeXBlKG5ld1ZhbCkgewogICAgICAvLyDlvZMgQ3VycmVudERyaXZlclR5cGUg5Y+Y5YyW5pe277yM5pu05pawIHNlbGVjdGVkRHJpdmVyCiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWREcml2ZXIobmV3VmFsKTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uICgpIHsKICAgIC8vIC8vIOmYu+atoum7mOiupOeahOinpuaRuOihjOS4ugogICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMucHJldmVudERlZmF1bHQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLnByZXZlbnREZWZhdWx0LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLnByZXZlbnREZWZhdWx0LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgIC8vIC8vIOmYu+atoum7mOiupOeahOm8oOagh+ihjOS4ugogICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5wcmV2ZW50RGVmYXVsdCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMucHJldmVudERlZmF1bHQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5wcmV2ZW50RGVmYXVsdCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICAvLyAvLyDpmLvmraLpu5jorqTnmoTmu5rova7ooYzkuLoKICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgdGhpcy5wcmV2ZW50RGVmYXVsdCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICBsZXQgdGhhdCA9IHRoaXMKCiAgICB0aGlzLmdldExvY2F0aW9uSG9zdE5hbWUoKTsKCiAgICB0aGlzLmxvYWRJbWFnZVRvQ2FudmFzTWFpbkNhbWVyYSgpOwogICAgdGhpcy5sb2FkSW1hZ2VUb0NhbnZhc0d1aWRlckNhbWVyYSgpOwoKICAgIHRoaXMuaW5pdENhbnZhcygpOwogICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpOwoKICAgIGZvciAoY29uc3QgaSBpbiB0aGlzLiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpKSB7CiAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKClbaV0KICAgICAgaWYgKHBsdWdpbi5vbkFwcE1vdW50ZWQpIHsKICAgICAgICBwbHVnaW4ub25BcHBNb3VudGVkKHRoYXQpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmNvbm5lY3QoKTsKICAgIHRoaXMuc2V0dXBOZXR3b3JrU3RhdHVzTGlzdGVuZXIoKTsKCiAgICAvLyDkvb/nlKggUHJvbWlzZSDmo4Dmn6UgT3BlbkNWLmpzIOaYr+WQpuWKoOi9veWujOaIkAogICAgdGhpcy5sb2FkT3BlbkN2KCkudGhlbigoKSA9PiB7CiAgICAgIGlmICghdGhpcy5faXNEZXN0cm95ZWQpIHsgLy8g5qOA5p+l57uE5Lu25piv5ZCm5bey6ZSA5q+BCiAgICAgICAgY29uc29sZS5sb2coJ09wZW5DVi5qcyBpcyByZWFkeScpOwogICAgICAgIHRoaXMub25DdlJlYWR5KCk7ICAvLyDosIPnlKggT3BlbkNWIOWHhuWkh+WlveeahOWbnuiwgwogICAgICB9CiAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgT3BlbkNWLmpzOicsIGVycm9yKTsKICAgIH0pOwoKICAgIC8vIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgLy8gc2NyaXB0LnNyYyA9ICdodHRwczovL2RvY3Mub3BlbmN2Lm9yZy80LjUuNS9vcGVuY3YuanMnOwogICAgLy8gc2NyaXB0LmFzeW5jID0gdHJ1ZTsKICAgIC8vIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB0aGlzLm9uQ3ZSZWFkeSgpOwogICAgLy8gZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwoKICAgIGltcG9ydCgnQC9hc3NldHMvanMvc3RlbGxhcml1bS13ZWItZW5naW5lLndhc20nKS50aGVuKGYgPT4gewogICAgICBpZiAoIXRoaXMuX2lzRGVzdHJveWVkKSB7IC8vIOWGjeasoeajgOafpee7hOS7tuaYr+WQpuW3sumUgOavgQogICAgICAgIC8vIEluaXRpYWxpemUgdGhlIFN0ZWxXZWJFbmdpbmUgdmlld2VyIHNpbmdsZXRvbgogICAgICAgIC8vIEFmdGVyIHRoaXMgY2FsbCwgdGhlIFN0ZWxXZWJFbmdpbmUgc3RhdGUgd2lsbCBhbHdheXMgYmUgYXZhaWxhYmxlIGluIHZ1ZXggc3RvcmUKICAgICAgICAvLyBpbiB0aGUgJHN0b3JlLnN0ZWwgb2JqZWN0IGluIGEgcmVhY3RpdmUgd2F5ICh1c2VmdWwgZm9yIHZ1ZSBjb21wb25lbnRzKS4KICAgICAgICAvLyBUbyBtb2RpZnkgdGhlIHN0YXRlIG9mIHRoZSBTdGVsV2ViRW5naW5lLCBpdCdzIGVub3VnaCB0byBjYWxsL3NldCB2YWx1ZXMgZGlyZWN0bHkgb24gdGhlICRzdGVsIG9iamVjdAogICAgICAgIHRyeSB7CiAgICAgICAgICBzd2guaW5pdFN0ZWxXZWJFbmdpbmUodGhhdC4kc3RvcmUsIGYuZGVmYXVsdCwgdGhhdC4kcmVmcy5zdGVsQ2FudmFzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IGF1dG8gbG9jYXRpb24gZGV0ZWN0aW9uIChldmVuIGlmIHdlIGRvbid0IHVzZSBpdCkKICAgICAgICAgICAgc3doLmdldEdlb2xvY2F0aW9uKCkudGhlbihwID0+IHN3aC5nZW9Db2RlUG9zaXRpb24ocCwgdGhhdCkpLnRoZW4oKGxvYykgPT4gewogICAgICAgICAgICAgIHRoYXQuJHN0b3JlLmNvbW1pdCgnc2V0QXV0b0RldGVjdGVkTG9jYXRpb24nLCBsb2MpCiAgICAgICAgICAgIH0sIChlcnJvcikgPT4geyBjb25zb2xlLmxvZyhlcnJvcikgfSkKCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuc2V0Rm9udCgncmVndWxhcicsIHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ2ZvbnRzL1JvYm90by1SZWd1bGFyLnR0ZicsIDEuMzgpCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuc2V0Rm9udCgnYm9sZCcsIHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ2ZvbnRzL1JvYm90by1Cb2xkLnR0ZicsIDEuMzgpCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuY29yZS5jb25zdGVsbGF0aW9ucy5zaG93X29ubHlfcG9pbnRlZCA9IGZhbHNlCgogICAgICAgICAgICB0aGF0LnNldFN0YXRlRnJvbVF1ZXJ5QXJncygpCiAgICAgICAgICAgIHRoYXQuZ3VpQ29tcG9uZW50ID0gJ0d1aScKICAgICAgICAgICAgZm9yIChjb25zdCBpIGluIHRoYXQuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKCkpIHsKICAgICAgICAgICAgICBjb25zdCBwbHVnaW4gPSB0aGF0LiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpW2ldCiAgICAgICAgICAgICAgaWYgKHBsdWdpbi5vbkVuZ2luZVJlYWR5KSB7CiAgICAgICAgICAgICAgICBwbHVnaW4ub25FbmdpbmVSZWFkeSh0aGF0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF0aGF0LmRhdGFTb3VyY2VJbml0RG9uZSkgewogICAgICAgICAgICAgIC8vIFNldCBhbGwgZGVmYXVsdCBkYXRhIHNvdXJjZXMKICAgICAgICAgICAgICBjb25zdCBjb3JlID0gdGhhdC4kc3RlbC5jb3JlCiAgICAgICAgICAgICAgY29yZS5zdGFycy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N0YXJzJyB9KQogICAgICAgICAgICAgIGNvcmUuc3RhcnMuYWRkRGF0YVNvdXJjZSh7IHVybDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwgKyAnc2t5ZGF0YS9zdGFyc19iYXNlJyB9KQogICAgICAgICAgICAgIGNvcmUuc3RhcnMuYWRkRGF0YVNvdXJjZSh7IHVybDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwgKyAnc2t5ZGF0YS9zdGFyc19leHRlbmQnIH0pCiAgICAgICAgICAgICAgY29yZS5kc3MuYWRkRGF0YVNvdXJjZSh7IHVybDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwgKyAnc2t5ZGF0YS9kc3MvdjEnIH0pCiAgICAgICAgICAgICAgLy8gY29yZS5zdGFycy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N0YXJzJyB9KQoKICAgICAgICAgICAgICAvLyBBbGxvdyB0byBzcGVjaWZ5IGEgY3VzdG9tIHBhdGggZm9yIHNreSBjdWx0dXJlIGRhdGEKICAgICAgICAgICAgICBpZiAodGhhdC4kcm91dGUucXVlcnkuc2MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHRoYXQuJHJvdXRlLnF1ZXJ5LnNjLnN1YnN0cmluZyh0aGF0LiRyb3V0ZS5xdWVyeS5zYy5sYXN0SW5kZXhPZignLycpICsgMSkKICAgICAgICAgICAgICAgIGNvcmUuc2t5Y3VsdHVyZXMuYWRkRGF0YVNvdXJjZSh7IHVybDogdGhhdC4kcm91dGUucXVlcnkuc2MsIGtleToga2V5IH0pCiAgICAgICAgICAgICAgICBjb3JlLnNreWN1bHR1cmVzLmN1cnJlbnRfaWQgPSBrZXkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29yZS5za3ljdWx0dXJlcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3NreWN1bHR1cmVzL3dlc3Rlcm4nLCBrZXk6ICd3ZXN0ZXJuJyB9KQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29yZS5kc29zLmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvZHNvJyB9KQogICAgICAgICAgICAgIGNvcmUubGFuZHNjYXBlcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL2xhbmRzY2FwZXMvZ3VlcmVpbnMnLCBrZXk6ICdndWVyZWlucycgfSkKICAgICAgICAgICAgICBjb3JlLm1pbGt5d2F5LmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvc3VydmV5cy9taWxreXdheScgfSkKICAgICAgICAgICAgICAvLyBjb3JlLmRzcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvZHNzJyB9KQogICAgICAgICAgICAgIGNvcmUubWlub3JfcGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL21wY29yYi5kYXQnLCBrZXk6ICdtcGNfYXN0ZXJvaWRzJyB9KQogICAgICAgICAgICAgIGNvcmUucGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvc3NvL21vb24nLCBrZXk6ICdtb29uJyB9KQogICAgICAgICAgICAgIGNvcmUucGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvc3NvL3N1bicsIGtleTogJ3N1bicgfSkKICAgICAgICAgICAgICBjb3JlLnBsYW5ldHMuYWRkRGF0YVNvdXJjZSh7IHVybDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwgKyAnc2t5ZGF0YS9zdXJ2ZXlzL3Nzby9tb29uJywga2V5OiAnZGVmYXVsdCcgfSkKICAgICAgICAgICAgICBjb3JlLmNvbWV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL0NvbWV0RWxzLnR4dCcsIGtleTogJ21wY19jb21ldHMnIH0pCiAgICAgICAgICAgICAgY29yZS5zYXRlbGxpdGVzLmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvdGxlX3NhdGVsbGl0ZS5qc29ubC5neicsIGtleTogJ2pzb25sL3NhdCcgfSkKCiAgICAgICAgICAgICAgLy8gTW91bnQgUG9pbnRpbmcKICAgICAgICAgICAgICBnbFN0ZWwgPSB0aGF0LnNldEdsb2FiYWxTdGVsKHRoYXQuJHN0ZWwpOwogICAgICAgICAgICAgIGdsTGF5ZXIgPSB0aGF0LnNldEdsb2JhbExheWVyKHRoYXQuJHN0ZWwpOwogICAgICAgICAgICAgIGdsVGVzdENpcmNsZSA9IHRoYXQudGVzdEFkZENpcmNsZSh0aGF0LiRzdGVsLCBnbExheWVyKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRWYWx1ZScsIHsgdmFyTmFtZTogJ3dhc21TdXBwb3J0JywgbmV3VmFsdWU6IGZhbHNlIH0pCiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHsKICAgICAgLy8g6aG16Z2i5a6M5YWo5Yqg6L29CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+mhtemdouW3suWujOWFqOWKoOi9vScsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnUHJvY2Vzc19Db21tYW5kX1JldHVybicsICdWdWVDbGllbnRWZXJzaW9uOicgKyBwcm9jZXNzLmVudi5WVUVfQVBQX1ZFUlNJT04pOwogICAgfSkKCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgICAvLyBET03liqDovb3lrozmiJAKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRE9N5bey5Yqg6L295a6M5oiQJywgJ2luZm8nKTsKICAgIH0pCgogIH0sCiAgLy8g5Zyo57uE5Lu26ZSA5q+B5pe256e76ZmkCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLnByZXZlbnREZWZhdWx0KTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMucHJldmVudERlZmF1bHQpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLnByZXZlbnREZWZhdWx0KTsKCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLnByZXZlbnREZWZhdWx0KTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMucHJldmVudERlZmF1bHQpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMucHJldmVudERlZmF1bHQpOwoKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3doZWVsJywgdGhpcy5wcmV2ZW50RGVmYXVsdCk7CgogICAgLy8g5riF55CG5p6B6L205qCh5YeG55u45YWz55qE5ZyG5ZyICiAgICBpZiAodGhpcy5jYWxpYnJhdGlvbkNpcmNsZXMpIHsKICAgICAgdGhpcy5jYWxpYnJhdGlvbkNpcmNsZXMuZm9yRWFjaChjaXJjbGUgPT4gewogICAgICAgIGlmIChnbExheWVyICYmIGNpcmNsZSkgewogICAgICAgICAgZ2xMYXllci5yZW1vdmUoY2lyY2xlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhbGlicmF0aW9uQ2lyY2xlcyA9IFtdOwogICAgfQoKICAgIGlmICh0aGlzLmFkanVzdG1lbnRDaXJjbGVzKSB7CiAgICAgIHRoaXMuYWRqdXN0bWVudENpcmNsZXMuZm9yRWFjaChjaXJjbGUgPT4gewogICAgICAgIGlmIChnbExheWVyICYmIGNpcmNsZSkgewogICAgICAgICAgZ2xMYXllci5yZW1vdmUoY2lyY2xlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmFkanVzdG1lbnRDaXJjbGVzID0gW107CiAgICB9CgogICAgLy8g5YGc5q2i6KeG5Zy65pu05paw5a6a5pe25ZmoCiAgICB0aGlzLnN0b3BGaWVsZFVwZGF0ZVRpbWVyKCk7CiAgfSwKCgp9Cg=="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0hBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;;;AAIA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA","file":"App.vue","sourceRoot":"src","sourcesContent":["// Stellarium Web - Copyright (c) 2022 - Stellarium Labs SRL\n//\n// This program is licensed under the terms of the GNU AGPL v3, or\n// alternatively under a commercial licence.\n//\n// The terms of the AGPL v3 license can be found in the main directory of this\n// repository.\n\n<template>\n  <v-app>\n    <v-navigation-drawer v-model=\"drawer_2\" ref=\"Drawer_2\" app absolute temporary :width=\"DeviceIsConnected ? 200 : 200\"\n      style=\"left: 170px; backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.1);\">\n\n      <div v-show=\"isOpenDevicePage\">\n        <span\n          style=\"position: absolute; top: 0px; left: 50%; transform: translateX(-50%); font-size: 30px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n          {{ $t(CurrentDriverType) }}\n          <v-divider></v-divider>\n        </span>\n\n        <div :style=\"{ width: DeviceIsConnected ? '200px' : '200px' }\"\n          style=\"position: absolute; top: 50px; max-height: calc(100% - 95px); overflow-y: auto;\"\n          class=\"params-container\">\n\n          <div v-show=\"!DeviceIsConnected\" style=\"text-align: center;\">\n            <span style=\"display: inline-block; font-size: 15px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n              {{ $t('Device Connection') }}\n            </span>\n\n            <!-- 驱动选择下拉框，添加@change事件 -->\n            <v-select :label=\"$t('Select Driver')\" :items=\"drivers\" item-text=\"label\" item-value=\"value\"\n              v-model=\"selectedDriver\" @change=\"confirmDriver\" style=\"width: 150px; display: inline-block;\">\n            </v-select>\n\n            <!-- 波特率下拉框，添加@change事件 -->\n            <v-select v-if=\"CurrentDriverType === 'Mount' || CurrentDriverType === 'Focuser'\" :label=\"$t('Baud Rate')\"\n              :items=\"BaudRateItems\" item-text=\"label\" item-value=\"value\" v-model=\"BaudRateSelected\"\n              @change=\"confirmDriver\" style=\"width: 150px; display: inline-block;\">\n            </v-select>\n\n            <v-row no-gutters>\n              <v-col cols=\"6\">\n                <button @click=\"clearDriver\" class=\"btn-confirm\" style=\"display: inline-block;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/delete.svg\" height=\"20px\"\n                      style=\"min-height: 20px; pointer-events: none;\"></img>\n                  </div>\n                </button>\n              </v-col>\n              <v-col cols=\"6\">\n                <button v-if=\"!isConnecting\" @click=\"connectDriver(selectedDriver)\" class=\"btn-confirm\"\n                  style=\"display: inline-block; background-color: green;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <v-icon color=\"white\">mdi-link</v-icon>\n                  </div>\n                </button>\n                <v-progress-circular v-else indeterminate color=\"green\" size=\"24\"></v-progress-circular>\n              </v-col>\n            </v-row>\n          </div>\n\n          <div v-show=\"DeviceIsConnected\" v-for=\"(item, index) in CurrentConfigItems()\" :key=\"index\"\n            class=\"config-item\">\n            <!-- 标题，仅在第一个项目显示 -->\n            <span v-if=\"index === 0\" class=\"config-title\">\n              {{ $t('Device Config Items') }}\n            </span>\n\n            <!-- 配置项卡片内容 -->\n            <v-card-text>\n              <!-- 文本输入类型 -->\n              <v-text-field v-if=\"item.inputType === 'text'\" v-model=\"item.value\" :label=\"item.label\"\n                @input=\"handleConfigChange(item.label, item.value)\" class=\"config-input\">\n              </v-text-field>\n\n              <!-- 数字输入类型 -->\n              <v-text-field v-if=\"item.inputType === 'number'\" v-model=\"item.value\" :label=\"item.label\"\n                :type=\"isDesktop ? 'number' : 'text'\" :min=\"item.min\" :max=\"item.max\"\n                :step=\"item.step !== undefined && item.step !== null ? item.step : 1\" :rules=\"numberRules(item)\"\n                :inputmode=\"isMobile ? getInputMode(item) : ''\" :pattern=\"isMobile ? getPattern(item) : ''\"\n                enterkeyhint=\"done\" @blur=\"onNumberCommit(item)\" @keydown.enter.prevent=\"onNumberCommit(item)\"\n                class=\"config-input\" />\n\n              <!-- 滑动条类型 -->\n              <div v-if=\"item.inputType === 'slider'\" class=\"slider-container\">\n                <span class=\"slider-label\">\n                  {{ item.label }}: {{ item.value }}\n                </span>\n                <div>\n                  <!-- 减小按钮 -->\n                  <button @click=\"decrementAndNotify(item)\" class=\"get-click btn-slider btn-minus\">\n                    <div class=\"btn-content\">\n                      <img src=\"@/assets/images/svg/ui/Minus.svg\" height=\"10px\" class=\"btn-icon\">\n                    </div>\n                  </button>\n\n                  <!-- 滑动条 -->\n                  <v-slider v-model=\"item.value\" :step=\"item.inputStep\" :max=\"item.inputMax\" :min=\"item.inputMin\"\n                    @change=\"handleConfigChange(item.label, item.value)\" color=\"white\"\n                    class=\"align-center slider-control\">\n                  </v-slider>\n\n                  <!-- 增加按钮 -->\n                  <button @click=\"incrementAndNotify(item)\" class=\"get-click btn-slider btn-plus\">\n                    <div class=\"btn-content\">\n                      <img src=\"@/assets/images/svg/ui/Plus.svg\" height=\"10px\" class=\"btn-icon\">\n                    </div>\n                  </button>\n                </div>\n              </div>\n\n              <!-- 选择框类型 -->\n              <v-select v-if=\"item.inputType === 'select'\" v-model=\"item.value\" :label=\"item.label\"\n                @change=\"handleConfigChange(item.label, item.value)\" :items=\"item.selectValue\" class=\"config-input\">\n              </v-select>\n\n              <!-- 开关类型 -->\n              <v-switch v-if=\"item.inputType === 'switch'\" v-model=\"item.value\" :label=\"item.label\"\n                @change=\"handleConfigChange(item.label, item.value)\" class=\"config-switch\">\n              </v-switch>\n\n              <!-- 提示信息类型（只读） -->\n              <div v-if=\"item.inputType === 'tip'\" class=\"tip-field\">\n                <div class=\"tip-label\">{{ item.label }}</div>\n                <div class=\"tip-value\" :title=\"formatTipTitle(item)\">\n                  {{ formatTipValue(item) }}\n                </div>\n              </div>\n            </v-card-text>\n          </div>\n\n          <div v-show=\"DeviceIsConnected\"\n            style=\"text-align: center; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px;\">\n            <button @click=\"disconnectDriver\" class=\"btn-confirm\" style=\"display: inline-block; background-color: red;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <v-icon color=\"white\">mdi-link-off</v-icon>\n              </div>\n            </button>\n          </div>\n\n        </div>\n\n        <div v-show=\"isOpenPowerPage\">\n          <span\n            style=\"position: absolute; top: 0px; left: 50%; transform: translateX(-50%); font-size: 26px; color: rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap; \">\n            {{ $t('Power Management') }}\n            <v-divider></v-divider>\n          </span>\n\n          <div style=\"position: absolute; top: 50px; max-height: calc(100% - 50px); width: 200px; overflow-y: auto;\">\n            <v-list dense>\n\n              <v-list-item @click.stop=\"SwitchOutPutPower(1, OutPutPower_1_ON)\"\n                :style=\"{ height: '36px', marginBottom: '10px' }\">\n                <v-list-item-icon style=\"margin-right: 10px;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/OutPutPower.svg\" height=\"30px\"\n                      style=\"min-height: 30px; pointer-events: none;\"></img>\n                  </div>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title>\n                    <span>\n                      <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('OutPut Power 1') }}\n                      </div>\n                      <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': OutPutPower_1_ON }\">{{\n                        OutPutPower_1_ON ?\n                          '[ON]' : '[OFF]' }}</div>\n                    </span>\n                  </v-list-item-title>\n\n                </v-list-item-content>\n              </v-list-item>\n\n              <v-list-item @click.stop=\"SwitchOutPutPower(2, OutPutPower_2_ON)\"\n                :style=\"{ height: '36px', marginBottom: '10px' }\">\n                <v-list-item-icon style=\"margin-right: 10px;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/OutPutPower.svg\" height=\"30px\"\n                      style=\"min-height: 30px; pointer-events: none;\"></img>\n                  </div>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title>\n                    <span>\n                      <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('OutPut Power 2') }}\n                      </div>\n                      <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': OutPutPower_2_ON }\">{{\n                        OutPutPower_2_ON ?\n                          '[ON]' : '[OFF]' }}</div>\n                    </span>\n                  </v-list-item-title>\n\n                </v-list-item-content>\n              </v-list-item>\n\n              <v-divider :style=\"{ marginBottom: '10px' }\"></v-divider>\n\n              <v-list-item @click.stop=\"RestartRaspberryPi()\" :style=\"{ height: '36px', marginBottom: '10px' }\">\n                <v-list-item-icon style=\"margin-right: 10px;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/Reboot.svg\" height=\"30px\"\n                      style=\"min-height: 30px; pointer-events: none;\"></img>\n                  </div>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Restart')\n                  }}</v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n\n              <v-list-item @click.stop=\"ShutdownRaspberryPi()\" :style=\"{ height: '36px', marginBottom: '10px' }\">\n                <v-list-item-icon style=\"margin-right: 10px;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/PowerOFF.svg\" height=\"30px\"\n                      style=\"min-height: 30px; pointer-events: none;\"></img>\n                  </div>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Shut Down')\n                  }}</v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n              <!-- 强制更新 -->\n              <v-list-item @click.stop=\"ForceUpdate()\" :style=\"{ height: '36px', marginBottom: '10px' }\">\n                <v-list-item-icon style=\"margin-right: 10px;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/PowerOFF.svg\" height=\"30px\"\n                      style=\"min-height: 30px; pointer-events: none;\"></img>\n                  </div>\n                </v-list-item-icon>\n                <v-list-item-content>\n                  <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Force Update')\n                  }}</v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n\n            </v-list>\n          </div>\n\n        </div>\n\n      </div>\n\n    </v-navigation-drawer>\n\n    <v-navigation-drawer v-model=\"nav\" app :stateless=\"drawer_2\" temporary width=\"170\"\n      style=\"backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.1);\">\n      <v-layout column fill-height>\n        <v-list dense>\n          <!-- 客户端版本和服务器版本信息 -->\n          <template>\n            <div style=\"display: flex; justify-content: center; align-items: center;\">\n              <span style=\"font-size: 10px; color: rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap;\">\n                Client Version: {{ VueClientVersion }}\n              </span>\n            </div>\n            <div style=\"display: flex; justify-content: center; align-items: center;\">\n              <!-- <span style=\"font-size: 10px; color: getQTClientVersionColor,rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap;\">\n                Server Version: {{ QTClientVersion }}\n              </span> -->\n              <span :style=\"{\n                fontSize: '10px',\n                color: getQTClientVersionColor,\n                userSelect: 'none',\n                whiteSpace: 'nowrap'\n              }\">\n                Server Version: {{ QTClientVersion }}\n              </span>\n            </div>\n            <v-divider></v-divider>\n          </template>\n\n          <!-- 退出(Quit) -->\n          <v-list-item @click.stop=\"QuitToMainApp()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Quit.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Quit')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 视图设置(View Settings) -->\n          <v-list-item @click.stop=\"toggleStoreValue('showViewSettingsDialog')\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Setting.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('View Settings')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 电源管理(Power Management) -->\n          <v-list-item @click.stop=\"openPowerManagerPage()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Power.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Power Management')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-divider></v-divider>\n\n          <!-- 设备列表(动态生成) -->\n          <v-list-item v-for=\"(device, index) in devices\" :key=\"index\" @click.stop=\"selectDevice(device)\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/${device.driverType}.svg`)\" height=\"30px\"\n                  style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t(device.driverType) }}</div>\n                  <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': device.isConnected }\">{{\n                    device.device }}\n                  </div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-divider></v-divider>\n\n          <!-- 连接所有(Connect All) -->\n          <v-list-item :disabled=\"loadingConnectAllDevice\" @touchstart=\"startConnectBtnPress\"\n            @touchend=\"endConnectBtnPress\" @mousedown=\"startConnectBtnPress\" @mouseup=\"endConnectBtnPress\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Connect.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\">\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px', userSelect: 'none' }\">\n                {{ $t('Connect All') }}\n              </v-list-item-title>\n              <v-progress-linear v-if=\"loadingConnectAllDevice\" indeterminate color=\"white\"\n                height=\"5\"></v-progress-linear>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 断开所有连接(Disconnect All) -->\n          <v-list-item @click.stop=\"disconnectAllDevice(false)\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DisConnect.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px', userSelect: 'none' }\">{{\n                $t('Disconnect All') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 设备分配(Device Allocation) -->\n          <v-list-item @click.stop=\"DeviceAllocation()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Allocation.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{\n                $t('Device Allocation') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 校准极轴(Calibrate Polar Axis) -->\n          <v-list-item @click.stop=\"CalibratePolarAxis()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/PoleAxis.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{\n                $t('Calibrate Polar Axis') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 图像文件(Image Files) -->\n          <v-list-item @click.stop=\"OpenIamgeFolder()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/FolderSwitch.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Image Files')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 日志(Logs) -->\n          <v-list-item @click.stop=\"OpenDebugLog()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DebugLog.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Logs')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-divider></v-divider>\n\n          <!-- 纬度和经度(Lat & Long) -->\n          <v-list-item @click.stop=\"locationClicked()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/Location.svg`)\" height=\"30px\" style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Lat & Long') }}</div>\n                  <div :style=\"{ fontSize: '7px' }\">{{ '(' + $store.state.currentLocation.lat + ', ' +\n                    $store.state.currentLocation.lng + ')' }}</div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 刷新页面(Refresh Page) -->\n          <v-list-item @click.stop=\"ShowConfirmDialog('Confirm', $t('Are you sure you need to refresh?'), 'Refresh')\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/Refresh.svg`)\" height=\"30px\" style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ fontSize: '10px' }\">{{ $t('Refresh Page') }}</div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- 数据版权(Data Credits) -->\n          <v-list-item @click.stop=\"toggleStoreValue('showDataCreditsDialog')\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DataCredits.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Data Credits')\n                }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n        </v-list>\n      </v-layout>\n    </v-navigation-drawer>\n\n\n\n\n    <v-main>\n\n      <canvas v-show=false id=\"TestCanvas\" width=\"1920\" height=\"1080\"></canvas>\n\n      <v-container class=\"fill-height\" fluid style=\"padding: 0\">\n        <div id=\"stel\" v-bind:class=\"{ right_panel: $store.state.showSidePanel }\">\n          <div style=\"position: relative; width: 100%; height: 100%\">\n            <component v-bind:is=\"guiComponent\"></component>\n            <canvas id=\"stel-canvas\" ref='stelCanvas' :style=\"{ zIndex: canvasZIndexStel }\"></canvas>\n            <canvas ref=\"mainCanvas\" id=\"mainCamera-canvas\" :style=\"{ zIndex: canvasZIndexMainCamera }\"\n              @click=\"handleMainCanvasClick\" @touchstart=\"handleTouchStart\" @touchmove=\"handleTouchMove\"\n              @touchend=\"handleTouchEnd\" @mousedown=\"handleMouseDown\" @mouseup=\"handleMouseUp\"\n              @mousemove=\"handleMouseMove\" @wheel=\"handleWheel\">\n            </canvas>\n            <canvas ref=\"guiderCanvas\" id=\"guiderCamera-canvas\" :style=\"{ zIndex: canvasZIndexGuiderCamera }\"\n              @click=\"handleGuiderCanvasClick\"></canvas>\n            <!-- <img id=\"imageSrc\" alt=\"Source\" :src=\"imageSrc\" crossOrigin = \"\" /> -->\n            <ProgressBar :progress=\"progressValue\" :description=\"progressDescription\" :showDescription=\"true\"\n              :isShow=\"currentcanvas === 'MainCamera'\" />\n          </div>\n        </div>\n\n\n      </v-container>\n    </v-main>\n\n    <v-dialog v-model=\"showDisconnectDialog\" persistent max-width=\"290\">\n      <v-card>\n        <v-card-title class=\"text-h5\">Confirm Action</v-card-title>\n        <v-card-text>Are you sure you want to disconnect the driver {{ currentDisconnectDriverName }}?</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"red darken-1\" text @click=\"showDisconnectDialog = false\">Cancel</v-btn>\n          <v-btn color=\"green darken-1\" text @click=\"confirmDisconnect\">Confirm</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n\n    <!-- 校准信息显示框 -->\n    <div v-if=\"calibrationInfo.isCalibrating || calibrationInfo.calibrationState === 'complete'\"\n      class=\"calibration-info-box\">\n      <div class=\"calibration-content\">\n        <div class=\"calibration-title\">{{ $t('Focuser Travel Calibration') }}</div>\n        <div class=\"calibration-message\">{{ calibrationInfo.calibrationMessage }}</div>\n        <div class=\"calibration-progress\">{{ $t('Step') }} {{ calibrationInfo.calibrationStep }}/3</div>\n      </div>\n    </div>\n\n  </v-app>\n</template>\n<script>\nimport _ from 'lodash'\nimport Gui from '@/components/gui.vue'\nimport GuiLoader from '@/components/gui-loader.vue'\nimport swh from '@/assets/sw_helpers.js'\nimport Moment from 'moment'\nimport BackgroundImage from '@/assets/images/svg/ui/Background.svg';\nimport ErrorImage from '@/assets/images/svg/ui/errorImage.svg';\nimport ProgressBar from '@/components/ProgressBar.vue';\n\nlet glTestCircle;\nlet glLayer;\nlet glStel;\n\nexport default {\n  data(context) {\n    return {\n      menuItems: [\n        { title: this.$t('View Settings'), icon: 'mdi-settings', store_var_name: 'showViewSettingsDialog', store_show_menu_item: 'showViewSettingsMenuItem' },\n        { title: this.$t('Planets Tonight'), icon: 'mdi-panorama-fisheye', store_var_name: 'showPlanetsVisibilityDialog', store_show_menu_item: 'showPlanetsVisibilityMenuItem' },\n        { divider: true }\n      ].concat(this.getPluginsMenuItems()).concat([\n        { title: this.$t('Data Credits'), footer: true, icon: 'mdi-copyright', store_var_name: 'showDataCreditsDialog' }\n      ]),\n      menuComponents: [].concat(this.getPluginsMenuComponents()),\n      guiComponent: 'GuiLoader',\n      startTimeIsSet: false,\n      initDone: false,\n      dataSourceInitDone: false,\n      imageSrc: 'https://i.imgur.com/egA5FIv.jpeg', // 替换为你的图像路径\n      cvReady: false,\n      canvasZIndexStel: -10,\n      canvasZIndexMainCamera: -11,\n      canvasZIndexGuiderCamera: -12,\n      currentcanvas: 'Stel',\n\n      WebSocketUrl: '',\n\n      websocket: null,\n      message: '',\n      receivedMessages: [],// 存储接收到的消息\n      sentMessages: [], // 存储已发送的消息\n      messageCounter: 0, // 用于生成唯一的消息ID\n      websocketState: 'disconnected', // 添加WebSocket连接状态\n      networkDisconnected: false, // 添加网络连接状态\n\n      QTClientVersion: 'Not connected',\n      VueClientVersion: process.env.VUE_APP_VERSION,\n\n      // 校准信息对象\n      calibrationInfo: {\n        isCalibrating: false,\n        calibrationState: 'idle',\n        calibrationStep: 0,\n        calibrationMessage: ''\n      },\n\n      // isMessageBoxShow: false,\n\n      CurrentDriverType: '',\n      DeviceIsConnected: null,\n      confirmDriverType: '',\n\n      MainCameraOffsetMin: 0,\n      MainCameraOffsetMax: 0,\n\n      MainCameraGainMin: 0,\n      MainCameraGainMax: 0,\n\n      devices: [\n        { name: '导星镜', driverType: 'Guider', type: 'CCDs', ListNum: \"1\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Guider' },\n        { name: '主相机', driverType: 'MainCamera', type: 'CCDs', ListNum: \"20\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_MainCamera' },\n        { name: '赤道仪', driverType: 'Mount', type: 'Telescopes', ListNum: \"0\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Mount' },\n        { name: '望远镜', driverType: 'Telescopes', device: '', isConnected: true },\n        { name: '电动调焦器', driverType: 'Focuser', type: 'Focusers', ListNum: \"22\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Focuser' },\n        { name: '电子极轴镜', driverType: 'PoleCamera', type: 'CCDs', ListNum: \"2\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_PoleCamera' },\n        { name: '滤镜轮', driverType: 'CFW', type: 'Filter Wheels', ListNum: \"21\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_CFW' },\n      ],\n\n      // Changing the label name also requires changing the emit signal name\n      GuiderConfigItems: [\n        { driverType: 'Guider', label: 'Guider Focal Length (mm)', value: '', inputType: 'text' },\n        { driverType: 'Guider', label: 'Multi Star Guider', value: false, inputType: 'switch' },\n        // { driverType: 'Guider', label: 'Guider Pixel size', value: '', inputType: 'text'},\n        { driverType: 'Guider', label: 'Guider Gain', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n        { driverType: 'Guider', label: 'Calibration step (ms)', value: '', inputType: 'text' },\n        { driverType: 'Guider', label: 'Ra Aggression', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n        { driverType: 'Guider', label: 'Dec Aggression', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n\n      ],\n\n      MainCameraConfigItems: [\n        // vue处理参数\n        { driverType: 'MainCamera', label: 'ImageCFA', value: '', inputType: 'select', selectValue: ['GR', 'GB', 'BG', 'RGGB', 'null'] },\n        // 硬件处理参数\n        { driverType: 'MainCamera', label: 'Binning', value: '', inputType: 'slider', inputMin: 1, inputMax: 16, inputStep: 1 },\n        { driverType: 'MainCamera', label: 'Temperature', value: '', inputType: 'select', selectValue: [5, 0, -5, -10, -15, -20, -25] },\n        { driverType: 'MainCamera', label: 'Gain', value: '', inputType: 'slider', inputMin: 0, inputMax: 0, inputStep: 1 },\n        { driverType: 'MainCamera', label: 'Offset', value: '', inputType: 'slider', inputMin: 0, inputMax: 0, inputStep: 1 },\n      ],\n\n      MountConfigItems: [\n        { driverType: 'Mount', label: 'Flip ETA', value: '00:00:00', displayValue: '00:00:00', inputType: 'tip' },\n        { driverType: 'Mount', label: 'GotoThenSolve', value: false, inputType: 'switch' },\n\n        // { driverType: 'Mount', label: 'isAutoFlip', value: false, inputType: 'switch' },\n      ],\n\n      TelescopesConfigItems: [\n        { driverType: 'Telescopes', num: 1, label: 'Focal Length (mm)', value: '', inputType: 'number' },\n      ],\n\n      FocuserConfigItems: [\n        { driverType: 'Focuser', num: 2, label: 'Sync Focuser Step', value: '', inputType: 'text' },\n        { driverType: 'Focuser', num: 2, label: 'Min Limit', value: '', inputType: 'number' },\n        { driverType: 'Focuser', num: 2, label: 'Max Limit', value: '', inputType: 'number' },\n      ],\n\n      PoleCameraConfigItems: [\n\n      ],\n\n      CFWConfigItems: [\n\n      ],\n\n      BeforeChangeConfigItems: [],\n\n\n\n      imageData: null,\n\n      histogramImage: null,\n      histogram_min: 0,    // 直方图自动拉伸的最小值\n      histogram_max: 255,  // 直方图自动拉伸的最大值\n\n      currentHistogramMin: 0,\n      currentHistogramMax: 255,\n\n      ImageGainR: 1,\n      ImageGainB: 1,\n\n      ImageOffset: 0,\n\n      ImageCFA: 'BG',\n\n      cameraBin: 1,   // 当前相机binning\n\n      CanvasWidth: 1920,  // 主画布宽度\n      CanvasHeight: 1080, // 主画布高度\n\n      scale: 1, // 缩放比例\n      translateX: 0, // 平移x坐标\n      translateY: 0, // 平移y坐标\n      bufferCanvas: null, // 存储画布\n      bufferCtx: null, // 存储画布上下文\n      tempCanvas: null, // 临时画布\n      tempCtx: null, // 临时画布上下文\n\n      visibleWidth: 0, // 可见区域宽度\n      visibleHeight: 0, // 可见区域高度\n      visibleX: 0, // 可见区域x坐标\n      visibleY: 0, // 可见区域y坐标\n      isDragging: false, // 标记画布是否正在拖动\n      pendingScaleChange: false, // 标记画布是否正在缩放\n\n      touchStartX: 0, // 触摸开始x坐标\n      touchStartY: 0, // 触摸开始y坐标\n      startDistance: 0, // 触摸开始距离\n\n      moveIntervalId: null, // 拖动定时器\n      zoomIntervalId: null, // 缩放定时器\n\n\n      imageWidth: 0, // 图像宽度\n      imageHeight: 0, // 图像高度\n      drawImgData: null,\n      OriginalImage: null,\n      detectStarsImg: null,\n\n      isNotDrawStars: true,\n\n      mainCameraSizeX: 0,\n      mainCameraSizeY: 0,\n\n      ImageProportion: 0,\n\n      DetectedStarsList: [],\n      DetectedStarsFinish: false,\n\n      CartesianList: [],\n\n      PolarPoint_Altitude: 0,\n\n      LastPoint_AzAlt: null,\n\n      MarkCircleNum: 0,\n\n      LastCircle_RaDec: null,\n      LastCircle_AzAlt: null,\n\n      Circles: [],\n\n      // 极轴校准相关数组\n      calibrationCircles: [],  // 校准点圆圈数组\n      adjustmentCircles: [],   // 调整点圆圈数组\n      targetPointCircle: null, // 目标点圆形对象\n      fakePolarAxisCircle: null, // 假极点圆形对象\n      lastPosition: null,      // 上一次位置\n      fieldUpdateTimer: null,  // 视场更新定时器\n      fieldOfViewPolygons: [], // 存储视场多边形对象\n\n      drawer_2: null,    // 设置侧边栏的显示与隐藏\n\n      drivers: [], // 驱动选项数组\n      selectedDriver: null, // 选中的驱动\n\n      devicesList: [], // 设备选项数组\n      selectedDevice: null, // 选中的设备\n      ToBeConnectDevice: [],\n\n      loadingSelectDriver: false,\n      loadingConnectAllDevice: false,\n\n      CurrentLocationLng: 0,\n      CurrentLocationLat: 0,\n\n      histogramData: [],\n\n      ImageArrayBuffer: null,\n\n      isOpenDevicePage: false, // 设置设备页面是否打开\n      isOpenPowerPage: false, // 设置电源页面是否打开\n\n      OutPutPower_1_ON: true,\n      OutPutPower_2_ON: false,\n\n      isPolarAxisMode: false,\n\n      isTouching: false, // 标记是否正在处理触摸事件\n      ConnectBtnPressTimer: null,\n      ConnectBtnlongPressThreshold: 1000,\n      isConnectBtnLongPress: false, // 标记是否为长按\n      ConnectBtnCanClick: true,\n\n\n      haveDeviceConnect: false,\n      isConnecting: false, // 添加连接状态\n\n      disconnectTimeoutTriggered: false,\n      disconnectTimeout: null,\n\n      isDownloadingImage: false,\n      isDownloadingImageName: '',\n      isWaitingLogged: false, // 添加等待日志标志\n\n      showDisconnectDialog: false,\n      currentDisconnectDriverName: '',\n\n      enableMainCanvasClick: false, // 控制画布是否可以点击，用来移动调焦选择框和选星\n\n      lastImageProcessParams: { // 最后处理图像的参数\n        blackLevel: 0,\n        whiteLevel: 65535,\n        CFA: 'null',\n        analysis: null,\n        isColorCamera: false,\n      },\n      focuserPictureFileName: '',  // 焦距图片文件名\n      isProcessingImage: false,   // 控制是否正在处理图像\n      isFocusLoopShooting: false,  // 控制是否进行ROi循环拍摄\n      focuserROIStarsList: [],  // 用来保存ROI区域的星点列表，分别保存x,y,HFR\n      selectStarX: -1,\n      selectStarY: -1,\n      DrawSelectStarX: -1,\n      DrawSelectStarY: -1,\n      DrawSelectStarHFR: -1,\n      ROI_x: -1,    // 用来保存ROI区域的x坐标,在vue中计算\n      ROI_y: -1,    // 用来保存ROI区域的y坐标,在vue中计算\n      ROI_x_qt: -1,    // 用来保存ROI区域的x坐标,在qt中计算\n      ROI_y_qt: -1,    // 用来保存ROI区域的y坐标,在qt中计算\n      ROI_length: 300, // 用来保存ROI区域的长度\n      showSelectStar: false,\n\n      isOneTouch: false,\n      currentTouchX: [0, 0],\n      currentTouchY: [0, 0],\n      startTouchX: [0, 0],\n      startTouchY: [0, 0],\n      startTouchDistance: 0,\n\n      // 定义波特率选项\n      BaudRateItems: [\n        { label: '9600', value: 9600 },\n        { label: '19200', value: 19200 },\n        { label: '38400', value: 38400 },\n        { label: '57600', value: 57600 },\n        { label: '115200', value: 115200 },\n        { label: '230400', value: 230400 },\n      ],\n      BaudRateSelected: 9600, // 波特率选择\n      cpuTemp: null,  // CPU温度\n      cpuUsage: null, // CPU使用率\n\n      progressValue: 0,// 控制图像处理进度条的变量\n      progressDescription: '', // 控制进度条显示内容\n\n      calculateGain: true, // 控制是否计算白平衡增益\n      lutCache: {\n        lastParams: null, // 用于存储上次的参数\n        lutR: null,\n        lutG: null,\n        lutB: null\n      },\n    }\n  },\n  components: {\n    Gui,\n    GuiLoader,\n    ProgressBar,\n    // MessageBox,\n  },\n  created() {\n    this.$bus.$on('AppSendMessage', this.sendMessage);\n    this.$bus.$on('AppUpdateDevices', this.updateDevices);\n    this.$bus.$on('Switch-MainPage', this.handleButtonTestClick);\n    this.$bus.$on('HandleHistogramNum', this.applyHistStretch);\n    this.$bus.$on('ImageGainR', this.ImageGainSet);\n    this.$bus.$on('ImageGainB', this.ImageGainSet);\n    this.$bus.$on('Offset', this.ImageOffsetSet);\n    this.$bus.$on('Binning', this.BinningSet);\n    this.$bus.$on('Gain', this.GainSet);\n    this.$bus.$on('Offset', this.OffsetSet);\n    this.$bus.$on('ImageCFA', this.ImageCFASet);\n    // this.$bus.$on('MainCameraCFA', this.ImageCFASet);\n    this.$bus.$on('Temperature', this.CameraTemperatureSet);\n    this.$bus.$on('Focal Length (mm)', this.FocalLengthSet);\n    this.$bus.$on('Guider Focal Length (mm)', this.GuiderFocalLengthSet);\n    this.$bus.$on('Multi Star Guider', this.MultiStarGuiderSet);\n    this.$bus.$on('Guider Pixel size', this.GuiderPixelSizeSet);\n    this.$bus.$on('Guider Gain', this.GuiderGainSet);\n    this.$bus.$on('Calibration step (ms)', this.CalibrationDurationSet);\n    this.$bus.$on('Ra Aggression', this.RaAggressionSet);\n    this.$bus.$on('Dec Aggression', this.DecAggressionSet);\n    this.$bus.$on('Sync Focuser Step', this.SyncFocuserStep);\n    this.$bus.$on('GotoThenSolve', this.GotoThenSolve);\n    this.$bus.$on('AutoFlip', this.AutoFlipSet);\n    this.$bus.$on('WestMinutesPastMeridian', this.WestMinutesPastMeridianSet);\n    this.$bus.$on('EastMinutesPastMeridian', this.EastMinutesPastMeridianSet);\n    this.$bus.$on('ImageProportion', this.setImageProportion);\n    this.$bus.$on('MountGoto', this.lookatcircle);\n    this.$bus.$on('SwitchImageToShow', this.SwitchImageToShow);\n    this.$bus.$on('PolarPointAltitude', this.setPolarPointAltitude);\n    this.$bus.$on('showStelCanvas', this.showStelCanvas);\n    this.$bus.$on('RecalibratePolarAxis', this.RecalibratePolarAxis);\n    this.$bus.$on('CurrentExpTimeList', this.CurrentExpTimeList);\n    this.$bus.$on('disconnectAllDevice', this.disconnectAllDevice);\n    this.$bus.$on('GetConnectedDevices', this.ReturnConnectedDevices);\n    this.$bus.$on('CurrentCFWList', this.CurrentCFWList);\n    this.$bus.$on('calcWhiteBalanceGains', this.calcWhiteBalanceGains);\n    this.$bus.$on('SwitchOutPutPower', this.SwitchOutPutPower);\n    this.$bus.$on('PolarAxisMode', this.PolarAxisMode);\n    this.$bus.$on('SendConsoleLogMsg', this.SendConsoleLogMsg);\n    // this.$bus.$on('DisconnectDriverSuccess', this.disconnectDriversuccess);\n    this.$bus.$on('UnBindingDevice', this.UnBindingDevice);\n    this.$bus.$on('CloseWebView', this.QuitToMainApp)\n    this.$bus.$on('RedBoxSizeChange', this.RedBoxSizeChange);\n    this.$bus.$on('setFocuserState', this.setFocuserState);  // 设置调焦状态和进度\n    this.$bus.$on('setShowSelectStar', this.setShowSelectStar);  // 设置是否显示选择星点\n    this.$bus.$on('ScaleChange', this.ScaleChange);\n    this.$bus.$on('showCanvas', this.showCanvas);\n\n    // 极轴校准绘制相关监听器\n    this.$bus.$on('DrawCalibrationPointPolygon', this.drawCalibrationPointPolygon);\n    this.$bus.$on('ClearCalibrationPoints', this.clearCalibrationPoints);\n    this.$bus.$on('DrawAdjustmentPointsPolygon', this.drawAdjustmentPointsPolygon);\n    this.$bus.$on('DrawTargetPointCircle', this.drawTargetPointCircle);\n    this.$bus.$on('DrawFakePolarAxisCircle', this.DrawFakePolarAxisCircle)\n\n    // 校准相关事件监听器\n    this.$bus.$on('StartCalibration', this.startCalibrationProcess);\n    this.$bus.$on('UpdateCalibrationInfo', this.updateCalibrationInfo);\n    this.$bus.$on('EndCalibration', this.endCalibration);\n\n    this.memoryCheckInterval = setInterval(this.checkMemoryUsage, 30000);\n\n\n  },\n  methods: {\n    // 是否允许小数：step 不是整数，或显式允许\n    allowsDecimal(item) {\n      const step = item.step ?? 1;\n      return item.allowDecimal === true || !Number.isInteger(step) || String(step).includes('.');\n    },\n    // 是否允许负数：根据配置或 min<0 猜测\n    allowsNegative(item) {\n      return item.allowNegative === true || (typeof item.min === 'number' && item.min < 0);\n    },\n    // 移动端键盘类型\n    getInputMode(item) {\n      // 仅移动端生效；桌面忽略\n      if (!this.isMobile) return undefined;\n      // 需要小数或负数，用 decimal（更容易出现小数点/负号）\n      return this.allowsDecimal(item) || this.allowsNegative(item) ? 'decimal' : 'numeric';\n    },\n    // 配合 iOS：pattern 可影响弹出键盘与校验\n    getPattern(item) {\n      const neg = this.allowsNegative(item);\n      if (this.allowsDecimal(item)) {\n        // 允许 . 或 , 作为小数点，便于不同语言键盘\n        return neg ? '^[-]?[0-9]*([.,][0-9]*)?$' : '^[0-9]*([.,][0-9]*)?$';\n      }\n      // 整数\n      return neg ? '^[-]?[0-9]*$' : '^[0-9]*$';\n    },\n\n    numberRules(item) {\n      return [\n        v => v === '' || v === null || !isNaN(this._toNumber(v)) || '请输入数字',\n        v => item.min === undefined || this._toNumber(v) >= item.min || `最小值 ${item.min}`,\n        v => item.max === undefined || this._toNumber(v) <= item.max || `最大值 ${item.max}`,\n      ];\n    },\n\n    // 统一把逗号小数转为点，去掉多余空白\n    _toNumber(v) {\n      if (v === '' || v === null || v === undefined) return NaN;\n      if (typeof v === 'number') return v;\n      const s = String(v).trim().replace(',', '.');\n      return Number(s);\n    },\n\n    onNumberCommit(item) {\n      let v = this._toNumber(item.value);\n      if (!Number.isFinite(v)) return;\n\n      // 1) 夹取到 min/max\n      if (item.min !== undefined && v < item.min) v = item.min;\n      if (item.max !== undefined && v > item.max) v = item.max;\n\n      // 2) 按 step 对齐（以 min 或 0 为基准）\n      const step = item.step ?? 1;\n      if (step > 0) {\n        const base = (item.min !== undefined ? item.min : 0);\n        v = base + Math.round((v - base) / step) * step;\n        if (item.min !== undefined && v < item.min) v = item.min;\n        if (item.max !== undefined && v > item.max) v = item.max;\n        v = Number(v.toFixed(12)); // 去浮点误差\n      }\n\n      // 回写并通知\n      item.value = v;\n      this.handleConfigChange(item.label, v);\n    },\n    checkMemoryUsage() {\n      if (window.performance && window.performance.memory) {\n        const memoryInfo = window.performance.memory;\n        const used = Math.round(memoryInfo.usedJSHeapSize / 1048576);\n        const limit = Math.round(memoryInfo.jsHeapSizeLimit / 1048576);\n\n        // console.log(`内存使用: ${used}MB / ${limit}MB`);\n\n        if (memoryInfo.usedJSHeapSize > memoryInfo.jsHeapSizeLimit * 0.7) {\n          this.$bus.$emit('showWarning', this.$i18n.locale === 'cn' ?\n            '内存使用接近限制，请保存工作后刷新页面' :\n            'Memory usage is approaching limit. Please save your work and refresh the page.');\n\n          // 可选：尝试手动触发垃圾回收\n          if (window.gc) {\n            try { window.gc(); } catch (e) { }\n          }\n        }\n      }\n    },\n\n    formatTipValue(item) {\n      return (item && item.displayValue != null)\n        ? String(item.displayValue)\n        : (item && item.value != null ? String(item.value) : '-');\n    },\n    formatTipTitle(item) {\n      if (item && item.tooltip != null) return String(item.tooltip);\n      if (item && item.value != null) return String(item.value);\n      return '';\n    },\n    copyTip(item) {\n      const text = (item && item.value != null) ? String(item.value) : '';\n      if (!text) return;\n      if (navigator && navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(text);\n      }\n    },\n\n    // 处理星点识别结果\n    handleStarDetectionResult(detected, hfr) {\n      if (detected) {\n        this.callShowMessageBox(`星点的HFR为：${hfr}`, 'info');\n      } else {\n        this.callShowMessageBox('未识别到星点', 'warning');\n      }\n    },\n\n    // 处理自动对焦模式变化\n    handleAutoFocusModeChanged(mode, hfr) {\n      if (mode === 'coarse') {\n        this.callShowMessageBox('进入粗调模式', 'info');\n      } else if (mode === 'fine') {\n        this.callShowMessageBox('进入精调模式', 'info');\n      }\n    },\n    \n\n    preventDefault(event) {\n      event.preventDefault();\n    },\n    getLocationHostName() {\n      const hostname = window.location.hostname;\n      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      const port = window.location.protocol === 'https:' ? '8601' : '8600';\n      this.SendConsoleLogMsg('location hostname:' + hostname, 'info');\n      this.WebSocketUrl = `${protocol}//${hostname}:${port}`;\n      console.log('WebSocketUrl:', this.WebSocketUrl);\n    },\n    getQTClientVersion() {\n      this.sendMessage('Vue_Command', 'getQTClientVersion');\n    },\n    connect() {\n      // 替换为你的 WebSocket 服务器地址\n      // this.websocket = new WebSocket('ws://192.168.2.31:8600');  // process.env.VUE_APP_WEBSOCKET\n      // this.websocket = new WebSocket(process.env.VUE_APP_WEBSOCKET);\n      const wsOptions = {\n        rejectUnauthorized: false  // 禁用证书验证\n      };\n      this.websocket = new WebSocket(this.WebSocketUrl, [], wsOptions);\n\n      this.websocket.onopen = () => {\n        this.websocketState = 'connected';\n        this.networkDisconnected = false; // WebSocket连接成功时重置网络连接状态\n        if (this.disconnectTimeoutTriggered) {\n          this.callShowMessageBox('WebSocket connected', 'success');\n        }\n        this.$bus.$emit('ShowNetStatus', 'true');\n        this.StatusRecovery();\n        console.log('process.env.NODE_ENV:', process.env.NODE_ENV);\n      };\n\n      this.websocket.onmessage = (message) => {\n        // console.log('QHYCCD | Received message:', message.data);\n\n        const data = JSON.parse(message.data);\n\n        if (data.type === 'QT_Return') {\n          const parts = data.message.split(':');\n          let messageType;\n          if (parts.length > 0) {\n            messageType = parts[0];\n            // console.log('QHYCCD | 获得信息('+messageType+'):', parts);\n          }\n          else {\n            console.error('消息格式错误，无法分割:', data.message);\n            return;\n          }\n          let acceptMessage = false;\n          if (data.message.startsWith('StagingScheduleData:')) {\n            console.log('------------------------------');\n            acceptMessage = true;\n            const parts = data.message.split('[');\n\n            if (parts.length > 0) {\n              console.log('parts.length: ', parts.length);\n              this.$bus.$emit('StagingScheduleData', data.message);\n            }\n            console.log('------------------------------');\n          }\n\n          if (data.message.startsWith('SendDebugMessage|')) {\n            acceptMessage = true;\n            const parts = data.message.split('|');\n            if (parts.length === 3) {\n              const type = parts[1];\n              const message = parts[2];\n              this.$bus.$emit('SendDebugMessage', type, message);\n            }\n          }\n\n          if (!acceptMessage) {\n            switch (messageType) {\n              case 'AddDriver':\n                if (parts.length === 3) {\n                  const label = parts[1];\n                  const value = parts[2];\n                  const type = this.CurrentDriverType;\n                  // 创建一个驱动对象\n                  const driver = { type, label, value };\n\n                  // if (type === 'MainCamera' && label === \"QHY CCD2\") {\n                  //   break;\n                  // }\n                  // if (type === 'Guider' && label === \"QHY CCD\") {\n                  //   break;\n                  // }\n\n                  // 检查label是否为\"QHY CCD\"或\"QFocuser\"，如果是，则插入到数组首位\n                  if (label === \"QHY CCD\" || label === \"QFocuser\" || label === \"QHY CCD2\") {\n                    this.drivers.unshift(driver); // 将新驱动添加到数组的开始位置\n                  } else {\n                    this.drivers.push(driver); // 将新驱动添加到数组的末尾\n                  }\n                }\n                break;\n\n              case 'AddDevice':\n                if (parts.length === 2) {\n                  const label = parts[1];\n                  console.log('QHYCCD | AddDevice: ', label);\n                  // const value = parts[2];\n                  const type = this.confirmDriverType;\n                  // 创建一个驱动对象\n                  const device = { type, label, label };\n                  console.log('QHYCCD | AddDevice: ', device);\n                  // this.$bus.$emit('add-device', device);\n                  this.devicesList.push(device);\n\n                  this.ToBeConnectDevice = [];\n                  this.devicesList.forEach(devicesList => {\n                    if (devicesList.type === this.CurrentDriverType) {\n                      this.ToBeConnectDevice.push(devicesList);\n                    }\n                  });\n\n                  this.loadingSelectDriver = false;\n                }\n                break;\n\n              case 'updateDevices_':\n                if (parts.length === 3) {\n                  const ListNum = parts[1];\n                  const name = parts[2];\n                  this.updateDevices_(ListNum, name);\n                }\n                break;\n\n              case 'ConnectSuccess':\n                if (parts.length === 4) {\n                  const type = parts[1];\n                  const deviceName = parts[2];\n                  const driverName = parts[3];\n\n                  if (deviceName != '') {\n                    this.updateDevicesConnect(type, deviceName, driverName, true);\n                  } else {\n                    this.updateDevicesConnect(type, deviceName, driverName, false);\n                  }\n                }\n                break;\n\n              case 'ConnectFailed':\n                if (parts.length === 2) {\n                  const reason = parts[1];\n                  this.callShowMessageBox(reason, 'error');\n                  this.loadingConnectAllDevice = false;\n                }\n                break;\n\n              case 'ScanFailed':\n                if (parts.length === 2) {\n                  const reason = parts[1];\n                  this.callShowMessageBox(reason, 'error');\n                  this.loadingSelectDriver = false;\n                }\n                break;\n\n              case 'AddDeviceType':\n                if (parts.length === 2) {\n                  const DeviceType = parts[1];\n                  this.$bus.$emit('AddDeviceType', DeviceType);\n                }\n                break;\n\n              case 'DeviceToBeAllocated':\n                if (parts.length === 4) {\n                  const DeviceType = parts[1];\n                  const DeviceIndex = parts[2];\n                  const DeviceName = parts[3];\n                  this.$bus.$emit('DeviceToBeAllocated', DeviceIndex, DeviceName);\n                }\n                break;\n\n              case 'ShowDeviceAllocationWindow':\n                this.$bus.$emit('toggleDeviceAllocationPanel');\n                this.nav = false;\n                break;\n\n              case 'ExposureCompleted':\n                this.$bus.$emit('ExposureCompleted');\n                break;\n\n              case 'SaveJpgSuccess':\n                if (parts.length === 4) {\n                  const fileName = parts[1];\n                  const roi_x = parseInt(parts[2]);\n                  const roi_y = parseInt(parts[3]);\n                  this.ROI_x = roi_x;\n                  this.ROI_y = roi_y;\n\n                  // this.$bus.$emit('showRoiImage', fileName);\n                  this.showRoiImage(fileName, roi_x, roi_y);\n                }\n                break;\n\n              case 'SaveBinSuccess':\n                if (parts.length === 2) {\n                  const fileName = parts[1];\n                  this.readBinFile('img/' + fileName);\n                  this.DetectedStarsFinish = false;\n                }\n                break;\n\n\n              case 'SaveGuiderImageSuccess':\n                if (parts.length === 2) {\n                  const fileName = parts[1];\n                  this.loadAndDisplayImage('img/' + fileName);\n                }\n                break;\n              case 'GuideSize':\n                if (parts.length === 3) {\n                  const col = parts[1];\n                  const row = parts[2];\n                  this.$bus.$emit(\"GuideSize\", col, row);\n                }\n\n              case 'AddScatterChartData':\n                if (parts.length === 3) {\n                  const Data_x = parts[1];\n                  const Data_y = parts[2];\n                  const newDataPoint = [Data_x, Data_y];\n                  this.$bus.$emit('AddScatterChartData', newDataPoint);\n                }\n                break;\n\n              case 'AddLineChartData':\n                if (parts.length === 4) {\n                  const Data_x = parts[1];\n                  const Data_Ra = parts[2];\n                  const Data_Dec = parts[3];\n                  const newDataPoint_Ra = [Data_x, Data_Ra];\n                  const newDataPoint_Dec = [Data_x, Data_Dec];\n                  this.$bus.$emit('AddLineChartData', newDataPoint_Ra, newDataPoint_Dec);\n                }\n                break;\n\n              case 'SetLineChartRange':\n                if (parts.length === 3) {\n                  const min = parts[1];\n                  const max = parts[2];\n                  this.$bus.$emit('SetLineChartRange', min, max);\n                }\n                break;\n\n              case 'GuiderStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('GuiderStatus', status);\n                }\n                break;\n\n              case 'FocusChangeSpeedSuccess':\n                if (parts.length === 2) {\n                  const Speed = parts[1];\n                  this.$bus.$emit('FocusChangeSpeedSuccess', Speed);\n                }\n                break;\n\n\n              case 'FocusPosition':\n                if (parts.length === 3) {\n                  const CurrentPosition = parts[1];\n                  const TargetPosition = parts[2];\n                  this.$bus.$emit('FocusPosition', CurrentPosition, TargetPosition);\n                }\n                break;\n\n              case 'FocusMoveDone':\n                if (parts.length === 3) {\n                  const CurrentPosition = parts[1];\n                  const HFR = parts[2];\n                  this.$bus.$emit('UpdateHFR', CurrentPosition, HFR);\n                  this.$bus.$emit('addData_Point', CurrentPosition, HFR);\n                }\n                break;\n\n              case 'addData_Point':\n                if (parts.length === 3) {\n                  const position = parseFloat(parts[1]);\n                  const hfr = parseFloat(parts[2]);\n                  const stage = parts[3] || 'fine';\n                  \n                  if (stage === 'clear' || position === -1 || hfr === -1) {\n                    console.log('App.vue | 接收到清空数据消息');\n                    this.$bus.$emit('ClearFineData');\n                  } else {\n                    console.log('App.vue | 接收到数据点消息:', { position, hfr, stage });\n                    console.log('App.vue | 原始消息:', data.message);\n                    this.$bus.$emit('addData_Point', position, hfr);\n                  }\n                } else {\n                  console.error('App.vue | 数据点消息格式错误:', parts);\n                }\n                break;\n\n              case 'AutofocusFailed':\n                console.log('App.vue | 接收到AutofocusFailed消息');\n                this.$bus.$emit('showAutofocusFailureAlert');\n                break;\n\n              case 'addMinPointData_Point':\n                if (parts.length === 3) {\n                  const x = parseInt(parts[1]);\n                  const y = parseFloat(parts[2]);\n                  this.$bus.$emit('addMinPointData_Point', x, y);\n                }\n                break;\n              case 'addLineData_Point':\n                if (parts.length === 4) {\n                  const a = parseFloat(parts[1]);\n                  const b = parseFloat(parts[2]);\n                  const c = parseFloat(parts[3]);\n                  console.log('addLineData_Point:', a, b, c);\n                  this.$bus.$emit('addLineData_Point', a, b, c);\n                }\n                break;\n              case 'MainCameraSize':\n                if (parts.length === 3) {\n                  const SizeX = parts[1];\n                  const SizeY = parts[2];\n                  this.$bus.$emit('MainCameraSize', SizeX, SizeY);\n                  this.mainCameraSizeX = SizeX;\n                  this.mainCameraSizeY = SizeY;\n                }\n                break;\n\n              case 'MainCameraBinning':\n                if (parts.length === 2) {\n                  this.cameraBin = parseInt(parts[1]);\n                  this.MainCameraConfigItems.find(item => item.label === 'Binning').value = this.cameraBin;\n                  this.$bus.$emit('MainCameraBinning', this.cameraBin);\n                }\n                break;\n\n              case 'fitQuadraticCurve':\n                // 新的数据格式: \"fitQuadraticCurve:a:b:c:bestPosition:minHFR\"\n                console.log('App.vue | 接收到fitQuadraticCurve消息:', data.message);\n                // 使用setTimeout确保清除操作在添加数据之前完成\n                this.$bus.$emit('ClearfitQuadraticCurve');\n                setTimeout(() => {\n                  this.$bus.$emit('fitQuadraticCurve', data.message);\n                }, 10);\n                break;\n\n              case 'fitQuadraticCurve_minPoint':\n                // 新的数据格式: \"fitQuadraticCurve_minPoint:bestPosition:minHFR\"\n                console.log('App.vue | 接收到fitQuadraticCurve_minPoint消息:', data.message);\n                this.$bus.$emit('fitQuadraticCurve_minPoint', data.message);\n                break;\n\n\n              case 'TelescopePark':\n                if (parts.length === 2) {\n                  const Switch = parts[1];\n                  this.$bus.$emit('MountParkSwitch', Switch);\n                }\n                break;\n\n              case 'TelescopeTrack':\n                if (parts.length === 2) {\n                  const Switch = parts[1];\n                  this.$bus.$emit('MountTrackSwitch', Switch);\n                }\n                break;\n\n              case 'MountSetSpeedSuccess':\n                if (parts.length === 2) {\n                  const num = parts[1];\n                  this.$bus.$emit('newMountSlewRate', num);\n                }\n                break;\n\n\n              case 'TelescopePierSide':\n                if (parts.length === 2) {\n                  const Side = parts[1];\n                  this.$bus.$emit('updateMountPierSide', Side);\n                }\n                break;\n\n              case 'TelescopeTotalSlewRate':\n                if (parts.length === 2) {\n                  const num = parts[1];\n                  this.$bus.$emit('MountTotalSlewRate', num);\n                }\n                break;\n\n\n              case 'UpdateScheduleProcess':\n                if (parts.length === 3) {\n                  const RowNum = parts[1];\n                  const Process = parts[2];\n                  this.$bus.$emit('UpdateScheduleProcess', RowNum, Process);\n                }\n                break;\n\n              case 'ExpTimeList':\n                if (parts.length === 2) {\n                  this.$bus.$emit('initExpTimeList', parts[1]);\n                }\n                break;\n\n\n              case 'CameraInExposuring':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('CameraInExposuring', status);\n                }\n                break;\n\n              case 'AutoFocusOver':\n                if (parts.length >= 4) {\n                  // 新格式: AutoFocusOver:success:bestPosition:minHFR\n                  const success = parts[1] === 'true';\n                  const bestPosition = parseFloat(parts[2]);\n                  const minHFR = parseFloat(parts[3]);\n                  this.$bus.$emit('AutoFocusOver', success, bestPosition, minHFR);\n                } else {\n                  // 兼容旧格式: AutoFocusOver\n                  this.$bus.$emit('AutoFocusOver');\n                }\n                break;\n\n              case 'StarDetectionResult':\n                if (parts.length === 3) {\n                  const detected = parts[1] === 'true';\n                  const hfr = parseFloat(parts[2]);\n                  this.handleStarDetectionResult(detected, hfr);\n                }\n                break;\n\n              case 'AutoFocusModeChanged':\n                if (parts.length === 3) {\n                  const mode = parts[1];\n                  const hfr = parseFloat(parts[2]);\n                  this.handleAutoFocusModeChanged(mode, hfr);\n                }\n                break;\n\n              case 'CFWPositionMax':\n                if (parts.length === 2) {\n                  this.$bus.$emit('SetCFWPositionMax', parts[1]);\n\n                  for (let i = 1; i <= parts[1]; i++) {\n                    this.CFWConfigItems.push({ driverType: 'CFW', label: `CFW [${i}]`, value: '', inputType: 'text' });\n                  }\n\n                  this.$bus.$emit('AppSendMessage', 'Vue_Command', 'getCFWList');\n                }\n                break;\n\n\n              case 'SetCFWPositionSuccess':\n                if (parts.length === 2) {\n                  this.$bus.$emit('SetCFWPositionSuccess', parts[1]);\n                }\n                break;\n\n              case 'getCFWList':\n                if (parts.length === 2) {\n                  this.$bus.$emit('initCFWList', parts[1]);\n                }\n                break;\n\n              case 'GuiderSwitchStatus':\n                if (parts.length === 2) {\n                  this.$bus.$emit('GuiderSwitchStatus', parts[1]);\n                }\n                break;\n\n              case 'GuiderLoopExpStatus':\n                if (parts.length === 2) {\n                  this.$bus.$emit('GuiderLoopExpStatus', parts[1]);\n                }\n                break;\n\n              case 'TelescopeRADEC':\n                if (parts.length === 3) {\n                  this.UpdateCirclePos(parts[1], parts[2]);\n                  this.$bus.$emit('updateCurrentLocation', parts[1], parts[2]);\n                }\n                break;\n\n\n              case 'TelescopeStatus':\n                if (parts.length === 2) {\n                  this.UpdateTelescopeStatus(parts[1]);\n                }\n                break;\n\n              case 'MainCameraStatus':\n                if (parts.length === 2) {\n                  this.UpdateMainCameraStatus(parts[1]);\n                }\n                break;\n\n\n              case 'MainCameraTemperature':\n                if (parts.length === 2) {\n                  this.UpdateMainCameraTemperature(parts[1]);\n                }\n                break;\n\n\n              case 'ShowAllImageFolder':\n                if (parts.length === 3) {\n                  this.$bus.$emit('ShowAllImageFolder', parts[1], parts[2]);\n                }\n                break;\n\n\n              case 'ImageFilesName':\n                if (parts.length === 2) {\n                  this.$bus.$emit('ImageFilesName', parts[1]);\n                }\n                break;\n\n\n              case 'USBCheck':\n                if (parts.length === 2) {\n                  const USBdata = parts[1].split(',');\n                  console.log('USB name: ', USBdata[0]);\n                  console.log('USB space: ', USBdata[1]);\n                  this.SendConsoleLogMsg('USB name:' + USBdata[0], 'info');\n                  this.SendConsoleLogMsg('USB space:' + USBdata[1], 'info');\n\n                  this.$bus.$emit('USB_Name_Sapce', USBdata[0], USBdata[1]);\n                }\n                break;\n\n              case 'ImageSaveErroe':\n                if (parts.length === 2) {\n                  const Erroe = parts[1];\n                  if (Erroe === 'USB-Null') {\n                    this.callShowMessageBox('No USB Drive Detected.', 'error');\n                  } else if (Erroe === 'USB-Multiple') {\n                    this.callShowMessageBox('Multiple USB drives detected, please remove excess USB drives.', 'error');\n                  }\n                }\n                break;\n\n              case 'DetectedStars':\n                console.log('Detected', parts.length, 'stars.');\n                this.SendConsoleLogMsg('Detected ' + parts.length + ' stars.', 'info');\n                this.DetectedStarsList = [];\n                for (let i = 0; i < parts.length; i++) {\n                  const a = parts[i];\n                  const b = a.split('|');\n                  if (b.length === 3) {\n                    const x = b[0];\n                    const y = b[1];\n                    const hfr = b[2];\n                    // console.log('Stars at(', x, ',', y, ') with HFR:', hfr);\n                    this.DetectedStarsList.push({ x: x, y: y, hfr: hfr });\n                  }\n                }\n                this.DetectedStarsFinish = true;\n                break;\n\n              case 'SolveImageResult':\n                if (parts.length === 5) {\n                  // this.UpdateCirclePos(parts[1], parts[2]);\n                  console.log('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):', parts[1], ',', parts[2], ',', parts[3], ',', parts[4]);\n                  this.SendConsoleLogMsg('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):' + parts[1] + ',' + parts[2] + ',' + parts[3] + ',' + parts[4], 'info');\n                  this.SolveResultMark(parts[1], parts[2], parts[3], parts[4]);\n                  this.$bus.$emit(\"ImageSolveFinished\", true);\n                  this.$bus.$emit('setParsingProgress', false);\n                }\n                break;\n\n              case 'SolveFovResult':\n                if (parts.length === 9) {\n                  const RaDec = [\n                    { Ra: parts[1], Dec: parts[2] },\n                    { Ra: parts[3], Dec: parts[4] },\n                    { Ra: parts[5], Dec: parts[6] },\n                    { Ra: parts[7], Dec: parts[8] },\n                  ];\n                  this.SolveFovMark(RaDec);\n                }\n                break;\n\n              case 'RealTimeSolveImageResult':\n                if (parts.length === 5) {\n                  console.log('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):', parts[1], ',', parts[2], ',', parts[3], ',', parts[4]);\n                  this.SendConsoleLogMsg('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):' + parts[1] + ',' + parts[2] + ',' + parts[3] + ',' + parts[4], 'info');\n                  const result = this.SolveResultMark_RealTime(parts[1], parts[2], parts[3], parts[4])\n                }\n                break;\n\n              case 'SolveImageSucceeded':\n                console.log('解析同步成功');\n                this.$bus.$emit(\"handleOperationComplete\", \"solve\");\n                this.$bus.$emit('showMsgBox', 'Solve image succeed!', 'success');\n                break;\n\n              case 'SolveImagefailed':\n                this.callShowMessageBox('Solve image faild...', 'error');\n                this.$bus.$emit(\"ImageSolveFinished\", false);\n                this.$bus.$emit('setParsingProgress', false);\n                this.$bus.$emit('MountOperationComplete', 'solve');\n                break;\n\n              case 'MainCameraOffsetRange':\n                if (parts.length === 3) {\n                  console.log('MainCameraOffsetRange:', parts[1], ',', parts[2]);\n                  this.SendConsoleLogMsg('MainCameraOffsetRange:' + parts[1] + ',' + parts[2], 'info');\n                  this.MainCameraOffsetMin = parts[1];\n                  this.MainCameraOffsetMax = parts[2];\n\n                  const OffsetItem = this.MainCameraConfigItems.find(item => item.label === 'Offset');\n                  if (OffsetItem) {\n                    console.log('MainCameraOffsetRange:', parseInt(this.MainCameraOffsetMin, 10), ',', parseInt(this.MainCameraOffsetMax, 10));\n                    OffsetItem.inputMin = parseInt(this.MainCameraOffsetMin, 10);\n                    OffsetItem.inputMax = parseInt(this.MainCameraOffsetMax, 10);\n                  }\n                }\n                break;\n\n              case 'MainCameraGainRange':\n                if (parts.length === 3) {\n                  console.log('MainCameraGainRange:', parts[1], ',', parts[2]);\n                  this.SendConsoleLogMsg('MainCameraGainRange:' + parts[1] + ',' + parts[2], 'info');\n                  this.MainCameraGainMin = parts[1];\n                  this.MainCameraGainMax = parts[2];\n\n                  const gainItem = this.MainCameraConfigItems.find(item => item.label === 'Gain');\n                  if (gainItem) {\n                    console.log('MainCameraGainRange:', parseInt(this.MainCameraGainMin, 10), ',', parseInt(this.MainCameraGainMax, 10));\n                    gainItem.inputMin = parseInt(this.MainCameraGainMin, 10);\n                    gainItem.inputMax = parseInt(this.MainCameraGainMax, 10);\n                  }\n                }\n                break;\n\n              case 'OutputPowerStatus':\n                if (parts.length === 3) {\n                  const index = parseInt(parts[1], 10);\n                  const value = parseInt(parts[2], 10);\n\n                  if (index === 1) {\n                    this.OutPutPower_1_ON = value === 1;\n                  } else if (index === 2) {\n                    this.OutPutPower_2_ON = value === 1;\n                  }\n                }\n                break;\n\n              case 'PHD2StarBoxView':\n                if (parts.length === 2) {\n                  const view = parts[1];\n                  this.$bus.$emit('PHD2StarBoxView', view);\n                }\n                break;\n\n              case 'PHD2StarCrossView':\n                if (parts.length === 2) {\n                  const view = parts[1];\n                  this.$bus.$emit('PHD2StarCrossView', view);\n                }\n                break;\n\n              case 'PHD2StarBoxPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Box_X = parseInt(parts[3], 10);\n                  const Box_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2Box(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y);\n                }\n                break;\n\n              case 'PHD2MultiStarsPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Box_X = parseInt(parts[3], 10);\n                  const Box_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2MultiStars(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y);\n                }\n                break;\n\n              case 'ClearPHD2MultiStars':\n                this.$bus.$emit('ClearPHD2MultiStars');\n                break;\n\n              case 'PHD2StarCrossPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Cross_X = parseInt(parts[3], 10);\n                  const Cross_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2Cross(PHD2ImageSize_X, PHD2ImageSize_Y, Cross_X, Cross_Y);\n                }\n                break;\n\n              case 'QTClientVersion':\n                if (parts.length === 2) {\n                  this.QTClientVersion = parts[1];\n                }\n                break;\n\n\n              case 'CaptureImageSaveStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  if (status === 'Repeat') {\n                    this.callShowMessageBox(this.$t('There is no need to save it again'), 'error');\n                  } else if (status === 'Success') {\n                    this.callShowMessageBox(this.$t('Image saved successfully'), 'success');\n                  } else if (status === 'Null') {\n                    this.callShowMessageBox(this.$t('No images to save'), 'error');\n                  }\n                }\n                break;\n\n              case 'INDIServerDebug':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('INDIServerDebug', message);\n                }\n                break;\n\n              case 'HotspotName':\n                if (parts.length === 2) {\n                  const Name = parts[1];\n                  this.$bus.$emit('HotspotName', Name);\n                }\n                break;\n              case 'EditHotspotNameSuccess':\n                this.$bus.$emit('EditHotspotNameSuccess');\n                break;\n\n              case 'DSLRsSetup':\n                if (parts.length === 2) {\n                  const Name = parts[1];\n                  this.$bus.$emit('ShowDSLRsSetup', Name);\n                }\n                break;\n\n              case 'ConfigureRecovery':\n                if (parts.length === 3) {\n                  const ConfigName = parts[1];\n                  const ConfigValue = parts[2];\n                  console.log('Configure:', ConfigName, ',', ConfigValue);\n                  this.SendConsoleLogMsg('Configure Recovery:' + parts[1] + ',' + parts[2], 'info');\n                  this.$bus.$emit(ConfigName, ConfigValue);\n\n                  if (parts[1] === 'FocalLength') {\n                    this.TelescopesConfigItems[0].value = parts[2];\n                    for (const device of this.devices) {\n                      if (device.driverType === 'Telescopes') {\n                        if (parts[2] === '' || parts[2] === NaN) {\n                          device.device = '';\n                          device.isConnected = false;\n                        } else {\n                          device.device = parts[2] + ' mm';\n                          device.isConnected = true;\n                        }\n                      }\n                    }\n                  }\n\n                  if (parts[1] === 'GuiderFocalLength') {\n                    this.GuiderConfigItems[0].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderFocalLength:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'Coordinates') {\n                    const [latStr, lngStr, isAutoStr] = parts[2].split(',').map(item => item.trim());\n                    const lat = parseFloat(latStr);\n                    const lng = parseFloat(lngStr);\n                    const isAuto = isAutoStr === 'true' || isAutoStr === '1';\n                    this.SetCurrentLocation(lat, lng, isAuto);\n                  }\n\n                  if (parts[1] === 'MultiStarGuider') {\n                    this.GuiderConfigItems[1].value = (parts[2] === 'true');\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'MultiStarGuider:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'GuiderGain') {\n                    this.GuiderConfigItems[2].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderGain:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'CalibrationDuration') {\n                    this.GuiderConfigItems[3].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'CalibrationDuration:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'RaAggression') {\n                    this.GuiderConfigItems[4].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'RaAggression:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'DecAggression') {\n                    this.GuiderConfigItems[5].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DecAggression:' + parts[2]);\n                  }\n                }\n                break;\n\n\n              case 'ConnectDriverSuccess':\n                if (parts.length === 2) {\n                  const device = parts[1];\n                  this.connectDriverSuccess(device);\n                }\n                break;\n\n              case 'ConnectDriverFailed':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.connectDriverFailed(message);\n                }\n                break;\n\n              case 'DisconnectDriverSuccess':\n                if (parts.length === 2) {\n                  const device = parts[1];\n                  this.disconnectDriversuccess(device);\n                }\n                break;\n\n              case 'DisconnectDriverFail':\n                if (parts.length === 2) {\n                  const driver = parts[1];\n                  this.disconnectDriverFail(device)\n                }\n\n              case 'SelectedDriverList':\n                if (parts.length >= 3) {\n                  const deviceObjects = parts.slice(1).reduce((acc, part, index, array) => {\n                    if (index % 2 === 0) {\n                      acc.push({ [array[index]]: array[index + 1] });\n                    }\n                    return acc;\n                  }, []);\n                  this.loadSelectedDriverList(deviceObjects);\n                }\n                break;\n\n\n              case 'BindDeviceList':\n                if (parts.length >= 3) {\n                  const deviceObjects = parts.slice(1).reduce((acc, part, index, array) => {\n                    if (index % 2 === 0) {\n                      acc.push({ [array[index]]: array[index + 1] });\n                    }\n                    return acc;\n                  }, []);\n                  this.loadBindDeviceList(deviceObjects);\n                }\n                break;\n\n\n              case 'BindDeviceTypeList':\n                if (parts.length >= 5) { // 确保至少有五个参数加上前缀\n                  const deviceTypeObjects = [];\n                  for (let i = 1; i < parts.length; i += 4) {\n                    const deviceTypeObject = {\n                      Type: parts[i],\n                      DeviceName: parts[i + 1],\n                      DriverName: parts[i + 2],\n                      isbind: parts[i + 3] == \"true\" ? true : false,\n                    };\n                    deviceTypeObjects.push(deviceTypeObject);\n                  }\n                  this.loadBindDeviceTypeList(deviceTypeObjects);\n                }\n                break;\n\n              case 'deleteDeviceAllocationList':\n                if (parts.length === 2) {\n                  const deviceName = parts[1];\n                  this.deleteDeviceAllocationList(deviceName);\n                }\n                break;\n\n              case 'deleteDeviceTypeAllocationList':\n                if (parts.length === 2) {\n                  const deviceType = parts[1];\n                  if (deviceType != '') {\n                    this.$bus.$emit('deleteDeviceTypeAllocationList', deviceType);\n                  }\n                  if (deviceType == 'CFW') {\n                    for (let i = 0; i < this.devices.length; i++) {\n                      if (this.devices[i].driverType == 'CFW') {\n                        this.devices[i].isConnected = false;\n                        this.devices[i].device = '';\n                        this.devices[i].driverName = '';\n                        this.devices[i].BaudRate = 9600;\n                        this.$bus.$emit('CFWConnected', 0);\n                      }\n                    }\n                  }\n                }\n                break;\n\n              case 'ParseInfoEmitted':\n                if (parts.length === 2) {\n                  const progress = parts[1];\n                  this.$bus.$emit('ParseInfoEmitted', progress);\n                }\n                break;\n\n              case 'GuiderUpdateStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('GuiderUpdateStatus', parseInt(status, 10));\n                }\n                break;\n\n              case 'LoopSolveImageFinished':\n                this.$bus.$emit('LoopSolveImageFinished');\n                break;\n\n              case 'disconnectDevicehasortherdevice':\n                if (parts.length === 2) {\n                  const drivername = parts[1];\n                  this.showSelectdisconnectDriver(drivername);\n                }\n                break;\n\n              case 'getFocuserMoveState':\n                this.$bus.$emit('getFocuserMoveState');\n                break;\n\n              case 'FocusMoveToLimit':\n                if (parts.length === 2) {\n                  const errorlog = parts[1];\n                  this.callShowMessageBox(errorlog, 'error');\n                }\n                break;\n\n              case 'startFocusLoopFailed':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('startFocusLoopFailed', message);\n                }\n                break;\n\n              case 'setFocuserLoopingState':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('setFocuserLoopingState', message);\n                  if (message == 'true') {\n                    this.isFocusLoopShooting = true;\n                  } else {\n                    this.isFocusLoopShooting = false;\n                  }\n                }\n                break;\n\n              case 'focuserROIStarsList':\n                if (parts.length === 4) {\n                  const x = parts[1];\n                  const y = parts[2];\n                  const HFR = parts[3];\n                  this.focuserROIStarsList.push({ x, y, HFR });\n                }\n                break;\n\n              // case 'clearFocuserROIStarsList':\n              //   this.focuserROIStarsList = [];\n              //   break;\n\n              case 'setSelectStarPosition':\n                if (parts.length === 4) {\n                  this.DrawSelectStarX = parseFloat(parts[1]);\n                  this.DrawSelectStarY = parseFloat(parts[2]);\n                  this.DrawSelectStarHFR = parseFloat(parts[3]);\n                }\n                break;\n\n              case 'SetRedBoxState':\n                if (parts.length === 4) {\n                  const length = parseInt(parts[1]);\n                  this.ROI_x = parseFloat(parts[2]);\n                  this.ROI_y = parseFloat(parts[3]);\n\n                  this.setRedBoxState(length, this.ROI_x, this.ROI_y);\n                  console.log('设置红色ROI框: ', length, this.ROI_x, this.ROI_y);\n                }\n                break;\n\n              case 'SetVisibleArea':\n                if (parts.length === 4) {\n                  this.visibleX = parseFloat(parts[1]);\n                  this.visibleY = parseFloat(parts[2]);\n                  this.scale = parseFloat(parts[3]);\n                  this.$bus.$emit('setScale', this.scale);\n                  console.log('设置可见区域: ', this.visibleX, this.visibleY, this.scale);\n                  this.SendConsoleLogMsg('update VisibleArea x=' + this.visibleX + ', y=' + this.visibleY + ', scale=' + this.scale, 'info');\n                }\n                break;\n\n              case 'SetSelectStars':\n                if (parts.length === 3) {\n                  this.selectStarX = parseFloat(parts[1]);\n                  this.selectStarY = parseFloat(parts[2]);\n                  this.SendConsoleLogMsg('update SelectStars x=' + this.selectStarX + ', y=' + this.selectStarY, 'info');\n                }\n                break;\n\n              case 'updateCPUInfo':\n                if (parts.length === 3) {\n                  let cpuTemp = parseFloat(parts[1]);\n                  let cpuUsage = parseFloat(parts[2]);\n                  this.cpuTemp = isNaN(cpuTemp) ? null : (cpuTemp % 1 === 0 ? cpuTemp : cpuTemp.toFixed(1));  // 如果 cpuTemp 是 NaN，设置为 null，否则如果 cpuTemp 是整数，就不保留小数，否则保留一位小数\n                  this.cpuUsage = isNaN(cpuUsage) ? null : (cpuUsage % 1 === 0 ? cpuUsage : cpuUsage.toFixed(1));  // 如果 cpuUsage 是 NaN，设置为 null，否则如果 cpuUsage 是整数，就不保留小数，否则保留一位小数\n                  this.$bus.$emit('updateCPUInfo', this.cpuTemp, this.cpuUsage);\n                }\n                break;\n\n              case 'TianWen':\n                if (parts.length === 4) {\n                  const notice_type = parts[1];\n                  const ra = parts[2];\n                  const dec = parts[3];\n                  this.$bus.$emit('TianWen', notice_type, ra, dec);\n                }\n                break;\n\n              case 'setMainCameraParameters':\n                if (parts.length >= 3) {\n                  let parameters = {};\n                  for (let i = 1; i < parts.length; i += 2) {\n                    const parameter = parts[i];\n                    const value = parts[i + 1];\n                    parameters[parameter] = value;\n                  }\n                  this.setMainCameraParameters(parameters);\n                }\n                break;\n\n              case 'localMessage':\n                if (parts.length === 4) {\n                  const lat = parts[1];\n                  const lon = parts[2];\n                  const language = parts[3];\n                  this.SendConsoleLogMsg('2------------获得参数设置localMessage: ' + lat + ',' + lon + ',' + language, 'info');\n                  if (language == 'zh') {\n                    this.$bus.$emit('ClientLanguage', 'cn');\n                  } else {\n                    this.$bus.$emit('ClientLanguage', 'en');\n                  }\n                  this.$bus.$emit('setLocationLatAndLon', lat, lon);\n                }\n                break;\n\n              case 'isAutoLocation':\n                if (parts.length === 2) {\n                  const isAutoLocation = parts[1];\n                  this.$bus.$emit('isAutoLocation', isAutoLocation);\n                }\n                break;\n\n              case 'sendGetLocation':\n                if (parts.length === 3) {\n                  const lat = parts[1];\n                  const lon = parts[2];\n                  this.SendConsoleLogMsg('sendGetLocation: ' + lat + ',' + lon, 'info');\n                  this.$bus.$emit('sendGetLocation', lat, lon);\n                }\n                break;\n\n              case 'MainCameraCFA':\n                if (parts.length === 2) {\n                  let value = parts[1];\n                  if (value === '') {\n                    value = 'null';\n                  } else if (value === 'GRBG') {\n                    value = 'GR';\n                  } else if (value === 'GBRG') {\n                    value = 'GB';\n                  } else if (value === 'BGGR') {\n                    value = 'BG';\n                  } else if (value === 'RG') {\n                    value = 'RGGB';\n                  }\n                  this.ImageCFA = value;\n                  console.log(\"获取到的主相机参数  MainCameraCFA: \", this.ImageCFA);\n                  this.MainCameraConfigItems.find(item => item.label === 'ImageCFA').value = this.ImageCFA;\n                }\n                break;\n\n              case 'CameraNotIdle':\n                this.callShowMessageBox('Camera is not idle', 'error');\n                this.$bus.$emit('MountOperationComplete', 'solve');\n                break;\n\n              case 'MainCameraNotConnect':\n                this.callShowMessageBox('Main Camera is not connect', 'error');\n                this.$bus.$emit('MountOperationComplete', 'solve');\n                break;\n              case 'ServerInitSuccess':\n                this.callShowMessageBox('Server init success', 'success');\n                window.location.reload();\n                break;\n              case 'PolarAlignmentState':\n                if (parts.length === 4) {\n                  const state = parts[1];\n                  const message = parts[2];\n                  const percentage = parts[3];\n                  this.$bus.$emit('PolarAlignmentState', state, message, percentage);\n                }\n                break;\n              case 'PolarAlignmentAdjustmentGuideData':\n                if (parts.length === 21) {  // 从17改为21\n                  const ra = parseFloat(parts[1]);\n                  const dec = parseFloat(parts[2]);\n                  // 新增：四个角点\n                  const ra0 = parseFloat(parts[3]);\n                  const dec0 = parseFloat(parts[4]);\n                  const ra1 = parseFloat(parts[5]);\n                  const dec1 = parseFloat(parts[6]);\n                  const ra2 = parseFloat(parts[7]);\n                  const dec2 = parseFloat(parts[8]);\n                  const ra3 = parseFloat(parts[9]);\n                  const dec3 = parseFloat(parts[10]);\n\n                  const targetra = parseFloat(parts[11]);\n                  const targetdec = parseFloat(parts[12]);\n                  const offsetra = parseFloat(parts[13]);\n                  const offsetdec = parseFloat(parts[14]);\n                  const adjustmentra = parts[15];\n                  const adjustmentdec = parts[16];\n                  const fakePolarRA = parseFloat(parts[17]);\n                  const fakePolarDEC = parseFloat(parts[18]);\n                  const realPolarRA = parseFloat(parts[19]);\n                  const realPolarDEC = parseFloat(parts[20]);\n\n\n                  // console.log('自动对焦绘制数据: ', ra, dec, targetra, targetdec, fakePolarRA, fakePolarDEC, realPolarRA, realPolarDEC);\n                  console.log('四角点数据: ', ra0, dec0, ra1, dec1, ra2, dec2, ra3, dec3);\n\n                  // 现有事件保持不变（使用计算的max/min值兼容）\n                  this.$bus.$emit('FieldDataUpdate', [ra, dec, ra0, dec0, ra1, dec1, ra2, dec2, ra3, dec3, targetra, targetdec, fakePolarRA, fakePolarDEC, realPolarRA, realPolarDEC]);\n\n                  // console.log('自动对焦显示更新数据: ', offsetra, offsetdec, adjustmentra, adjustmentdec);\n                  this.$bus.$emit('updateCardInfo', ra, dec, targetra, targetdec, offsetra, offsetdec, adjustmentra, adjustmentdec, \"deg\");\n\n                }\n                break;\n\n              case 'focusMoveFailed':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.callShowMessageBox(message, 'error');\n                  this.$bus.$emit('focusMoveFailed', message);\n                }\n\n              case 'focusMoveFailed':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.callShowMessageBox(message, 'error');\n                  this.$bus.$emit('focusMoveFailed', message);\n                }\n                break;\n\n              case 'MeridianETA_hms': {\n                if (parts.length >= 4) {\n                  const h = parts[1];\n                  const m = parts[2];\n                  const s = parts[3];\n\n                  const hms = `${h}:${m}:${s}`;\n                  const item = this.MountConfigItems.find(i => i.label === 'Flip ETA');\n                  if (item) {\n                    item.value = hms;\n                    item.displayValue = hms;\n                  }\n                }\n                break;\n              }\n\n              case 'AutoFlip':\n                if (parts.length >= 2) {\n                  const isAutoFlip = parts[1];\n                  // 查找是否已存在 \"AutoFlip\" 项\n                  let item = this.MountConfigItems.find(i => i.label === 'AutoFlip');\n                  if (item) {\n                    // 已存在 → 更新\n                    item.value = isAutoFlip == 'true';\n                  } else {\n                    // 不存在 → 新增\n                    this.MountConfigItems.push({ driverType: 'Mount', label: 'AutoFlip', value: isAutoFlip == 'true', inputType: 'switch' },);\n                  }\n                }\n                break;\n\n              // case 'MinutesPastMeridian':\n              //   if (parts.length >= 3) {\n              //     const EastMinutesPastMeridian = parts[1];\n              //     const WestMinutesPastMeridian = parts[2];\n              //     let item = this.MountConfigItems.find(i => i.label === 'EastMinutesPastMeridian');\n              //     if (item) {\n              //       item.value = EastMinutesPastMeridian;\n              //     } else {\n              //       this.MountConfigItems.push({ driverType: 'Mount', label: 'EastMinutesPastMeridian', value: EastMinutesPastMeridian,min:-180,max:180, inputType: 'number' },);\n              //     }\n              //     item = this.MountConfigItems.find(i => i.label === 'WestMinutesPastMeridian');\n              //     if (item) {\n              //       item.value = WestMinutesPastMeridian;\n              //     } else {\n              //       this.MountConfigItems.push({ driverType: 'Mount', label: 'WestMinutesPastMeridian', value: WestMinutesPastMeridian,min:-180,max:180, inputType: 'number' },);\n              //     }\n              //   }\n              //   break;\n              case 'EastMinutesPastMeridian':\n                if (parts.length === 2) {\n                  const EastMinutesPastMeridian = parts[1];\n                  let item = this.MountConfigItems.find(i => i.label === 'EastMinutesPastMeridian');\n                  if (item) {\n                    item.value = EastMinutesPastMeridian;\n                  } else {\n                    this.MountConfigItems.push({ driverType: 'Mount', label: 'EastMinutesPastMeridian', value: EastMinutesPastMeridian, min: -180, max: 180, inputType: 'number' },);\n                  }\n                }\n                break;\n              case 'WestMinutesPastMeridian':\n                if (parts.length === 2) {\n                  const WestMinutesPastMeridian = parts[1];\n                  let item = this.MountConfigItems.find(i => i.label === 'WestMinutesPastMeridian');\n                  if (item) {\n                    item.value = WestMinutesPastMeridian;\n                  } else {\n                    this.MountConfigItems.push({ driverType: 'Mount', label: 'WestMinutesPastMeridian', value: WestMinutesPastMeridian, min: -180, max: 180, inputType: 'number' },);\n                  }\n                }\n                break;\n              case 'GotoThenSolve':\n                if (parts.length === 2) {\n                  const GotoThenSolve = parts[1];\n                  let item = this.MountConfigItems.find(i => i.label === 'GotoThenSolve');\n                  if (item) {\n                    item.value = GotoThenSolve;\n                  }\n                }\n                break;\n\n              case 'addFwhmNow':\n                if (parts.length >= 2) {\n                  const fwhm = parseFloat(parts[1]);\n                  console.log('Received addFwhmNow:', fwhm);\n                  this.$bus.$emit('addFwhmNow', fwhm);\n                }\n                break;\n\n              default:\n                console.warn('未处理命令: ', data.message);\n                break;\n            }\n          }\n        }\n        else if (data.type === 'QT_Confirm') {\n          // 处理确认消息\n          const messageId = data.msgid;\n          this.handleMessageResponse(messageId);\n        } else if (data.type === 'Process_Command') {\n          console.log('Process_Command: ', data.message);\n          // 处理返回消息\n          const parts = data.message.split(':');\n          if (parts[0] === 'qtServerIsOver') {\n            this.callShowMessageBox('QT Server is over', 'error');\n            this.ShowConfirmDialog('restart', 'QT server encountered a segmentation fault or is frozen, please restart or exit!', 'restartQtServer');\n          }\n          else if (parts[0] === 'checkHasNewUpdatePack') {\n            if (parts.length === 2) {\n              const version = parts[1];\n              this.SendConsoleLogMsg('获取到更新包版本: ' + version, 'info');\n\n              this.ShowConfirmDialog('ForceUpdate', this.$t('checkHasNewUpdatePack') + ': ' + version + '，' + this.$t('updateConfirm'), 'updateCurrentClient:' + version);\n            }\n          }\n          else if (parts[0] === 'No_update_pack_found') {\n            this.callShowMessageBox(this.$t('No_update_pack_found'), 'error');\n          } else if (parts[0] === 'update_progress') {\n            this.$bus.$emit('update_progress', data.message);\n          } else if (parts[0] === 'update_error') {\n            this.$bus.$emit('update_error', data.message);\n          } else if (parts[0] === 'update_success') {\n            this.$bus.$emit('update_success', data.message);\n          } else if (parts[0] === 'testQtServerProcess') {\n\n          }\n          else {\n            console.warn('未处理命令: ', data.message);\n          }\n        }\n\n        this.receivedMessages.push(data.message); // 将接收到的消息添加到数组中\n      };\n\n      this.websocket.onerror = (error) => {\n        const errorDetails = {\n          type: error.type,\n          timestamp: new Date().toISOString(),\n          url: this.WebSocketUrl,\n          readyState: this.websocket.readyState,\n          protocol: this.websocket.protocol,\n          extensions: this.websocket.extensions\n        };\n        console.error('WebSocket Error Details:', errorDetails);\n        this.SendConsoleLogMsg('WebSocket Error: ' + JSON.stringify(errorDetails), 'error');\n        this.websocketState = 'error';\n        this.networkDisconnected = true;\n      };\n\n      this.websocket.onclose = () => {\n        console.log('QHYCCD | WebSocket disconnected');\n        this.websocketState = 'disconnected';\n        this.networkDisconnected = true; // WebSocket连接关闭时设置网络连接状态\n        console.log('QHYCCD | WebSocket disconnected');\n        this.$bus.$emit('ShowNetStatus', 'false');\n\n        // 设置一个定时器，1秒后检查网络状态\n        this.disconnectTimeout = setTimeout(() => {\n          if (this.networkDisconnected) { // 如果1秒后仍然断开\n            this.callShowMessageBox('WebSocket disconnected', 'error');\n            this.disconnectTimeoutTriggered = true;\n          }\n        }, 1000); // 1秒后执行\n\n        // 启动自动重连\n        this.reconnectWebSocket();\n      };\n    },\n\n    // 自动重连\n    reconnectWebSocket() {\n      setTimeout(() => {\n        console.log('QHYCCD | WebSocket reconnected');\n        this.SendConsoleLogMsg('WebSocket reconnected.', 'info');\n        this.connect();\n      }, 2000); // 2秒后尝试重新连接\n    },\n    // 自动重连\n\n    //监听网络连接状态\n    setupNetworkStatusListener() {\n      window.addEventListener('online', () => {\n        // 检查断开连接的定时器是否已经触发\n        if (this.disconnectTimeoutTriggered) {\n          this.callShowMessageBox('WebSocket connected', 'success');\n        }\n        clearTimeout(this.disconnectTimeout); // 清除断开连接的定时器\n        this.networkDisconnected = false; // 网络恢复时重置网络连接状态\n        this.$bus.$emit('ShowNetStatus', 'true');\n        this.StatusRecovery();\n        this.reconnectWebSocket(); // 网络恢复后自动重连WebSocket\n      });\n\n      window.addEventListener('offline', () => {\n        this.networkDisconnected = true; // 网络断开时设置网络连接状态\n        this.$bus.$emit('ShowNetStatus', 'false');\n        this.disconnectTimeoutTriggered = false; // 初始化断开连接定时器触发标志\n        // 设置一个定时器，1秒后检查网络状态\n        this.disconnectTimeout = setTimeout(() => {\n          if (this.networkDisconnected) { // 如果1秒后仍然断开\n            this.disconnectTimeoutTriggered = true; // 标记定时器已触发\n            this.callShowMessageBox('WebSocket disconnected', 'error');\n          }\n        }, 1000); // 1秒后执行\n      });\n    },\n    //监听网络连接状态\n\n    sendMessage(type, message) {\n      console.log(\"QHYCCD | sendMessage: \", message);\n\n      const messageId = this.generateMessageId(); // 生成唯一的消息ID\n      const messageObj = { type: type, msgid: messageId, message: message }; // 创建包含类型和消息的对象\n      const messageJson = JSON.stringify(messageObj); // 将消息对象转换为 JSON 字符串\n      const messageState = { msgid: messageId, text: messageJson, success: false }; // 创建包含消息和状态信息的对象\n\n      if (this.websocket.readyState === WebSocket.OPEN) {\n        this.websocket.send(messageJson);\n        // messageState.success = true; // 设置消息为成功\n      }\n      this.sentMessages.push(messageState); // 添加消息对象到已发送的消息数组\n    },\n\n    generateMessageId() {\n      // 使用时间戳和计数器生成唯一的消息ID\n      return Date.now() + \"-\" + (this.messageCounter++);\n    },\n\n    handleMessageResponse(messageId) {\n      // 根据返回的消息ID更新消息发送状态\n      const lastMessage = this.sentMessages[this.sentMessages.length - 1];\n      if (lastMessage && lastMessage.msgid === messageId) {\n        lastMessage.success = true;\n      }\n    },\n\n    // 消息框\n    callShowMessageBox(msg, type) {\n      console.log('QHYCCD | callShowMessageBox:', msg, type);\n      this.SendConsoleLogMsg(msg, type);\n      this.$bus.$emit('showMsgBox', msg, type);\n    },\n    // 消息框\n\n    locationClicked: function () {\n      this.$bus.$emit('Vue_Command', 'localMessage'); // 获取位置信息\n      this.$store.commit('toggleBool', 'showLocationDialog');\n\n      this.$bus.$emit('ResetTime');\n    },\n\n    SetCurrentLocation(lat, lng, isAuto) {\n      console.log('SetCurrentLocation:', lat, ',', lng);\n      this.$bus.$emit('SendConsoleLogMsg', 'Set Current Location:' + lat + ',' + lng, 'info');\n      this.$bus.$emit('PolarPointAltitude', lat);\n      this.$bus.$emit('resetLocation', lat, lng, isAuto);\n      const loc = {\n        short_name: 'Unknown',\n        country: 'Unknown',\n        lng: lng,\n        lat: lat,\n        alt: 0,\n        accuracy: 0,\n        street_address: ''\n      }\n      this.$store.commit('setCurrentLocation', loc);\n\n      this.$bus.$emit('ShowPositionInfo', lat, lng);\n\n      setTimeout(() => {\n        this.$bus.$emit('ResetTime');\n      }, 1000);\n    },\n    // 状态恢复\n    StatusRecovery() {\n      // this.sendMessage('SendConsoleLogMsg', '网络连接恢复，恢复当前状态!', 'warning');\n      this.getQTClientVersion();                // 获取QTClient版本\n      this.sendMessage('Vue_Command', 'getROIInfo'); // 获取ROI信息\n      this.sendMessage('Vue_Command', 'localMessage'); // 获取位置信息\n      this.sendMessage('Vue_Command', 'getLastSelectDevice'); // 获取上一次选择的设备\n      this.sendMessage('Vue_Command', 'getMainCameraParameters'); // 获取主相机参数\n      this.sendMessage('Vue_Command', 'getMountParameters'); // 获取赤道仪UI信息\n      this.RecalibratePolarAxis(); // 重新校准极轴\n      this.sendMessage('Vue_Command', 'getStagingSolveResult'); // 获取定标结果\n      this.sendMessage('Vue_Command', 'getFocuserLoopingState'); // 获取焦距器循环状态\n      this.sendMessage('Vue_Command', 'getStagingScheduleData'); // 获取定标计划数据\n      this.sendMessage('Vue_Command', 'getStagingSolveResult'); // 获取定标结果\n      this.sendMessage('Vue_Command', 'getGPIOsStatus'); // 获取GPIO状态\n      // this.sendMessage('Vue_Command', 'getStagingImage'); // 获取最后拍摄的图像\n      this.sendMessage('Vue_Command', 'getPolarAlignmentState'); // 获取极轴对齐状态\n\n\n      this.disconnectTimeoutTriggered = false;\n    },\n\n    openPowerManagerPage() {\n      this.isOpenDevicePage = false;\n      this.isOpenPowerPage = true;\n\n      this.drawer_2 = true;\n    },\n\n    QuitToMainApp() {\n      this.sendMessage('Broadcast_Msg', 'CloseWebView');\n    },\n\n    selectDevice(device) {\n      if (!this.haveDeviceConnect || (this.haveDeviceConnect) || device.driverType === 'Telescopes') {\n        this.isOpenDevicePage = true;\n        this.isOpenPowerPage = false;\n\n        if (device.isget === false) {\n          // device.isget = true;\n          this.sendMessage('Vue_Command', 'SelectIndiDriver:' + device.type + \":\" + device.ListNum);\n          this.drivers = [];\n        }\n\n        this.CurrentDriverType = device.driverType;\n        this.DeviceIsConnected = device.isConnected;\n        this.BaudRateSelected = device.BaudRate;\n        if (device.driverType === 'Telescopes') {\n          this.DeviceIsConnected = true;\n        }\n\n        this.drawer_2 = true;\n\n        this.ToBeConnectDevice = [];\n        this.devicesList.forEach(devicesList => {\n          if (devicesList.type === this.CurrentDriverType) {\n            this.ToBeConnectDevice.push(devicesList);\n          }\n        });\n      } else {\n        this.callShowMessageBox('The device is not connected.', 'error');\n      }\n\n    },\n\n    CurrentConfigItems() {\n      console.log('CurrentConfigItems: ', this.CurrentDriverType + 'ConfigItems');\n      switch (this.CurrentDriverType) {\n        case 'Guider':\n          return this.GuiderConfigItems;\n        case 'MainCamera':\n          return this.MainCameraConfigItems;\n        case 'Mount':\n          return this.MountConfigItems;\n        case 'Telescopes':\n          return this.TelescopesConfigItems;\n        case 'Focuser':\n          return this.FocuserConfigItems;\n        case 'PoleCamera':\n          return this.PoleCameraConfigItems;\n        case 'CFW':\n          return this.CFWConfigItems;\n        default:\n          return [];\n      }\n    },\n\n    confirmDriver() {\n      // 确定驱动的逻辑\n      console.log(\"QHYCCD | confirmDriver: \", this.selectedDriver);\n      this.SendConsoleLogMsg('Confirm Indi Driver:' + this.selectedDriver, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConfirmIndiDriver:' + this.selectedDriver + ':' + this.BaudRateSelected);\n      this.confirmDriverType = this.CurrentDriverType;\n      this.loadingSelectDriver = true;\n\n      this.devices.forEach(device => {\n        if (device.driverType === this.CurrentDriverType) {\n          device.device = this.selectedDriver;\n          device.driverName = this.selectedDriver;\n          device.BaudRate = this.BaudRateSelected;\n        }\n      });\n    },\n    clearDriver() {\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ClearIndiDriver');\n      this.SendConsoleLogMsg('Clear Indi Driver', 'info');\n      this.devices.forEach(device => {\n        if (device.driverType === this.CurrentDriverType) {\n          device.device = '';\n          device.driverName = '';\n          device.BaudRate = 9600;\n        }\n      });\n      this.selectedDriver = '';\n    },\n    confirmDevice() {\n      // 确定设备的逻辑\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConfirmIndiDevice:' + this.selectedDevice + ':' + this.selectedDriver);\n      // this.$bus.$emit('AppUpdateDevices', this.CurrentDriverType, this.selectedDevice);\n      this.updateDevices(this.CurrentDriverType, this.selectedDevice);\n    },\n\n    updateDevices(driverType, newDevice) {    // 手动选择\n      this.devices.forEach(device => {\n        if (device.driverType === driverType) {\n          device.device = newDevice;\n        }\n      });\n    },\n\n    updateDevices_(ListNum, newDevice) {    // 从文件导入\n      this.devices.forEach(device => {\n        if (device.ListNum === ListNum) {\n          device.device = newDevice;\n        }\n      });\n      this.loadingConnectAllDevice = false;\n    },\n\n    updateDevicesConnect(type, DeviceName, DriverName, isBind = true) {    // 连接成功\n      this.SendConsoleLogMsg('updateDevicesConnect' + type + ' ' + DeviceName + ' ' + DriverName + ' ' + isBind, 'info');\n      this.devices.forEach(device => {\n        if (device.driverType === type) {\n          if (isBind == true) {\n            device.device = DeviceName;\n          } else {\n            device.device = \"Not Bind Device\";\n          }\n          device.driverName = DriverName;\n          device.isConnected = true;\n        }\n      });\n      this.callShowMessageBox(DeviceName + ' success connected', 'success');\n      this.haveDeviceConnect = true;\n      this.loadingConnectAllDevice = false;\n\n      if (type === 'MainCamera') {\n        this.$bus.$emit('MainCameraConnected', 1);\n        console.log('MainCamera is Connected.');\n      } else if (type === 'Mount') {\n        this.$bus.$emit('MountConnected', 1);\n        console.log('Mount is Connected.');\n      } else if (type === 'CFW') {\n        this.$bus.$emit('CFWConnected', 1);\n        console.log('Mount is Connected.');\n      } else if (type === 'Focuser') {\n        this.$bus.$emit('FocuserConnected', 1);\n        console.log('Focuser is Connected.');\n      } else if (type === 'Guider') {\n        this.$bus.$emit('GuiderConnected', 1);\n        console.log('Guider is Connected.');\n      }\n      console.log('updateDevicesConnect: ', type, DeviceName, DriverName, isBind);\n\n      this.$bus.$emit('DeviceConnectSuccess', type, DeviceName, DriverName, isBind);\n    },\n    startConnectBtnPress(event) {\n      // 如果是触摸事件，标记并处理\n      if (event.type === 'touchstart') {\n        this.isTouching = true;\n        this.isConnectBtnLongPress = false; // 重置长按标记\n        // this.ConnectBtnPressTimer = setTimeout(() => {\n        //   this.isConnectBtnLongPress = true; // 标记为长按\n        //   this.handleConnectBtnLongPress();\n        // }, this.ConnectBtnlongPressThreshold);\n        this.handleConnectBtnClick();\n      }\n      // 如果是鼠标事件，且没有正在进行的触摸事件，则处理\n      else if (event.type === 'mousedown' && !this.isTouching) {\n        this.isConnectBtnLongPress = false; // 重置长按标记\n        // this.ConnectBtnPressTimer = setTimeout(() => {\n        //   this.isConnectBtnLongPress = true; // 标记为长按\n        //   this.handleConnectBtnLongPress();\n        // }, this.ConnectBtnlongPressThreshold);\n        this.handleConnectBtnClick();\n      }\n    },\n    endConnectBtnPress(event) {\n      // 如果是触摸事件，处理并重置标记\n      if (event.type === 'touchend') {\n        clearTimeout(this.ConnectBtnPressTimer); // 清除定时器\n        // if (!this.isConnectBtnLongPress) {\n        //   this.handleConnectBtnClick(); // 如果不是长按，则触发点击事件\n        // }\n        this.handleConnectBtnClick();\n        this.ConnectBtnPressTimer = null; // 重置定时器\n        this.isTouching = false; // 重置触摸标记\n      }\n      // 如果是鼠标事件，且没有正在进行的触摸事件，则处理\n      else if (event.type === 'mouseup' && !this.isTouching) {\n        clearTimeout(this.ConnectBtnPressTimer); // 清除定时器\n        // if (!this.isConnectBtnLongPress) {\n        //   this.handleConnectBtnClick(); // 如果不是长按，则触发点击事件\n        // }\n        this.handleConnectBtnClick();\n        this.ConnectBtnPressTimer = null; // 重置定时器\n      }\n    },\n    handleConnectBtnClick() {\n      if (this.haveDeviceConnect) {\n        this.callShowMessageBox('Please disconnect all devices first.', 'error');\n        return;\n      }\n      if (!this.ConnectBtnCanClick) return; // 如果不可点击，直接返回\n      this.ConnectBtnCanClick = false; // 设置为不可点击\n      console.log(\"Connect Button clicked\");\n\n      this.connectAllDevice();\n\n      // 恢复点击权限\n      setTimeout(() => {\n        this.ConnectBtnCanClick = true;\n      }, 1000); // 1秒后恢复\n    },\n    handleConnectBtnLongPress() {\n      if (this.haveDeviceConnect) {\n        this.callShowMessageBox('Please disconnect all devices first.', 'error');\n        return;\n      }\n      // 长按事件的处理\n      console.log(\"Connect Button long pressed\");\n\n      this.autoConnectAllDevice();\n    },\n    connectAllDevice() {\n      console.log(\"QHYCCD | connectAllDevice.\");\n      this.SendConsoleLogMsg('Connect All Device', 'info');\n      this.sendMessage('Vue_Command', 'connectAllDevice');\n      this.loadingConnectAllDevice = true;\n    },\n    autoConnectAllDevice() {\n      console.log(\"QHYCCD | autoConnectAllDevice.\");\n      this.SendConsoleLogMsg('Auto Connect All Device', 'info');\n      this.sendMessage('Vue_Command', 'autoConnectAllDevice');\n      this.loadingConnectAllDevice = true;\n    },\n\n    disconnectAllDevice(confirm) {\n      // 检查是否有设备的 isConnected 属性为 true\n      // const hasConnectedDevices = this.devices.some(device => device.isConnected);\n\n      if (this.haveDeviceConnect) {\n        if (confirm === false) {\n          this.ShowConfirmDialog('Confirm', 'Are you sure you want to disconnect all devices?', 'disconnectAllDevice');\n        } else {\n          this.sendMessage('Vue_Command', 'disconnectAllDevice');\n          this.SendConsoleLogMsg('Disconnect All Device', 'info');\n          this.haveDeviceConnect = false;\n          // this.devices.forEach(device => {\n          //   device.isConnected = false;\n          //   // device.device = '';\n          // });\n\n          this.$bus.$emit('MainCameraConnected', 0);\n          this.$bus.$emit('MountConnected', 0);\n          this.$bus.$emit('CFWConnected', 0);\n          this.$bus.$emit('FocuserConnected', 0);\n          this.$bus.$emit('GuiderConnected', 0);\n          this.clearDeviceList();\n        }\n      } else {\n        this.callShowMessageBox('No devices have been connected.', 'error');\n      }\n      this.selectedDriver = '';\n    },\n\n    clearDeviceList() {\n      this.devices.forEach(device => {\n        device.device = device.driverName;\n        device.isConnected = false;\n        device.isget = false;\n        device.BaudRate = 9600;\n      });\n      this.ToBeConnectDevice = [];\n      this.devicesList = [];\n      this.drivers = [];\n      this.$bus.$emit('clearDeviceAllocationList');\n    },\n\n    SwitchOutPutPower(index, isPowerON) {\n      if (isPowerON) {\n        this.drawer_2 = false;\n        this.ShowConfirmDialog('Output Power:' + index, 'Are you sure you want to turn off this output power?', 'SwitchOutPutPower');\n      } else {\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'SwitchOutPutPower:' + index);\n        this.SendConsoleLogMsg('Switch OutPutPower' + index, 'info');\n      }\n    },\n\n    RestartRaspberryPi() {\n      this.drawer_2 = false;\n      this.ShowConfirmDialog('Restart', 'Are you sure you want to restart the Raspberry Pi?', 'RestartRaspberryPi');\n    },\n\n    ShutdownRaspberryPi() {\n      this.drawer_2 = false;\n      this.ShowConfirmDialog('Shut Down', 'Are you sure you want to shut down the Raspberry Pi?', 'ShutdownRaspberryPi');\n    },\n\n    ForceUpdate() {\n      this.drawer_2 = false;\n      this.ShowConfirmDialog('Force Update', 'Are you sure you want to force update the Raspberry Pi?', 'ForceUpdate');\n    },\n\n    ReturnConnectedDevices() {\n      this.devices.forEach(device => {\n        if (device.driverType === 'MainCamera') {\n          if (device.isConnected === true) {\n            this.$bus.$emit('MainCameraConnected', 1);\n            console.log('MainCamera is Connected.');\n            this.SendConsoleLogMsg('MainCamera is Connected.', 'info');\n          }\n        } else if (device.driverType === 'Mount') {\n          if (device.isConnected === true) {\n            this.$bus.$emit('MountConnected', 1);\n            console.log('Mount is Connected.');\n            this.SendConsoleLogMsg('Mount is Connected.', 'info');\n          }\n        }\n      });\n      this.sendMessage('Vue_Command', 'loadSelectedDriverList');\n      this.sendMessage('Vue_Command', 'loadBindDeviceList');\n      this.sendMessage('Vue_Command', 'loadBindDeviceTypeList');\n    },\n\n    OpenIamgeFolder() {\n      this.$bus.$emit('ImageManagerPanelOpen');\n      this.nav = false;\n    },\n\n    OpenDebugLog() {\n      this.$bus.$emit('toggleINDIDebugDialog');\n      this.nav = false;\n    },\n\n    SendConsoleLogMsg(message, type) {\n      if (type == 'error') {\n        console.error('Error: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else if (type == 'info') {\n        console.log('Info: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else if (type == 'warning') {\n        console.warn('Warning: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else {\n        console.log('Debug: ' + message);\n      }\n    },\n\n    DeviceAllocation() {\n      this.$bus.$emit('toggleDeviceAllocationPanel');\n      this.nav = false;\n    },\n\n    // CurrentExpTimeList(index, value) {\n    //   const expTimeIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ExpTime [' + (index + 1) + ']');\n    //   if (expTimeIndex !== -1) { // 确保找到了对应的配置项\n    //     // 更新 ExpTime1 配置项的值\n    //     this.MainCameraConfigItems[expTimeIndex].value = value;\n    //   } else {\n    //     console.error('ExpTime [' + index + '] configuration item not found.');\n    //   }\n    // },\n\n    CurrentCFWList(index, value) {\n      const expTimeIndex = this.CFWConfigItems.findIndex(item => item.label === 'CFW [' + (index + 1) + ']');\n      if (expTimeIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.CFWConfigItems[expTimeIndex].value = value;\n      } else {\n        console.error('CFW [' + index + '] configuration item not found.');\n      }\n    },\n\n    confirmConfiguration(List) {\n      List.forEach(item => {\n        if (item.value !== '') {\n          // console.log(item.label, item.value);\n          this.SendConsoleLogMsg(item.label + ':' + item.value, 'info');\n          this.$bus.$emit(item.label, item.label + ':' + item.value);\n        } else if (item.value == '' && item.label === 'Focal Length (mm)') {\n          this.SendConsoleLogMsg(item.label + 'is NULL', 'info');\n          this.$bus.$emit(item.label, item.label + ':');\n        }\n      });\n      this.callShowMessageBox('Configuration has been modified!', 'success');\n    },\n\n    loadAndDisplayImage(imagePath) {\n      const canvas = document.getElementById('guiderCamera-canvas');\n      // const canvas = document.getElementById('mainCamera-canvas');\n      if (canvas.getContext) {\n        const ctx = canvas.getContext('2d');\n        const img = new Image();\n\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.drawImage(img, 0, 0);\n          // this.$bus.$emit('showSolveImage', img);\n        };\n\n        // 添加错误处理\n        img.onerror = (error) => {\n          console.log(`加载图像失败: ${imagePath}`);\n          this.SendConsoleLogMsg(`加载图像失败: ${imagePath}`, 'error');\n        };\n\n        img.src = imagePath;\n      }\n    },\n\n    ImageGainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value); // 将值转换为 double 类型\n\n      if (signal === 'ImageGainR') {\n        // 处理 ImageGainR 信号\n        this.ImageGainR = doubleValue;\n        this.SendConsoleLogMsg('ImageGainR is set to:' + doubleValue, 'info');\n        this.sendMessage('Vue_Command', 'ImageGainR:' + doubleValue);\n      } else if (signal === 'ImageGainB') {\n        // 处理 ImageGainB 信号\n        this.ImageGainB = doubleValue;\n        this.SendConsoleLogMsg('ImageGainB is set to:' + doubleValue, 'info');\n        this.sendMessage('Vue_Command', 'ImageGainB:' + doubleValue);\n      }\n    },\n\n    ImageOffsetSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value); // 将值转换为 double 类型\n\n      this.ImageOffset = doubleValue;\n      console.log('Image Offset is set to:', doubleValue);\n      this.SendConsoleLogMsg('Image Offset is set to:' + doubleValue, 'info');\n      this.sendMessage('Vue_Command', 'ImageOffset:' + doubleValue);\n    },\n\n    BinningSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n      this.cameraBin = IntValue;\n      console.log('Image Binning is set to:', IntValue);\n      this.SendConsoleLogMsg('Image Binning is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetBinning:' + IntValue);\n      this.$bus.$emit('SetBinningNum', IntValue);\n    },\n\n    GainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Gain is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Gain is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraGain:' + IntValue);\n    },\n\n    OffsetSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Offset is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Offset is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraOffset:' + IntValue);\n    },\n\n    ImageCFASet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n\n      // if (['GR', 'GB', 'BG', 'RGGB','null'].includes(value)) {\n      if (['GR', 'GB', 'BG', 'RG', 'GRBG', 'GBRG', 'BGGR', 'RGGB', 'null', ''].includes(value)) {\n        if (value === '') {\n          value = 'null';\n        } else if (value === 'GRBG') {\n          value = 'GR';\n        } else if (value === 'GBRG') {\n          value = 'GB';\n        } else if (value === 'BGGR') {\n          value = 'BG';\n        } else if (value === 'RG') {\n          value = 'RGGB';\n        }\n        this.ImageCFA = value;\n        // console.log('ImageCFA is set to:', value);\n        this.SendConsoleLogMsg('ImageCFA is set to:' + value, 'info');\n        this.sendMessage('Vue_Command', 'ImageCFA:' + value);\n      } else {\n        // console.log(`Invalid value for ImageCFA: '${value}'. Please set it to one of 'GR', 'GB', 'BG', 'RGGB'.`);\n        this.callShowMessageBox(`Invalid value for ImageCFA: '${value}'. Please set it to one of 'GR', 'GB', 'BG', 'RGGB'.`, 'error');\n      }\n    },\n\n    CameraTemperatureSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Temperature is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Temperature is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraTemperature:' + IntValue);\n    },\n\n    FocalLengthSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n\n      for (const device of this.devices) {\n        if (device.driverType === 'Telescopes') {\n\n          if (value === '' || value === NaN) {\n            device.device = '';\n            this.SendConsoleLogMsg('Focal Length is set to:' + 0, 'info');\n            this.$bus.$emit('SetFocalLengthNum', '');\n          } else {\n            const IntValue = parseInt(value); // 将值转换为 Int 类型\n            device.device = value + ' mm';\n            this.SendConsoleLogMsg('Focal Length is set to:' + IntValue, 'info');\n            this.$bus.$emit('SetFocalLengthNum', IntValue);\n          }\n        }\n      }\n\n\n    },\n\n    GuiderFocalLengthSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n\n      this.SendConsoleLogMsg('Guider Focal Length is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderFocalLength:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderFocalLength:' + IntValue);\n    },\n\n    MultiStarGuiderSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      this.SendConsoleLogMsg('Multi Star Guider is set to:' + value, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'MultiStarGuider:' + value);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:MultiStarGuider:' + value);\n    },\n\n    GuiderPixelSizeSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value);\n      this.SendConsoleLogMsg('Guider Pixel size is set to:' + doubleValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderPixelSize:' + doubleValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderPixelSize:' + doubleValue);\n    },\n\n    GuiderGainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Guider Gain is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderGain:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderGain:' + IntValue);\n    },\n\n    CalibrationDurationSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Guider Calibration step is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'CalibrationDuration:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:CalibrationDuration:' + IntValue);\n    },\n\n    RaAggressionSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Ra Aggression is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'RaAggression:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:RaAggression:' + IntValue);\n    },\n\n    DecAggressionSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Dec Aggression is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DecAggression:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:DecAggression:' + IntValue);\n    },\n\n    SyncFocuserStep(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Sync Focuser Step:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'SyncFocuserStep:' + IntValue);\n    },\n\n    GotoThenSolve(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const BooleanValue = Boolean(value);\n      this.SendConsoleLogMsg('Goto Then Solve:' + BooleanValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GotoThenSolve:' + BooleanValue);\n    },\n\n    AutoFlipSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const BooleanValue = Boolean(value);\n      this.SendConsoleLogMsg('Auto Flip:' + BooleanValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'AutoFlip:' + BooleanValue);\n    },\n\n    WestMinutesPastMeridianSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const WestMinutesPastMeridian = parseFloat(value);\n      this.SendConsoleLogMsg('Minutes Past Meridian:' + WestMinutesPastMeridian, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'WestMinutesPastMeridian:' + WestMinutesPastMeridian);\n    },\n\n    EastMinutesPastMeridianSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const EastMinutesPastMeridian = parseFloat(value);\n      this.SendConsoleLogMsg('Minutes Past Meridian:' + EastMinutesPastMeridian, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'EastMinutesPastMeridian:' + EastMinutesPastMeridian);\n    },\n\n    async readBinFile(fileName, retryCount = 1) {\n      while (this.isDownloadingImage) {\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        if (!this.isWaitingLogged) {\n          this.SendConsoleLogMsg('The image is already being processed. Please wait for the previous process to complete.', 'warning');\n          this.isWaitingLogged = true; // 确保只记录一次等待信息\n        }\n      }\n\n      if (this.isDownloadingImageName === fileName) {\n        this.SendConsoleLogMsg('The image(' + fileName + ') is already processed.', 'info');\n        return;\n      }\n\n      this.isDownloadingImage = true;\n      this.isWaitingLogged = false; // 重置等待日志标志\n      this.SendConsoleLogMsg('CaptureTestTime | Read image(' + fileName + ') data start.', 'info');\n\n      const startTime = new Date();\n      try {\n        // Check if the fileName is valid\n        if (!fileName || typeof fileName !== 'string') {\n          throw new Error('Invalid file name provided');\n        }\n\n        // Fetch with progress tracking\n        const response = await fetch(fileName, { cache: 'no-store' });\n        if (!response.ok) {\n          throw new Error(`Network response was not ok. Status: ${response.status}`);\n        }\n\n        const contentLength = response.headers.get('content-length');\n        if (!contentLength) {\n          throw new Error('Content-Length header is missing');\n        }\n\n        const total = parseInt(contentLength, 10);\n        if (isNaN(total) || total <= 0) {\n          throw new Error('Invalid content-length value');\n        }\n\n        let loaded = 0;\n\n        const reader = response.body.getReader();\n        const stream = new ReadableStream({\n          start: (controller) => {\n            const push = () => {\n              reader.read().then(({ done, value }) => {\n                if (done) {\n                  controller.close();\n                  return;\n                }\n                loaded += value.byteLength;\n                const percent = (loaded / total) * 100;\n                if (Math.round(percent) % 10 === 0) {\n                  // this.SendConsoleLogMsg(`Progress: ${Math.round(percent)}%`, 'info');\n                  this.updateCaptureImageProgress(Math.round(percent));\n                }\n                // this.SendConsoleLogMsg(`当前进度: ${Math.round(percent)}%`, 'info');\n                controller.enqueue(value);\n                push();\n              }).catch(error => {\n                console.error('Stream reading error:', error);\n                this.SendConsoleLogMsg('Stream reading error: ' + error.message, 'error');\n                controller.error(error);\n              });\n            };\n            push();\n          }\n        });\n\n        const newResponse = new Response(stream);\n        const blob = await newResponse.blob();\n\n        // FileReader with progress tracking\n        const fileReader = new FileReader();\n        fileReader.onload = () => {\n          this.ImageArrayBuffer = fileReader.result;\n\n          const endTime = new Date();\n          const elapsedTime = endTime.getTime() - startTime.getTime();\n          this.SendConsoleLogMsg('CaptureTestTime | Read image data end: ' + elapsedTime + ' ms', 'info');\n          if (!this.isPolarAxisMode) {\n            this.callShowMessageBox(`Read image data end: '${elapsedTime}' ms.`, 'info');\n          }\n          this.isDownloadingImageName = fileName;\n          this.processImage(this.ImageArrayBuffer);\n        };\n\n        fileReader.onerror = (error) => {\n          console.error('FileReader error:', error);\n          this.SendConsoleLogMsg('FileReader error: ' + error.message, 'error');\n        };\n\n        fileReader.readAsArrayBuffer(blob);\n      } catch (error) {\n        console.error('There was a problem with the fetch operation:', error);\n        this.SendConsoleLogMsg('There was a problem with the fetch operation: ' + error.message, 'error');\n\n        // 下载失败，重试\n        if (retryCount > 0) {\n          console.log('Retrying download...');\n          this.SendConsoleLogMsg('Retrying download...', 'warning');\n          this.isDownloadingImage = false;\n          this.updateCaptureImageProgress(100);\n          await this.readBinFile(fileName, retryCount - 1);\n        } else {\n          this.SendConsoleLogMsg('Max retries reached. Download failed.', 'error');\n        }\n      } finally {\n        this.isDownloadingImage = false; // 确保在任何情况下都重置状态\n      }\n    },\n\n\n    // async readBinFile(fileName, retryCount = 1) {\n    //   while (this.isDownloadingImage) {\n    //     await new Promise(resolve => setTimeout(resolve, 1000));\n    //     if (!this.isWaitingLogged) {\n    //       this.SendConsoleLogMsg('The image is already being processed. Please wait for the previous process to complete.', 'warning');\n    //       this.isWaitingLogged = true; // 确保只记录一次等待信息\n    //     }\n    //   }\n\n    //   if (this.isDownloadingImageName === fileName) {\n    //     this.SendConsoleLogMsg('The image(' + fileName + ') is already processed.', 'info');\n    //     return;\n    //   }\n\n    //   this.isDownloadingImage = true;\n    //   this.isWaitingLogged = false; // 重置等待日志标志\n    //   this.SendConsoleLogMsg('CaptureTestTime | Read image(' + fileName + ') data start.', 'info');\n\n    //   const startTime = new Date();\n    //   try {\n    //     // Fetch with progress tracking\n    //     const response = await fetch(fileName);\n    //     if (!response.ok) {\n    //       throw new Error('Network response was not ok');\n    //     }\n\n    //     const contentLength = response.headers.get('content-length');\n    //     if (!contentLength) {\n    //       throw new Error('Content-Length header is missing');\n    //     }\n\n    //     const total = parseInt(contentLength, 10);\n    //     let loaded = 0;\n\n    //     const reader = response.body.getReader();\n    //     const stream = new ReadableStream({\n    //       start: (controller) => {\n    //         const push = () => {\n    //           reader.read().then(({ done, value }) => {\n    //             if (done) {\n    //               controller.close();\n    //               return;\n    //             }\n    //             loaded += value.byteLength;\n    //             const percent = (loaded / total) * 100;\n    //             if (Math.round(percent) % 10 === 0) {\n    //               this.SendConsoleLogMsg(`Progress: ${Math.round(percent)}%`,'info');\n    //               this.updateCaptureImageProgress(Math.round(percent));\n    //             }\n    //             controller.enqueue(value);\n    //             push();\n    //           }).catch(error => {\n    //             console.error('Stream reading error:', error);\n    //             controller.error(error);\n    //           });\n    //         };\n    //         push();\n    //       }\n    //     });\n\n    //     const newResponse = new Response(stream);\n    //     const blob = await newResponse.blob();\n\n    //     // FileReader with progress tracking\n    //     const fileReader = new FileReader();\n    //     fileReader.onload = () => {\n    //       this.ImageArrayBuffer = fileReader.result;\n\n    //       const endTime = new Date();\n    //       const elapsedTime = endTime.getTime() - startTime.getTime();\n    //       this.SendConsoleLogMsg('CaptureTestTime | Read image data end: ' + elapsedTime + ' ms', 'info');\n    //       if (!this.isPolarAxisMode) {\n    //         this.callShowMessageBox(`Read image data end: '${elapsedTime}' ms.`, 'info');\n    //       }\n    //       this.isDownloadingImageName = fileName;\n    //       this.processImage(this.ImageArrayBuffer);\n    //     };\n\n    //     fileReader.onerror = (error) => {\n    //       console.error('FileReader error:', error);\n    //       this.SendConsoleLogMsg('FileReader error:' + error, 'error');\n    //     };\n\n    //     fileReader.readAsArrayBuffer(blob);\n    //   } catch (error) {\n    //     console.error('There was a problem with the fetch operation:', error);\n    //     this.SendConsoleLogMsg('There was a problem with the fetch operation:' + error, 'error');\n\n    //     // 下载失败，重试\n    //     if (retryCount > 0) {\n    //       console.log('Retrying download...');\n    //       this.SendConsoleLogMsg('Retrying download...', 'warning');\n    //       this.isDownloadingImage = false;\n    //       this.updateCaptureImageProgress(100);\n    //       await this.readBinFile(fileName, retryCount - 1);\n    //     }\n    //   } finally {\n    //     this.isDownloadingImage = false; // 确保在任何情况下都重置状态\n    //   }\n    // },\n\n    updateCaptureImageProgress(num) {\n      this.$bus.$emit('ShowCaptureImageProgress', num);\n    },\n\n    setImageProportion(value) {\n      this.ImageProportion = value;\n    },\n\n    async processImage(imgArray, histogramMin = -1, histogramMax = -1, options = {}) {\n      let { calculateHistogram = true } = options;\n      this.progressValue = 0;\n      this.progressDescription = this.$i18n.locale === 'cn' ? '开始处理图像...' : 'Processing image...';\n      let mat = null;\n      let targetImg8 = null;\n      let resizeImg = null;\n\n      // 使用setTimeout和Promise创建非阻塞处理\n      const processAsync = (fn) => {\n        return new Promise(resolve => {\n          setTimeout(() => {\n            const result = fn();\n            resolve(result);\n          }, 0);\n        });\n      };\n\n      try {\n        if (!(imgArray instanceof ArrayBuffer) && !ArrayBuffer.isView(imgArray)) {\n          throw new Error(\"Input must be ArrayBuffer or TypedArray\");\n        }\n        let uintArray = new Uint16Array(imgArray);\n\n        if (uintArray.length != parseInt(this.mainCameraSizeY) * parseInt(this.mainCameraSizeX)) {\n          throw new Error(\"Image size mismatch\");\n        }\n        // 创建Mat对象\n        await processAsync(() => {\n          mat = new cv.Mat(parseInt(this.mainCameraSizeY), parseInt(this.mainCameraSizeX), cv.CV_16UC1);\n          mat.data16U.set(uintArray);\n          this.progressValue = 10;\n          this.progressDescription = this.$i18n.locale === 'cn' ? '创建Mat对象...' : 'Creating Mat object...';\n          return true;\n        });\n\n        // 用户自定义参数\n        let CFA = this.ImageCFA;\n        let isColorCamera = false;\n        let mode = 1;\n        let blackLevel, whiteLevel;\n\n        if (histogramMin == -1 && histogramMax == -1) {\n          // 获取自动拉伸参数\n          const result = await processAsync(() => {\n            const res = this.GetAutoStretch(mat, mode);\n            this.progressValue = 20;\n            this.progressDescription = this.$i18n.locale === 'cn' ? '获取自动拉伸参数...' : 'Getting auto stretch parameters...';\n            return res;\n          });\n\n          calculateHistogram = true;\n          // 从结果中提取值\n          blackLevel = result.blackLevel;\n          whiteLevel = result.whiteLevel;\n        } else {\n          blackLevel = histogramMin;  // 现在可以正常工作\n          whiteLevel = histogramMax;  // 现在可以正常工作\n        }\n\n        // 根据CFA设置颜色转换模式\n        if (CFA === 'GR') {\n          isColorCamera = true;\n        } else if (CFA === 'GB') {\n          isColorCamera = true;\n        } else if (CFA === 'BG') {\n          isColorCamera = true;\n        } else if (CFA === 'RGGB') {\n          isColorCamera = true;\n        } else {\n          isColorCamera = false;\n        }\n        console.log(\"当前拍摄参数:isColorCamera:\", isColorCamera, \"CFA:\", CFA);\n        // 计算直方图\n        const analysis = await processAsync(() => {\n          const result = isColorCamera\n            ? this.analyzeImageStatistics(mat, 'bayer', CFA, { calculateGain: this.calculateGain, calculateHistogram: calculateHistogram })\n            : this.analyzeImageStatistics(mat, 'gray', { calculateGain: this.calculateGain, calculateHistogram: calculateHistogram });\n\n          if (this.ImageGainR != 1 || this.ImageGainB != 1 || this.ImageOffset != 0) {\n            result.gainR = this.ImageGainR;\n            result.gainB = this.ImageGainB;\n            result.offset = this.ImageOffset;\n          }\n\n          this.progressValue = 40;\n          this.progressDescription = this.$i18n.locale === 'cn' ? '计算直方图...' : 'Calculating histogram...';\n          return result;\n        });\n\n        if (analysis.histogram) {\n          this.$bus.$emit('showHistogram', analysis.histogram);  // 更新 直方图数据\n          this.$bus.$emit('ChangeDialPosition', blackLevel, whiteLevel);  // 更新直方图的显示轴\n          this.$bus.$emit('AutoHistogramNum', blackLevel, whiteLevel);\n        }\n\n        this.lastImageProcessParams = {\n          blackLevel: blackLevel,\n          whiteLevel: whiteLevel,\n          CFA: CFA,\n          analysis: analysis,\n          isColorCamera: isColorCamera,\n        };\n\n        // 使用增益和拉伸，并转化为8位图像\n        targetImg8 = await processAsync(() => {\n          const result = isColorCamera\n            ? this.applyStretchAndGain(mat, analysis, 'bayer', CFA, blackLevel, whiteLevel)\n            : this.applyStretchAndGain(mat, analysis, 'gray', CFA, blackLevel, whiteLevel);\n\n          // 释放mat\n          if (mat) {\n            mat.delete();\n            mat = null;\n          }\n\n          this.progressValue = 60;\n          this.progressDescription = this.$i18n.locale === 'cn' ? '根据参数处理...' : 'Processing with parameters...';\n          return result;\n        });\n\n        // 根据模式处理图像\n        if (this.isPolarAxisMode) {\n          await processAsync(() => {\n            resizeImg = new cv.Mat();\n            cv.resize(targetImg8, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n\n            if (targetImg8) {\n              targetImg8.delete();\n              targetImg8 = null;\n            }\n            this.progressValue = 0;\n            return true;\n          });\n\n          this.$bus.$emit('showSolveImage', resizeImg);\n\n          if (resizeImg) {\n            resizeImg.delete();\n            resizeImg = null;\n          }\n        } else {\n          // 转换为ImageData对象\n          const colorData = await processAsync(() => {\n            const data = new ImageData(\n              new Uint8ClampedArray(targetImg8.data),\n              targetImg8.cols,\n              targetImg8.rows\n            );\n\n            if (targetImg8) {\n              targetImg8.delete();\n              targetImg8 = null;\n            }\n            if (resizeImg) {\n              resizeImg.delete();\n              resizeImg = null;\n            }\n            this.progressValue = 80;\n            this.progressDescription = this.$i18n.locale === 'cn' ? '转换为ImageData对象...' : 'Converting to ImageData object...';\n            return data;\n          });\n\n          this.drawImgData = true;\n\n          // 设置缓冲画布\n          await processAsync(() => {\n            this.bufferCanvas.width = colorData.width;\n            this.bufferCanvas.height = colorData.height;\n            this.bufferCtx.putImageData(colorData, 0, 0);\n            this.progressValue = 90;\n            this.progressDescription = this.$i18n.locale === 'cn' ? '绘制缓冲画布图像...' : 'Drawing buffer canvas image...';\n            return true;\n          });\n\n          // 绘制主画布图像\n          this.progressValue = 100;\n          this.progressDescription = this.$i18n.locale === 'cn' ? '绘制主画布图像...' : 'Drawing main canvas image...';\n          this.drawImageData();\n        }\n      } catch (error) {\n        this.handleError('Process image data error', 'processImage', error);\n        this.progressValue = 0;\n        this.progressDescription = '';\n      } finally {\n        this.progressValue = 0;\n        // 确保所有Mat对象都被释放\n        if (mat) {\n          mat.delete();\n          mat = null;\n        }\n        if (targetImg8) {\n          targetImg8.delete();\n          targetImg8 = null;\n        }\n        if (resizeImg) {\n          resizeImg.delete();\n          resizeImg = null;\n        }\n        // 处理后检查内存\n        this.checkMemoryUsage();\n        // 在处理完大量数据后手动请求垃圾回收\n        if (window.gc) {\n          try { window.gc(); } catch (e) { }\n        }\n      }\n    },\n\n\n    /**\n     * 获取自动拉伸参数，返回黑色和白色阈值\n     * @param {cv.Mat} imgMat 输入的图像Mat对象\n     * @param {int} mode 模式\n     * @returns {int，int} 黑色和白色阈值\n     */\n    GetAutoStretch(imgMat, mode) {\n      // 仅支持 Mat 类型输入，并假定为16位图像\n      // 使用 OpenCV 的 meanStdDev 函数直接计算均值和标准差\n      const means = new cv.Mat();\n      const stdDevs = new cv.Mat();\n\n      // 高效计算均值和标准差\n      cv.meanStdDev(imgMat, means, stdDevs);\n\n      // 获取计算结果\n      const mean = means.doubleAt(0, 0);\n      const stdDev = stdDevs.doubleAt(0, 0);\n\n      // 释放临时 Mat 对象\n      means.delete();\n      stdDevs.delete();\n\n      // 根据模式设置标准差倍数\n      let a, b;\n      switch (mode) {\n        case 0: a = 3; b = 5; break;\n        case 1: a = 2; b = 5; break;\n        case 2: a = 3; b = 8; break;\n        default: a = 2; b = 8;\n      }\n\n      // 固定为16位图像处理\n      const maxValue = 65535;\n\n      // 计算黑白点\n      let blackLevel = Math.round(Math.max(0, mean - stdDev * a));\n      let whiteLevel = Math.round(Math.min(maxValue, mean + stdDev * b));\n\n      // 确保 blackLevel < whiteLevel\n      if (blackLevel >= whiteLevel) {\n        blackLevel = whiteLevel - 1;\n      }\n\n      return { blackLevel, whiteLevel };\n    },\n\n    /**\n     * 分析16位图像并计算直方图和白平衡增益\n     * @param {cv.Mat} img16 - 输入的16位图像Mat对象\n     * @param {string} imageType - 图像类型: 'gray'(灰度图) 或 'bayer'(Bayer格式)\n     * @param {string} bayerPattern - Bayer模式，如果imageType为'bayer'则需提供: 'RGGB', 'GR', 'GB', 'BG'\n     * @param {Object} options - 可选参数\n     * @param {number} options.bins - 直方图箱数，默认256\n     * @param {boolean} options.calculateGain - 是否计算白平衡增益参数，默认true\n     * @param {boolean} options.usePercentile - 是否使用百分位计算增益，默认true\n     * @param {number} options.lowPercentile - 下截断百分位，默认1\n     * @param {number} options.highPercentile - 上截断百分位，默认99\n     * @returns {Object} 直方图数据和增益参数\n     */\n    analyzeImageStatistics(img16, imageType, bayerPattern = 'RGGB', options = {}) {\n      // 首先检查输入Mat是否有效\n      if (!img16 || img16.rows <= 0 || img16.cols <= 0) {\n        console.error('无效的图像数据');\n        return {};\n      }\n\n      const { calculateGain = true, calculateHistogram = true } = options;\n      const result = {};\n\n\n      // 设置直方图参数\n      const step = 4;\n\n      // 安全访问函数\n      const safeUshortAt = (mat, y, x) => {\n        if (y >= 0 && y < mat.rows && x >= 0 && x < mat.cols) {\n          try {\n            return mat.ushortAt(y, x);\n          } catch (e) {\n            console.error(`访问位置错误: (${y},${x})`);\n            return 0;\n          }\n        }\n        return 0;\n      };\n\n      // 安全掩码设置（setter）：OpenCV.js 设置像素需使用 ucharPtr 返回的视图再赋值\n      const safeSetMask = (mask, y, x, value) => {\n        if (y >= 0 && y < mask.rows && x >= 0 && x < mask.cols) {\n          try {\n            const ptr = mask.ucharPtr(y, x);\n            if (ptr && ptr.length > 0) ptr[0] = value;\n          } catch (e) {\n            console.error(`设置掩码错误: (${y},${x})`);\n          }\n        }\n      };\n\n      if (imageType === 'gray') {\n        if (calculateHistogram) {\n          // 计算直方图\n          const histData = Array(65536).fill(0);\n          for (let i = 0; i < img16.rows; i += step) {\n            for (let j = 0; j < img16.cols; j += step) {\n              try {\n                histData[safeUshortAt(img16, i, j)]++;\n              } catch (e) {\n                // 忽略错误继续执行\n              }\n            }\n          }\n          result.histogram = histData;\n        }\n      } else if (imageType === 'bayer') {\n        // 确保图像大小足够进行Bayer处理\n        if (img16.rows < 2 || img16.cols < 2) {\n          console.error('图像尺寸过小，无法进行Bayer处理');\n          return {};\n        }\n\n        const rows = img16.rows;\n        const cols = img16.cols;\n\n        // 创建掩码 - 使用稀疏采样\n        const maskR = new cv.Mat(rows, cols, cv.CV_8UC1, new cv.Scalar(0));\n        const maskG = new cv.Mat(rows, cols, cv.CV_8UC1, new cv.Scalar(0));\n        const maskB = new cv.Mat(rows, cols, cv.CV_8UC1, new cv.Scalar(0));\n\n        // 确定采样步长 - 大图像时采用更大步长\n        const sampleStep = Math.max(2, Math.floor(Math.min(rows, cols) / 200) * 2);\n\n        // 确定Bayer模式位置\n        let rOffsets, gOffsets, bOffsets;\n        switch (bayerPattern) {\n          case 'RGGB':\n            rOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            bOffsets = [{ y: 1, x: 1 }];\n            break;\n          case 'GR':\n            gOffsets = [{ y: 0, x: 0 }, { y: 1, x: 1 }];\n            rOffsets = [{ y: 0, x: 1 }];\n            bOffsets = [{ y: 1, x: 0 }];\n            break;\n          case 'GB':\n            gOffsets = [{ y: 0, x: 0 }, { y: 1, x: 1 }];\n            bOffsets = [{ y: 0, x: 1 }];\n            rOffsets = [{ y: 1, x: 0 }];\n            break;\n          case 'BG':\n            bOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            rOffsets = [{ y: 1, x: 1 }];\n            break;\n          default:\n            rOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            bOffsets = [{ y: 1, x: 1 }];\n        }\n\n        // 采样数据用于增益计算\n        const rValues = [];\n        const gValues = [];\n        const bValues = [];\n\n        // 采样设置掩码和收集采样数据\n        for (let y = 0; y < rows; y += sampleStep) {\n          for (let x = 0; x < cols; x += sampleStep) {\n            // 处理红色通道\n            for (const pos of rOffsets) {\n              const py = y + pos.y;\n              const px = x + pos.x;\n              if (py < rows && px < cols && py >= 0 && px >= 0) {\n                try {\n                  safeSetMask(maskR, py, px, 255);\n                  if (calculateGain && y % (sampleStep * 2) === 0 && x % (sampleStep * 2) === 0) {\n                    rValues.push(safeUshortAt(img16, py, px));\n                  }\n                } catch (e) {\n                  console.error(`R通道错误：(${py},${px})`, e);\n                }\n              }\n            }\n\n            // 处理绿色通道\n            for (const pos of gOffsets) {\n              const py = y + pos.y;\n              const px = x + pos.x;\n              if (py < rows && px < cols && py >= 0 && px >= 0) {\n                try {\n                  safeSetMask(maskG, py, px, 255);\n                  if (calculateGain && y % (sampleStep * 2) === 0 && x % (sampleStep * 2) === 0) {\n                    gValues.push(safeUshortAt(img16, py, px));\n                  }\n                } catch (e) {\n                  console.error(`G通道错误：(${py},${px})`, e);\n                }\n              }\n            }\n\n            // 处理蓝色通道\n            for (const pos of bOffsets) {\n              const py = y + pos.y;\n              const px = x + pos.x;\n              if (py < rows && px < cols && py >= 0 && px >= 0) {\n                try {\n                  safeSetMask(maskB, py, px, 255);\n                  if (calculateGain && y % (sampleStep * 2) === 0 && x % (sampleStep * 2) === 0) {\n                    bValues.push(safeUshortAt(img16, py, px));\n                  }\n                } catch (e) {\n                  console.error(`B通道错误：(${py},${px})`, e);\n                }\n              }\n            }\n          }\n        }\n\n        if (calculateHistogram) {\n          // 计算三个通道的直方图\n          const histDataR = Array(65536).fill(0);\n          const histDataG = Array(65536).fill(0);\n          const histDataB = Array(65536).fill(0);\n\n          // 确保安全访问\n          const maxRows = rows - 1;\n          const maxCols = cols - 1;\n\n          for (let i = 0; i < maxRows; i += 2) {\n            for (let j = 0; j < maxCols; j += 2) {\n              try {\n                if (bayerPattern === 'RGGB') {\n                  histDataR[safeUshortAt(img16, i, j)]++;\n                  const g1 = safeUshortAt(img16, i + 1, j);\n                  const g2 = safeUshortAt(img16, i, j + 1);\n                  histDataG[Math.floor((g1 + g2) / 2)]++;\n                  histDataB[safeUshortAt(img16, i + 1, j + 1)]++;\n                } else if (bayerPattern === 'GR') {\n                  const g1 = safeUshortAt(img16, i, j);\n                  const g2 = safeUshortAt(img16, i + 1, j + 1);\n                  histDataG[Math.floor((g1 + g2) / 2)]++;\n                  histDataR[safeUshortAt(img16, i + 1, j)]++;\n                  histDataB[safeUshortAt(img16, i, j + 1)]++;\n                } else if (bayerPattern === 'GB') {\n                  const g1 = safeUshortAt(img16, i, j);\n                  const g2 = safeUshortAt(img16, i + 1, j + 1);\n                  histDataG[Math.floor((g1 + g2) / 2)]++;\n                  histDataB[safeUshortAt(img16, i + 1, j)]++;\n                  histDataR[safeUshortAt(img16, i, j + 1)]++;\n                } else if (bayerPattern === 'BG') {\n                  histDataB[safeUshortAt(img16, i, j)]++;\n                  const g1 = safeUshortAt(img16, i + 1, j);\n                  const g2 = safeUshortAt(img16, i, j + 1);\n                  histDataG[Math.floor((g1 + g2) / 2)]++;\n                  histDataR[safeUshortAt(img16, i + 1, j + 1)]++;\n                }\n              } catch (e) {\n                console.error(`直方图计算错误：(${i},${j})`, e);\n              }\n            }\n          }\n          result.histogram = [histDataR, histDataG, histDataB];\n        }\n\n        // 计算白平衡增益参数 - 使用快速中位数近似法\n        if (calculateGain && rValues.length > 0 && gValues.length > 0 && bValues.length > 0) {\n          try {\n            // 快速计算中位数而非排序全部数组\n            const rMean = this.truncatedMean(rValues);\n            const gMean = this.truncatedMean(gValues);\n            const bMean = this.truncatedMean(bValues);\n\n            // 计算增益\n            const gainR = Math.min(Math.max(gMean / rMean, 0.1), 2);\n            const gainB = Math.min(Math.max(gMean / bMean, 0.1), 2);\n\n            result.whiteBalance = {\n              gainR: gainR,\n              gainB: gainB\n            };\n          } catch (e) {\n            console.error(\"白平衡增益计算错误\", e);\n            result.whiteBalance = { gainR: 1.0, gainB: 1.0 };\n          }\n        }\n\n        // 释放资源\n        try {\n          maskR.delete();\n          maskG.delete();\n          maskB.delete();\n        } catch (e) {\n          console.error(\"释放资源错误\", e);\n        }\n      }\n\n      return result;\n    },\n\n    /**\n     * 使用截断均值计算 - 去除上下一定比例的极值后计算平均值\n     * @param {Array} arr - 输入数据数组\n     * @param {number} lowerPercent - 下截断百分比，默认5%\n     * @param {number} upperPercent - 上截断百分比，默认5%\n     * @returns {number} 截断均值\n     */\n    truncatedMean(arr, lowerPercent = 5, upperPercent = 5) {\n      if (arr.length === 0) return 0;\n\n      // 过滤极端黑点和过饱和点\n      const filtered = arr.filter(v => v > 100 && v < 65000);\n      if (filtered.length === 0) return arr.length > 0 ? arr[0] : 0;\n\n      // 对于特别大的数组，采样处理\n      let workingArray = filtered;\n      if (filtered.length > 10000) {\n        workingArray = [];\n        const step = Math.ceil(filtered.length / 5000);\n        for (let i = 0; i < filtered.length; i += step) {\n          workingArray.push(filtered[i]);\n        }\n      }\n\n      // 排序数组\n      workingArray.sort((a, b) => a - b);\n\n      // 计算截断点\n      const lowerCutoff = Math.floor(workingArray.length * (lowerPercent / 100));\n      const upperCutoff = Math.floor(workingArray.length * (1 - upperPercent / 100));\n\n      // 获取截断后的子数组\n      const truncated = workingArray.slice(lowerCutoff, upperCutoff);\n\n      // 计算平均值\n      if (truncated.length === 0) return workingArray[Math.floor(workingArray.length / 2)];\n\n      const sum = truncated.reduce((acc, val) => acc + val, 0);\n      return sum / truncated.length;\n    },\n    /**\n     * 快速计算中位数 - 使用随机选择算法\n     */\n    quickMedian(arr) {\n      if (arr.length === 0) return 0;\n      if (arr.length < 100) {\n        // 小数组直接排序\n        const sortedArr = [...arr].sort((a, b) => a - b);\n        return sortedArr[Math.floor(sortedArr.length / 2)];\n      }\n\n      // 大数组随机采样\n      const samples = [];\n      for (let i = 0; i < 100; i++) {\n        samples.push(arr[Math.floor(Math.random() * arr.length)]);\n      }\n      samples.sort((a, b) => a - b);\n      return samples[50]; // 返回采样的中位数\n    },\n\n    /**\n     * 应用白平衡和亮度拉伸，将16位图像转换为8位图像\n     * @param {cv.Mat} img16 - 输入的16位图像Mat对象\n     * @param {Object} analysis - 从analyzeImageStatistics获取的分析结果\n     * @param {string} imageType - 图像类型: 'gray'(灰度图) 或 'bayer'(彩色相机)\n     * @param {string} bayerPattern - Bayer模式，仅当imageType为'bayer'时需要\n     * @param {Object} stretchParams - 手动指定拉伸参数，可选\n     * @param {number} stretchParams.blackLevel - 黑点值 \n     * @param {number} stretchParams.whiteLevel - 白点值\n     * @returns {cv.Mat} 处理后的8位RGBA图像\n     */\n    applyStretchAndGain(img16, analysis, imageType, bayerPattern = 'RGGB', blackLevel, whiteLevel) {\n      // 确保黑点小于白点\n      if (blackLevel >= whiteLevel) {\n        blackLevel = whiteLevel - 1;\n      }\n\n      // 计算转换比例和偏移\n      const scale = 255.0 / (whiteLevel - blackLevel);\n      const offset = -blackLevel * scale;\n\n      if (imageType === 'gray') {\n        // 单色相机 - 一步转换到8位RGBA\n        const rgbaImg = new cv.Mat();\n        const gray8 = new cv.Mat();\n\n        img16.convertTo(gray8, cv.CV_8U, scale, offset);\n        cv.cvtColor(gray8, rgbaImg, cv.COLOR_GRAY2RGBA);\n        gray8.delete();\n\n        return rgbaImg;\n      } else {\n        // 彩色相机处理\n        let gainR = 1.0, gainB = 1.0;\n        if (analysis && analysis.whiteBalance) {\n          gainR = analysis.whiteBalance.gainR;\n          gainB = analysis.whiteBalance.gainB;\n        }\n\n        // 使用LUT优化白平衡和拉伸\n        // 1. 创建三个LUT表\n        const { lutR, lutG, lutB } = this.getLUT(blackLevel, whiteLevel, gainR, gainB);\n\n        // 3. 创建8位输出图像\n        const img8 = new cv.Mat(img16.rows, img16.cols, cv.CV_8UC1);\n\n        // 4. 使用LUT应用白平衡和拉伸\n        // 为避免像素遍历，我们使用更高效的方式\n        const rows = img16.rows;\n        const cols = img16.cols;\n        const data8 = img8.data;\n\n        // 确定Bayer模式的位置\n        let rOffsets, gOffsets, bOffsets;\n        switch (bayerPattern) {\n          case 'RGGB':\n            rOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            bOffsets = [{ y: 1, x: 1 }];\n            break;\n          case 'GR':\n            gOffsets = [{ y: 0, x: 0 }, { y: 1, x: 1 }];\n            rOffsets = [{ y: 0, x: 1 }];\n            bOffsets = [{ y: 1, x: 0 }];\n            break;\n          case 'GB':\n            gOffsets = [{ y: 0, x: 0 }, { y: 1, x: 1 }];\n            bOffsets = [{ y: 0, x: 1 }];\n            rOffsets = [{ y: 1, x: 0 }];\n            break;\n          case 'BG':\n            bOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            rOffsets = [{ y: 1, x: 1 }];\n            break;\n          default:\n            rOffsets = [{ y: 0, x: 0 }];\n            gOffsets = [{ y: 0, x: 1 }, { y: 1, x: 0 }];\n            bOffsets = [{ y: 1, x: 1 }];\n        }\n\n        // 使用TypedArray方式处理 - 比逐个像素处理更快\n        const data16U = img16.data16U;\n\n        // 使用Bayer掩码创建转换LUT，批量处理\n        for (let y = 0; y < rows; y += 2) {\n          for (let x = 0; x < cols; x += 2) {\n            // 处理2x2块\n            // R位置\n            for (const pos of rOffsets) {\n              const idx = (y + pos.y) * cols + (x + pos.x);\n              if (idx < data16U.length) {\n                data8[idx] = lutR[data16U[idx]];\n              }\n            }\n\n            // G位置\n            for (const pos of gOffsets) {\n              const idx = (y + pos.y) * cols + (x + pos.x);\n              if (idx < data16U.length) {\n                data8[idx] = lutG[data16U[idx]];\n              }\n            }\n\n            // B位置\n            for (const pos of bOffsets) {\n              const idx = (y + pos.y) * cols + (x + pos.x);\n              if (idx < data16U.length) {\n                data8[idx] = lutB[data16U[idx]];\n              }\n            }\n          }\n        }\n\n        // 5. 将8位单通道转为RGBA\n        const rgbaImg = new cv.Mat();\n        let cvmode;\n        switch (bayerPattern) {\n          case 'RGGB': cvmode = cv.COLOR_BayerRG2RGBA; break;\n          case 'GR': cvmode = cv.COLOR_BayerGR2RGBA; break;\n          case 'GB': cvmode = cv.COLOR_BayerGB2RGBA; break;\n          case 'BG': cvmode = cv.COLOR_BayerBG2RGBA; break;\n          default: cvmode = cv.COLOR_GRAY2RGBA;\n        }\n\n        cv.cvtColor(img8, rgbaImg, cvmode);\n        img8.delete();\n\n        return rgbaImg;\n      }\n    },\n    /**\n     * 获取或计算LUT表\n     * @param {number} blackLevel - 黑点值\n     * @param {number} whiteLevel - 白点值\n     * @param {number} gainR - 红色增益\n     * @param {number} gainB - 蓝色增益\n     * @returns {Object} 包含LUT表的Object\n     */\n    getLUT(blackLevel, whiteLevel, gainR, gainB) {\n      // 创建当前参数的快照\n      const currentParams = `${blackLevel}_${whiteLevel}_${gainR}_${gainB}`;\n\n      // 如果参数未变化，直接返回缓存的LUT表\n      if (this.lutCache.lastParams === currentParams &&\n        this.lutCache.lutR && this.lutCache.lutG && this.lutCache.lutB) {\n        return {\n          lutR: this.lutCache.lutR,\n          lutG: this.lutCache.lutG,\n          lutB: this.lutCache.lutB\n        };\n      }\n\n      // 参数变化，需要重新计算LUT表\n      console.log('重新计算LUT表');\n\n      // 计算转换比例\n      const scale = 255.0 / (whiteLevel - blackLevel);\n\n      // 创建LUT表\n      const lutR = this.lutCache.lutR || new Uint8Array(65536);\n      const lutG = this.lutCache.lutG || new Uint8Array(65536);\n      const lutB = this.lutCache.lutB || new Uint8Array(65536);\n\n      // 计算LUT表\n      for (let i = 0; i < 65536; i++) {\n        lutR[i] = Math.min(255, Math.max(0, Math.round((i * gainR - blackLevel) * scale)));\n        lutG[i] = Math.min(255, Math.max(0, Math.round((i - blackLevel) * scale)));\n        lutB[i] = Math.min(255, Math.max(0, Math.round((i * gainB - blackLevel) * scale)));\n      }\n\n      // 更新缓存\n      this.lutCache.lastParams = currentParams;\n      this.lutCache.lutR = lutR;\n      this.lutCache.lutG = lutG;\n      this.lutCache.lutB = lutB;\n\n      return { lutR, lutG, lutB };\n    },\n    // checkImageData(img) {\n    //   // 检查是否为 cv.Mat 类型\n    //   if (!(img instanceof cv.Mat)) {\n    //     this.SendConsoleLogMsg('The image is not a valid cv.Mat object.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像是否为空\n    //   if (img.empty()) {\n    //     this.SendConsoleLogMsg('The image is empty.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像深度是否为 8 位或 16 位\n    //   const depth = img.type() & cv.CV_MAT_DEPTH_MASK;\n    //   if (depth !== cv.CV_8U && depth !== cv.CV_16U) {\n    //     this.SendConsoleLogMsg('The image depth is not 8-bit or 16-bit.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像尺寸是否合理\n    //   if (img.rows <= 0 || img.cols <= 0) {\n    //     this.SendConsoleLogMsg('The image dimensions are not valid.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像数据是否超出范围或全为0\n    //   const data = img.data;\n    //   let isAllZero = true;\n    //   const maxValue = depth === cv.CV_8U ? 255 : 65535;\n\n    //   for (let i = 0; i < data.length; i++) {\n    //     if (data[i] < 0 || data[i] > maxValue) {\n    //       this.SendConsoleLogMsg('The image data contains out-of-range values.', 'error');\n    //       return false;\n    //     }\n    //     if (data[i] !== 0) {\n    //       isAllZero = false;\n    //     }\n    //   }\n\n    //   if (isAllZero) {\n    //     this.SendConsoleLogMsg('The image data is all zero.', 'error');\n    //     return false;\n    //   }\n    //   return true;\n    // },\n\n\n    // processImage(imgArray) {\n    //   this.progressValue = 0;\n    //   try {\n    //     if (!(imgArray instanceof ArrayBuffer) && !ArrayBuffer.isView(imgArray)) {\n    //       throw new Error(\"Input must be ArrayBuffer or TypedArray\");\n    //     }\n    //     const totalStartTime = new Date(); // 总开始时间\n\n    //     this.SendConsoleLogMsg('CaptureTestTime | Process image data start.', 'info');\n    //     const startTime = new Date();\n    //     let img_bit = -1;\n    //     let uintArray;\n    //     if (imgArray.byteLength === this.mainCameraSizeX * this.mainCameraSizeY * 2 ){\n    //       uintArray = new Uint16Array(imgArray);\n    //       img_bit = 16;\n    //     }else if(imgArray.byteLength === this.mainCameraSizeX * this.mainCameraSizeY){\n    //       uintArray = new Uint8Array(imgArray);\n    //       img_bit = 8;\n    //     }else{\n    //       this.SendConsoleLogMsg(`Image data is underfind bit`, 'error');\n    //       return;\n    //     }\n\n    //     this.SendConsoleLogMsg(`Image data detected as ${img_bit}-bit.`, 'info');\n\n\n\n    //     // 设置画布宽高常量\n    //     const canvasWidth = parseInt(this.mainCameraSizeX);\n    //     const canvasHeight = parseInt(this.mainCameraSizeY);\n\n    //     // 获取原始画布和修改后的画布以及对应上下文\n    //     const modifiedCanvas = document.getElementById('mainCamera-canvas');\n    //     const modifiedCtx = modifiedCanvas.getContext('2d');\n\n\n\n    //     modifiedCanvas.width = canvasWidth;\n    //     modifiedCanvas.height = canvasHeight;\n\n    //     let mat;\n    //     if (img_bit === 16){\n    //       mat = new cv.Mat(canvasHeight, canvasWidth, cv.CV_16UC1);\n    //       mat.data16U.set(uintArray);\n    //     }else{\n    //       mat = new cv.Mat(canvasHeight, canvasWidth, cv.CV_8UC1);\n    //       mat.data.set(uintArray);\n    //     }\n    //     this.progressValue = 10;\n\n    //     const matEndTime = new Date(); // mat 结束时间\n    //     this.SendConsoleLogMsg('CaptureTestTime | Mat creation time: ' + (matEndTime.getTime() - startTime.getTime()) + ' ms', 'info');\n\n    //     // 用户自定义参数\n    //     let gainR = this.ImageGainR;\n    //     let gainB = this.ImageGainB;\n    //     let offset = this.ImageOffset;\n    //     let CFA = this.ImageCFA;\n    //     let mode = 1;\n\n    //     // 参数\n    //     let B = 0;\n    //     let W = 65535;\n    //     let cvmode = 0;\n\n    //     const { blackLevel, whiteLevel } = this.GetAutoStretch(uintArray, mode, img_bit);\n    //     B = blackLevel;\n    //     W = whiteLevel;\n    //     this.progressValue = 30;\n    //     const GetAutoStretchEndTime = new Date(); // GetAutoStretch 结束时间\n    //     this.SendConsoleLogMsg('CaptureTestTime | GetAutoStretch time: ' + (GetAutoStretchEndTime.getTime() - matEndTime.getTime()) + ' ms', 'info');\n\n    //     // 根据CFA设置颜色转换模式\n    //     if (CFA === 'GR') {\n    //       cvmode = cv.COLOR_BayerGR2RGBA;\n    //     } else if (CFA === 'GB') {\n    //       cvmode = cv.COLOR_BayerGB2RGBA;\n    //     } else if (CFA === 'BG') {\n    //       cvmode = cv.COLOR_BayerBG2RGBA;\n    //     } else if (CFA === 'RGGB') {\n    //       cvmode = cv.COLOR_BayerRG2RGBA;\n    //     }else{\n    //       cvmode = cv.COLOR_GRAY2RGBA\n    //     }\n\n    //     // 对目标图像进行颜色转换\n    //     let dst = new cv.Mat();\n\n    //     try {\n    //       cv.cvtColor(mat, dst, cvmode);\n    //     } catch (error) {\n    //       this.handleError('cvtColor 出错', 'cvtColor', error);\n    //       mat.delete();\n    //       return;\n    //     }\n\n    //     this.progressValue = 50;\n\n    //     const cvtColorEndTime = new Date(); // cvtColor 结束时间\n    //     this.SendConsoleLogMsg('CaptureTestTime | cvtColor time: ' + (cvtColorEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n    //     mat.delete();\n\n    //     // 调整图像大小\n    //     // cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n    //     // dst.delete();\n\n    //     // let originalImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n    //     // resizeImg.delete();\n\n    //     let resizeImg = new cv.Mat(); // 用来存储调整后的图像\n    //     if (this.isPolarAxisMode) {\n    //       this.progressValue = 0;\n    //       // 调整图像大小\n    //       cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n    //       dst.delete();\n\n    //       let originalImg8;\n    //       if (img_bit === 16){\n    //         originalImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n    //       }else{\n    //         originalImg8 = resizeImg;\n    //       }\n\n    //       resizeImg.delete();\n\n    //       const Bit16To8_StretchEndTime = new Date(); // Bit16To8_Stretch 结束时间\n    //       this.SendConsoleLogMsg('CaptureTestTime | Bit16To8_Stretch time: ' + (Bit16To8_StretchEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n    //       let targetImg8 = this.ImageSoftAWB(originalImg8, gainR, gainB, offset);\n    //       this.$bus.$emit('showSolveImage', targetImg8);\n\n    //       const ImageSoftAWBEndTime = new Date(); // ImageSoftAWB 结束时间\n    //       this.SendConsoleLogMsg('CaptureTestTime | ImageSoftAWB time: ' + (ImageSoftAWBEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n    //     } else {\n    //       modifiedCtx.clearRect(0, 0, modifiedCanvas.width, modifiedCanvas.height);\n    //       cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n    //       this.progressValue = 70;\n    //       let originalResizeImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n    //       this.OriginalImage = new ImageData(new Uint8ClampedArray(originalResizeImg8.data), originalResizeImg8.cols, originalResizeImg8.rows);\n    //       resizeImg.delete();\n    //       originalResizeImg8.delete();\n    //       console.log('dst.data.length: ', dst.data.length);\n    //       console.log('dst.cols: ', dst.cols);\n    //       console.log('dst.rows: ', dst.rows);\n    //       let originalImg8 = this.Bit16To8_Stretch(dst, B, W);\n    //       dst.delete();\n    //       this.progressValue = 80;\n\n    //       const Bit16To8_StretchEndTime = new Date(); // Bit16To8_Stretch 结束时间\n    //       this.SendConsoleLogMsg('CaptureTestTime | Bit16To8_Stretch time: ' + (Bit16To8_StretchEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n    //       // let targetImg8 = this.ImageSoftAWB(originalImg8, gainR, gainB, offset);\n\n    //       // const ImageSoftAWBEndTime = new Date(); // ImageSoftAWB 结束时间\n    //       // this.SendConsoleLogMsg('CaptureTestTime | ImageSoftAWB time: ' + (ImageSoftAWBEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n\n    //       // originalImg8.delete();\n\n    //       this.lastImageProcessParams = {\n    //         gainR: gainR,\n    //         gainB: gainB,\n    //         offset: offset,\n    //         CFA: CFA,\n    //         mode: mode,\n    //         B: B,\n    //         W: W,\n    //         cvmode: cvmode,\n    //       };\n\n    //       modifiedCanvas.width = this.CanvasWidth;\n    //       modifiedCanvas.height = this.CanvasHeight;\n    //       let colorData = new ImageData(new Uint8ClampedArray(originalImg8.data), originalImg8.cols, originalImg8.rows);\n    //       originalImg8.delete();\n    //       this.drawImgData = colorData;\n    //       this.progressValue = 90;\n    //       // 设置缓冲画布宽高\n    //       this.bufferCanvas.width = colorData.width;\n    //       this.bufferCanvas.height = colorData.height;\n    //       // 绘制缓存画布图像\n    //       this.bufferCtx.putImageData(colorData, 0, 0);\n    //       // 绘制主画布图像\n    //       this.drawImageData();\n    //       this.progressValue = 100;\n    //       const DrawImageDataEndTime = new Date(); // DrawImageData 结束时间\n    //       this.SendConsoleLogMsg('CaptureTestTime | DrawImageData time: ' + (DrawImageDataEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n\n    //       const endTime = new Date();\n    //       const elapsedTime = endTime.getTime() - startTime.getTime();\n    //       this.SendConsoleLogMsg('CaptureTestTime | Process image data end:' + elapsedTime + ' milliseconds', 'info');\n\n    //       const totalEndTime = new Date(); // 总结束时间\n    //       this.SendConsoleLogMsg('CaptureTestTime | Total process image data time: ' + (totalEndTime.getTime() - totalStartTime.getTime()) + ' ms', 'info');\n\n    //       this.$bus.$emit('showCaptureImage');\n    //       this.MakeHistogram(colorData);\n    //       this.histogramImage = colorData;\n\n    //       const checkDetectedStarsFinish = () => {\n    //         if (this.DetectedStarsFinish) {\n    //           this.detectStarsImg = this.DrawDetectStars(targetImg8, this.DetectedStarsList);\n    //           targetImg8.delete();\n    //           clearInterval(intervalId);\n    //         }\n    //       };\n\n    //       const intervalId = setInterval(checkDetectedStarsFinish, 1000);\n    //     }\n\n    //     // if (this.isNotDrawStars) {\n    //     //   this.drawImageData(this.drawImgData);\n    //     // } else {\n    //     //   if (this.detectStarsImg != null) {\n    //     //     this.drawImageData(this.detectStarsImg);\n    //     //   } else {\n    //     //     this.drawImageData(this.drawImgData);\n    //     //   }\n    //     // }\n\n    //     // const windowWidth = window.innerWidth;\n    //     // const windowHeight = window.innerHeight;\n\n    //     // const minTranslateX = this.imageWidth - this.CanvasWidth;\n    //     // const minTranslateY = this.imageHeight - this.CanvasHeight;\n\n    //     // 计算初始的 ScaleImageSize_X 和 ScaleImageSize_Y\n    //     // this.ScaleImageSize_X = Math.floor(minTranslateX / this.CanvasWidth * windowWidth + windowWidth);\n    //     // this.ScaleImageSize_Y = Math.floor(minTranslateY / this.CanvasHeight * windowHeight + windowHeight);\n\n    //     // this.$bus.$emit('ScaleImageSize', this.ScaleImageSize_X, this.ScaleImageSize_Y);\n\n    //   } catch (error) {\n    //     this.handleError('Process image data error', 'processImage', error);\n    //     if (mat) {\n    //       mat.delete();\n    //     }\n    //     if (resizeImg) {\n    //       resizeImg.delete();\n    //     }\n    //     if (originalImg8) {\n    //       originalImg8.delete();\n    //     }\n    //     if (targetImg8) {\n    //       targetImg8.delete();\n    //     }\n    //   }\n    // },\n\n    // histogramStretch(imageData, min, max) {\n    //   const startTime = new Date();\n    //   // Convert ImageData to cv.Mat\n    //   const image = cv.matFromImageData(imageData);\n    //   let Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 转换图像数据时间: ' + (Time1.getTime() - startTime.getTime()) + ' ms', 'info');\n    //   // Perform the histogram stretch\n    //   const channels = new cv.MatVector();\n    //   cv.split(image, channels); // Split channels (BGR) into separate Mat objects\n    //   let Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 分割通道时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Calculate alpha and beta for each channel\n    //   let alpha = 255.0 / (max - min);\n    //   let beta = -min * alpha;\n\n    //   if (alpha < 0) {\n    //     alpha = 0;\n    //     beta = 0;\n    //   } else if (alpha > 255) {\n    //     alpha = 255;\n    //     beta = 0;\n    //   }\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 计算alpha和beta时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   // Iterate over each channel and apply histogram stretching\n    //   for (let i = 0; i < channels.size(); i++) {\n    //     let channel = channels.get(i);\n\n\n    //     // Apply histogram stretching to the channel\n    //     channel.convertTo(channel, -1, alpha, beta);\n\n    //     // Release the memory of channel\n    //     channel.delete();\n    //   }\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 各通道拉伸时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Merge the channels back into a single image\n    //   const stretchImage = new cv.Mat();\n    //   cv.merge(channels, stretchImage);\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 合并通道时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   // Release the memory of channels and MatVector\n    //   channels.delete();\n\n    //   // Convert cv.Mat back to ImageData\n    //   const stretchedImageData = new ImageData(new Uint8ClampedArray(stretchImage.data), stretchImage.cols, stretchImage.rows);\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 转换图像数据时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Clean up\n    //   image.delete();\n    //   stretchImage.delete();\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 释放内存时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   this.SendConsoleLogMsg('histogramStretch | 总时间: ' + (Time1.getTime() - startTime.getTime()) + ' ms', 'info');\n    //   return stretchedImageData;\n    // },\n\n    histogramStretch(imageData, min, max) {\n      if (max < min) {\n        this.SendConsoleLogMsg('histogramStretch | max < min, return original imageData', 'warning');\n        max = min;\n      }\n      const startTime = new Date();\n      // Calculate alpha and beta\n      let alpha = 255.0 / (max - min);\n      let beta = -min * alpha;\n\n      if (alpha < 0) {\n        alpha = 0;\n        beta = 0;\n      } else if (alpha > 255) {\n        alpha = 255;\n        beta = 0;\n      }\n\n      // Apply histogram stretching directly on ImageData\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        for (let j = 0; j < 3; j++) { // For each color channel\n          let value = imageData.data[i + j];\n          value = value * alpha + beta;\n          imageData.data[i + j] = Math.max(0, Math.min(255, value));\n        }\n      }\n\n      const endTime = new Date();\n      this.SendConsoleLogMsg('histogramStretch | 总时间: ' + (endTime.getTime() - startTime.getTime()) + ' ms', 'info');\n      return imageData;\n    },\n    localWhiteBalanceAdjustment(imageData, gainR, gainB, offset) {\n      // 分离通道\n      let value;\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        for (let j = 0; j < 3; j++) { // For each color channel\n          if (j == 0) {\n            value = imageData.data[i + j];\n            value = value * gainB + offset;\n          } else if (j == 2) {\n            value = imageData.data[i + j];\n            value = value * gainR + offset;\n          } else {\n            value = imageData.data[i + j];\n            value = value * 1 + offset;\n          }\n          imageData.data[i + j] = Math.max(0, Math.min(255, value));\n        }\n      }\n\n\n      return imageData;\n    },\n\n    initCanvas() {\n      this.bufferCanvas = document.createElement('canvas');\n      this.bufferCtx = this.bufferCanvas.getContext('2d');\n\n      this.tempCanvas = document.createElement('canvas');\n      this.tempCtx = this.tempCanvas.getContext('2d');\n    },\n\n    //*/*/*/*/*/*/*/*/*/*/*/\n    SwitchImageToShow(isOriginal) {\n      // console.log('Show Original Image: ', isOriginal);\n      this.SendConsoleLogMsg('Show Original Image:' + isOriginal, 'info');\n      this.isNotDrawStars = isOriginal;\n      if (isOriginal) {\n        // document.removeEventListener('click', this.handleTouchOrMouseDown);\n        this.enableMainCanvasClick = false;\n        this.drawImageData();\n      } else {\n        // document.addEventListener('click', this.handleTouchOrMouseDown);\n        this.enableMainCanvasClick = true;\n        // this.drawImageData(this.detectStarsImg);\n      }\n    },\n\n\n\n    drawImageData() {\n      if (this.bufferCanvas == null) {\n        this.SendConsoleLogMsg('drawImageData error: bufferCanvas is null or undefined.', 'error');\n        return;\n      }\n      if (!this.drawImgData) return;\n\n      // 可用相关参数\n      // window.innerWidth; // 窗口宽度\n      // window.innerHeight; // 窗口高度\n      // this.scale 缩放比例\n      // this.translateX 平移x坐标\n      // this.translateY 平移y坐标\n      // this.CanvasWidth 主画布宽度 1920\n      // this.CanvasHeight 主画布高度 1080\n      // this.mainCameraSizeX 原始图像宽度\n      // this.mainCameraSizeY 原始图像高度\n      // this.bufferCanvas.width 缓冲画布宽度\n      // this.bufferCanvas.height 缓冲画布高度\n      // this.ImageProportion 图像比例\n      // this.ROI_x ROI的x坐标\n      // this.ROI_y ROI的y坐标\n      // this.ROI_length ROI的长度\n\n      // console.log('当前画布参数:\\n bufferCanvas.width: ', this.bufferCanvas.width, '\\n bufferCanvas.height: ', this.bufferCanvas.height, '\\n ImageProportion: ', this.ImageProportion, '\\n scale: ', this.scale, '\\n visibleX: ', this.visibleX, '\\n visibleY: ', this.visibleY, '\\n visibleWidth: ', this.visibleWidth, '\\n visibleHeight: ', this.visibleHeight, '\\n ROI_x: ', this.ROI_x, '\\n ROI_y: ', this.ROI_y, '\\n ROI_length: ', this.ROI_length);\n\n\n      // 计算可见区域\n      const newVisibleWidth = this.bufferCanvas.width * this.scale;\n      const newVisibleHeight = newVisibleWidth / this.ImageProportion;\n\n      // 计算可见区域x坐标\n      let newVisibleX = this.visibleX;\n      // 计算可见区域y坐标\n      let newVisibleY = this.visibleY;\n\n      // 避免图像越界\n      if (newVisibleX - newVisibleWidth / 2 < 0) {\n        newVisibleX = newVisibleWidth / 2;\n      } else if (newVisibleX + newVisibleWidth / 2 > this.bufferCanvas.width) {\n        newVisibleX = this.bufferCanvas.width - newVisibleWidth / 2;\n      }\n\n      if (newVisibleY - newVisibleHeight / 2 < 0) {\n        newVisibleY = newVisibleHeight / 2;\n      } else if (newVisibleY + newVisibleHeight / 2 > this.bufferCanvas.height) {\n        newVisibleY = this.bufferCanvas.height - newVisibleHeight / 2;\n      }\n\n      // 更新ROI区域\n      // 计算可见区域的边界\n      const visibleLeft = newVisibleX - newVisibleWidth / 2;\n      const visibleRight = newVisibleX + newVisibleWidth / 2;\n      const visibleTop = newVisibleY - newVisibleHeight / 2;\n      const visibleBottom = newVisibleY + newVisibleHeight / 2;\n\n      // 计算 ROI 区域的边界\n      const roiLeft = this.ROI_x;\n      const roiRight = this.ROI_x + this.ROI_length;\n      const roiTop = this.ROI_y;\n      const roiBottom = this.ROI_y + this.ROI_length;\n\n      // 判断 ROI 区域是否在可见区域内\n      const isRoiInVisible = roiRight >= visibleLeft && roiLeft <= visibleRight && roiBottom >= visibleTop && roiTop <= visibleBottom;\n\n      // 计算 ROI 区域在屏幕上的位置，中心点坐标\n      const roiScreenX = (this.ROI_x - visibleLeft) * (window.innerWidth / newVisibleWidth) + this.RedBoxSideLength * window.innerWidth / newVisibleWidth / 2;\n      const roiScreenY = (this.ROI_y - visibleTop) * (window.innerHeight / newVisibleHeight) + this.RedBoxSideLength * window.innerHeight / newVisibleHeight / 2;\n      // this.SendConsoleLogMsg('ROI 区域在屏幕上的位置: ' + roiScreenX + '*' + roiScreenY + '长度 ' + this.RedBoxSideLength * window.innerWidth / newVisibleWidth + '*' + this.RedBoxSideLength * window.innerHeight / newVisibleHeight, 'info');\n      this.$bus.$emit('setRedBoxLength', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n      this.$bus.$emit('setRedBoxPosition', roiScreenX, roiScreenY);\n\n\n      const canvas = this.$refs.mainCanvas;\n      const ctx = canvas.getContext('2d');\n      canvas.width = this.CanvasWidth;\n      canvas.height = this.CanvasHeight;\n\n      ctx.drawImage(this.bufferCanvas, visibleLeft, visibleTop, newVisibleWidth, newVisibleHeight, 0, 0, canvas.width, canvas.height);\n\n      this.visibleX = newVisibleX;\n      this.visibleY = newVisibleY;\n      this.visibleWidth = newVisibleWidth;\n      this.visibleHeight = newVisibleHeight;\n\n      this.$bus.$emit('setCurrentMainCanvasHasImage', true); // 发送给电调，用于判断是否可以进行循环拍摄\n      // 发送消息给QT客户端，用于信息图标\n      // 统一坐标：发送给 QT 的 ROI 坐标采用传感器像素坐标（不再按 bin 放大），避免在回环中被重复乘以 bin 导致指数级增长\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendVisibleArea:' + this.visibleX + ':' + this.visibleY + ':' + this.scale);\n\n      // 如果选择了星点，则根据选择位置，在ROI区域中绘制一个圆\n      if (this.DrawSelectStarX != -1 && this.DrawSelectStarY != -1 && this.showSelectStar) {\n        let radius, canvasStarX, canvasStarY, color;\n        // 如果有星点\n        if (this.DrawSelectStarHFR != -1) {\n          radius = this.DrawSelectStarHFR / this.scale * 2;\n          if (radius <= 1) radius = 1;\n          canvasStarX = (this.DrawSelectStarX / this.cameraBin + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n          canvasStarY = (this.DrawSelectStarY / this.cameraBin + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n          color = 'green'; // 有星点，绘制绿色的圆\n        } else {\n          // 否则，在选择的位置绘制一个圆\n          radius = 10 / this.scale; // 你可以根据需要调整这个值\n          canvasStarX = (this.DrawSelectStarX / this.cameraBin + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n          canvasStarY = (this.DrawSelectStarY / this.cameraBin + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n          color = 'red'; // 无星点，绘制红色的圆\n        }\n\n        // 获取绘制圆的位置的图像数据\n        const imageData = ctx.getImageData(canvasStarX - radius, canvasStarY - radius, 2 * radius, 2 * radius);\n        // 发送图像数据给显示框\n        this.$bus.$emit('selectStarImage', imageData);\n        console.log('绘制星点的位置和大小: x =', canvasStarX, 'y =', canvasStarY, 'radius =', radius);\n        // 在指定位置开始绘制圆\n        ctx.beginPath();\n        ctx.arc(canvasStarX, canvasStarY, radius, 0, 2 * Math.PI);\n        ctx.strokeStyle = color;\n        ctx.lineWidth = 3;\n        ctx.stroke();\n        ctx.closePath();\n      }\n\n    },\n\n    addEventListeners() {\n\n    },\n\n    // 节流函数\n    throttle(func, delay) {\n      let lastExecuted = 0;\n      return function (...args) {\n        const now = Date.now();\n        if (now - lastExecuted >= delay) {\n          func.apply(this, args);\n          lastExecuted = now;\n        }\n      };\n    },\n\n    Bit16To8_Stretch(img16, B, W) {\n      console.log('Bit16To8_Stretch | B = ' + B + ', W = ' + W);\n      let img8 = new cv.Mat(img16.rows, img16.cols, cv.CV_8UC4);\n      img16.convertTo(img8, cv.CV_8U, 255.0 / (W - B), -B * 255.0 / (W - B));\n      return img8;\n    },\n\n    DrawDetectStars(image, Stars) {\n      console.log('Draw circle on the Capture Image(', image.cols, ',', image.rows, ').');\n      if (!(image instanceof cv.Mat)) {\n        throw new Error('Invalid image data');\n      }\n      Stars.forEach(star => {\n        let centerX = Math.round(star.x / (this.mainCameraSizeX / image.cols));\n        let centerY = Math.round(star.y / (this.mainCameraSizeY / image.rows));\n        let radius = Math.round(star.hfr);\n\n        console.log('Draw circle at(', centerX, ',', centerY, ') with radius:', radius);\n\n        let center = new cv.Point(centerX, centerY);\n        let color = new cv.Scalar(255, 0, 0, 255);\n        let thickness = 2; // 圆圈厚度\n\n        cv.circle(image, center, radius, color, thickness);\n\n        // 添加 hfr 值到圆的上方\n        // 确保 star.hfr 是一个数字\n        let hfrValue = parseFloat(star.hfr);\n        if (isNaN(hfrValue)) {\n          hfrValue = 0; // 如果 star.hfr 不能转换为数字，则默认值设为0\n        }\n\n        // 保留到小数点后2位\n        let text = hfrValue.toFixed(2);\n        let fontFace = cv.FONT_HERSHEY_SIMPLEX;\n        let fontScale = 1;\n        let textColor = new cv.Scalar(255, 0, 0, 255);\n        let textThickness = 2;\n\n        // 手动设置文本的位置，假设字体高度大约为10像素\n        let textX = centerX - (text.length * 10); // 估算每个字符宽度为5像素\n        let textY = centerY - radius - 3; // 圆的上方 3 像素\n\n        // 在图像上绘制文本\n        cv.putText(image, text, new cv.Point(textX, textY), fontFace, fontScale, textColor, textThickness);\n      });\n\n      const imageData = new ImageData(new Uint8ClampedArray(image.data), image.cols, image.rows);\n\n      return imageData;\n    },\n\n    DrawPHD2Box(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const BoxWidth = 20 / ratioZoomX;\n      const BoxHeight = 20 / ratioZoomY;\n\n      const BoxStartX = Box_X / ratioZoomX - BoxWidth / 2;\n      const BoxStartY = Box_Y / ratioZoomY - BoxHeight / 2;\n\n      this.$bus.$emit('PHD2BoxPosition', BoxStartX, BoxStartY, BoxWidth, BoxHeight);\n    },\n\n    DrawPHD2Cross(PHD2ImageSize_X, PHD2ImageSize_Y, Cross_X, Cross_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const CrossStartX = Cross_X / ratioZoomX;\n      const CrossStartY = Cross_Y / ratioZoomY;\n\n      this.$bus.$emit('PHD2CrossPosition', CrossStartX, CrossStartY);\n    },\n\n    DrawPHD2MultiStars(PHD2ImageSize_X, PHD2ImageSize_Y, Star_X, Star_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const StarStartX = Star_X / ratioZoomX - 12 / 2;\n      const StarStartY = Star_Y / ratioZoomY - 12 / 2;\n\n      this.$bus.$emit('PHD2MultiStarsPosition', StarStartX, StarStartY);\n    },\n\n    calculateHistogram(imageData) {\n      console.log('QHYCCD | calculateHistogram');\n      const histogram = [\n        Array(256).fill(0), // 存储蓝色通道直方图\n        Array(256).fill(0), // 存储绿色通道直方图\n        Array(256).fill(0)  // 存储红色通道直方图\n      ];\n\n      // 分别计算三个通道的直方图\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        const r = imageData.data[i];\n        const g = imageData.data[i + 1];\n        const b = imageData.data[i + 2];\n\n        // 更新每个通道的直方图\n        histogram[0][b]++;\n        histogram[1][g]++;\n        histogram[2][r]++;\n      }\n\n      return histogram;\n    },\n\n    applyHistStretch(Min, Max) {\n      this.currentHistogramMin = Min;\n      this.currentHistogramMax = Max;\n      if (this.ImageArrayBuffer) {\n        this.processImage(this.ImageArrayBuffer, Min, Max, { calculateHistogram: false });\n      }\n      this.$bus.$emit('ChangeDialPosition', Min, Max);\n    },\n\n\n    calcWhiteBalanceGains() {\n      // const Gains = this.calculateWhiteBalanceGains(this.histogramData, this.ImageOffset);\n      this.calculateGain = true;\n      this.processImage(this.ImageArrayBuffer, this.currentHistogramMin, this.currentHistogramMax, { calculateHistogram: false });\n\n      this.ImageGainR = Gains.GainR;\n      this.ImageGainB = Gains.GainB;\n\n      const GainRIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ImageGainR');\n      if (GainRIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.MainCameraConfigItems[GainRIndex].value = this.ImageGainR;\n      } else {\n        console.error('ImageGainR configuration item not found.');\n      }\n\n      const GainBIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ImageGainB');\n      if (GainBIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.MainCameraConfigItems[GainBIndex].value = this.ImageGainB;\n      } else {\n        console.error('ImageGainB configuration item not found.');\n      }\n\n    },\n\n\n    calculateWhiteBalanceGains() {\n      if (!(this.OriginalImage instanceof ImageData)) {\n        throw new Error('Invalid image data');\n      }\n\n      // 创建 cv.Mat 对象\n      const img8 = cv.matFromImageData(this.OriginalImage);\n\n      // 分割通道\n      const channels = new cv.MatVector();\n      cv.split(img8, channels);\n\n      // 获取各通道\n      const b = channels.get(0);\n      const g = channels.get(1);\n      const r = channels.get(2);\n\n      // 计算中位数\n      const medianB = new cv.Mat();\n      const medianG = new cv.Mat();\n      const medianR = new cv.Mat();\n      cv.medianBlur(b, medianB, 5);\n      cv.medianBlur(g, medianG, 5);\n      cv.medianBlur(r, medianR, 5);\n\n      // 计算平均亮度\n      const avgB = cv.mean(medianB)[0];\n      const avgG = cv.mean(medianG)[0];\n      const avgR = cv.mean(medianR)[0];\n\n      // 计算增益\n      const gainR = Math.min(Math.max(avgG / avgR, 0.1), 3);\n      const gainB = Math.min(Math.max(avgG / avgB, 0.1), 3);\n\n      // 释放内存\n      b.delete();\n      g.delete();\n      r.delete();\n      medianB.delete();\n      medianG.delete();\n      medianR.delete();\n      channels.delete();\n      img8.delete();\n\n      return { GainR: gainR, GainB: gainB };\n    },\n\n    loadOpenCv() {\n      return new Promise((resolve, reject) => {\n        if (typeof cv === 'undefined') {\n          // 如果 cv 未定义，尝试加载 OpenCV.js\n          const script = document.createElement('script');\n          script.src = '/opencv.js'; // 使用 public 文件夹中的路径\n          script.async = true;\n          script.onload = () => {\n            resolve();\n          };\n          script.onerror = (error) => {\n            reject(error);\n          };\n          document.head.appendChild(script);\n        } else {\n          // 如果 cv 已定义，直接解析\n          resolve();\n        }\n      });\n    },\n\n\n    onCvReady() {\n\n      // Test if some of opencv method can work.\n      if (cv) {\n        console.log(\"QHYCCD | OpenCV.js is ready.\");\n        this.SendConsoleLogMsg('OpenCV.js is ready.', 'info');\n      } else {\n        console.log(\"QHYCCD | Failed to load OpenCV.js\");\n        this.SendConsoleLogMsg('Failed to load OpenCV.js.', 'error');\n      }\n\n      this.cvReady = true;\n    },\n\n\n    loadImageToCanvasMainCamera: function () {\n      const canvas = document.getElementById('mainCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n      image.src = BackgroundImage;\n    },\n    loadImageToCanvasGuiderCamera: function () {\n      const canvas = document.getElementById('guiderCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n      image.src = BackgroundImage;\n    },\n\n\n    showGuiderCameraCanvas() {\n      // 动态更新z-index\n      this.canvasZIndexStel = -10;\n      this.canvasZIndexMainCamera = -11;\n      this.canvasZIndexGuiderCamera = 0;\n      this.$bus.$emit('setParsingProgress', false);\n\n      // this.convertToGrayscale();\n    },\n\n    showStelCanvas() {\n      if (this.isPolarAxisMode) {\n        this.$bus.$emit('setParsingProgress', true);\n      } else {\n        this.$bus.$emit('setParsingProgress', false);\n      }\n      this.canvasZIndexStel = 0;\n      this.canvasZIndexMainCamera = -10;\n      this.canvasZIndexGuiderCamera = -11;\n    },\n\n    showMainCameraCanvas() {\n      this.canvasZIndexStel = -10;\n      this.canvasZIndexMainCamera = 0;\n      this.canvasZIndexGuiderCamera = -11;\n\n      this.$bus.$emit('setParsingProgress', false);\n    },\n\n\n    handleButtonTestClick() {\n      // this.changeOrder();\n      if (this.currentcanvas === 'Stel') {\n        this.currentcanvas = 'MainCamera';\n        this.showMainCameraCanvas();\n      }\n      else if (this.currentcanvas === 'MainCamera') {\n        this.currentcanvas = 'GuiderCamera';\n        this.showGuiderCameraCanvas();\n      }\n      else if (this.currentcanvas === 'GuiderCamera') {\n        this.currentcanvas = 'Stel';\n        this.showStelCanvas();\n      }\n    },\n\n    getPluginsMenuItems: function () {\n      let res = []\n      for (const i in this.$stellariumWebPlugins()) {\n        const plugin = this.$stellariumWebPlugins()[i]\n        if (plugin.menuItems) {\n          res = res.concat(plugin.menuItems)\n        }\n      }\n      return res\n    },\n    getPluginsMenuComponents: function () {\n      let res = []\n      for (const i in this.$stellariumWebPlugins()) {\n        const plugin = this.$stellariumWebPlugins()[i]\n        if (plugin.menuComponents) {\n          res = res.concat(plugin.menuComponents)\n        }\n      }\n      return res\n    },\n    toggleStoreValue: function (storeVarName) {\n      this.nav = false;\n      this.$store.commit('toggleBool', storeVarName)\n    },\n    getStoreValue: function (storeVarName) {\n      return _.get(this.$store.state, storeVarName)\n    },\n    setStateFromQueryArgs: function () {\n      // Check whether the observing panel must be displayed\n      this.$store.commit('setValue', { varName: 'showSidePanel', newValue: this.$route.path.startsWith('/p/') })\n\n      // Set the core's state from URL query arguments such\n      // as date, location, view direction & fov\n      let that = this\n\n      if (!this.initDone) {\n        this.$stel.core.time_speed = 1\n        let d = new Date()\n        if (this.$route.query.date) {\n          d = new Moment(this.$route.query.date).toDate()\n          this.$stel.core.observer.utc = d.getMJD()\n          this.startTimeIsSet = true\n        }\n\n        if (this.$route.query.lng && this.$route.query.lat) {\n          const pos = { lat: Number(this.$route.query.lat), lng: Number(this.$route.query.lng), alt: this.$route.query.elev ? Number(this.$route.query.elev) : 0, accuracy: 1 }\n          swh.geoCodePosition(pos, that).then((loc) => {\n            that.$store.commit('setCurrentLocation', loc)\n          }, (error) => { console.log(error) })\n        }\n\n        this.$stel.core.observer.yaw = this.$route.query.az ? Number(this.$route.query.az) * Math.PI / 180 : 0\n        this.$stel.core.observer.pitch = this.$route.query.alt ? Number(this.$route.query.alt) * Math.PI / 180 : 30 * Math.PI / 180\n        this.$stel.core.fov = this.$route.query.fov ? Number(this.$route.query.fov) * Math.PI / 180 : 120 * Math.PI / 180\n\n        this.initDone = true\n      }\n\n      if (this.$route.path.startsWith('/skysource/')) {\n        const name = decodeURIComponent(this.$route.path.substring(11))\n        console.log('Will select object: ' + name)\n        this.SendConsoleLogMsg('Will select object: ' + name, 'info');\n        return swh.lookupSkySourceByName(name).then(ss => {\n          if (!ss) {\n            return\n          }\n          let obj = swh.skySource2SweObj(ss)\n          if (!obj) {\n            obj = this.$stel.createObj(ss.model, ss)\n            this.$selectionLayer.add(obj)\n          }\n          if (!obj) {\n            console.warning(\"Can't find object in SWE: \" + ss.names[0])\n          }\n          swh.setSweObjAsSelection(obj)\n        }, err => {\n          console.log(err)\n          console.log(\"Couldn't find skysource for name: \" + name)\n          this.SendConsoleLogMsg(\"Couldn't find skysource for name: \" + name, 'error');\n        })\n      }\n    },\n\n    lookatcircle() {\n      // glStel.core.selection = glTestCircle;\n      glStel.pointAndLock(glTestCircle);\n    },\n\n    setGloabalStel: function (stel) {\n      return stel;\n    },\n\n    setGlobalLayer: function (stel) {\n      return stel.createLayer({ id: 'testLayerStars', z: 7, visible: true });\n    },\n\n    // 坐标验证方法\n    isValidCoordinate: function (coord) {\n      // 如果是字符串，尝试转换为数字\n      if (typeof coord === 'string') {\n        coord = parseFloat(coord);\n      }\n\n      return typeof coord === 'number' &&\n        !isNaN(coord) &&\n        isFinite(coord) &&\n        coord >= -360 &&\n        coord <= 360;\n    },\n\n    vec3_from_sphe: function (ra_degree, dec_degree, out) {\n      // 确保坐标是数字类型\n      let ra = ra_degree;\n      let dec = dec_degree;\n\n      if (typeof ra === 'string') {\n        ra = parseFloat(ra);\n      }\n      if (typeof dec === 'string') {\n        dec = parseFloat(dec);\n      }\n\n      // 添加坐标验证\n      if (!this.isValidCoordinate(ra) || !this.isValidCoordinate(dec)) {\n        console.error('无效的坐标输入:', { ra_degree, dec_degree, converted: { ra, dec } });\n        return;\n      }\n\n      try {\n        const cp = Math.cos(dec * Math.PI / 180);\n        out[0] = Math.cos(ra * Math.PI / 180) * cp;\n        out[1] = Math.sin(ra * Math.PI / 180) * cp;\n        out[2] = Math.sin(dec * Math.PI / 180);\n      } catch (error) {\n        console.error('坐标转换出错:', error, { ra_degree, dec_degree, converted: { ra, dec } });\n      }\n    },\n\n    testAddCircle: function (stel, layer) {\n      console.log(\"Add a circle star near polaris\");\n\n      // 为临时对象创建带有名称的配置\n      const circleConfig = {\n        id: 'test_circle_' + Date.now(),\n        model_data: {},\n        names: ['Test Circle'],  // 添加名称\n        types: ['Temporary'],\n        model: 'temporary'\n      };\n\n      let circle = stel.createObj('circle', circleConfig);\n\n      circle.update();\n      layer.add(circle);\n\n      // 现在可以安全地选择对象，因为它有名称\n      stel.core.selection = circle;\n      stel.pointAndLock(circle);\n\n      // Circle Property\n      let mm = circle.pos;\n      this.vec3_from_sphe(2.52971, 89.2641, mm);\n      circle.pos = mm;\n      console.log(\"circle pos:\" + mm);\n      circle.label = \"\";\n      circle.frame = 1;\n      circle.size = [0.05, 0.05];\n      circle.color = [0, 1, 0, 0.25];\n      circle.border_color = [0, 1, 0, 1];\n\n      return circle;\n    },\n\n    UpdateCirclePos(Ra_degree, Dec_degree) {\n      // 添加安全检查\n      if (!glTestCircle || !glTestCircle.pos) {\n        console.warn('glTestCircle 未初始化，跳过位置更新');\n        return;\n      }\n      \n      let mm = glTestCircle.pos;\n      this.vec3_from_sphe(Ra_degree, Dec_degree, mm);\n      glTestCircle.pos = mm;\n      // console.log(\"赤道仪位置更新为:\"+Ra_degree+\"+\"+Dec_degree);\n    },\n\n    UpdateTelescopeStatus(status) {\n      this.$bus.$emit('MountStatus', status);\n      \n      // 添加安全检查\n      if (!glTestCircle) {\n        console.warn('glTestCircle 未初始化，跳过状态更新');\n        return;\n      }\n      \n      if (status === 'Moving') {\n        glTestCircle.color = [1, 0, 0, 0.25];\n        glTestCircle.border_color = [1, 0, 0, 1];\n      } else {\n        glTestCircle.color = [0, 1, 0, 0.25];\n        glTestCircle.border_color = [0, 1, 0, 1];\n      }\n    },\n\n    UpdateMainCameraStatus(status) {\n      this.$bus.$emit('MainCameraStatus', status);\n    },\n\n    // 绘制视场多边形（基于五个RA/DEC坐标的闭环）\n    AddFieldOfViewPolygon: function (stel, layer, coordinates, color, name) {\n      console.log(`开始创建视场多边形: ${name}`, { coordinates, color });\n\n      try {\n        // 验证输入参数\n        if (!coordinates || !Array.isArray(coordinates)) {\n          console.error('视场坐标必须是数组');\n          return null;\n        }\n\n        if (coordinates.length !== 5) {\n          console.error(`视场坐标必须是5个点，当前有${coordinates.length}个点`);\n          return null;\n        }\n\n        // 验证每个坐标点\n        for (let i = 0; i < coordinates.length; i++) {\n          const coord = coordinates[i];\n          if (!coord || typeof coord.ra === 'undefined' || typeof coord.dec === 'undefined') {\n            console.error(`坐标点${i}格式错误，需要包含ra和dec属性:`, coord);\n            return null;\n          }\n\n          // 验证坐标值\n          if (!this.isValidCoordinate(coord.ra) || !this.isValidCoordinate(coord.dec)) {\n            console.error(`坐标点${i}的值无效:`, coord);\n            return null;\n          }\n        }\n\n        // 设置默认颜色\n        const defaultColor = {\n          stroke: \"#FFFFFF\",\n          strokeOpacity: 1,\n          fill: \"#1E90FF\",\n          fillOpacity: 0.25\n        };\n\n        const finalColor = { ...defaultColor, ...color };\n        console.log('最终颜色配置:', finalColor);\n\n        // 创建多边形对象\n        const polygonConfig = {\n          id: 'field_of_view_' + Date.now(),\n          model_data: {},\n          names: [name || 'Field of View'],\n          types: ['FieldOfView'],\n          model: 'field_of_view'\n        };\n\n        console.log('创建GeoJSON多边形对象');\n        let polygon = stel.createObj('geojson', {\n          data: {\n            \"type\": \"FeatureCollection\",\n            \"features\": [\n              {\n                \"type\": \"Feature\",\n                \"properties\": {\n                  \"stroke\": finalColor.stroke,\n                  \"stroke-opacity\": finalColor.strokeOpacity,\n                  \"fill\": finalColor.fill,\n                  \"fill-opacity\": finalColor.fillOpacity,\n                  \"name\": name || 'Field of View'\n                },\n                \"geometry\": {\n                  \"type\": \"Polygon\",\n                  \"coordinates\": [\n                    [\n                      // 五个坐标点，形成闭环\n                      [coordinates[0].ra, coordinates[0].dec],\n                      [coordinates[1].ra, coordinates[1].dec],\n                      [coordinates[2].ra, coordinates[2].dec],\n                      [coordinates[3].ra, coordinates[3].dec],\n                      [coordinates[0].ra, coordinates[0].dec]  // 闭合多边形\n                    ]\n                  ]\n                }\n              }\n            ]\n          }\n        });\n\n        if (!polygon) {\n          console.error('GeoJSON多边形对象创建失败');\n          return null;\n        }\n\n        console.log('多边形对象创建成功，开始更新和添加到图层');\n\n        // 设置对象属性\n        polygon.update();\n        layer.add(polygon);\n\n        console.log('多边形已添加到图层');\n\n        // // 添加标签（可选）\n        // if (name) {\n        //   console.log('添加多边形标签');\n        //   // 计算视场中心点\n        //   const centerRa = coordinates.reduce((sum, coord) => sum + coord.ra, 0) / coordinates.length;\n        //   const centerDec = coordinates.reduce((sum, coord) => sum + coord.dec, 0) / coordinates.length;\n\n        //   let labelCircle = this.AddMarkCircle(stel, layer, 4, name);\n        //   if (labelCircle) {\n        //     let labelMm = labelCircle.pos;\n        //     this.vec3_from_sphe(centerRa, centerDec + 0.02, labelMm); // 在视场上方显示名称\n        //     labelCircle.pos = labelMm;\n        //     labelCircle.color = [1, 1, 1, 0.8];  // 白色，半透明\n        //     labelCircle.border_color = [0, 0, 0, 0.5];  // 黑色边框，半透明\n        //     labelCircle.size = [0.01, 0.01];  // 很小的圆圈作为名称标签\n\n        //     // 将标签与多边形关联\n        //     polygon.labelCircle = labelCircle;\n        //     console.log('标签已添加到多边形');\n        //   } else {\n        //     console.warn('标签创建失败');\n        //   }\n        // }\n\n        console.log(`视场多边形创建完成: ${name || 'Field of View'}`, {\n          coordinates: coordinates,\n          color: finalColor,\n          polygon: polygon\n        });\n\n        return polygon;\n\n      } catch (error) {\n        console.error('创建视场多边形时出错:', error);\n        console.error('错误堆栈:', error.stack);\n        return null;\n      }\n    },\n\n    // 删除指定的视场多边形\n    RemoveFieldOfViewPolygon: function (polygon) {\n      try {\n        if (!polygon) {\n          console.warn('要删除的多边形对象为空');\n          return false;\n        }\n\n        // 删除关联的标签\n        if (polygon.labelCircle) {\n          glLayer.remove(polygon.labelCircle);\n        }\n\n        // 删除多边形\n        glLayer.remove(polygon);\n\n        console.log('视场多边形已删除:', polygon);\n        return true;\n\n      } catch (error) {\n        console.error('删除视场多边形时出错:', error);\n        return false;\n      }\n    },\n\n    // 删除所有视场多边形\n    RemoveAllFieldOfViewPolygons: function () {\n      try {\n        // 如果有多边形数组，遍历删除\n        if (this.fieldOfViewPolygons && Array.isArray(this.fieldOfViewPolygons)) {\n          this.fieldOfViewPolygons.forEach(polygon => {\n            this.RemoveFieldOfViewPolygon(polygon);\n          });\n          this.fieldOfViewPolygons = [];\n        }\n\n        console.log('所有视场多边形已删除');\n        return true;\n\n      } catch (error) {\n        console.error('删除所有视场多边形时出错:', error);\n        return false;\n      }\n    },\n\n    // 更新视场多边形的位置\n    UpdateFieldOfViewPolygonPosition: function (polygon, newCoordinates) {\n      try {\n        if (!polygon || !newCoordinates || !Array.isArray(newCoordinates) || newCoordinates.length !== 5) {\n          console.error('更新视场多边形位置时参数无效');\n          return false;\n        }\n\n        // 验证新坐标\n        for (let i = 0; i < newCoordinates.length; i++) {\n          const coord = newCoordinates[i];\n          if (!this.isValidCoordinate(coord.ra) || !this.isValidCoordinate(coord.dec)) {\n            console.error(`新坐标点${i}的值无效:`, coord);\n            return false;\n          }\n        }\n\n        // 更新多边形数据\n        polygon.data.features[0].geometry.coordinates[0] = [\n          [newCoordinates[0].ra, newCoordinates[0].dec],\n          [newCoordinates[1].ra, newCoordinates[1].dec],\n          [newCoordinates[2].ra, newCoordinates[2].dec],\n          [newCoordinates[3].ra, newCoordinates[3].dec],\n          [newCoordinates[4].ra, newCoordinates[4].dec],\n          [newCoordinates[0].ra, newCoordinates[0].dec]  // 闭合\n        ];\n\n        polygon.update();\n\n        // 更新标签位置（如果存在）\n        if (polygon.labelCircle) {\n          const centerRa = newCoordinates.reduce((sum, coord) => sum + coord.ra, 0) / newCoordinates.length;\n          const centerDec = newCoordinates.reduce((sum, coord) => sum + coord.dec, 0) / newCoordinates.length;\n\n          let labelMm = polygon.labelCircle.pos;\n          this.vec3_from_sphe(centerRa, centerDec + 0.02, labelMm);\n          polygon.labelCircle.pos = labelMm;\n        }\n\n        console.log('视场多边形位置已更新:', newCoordinates);\n        return true;\n\n      } catch (error) {\n        console.error('更新视场多边形位置时出错:', error);\n        return false;\n      }\n    },\n\n    UpdateMainCameraTemperature(value) {\n      // console.log('Main Camera Temperature:', value + '°');\n      this.$bus.$emit('MainCameraTemperature', value);\n    },\n\n    setPolarPointAltitude(Altitude) {\n      this.PolarPoint_Altitude = Altitude;\n      console.log('Polar Point Altitude:', this.PolarPoint_Altitude);\n      this.SendConsoleLogMsg('Polar Point Altitude:' + this.PolarPoint_Altitude, 'info');\n    },\n\n    AddMarkCircle: function (stel, layer, frame, label) {\n      console.log(`开始创建标记圆圈: ${label}`);\n\n      try {\n        // 为临时对象创建带有名称的配置\n        const circleConfig = {\n          id: 'temp_circle_' + Date.now(),\n          model_data: {},\n          names: [label || 'Temporary Marker'],  // 添加名称\n          types: ['Temporary'],\n          model: 'temporary'\n        };\n\n        console.log('创建圆形对象');\n        let circle = stel.createObj('circle', circleConfig);\n\n        if (!circle) {\n          console.error('圆形对象创建失败');\n          return null;\n        }\n\n        console.log('圆形对象创建成功，开始设置属性');\n        circle.update();\n        layer.add(circle);\n\n        // 设置默认位置（北极星附近）\n        let mm = circle.pos;\n        this.vec3_from_sphe(2.52971, 89.2641, mm);\n        circle.pos = mm;\n\n        // 设置圆形属性\n        circle.label = label;\n        circle.frame = frame;\n        circle.size = [0.04, 0.04];\n        circle.color = [1, 1, 1, 0.5];\n        circle.border_color = [1, 1, 1, 1];\n\n        console.log(`标记圆圈创建完成: ${label}`, {\n          pos: mm,\n          size: circle.size,\n          color: circle.color,\n          border_color: circle.border_color\n        });\n\n        return circle;\n      } catch (error) {\n        console.error('创建标记圆圈时出错:', error);\n        console.error('错误堆栈:', error.stack);\n        return null;\n      }\n    },\n\n    AddMarkRectangle: function (stel, layer, RaDec) {\n      let line = stel.createObj('geojson', {\n        data: {\n          \"type\": \"FeatureCollection\",\n          \"features\": [\n            {\n              \"type\": \"Feature\",\n              \"properties\": {\n                \"stroke\": \"#FFFFFF\",\n                \"stroke-opacity\": 1,\n                \"fill\": \"#1E90FF\",\n                \"fill-opacity\": 0.25\n              },\n              \"geometry\": {\n                \"type\": \"Polygon\",\n                \"coordinates\": [\n                  [\n                    // [139.76, 35.52], [139.32, 33.41], [140.92, 33.08], [141.35, 35.19], [139.76, 35.52]\n                    [parseFloat(RaDec[0].Ra), parseFloat(RaDec[0].Dec)], [parseFloat(RaDec[1].Ra), parseFloat(RaDec[1].Dec)],\n                    [parseFloat(RaDec[2].Ra), parseFloat(RaDec[2].Dec)], [parseFloat(RaDec[3].Ra), parseFloat(RaDec[3].Dec)],\n                    [parseFloat(RaDec[0].Ra), parseFloat(RaDec[0].Dec)]\n                  ]\n                ]\n              }\n            },\n          ]\n        }\n      });\n\n      line.update();\n      layer.add(line);\n      return line;\n    },\n\n\n\n    // 辅助方法：将十六进制颜色转换为RGB\n    hexToRgb: function (hex) {\n      // 移除#号\n      hex = hex.replace('#', '');\n\n      // 解析RGB值\n      const r = parseInt(hex.substr(0, 2), 16);\n      const g = parseInt(hex.substr(2, 2), 16);\n      const b = parseInt(hex.substr(4, 2), 16);\n\n      return { r, g, b };\n    },\n\n    // 更新视场方法\n    updateFieldOfView: function (field) {\n      if (!field || !field.fieldInfo) return;\n\n      const info = field.fieldInfo;\n\n      // 计算视场的四个角点\n      const corners = [\n        { Ra: info.maxRa, Dec: info.maxDec },\n        { Ra: info.minRa, Dec: info.maxDec },\n        { Ra: info.minRa, Dec: info.minDec },\n        { Ra: info.maxRa, Dec: info.minDec },\n        { Ra: info.maxRa, Dec: info.maxDec }  // 闭合多边形\n      ];\n\n      // 更新GeoJSON数据\n      field.data = {\n        \"type\": \"FeatureCollection\",\n        \"features\": [\n          {\n            \"type\": \"Feature\",\n            \"properties\": {\n              \"stroke\": info.color,\n              \"strokeOpacity\": 0.8,\n              \"fill\": info.color,\n              \"fillOpacity\": 0.2\n            },\n            \"geometry\": {\n              \"type\": \"Polygon\",\n              \"coordinates\":\n                [\n                  [parseFloat(corners[0].Ra), parseFloat(corners[0].Dec)],\n                  [parseFloat(corners[1].Ra), parseFloat(corners[1].Dec)],\n                  [parseFloat(corners[2].Ra), parseFloat(corners[2].Dec)],\n                  [parseFloat(corners[3].Ra), parseFloat(corners[3].Dec)],\n                  [parseFloat(corners[4].Ra), parseFloat(corners[4].Dec)]\n                ]\n            }\n          }\n        ]\n      };\n\n      field.update();\n    },\n\n    // 启动视场更新定时器\n    startFieldUpdateTimer: function () {\n      if (this.fieldUpdateTimer) {\n        clearInterval(this.fieldUpdateTimer);\n      }\n\n      this.fieldUpdateTimer = setInterval(() => {\n        // 更新校准点视场\n        if (this.calibrationCircles) {\n          this.calibrationCircles.forEach(field => {\n            if (field.fieldInfo) {\n              this.updateFieldOfView(field);\n            }\n          });\n        }\n\n        // 更新调整点视场\n        if (this.adjustmentCircles) {\n          this.adjustmentCircles.forEach(field => {\n            if (field.fieldInfo) {\n              this.updateFieldOfView(field);\n            }\n          });\n        }\n      }, 3000); // 每3秒更新一次\n    },\n\n    // 停止视场更新定时器\n    stopFieldUpdateTimer: function () {\n      if (this.fieldUpdateTimer) {\n        clearInterval(this.fieldUpdateTimer);\n        this.fieldUpdateTimer = null;\n      }\n    },\n\n    getCiecleAzAlt(Circle) {\n      let obs = this.$stel.core.observer;\n      let cirs = this.$stel.convertFrame(obs, 'ICRF', 'CIRS', Circle.getInfo('radec'));\n      let observed = this.$stel.convertFrame(obs, 'CIRS', 'OBSERVED', cirs);\n      // const azalt = this.$stel.c2s(this.$stel.convertFrame(this.$stel.core.observer, 'ICRF', 'OBSERVED', obj.getInfo('radec')))\n      let azalt = this.$stel.c2s(observed);\n      let az = this.$stel.anp(azalt[0]);\n      let alt = this.$stel.anp(azalt[1]);\n\n      const az_raf = this.$stel.a2af(az, 1);\n      const Az_degree = (az_raf.degrees < 0 ? az_raf.degrees + 180 : az_raf.degrees) + az_raf.arcminutes / 60 + az_raf.arcseconds / 3600;\n\n      const alt_raf = this.$stel.a2af(alt, 1);\n      const Alt_degree = alt_raf.degrees + alt_raf.arcminutes / 60 + alt_raf.arcseconds / 3600;\n\n      console.log('AzAlt:', Az_degree, Alt_degree);\n\n      return { Az_degree, Alt_degree };\n    },\n\n    SolveResultMark(RaDegree, DecDegree, Azimuth, Altitude) {\n      let MarkCircle_RaDec = this.AddMarkCircle(this.$stel, glLayer, 1, \"RaDec\");\n      let mm = MarkCircle_RaDec.pos;\n      this.vec3_from_sphe(RaDegree, DecDegree, mm);\n      MarkCircle_RaDec.pos = mm;\n      console.log(\"RaDec circle coordinates:\" + mm);\n\n      const AzAlt = this.getCiecleAzAlt(MarkCircle_RaDec);\n      glLayer.remove(MarkCircle_RaDec);\n\n      this.MarkCircleNum++;\n      let Label = \"AzAlt_Vue_\" + this.MarkCircleNum;\n\n      let MarkCircle_AltAz = this.AddMarkCircle(this.$stel, glLayer, 4, Label);\n      mm = MarkCircle_AltAz.pos;\n      this.vec3_from_sphe(AzAlt.Az_degree, AzAlt.Alt_degree, mm);\n      MarkCircle_AltAz.pos = mm;\n      console.log(\"AzAlt_Vue circle coordinates:\" + mm);\n\n      console.log(\"AzAlt_Vue circle x:\" + mm[0]);\n      console.log(\"AzAlt_Vue circle y:\" + mm[1]);\n      console.log(\"AzAlt_Vue circle z:\" + mm[2]);\n\n      this.LastPoint_AzAlt = this.getCiecleAzAlt(MarkCircle_AltAz);\n\n      this.CalculationPolarPoint(mm);\n\n      // 将创建的圆存储到数组中\n      // this.Circles.push(MarkCircle_RaDec);\n      this.Circles.push(MarkCircle_AltAz);\n\n    },\n\n    RemoveAllCircles() {\n      this.Circles.forEach(circle => {\n        glLayer.remove(circle);\n      });\n      this.Circles = [];\n    },\n\n    SolveResultMark_RealTime(RaDegree, DecDegree, Azimuth, Altitude) {\n      this.LastCircle_RaDec = this.AddMarkCircle(this.$stel, glLayer, 1, \"RaDec\");\n      let mm = this.LastCircle_RaDec.pos;\n      this.vec3_from_sphe(RaDegree, DecDegree, mm);\n      this.LastCircle_RaDec.pos = mm;\n      console.log(\"RaDec circle coordinates:\" + mm);\n\n      const AzAlt = this.getCiecleAzAlt(this.LastCircle_RaDec);\n      glLayer.remove(this.LastCircle_RaDec);\n\n      if (this.LastCircle_AzAlt !== null && this.LastCircle_AzAlt !== undefined) {\n        glLayer.remove(this.LastCircle_AzAlt);\n      }\n      this.LastCircle_AzAlt = this.AddMarkCircle(this.$stel, glLayer, 4, 'Current');\n      mm = this.LastCircle_AzAlt.pos;\n      this.vec3_from_sphe(AzAlt.Az_degree, AzAlt.Alt_degree, mm);\n      this.LastCircle_AzAlt.pos = mm;\n      this.LastCircle_AzAlt.color = [0, 1, 1, 0.25];\n      console.log(\"AzAlt_Vue circle coordinates:\" + mm);\n\n      console.log(\"AzAlt_Vue circle x:\" + mm[0]);\n      console.log(\"AzAlt_Vue circle y:\" + mm[1]);\n      console.log(\"AzAlt_Vue circle z:\" + mm[2]);\n\n      this.Current_AzAlt = this.getCiecleAzAlt(this.LastCircle_AzAlt);\n      console.log(\"Current AzAlt:\", this.Current_AzAlt.Az_degree, this.Current_AzAlt.Alt_degree);\n      this.$bus.$emit('ShowCurrentAzAltText', this.Current_AzAlt.Az_degree, this.Current_AzAlt.Alt_degree);\n    },\n\n\n    CalculationPolarPoint(coordinate) {\n      this.CartesianList.push(coordinate);\n\n      if (this.CartesianList.length < 3) {\n        return;\n      }\n\n      this.$bus.$emit('HideSingleSolveBtn');\n\n      // 获取三个点的坐标\n      const p1 = this.CartesianList[0];\n      const p2 = this.CartesianList[1];\n      const p3 = this.CartesianList[2];\n\n      // 计算两个向量\n      const v1 = [\n        p2[0] - p1[0],\n        p2[1] - p1[1],\n        p2[2] - p1[2]\n      ];\n\n      const v2 = [\n        p3[0] - p1[0],\n        p3[1] - p1[1],\n        p3[2] - p1[2]\n      ];\n\n      // 计算法向量\n      const normal = [\n        v1[1] * v2[2] - v1[2] * v2[1],\n        v1[2] * v2[0] - v1[0] * v2[2],\n        v1[0] * v2[1] - v1[1] * v2[0]\n      ];\n\n      // 计算法向量的长度\n      const normalLength = Math.sqrt(normal[0] ** 2 + normal[1] ** 2 + normal[2] ** 2);\n\n      // 归一化法向量\n      const unitNormal = [\n        normal[0] / normalLength,\n        normal[1] / normalLength,\n        normal[2] / normalLength\n      ];\n\n      // 假设球的半径为r，圆心为(0, 0, 0)\n      const r = 1; // 根据你的实际情况调整\n\n      // 计算与球面的交点\n      const intersection1 = [\n        unitNormal[0] * r,\n        unitNormal[1] * r,\n        unitNormal[2] * r\n      ];\n\n      const intersection2 = [\n        -unitNormal[0] * r,\n        -unitNormal[1] * r,\n        -unitNormal[2] * r\n      ];\n\n      console.log('Intersection Points:', intersection1, intersection2);\n\n      // 选择离(0,0,1)更近的交点\n      const closerIntersection = intersection1[2] > 0 ? intersection1 : intersection2;\n\n      let MarkCircle_FakePolarPoint = this.AddMarkCircle(this.$stel, glLayer, 4, \"FakePolarPoint\");\n      let mm = MarkCircle_FakePolarPoint.pos;\n      mm[0] = closerIntersection[0];\n      mm[1] = closerIntersection[1];\n      mm[2] = closerIntersection[2];\n      MarkCircle_FakePolarPoint.pos = mm;\n      console.log(\"FakePolarPoint circle coordinates:\" + mm);\n\n      const AzAlt_FakePolarPoint = this.getCiecleAzAlt(MarkCircle_FakePolarPoint);\n\n      console.log(\"Fake Polar Point AzAlt:\", AzAlt_FakePolarPoint.Az_degree, ',', AzAlt_FakePolarPoint.Alt_degree);\n\n      this.Circles.push(MarkCircle_FakePolarPoint);\n\n      let AzAlt_PolarPoint = {\n        Az_degree: 0,\n        Alt_degree: this.PolarPoint_Altitude\n      };\n\n      // console.log(\"Real Polar Point AzAlt:\", AzAlt_PolarPoint.Az_degree, ',', AzAlt_PolarPoint.Alt_degree);\n      this.SendConsoleLogMsg('Real Polar Point AzAlt:' + AzAlt_PolarPoint.Az_degree + ',' + AzAlt_PolarPoint.Alt_degree, 'info');\n      // console.log(\"Last Point AzAlt:\", this.LastPoint_AzAlt.Az_degree, this.LastPoint_AzAlt.Alt_degree);\n      this.SendConsoleLogMsg('Last Point AzAlt:' + this.LastPoint_AzAlt.Az_degree + ',' + this.LastPoint_AzAlt.Alt_degree, 'info');\n\n      ////////////////////////////////////////////////\n\n      // // 将球坐标转换为笛卡尔坐标\n      // let fakePolarPoint = this.sphericalToCartesian(AzAlt_FakePolarPoint.Az_degree, AzAlt_FakePolarPoint.Alt_degree);\n      // let polarPoint = this.sphericalToCartesian(AzAlt_PolarPoint.Az_degree, AzAlt_PolarPoint.Alt_degree);\n      // let lastPoint = this.sphericalToCartesian(this.LastPoint_AzAlt.Az_degree, this.LastPoint_AzAlt.Alt_degree);\n\n      // // 计算旋转四元数\n      // let quaternion = this.computeQuaternion(fakePolarPoint, polarPoint);\n\n      // // 应用旋转\n      // let fourthPoint = this.applyQuaternion(lastPoint, quaternion);\n\n      // // 将结果转换回球坐标\n      // let fourthPointAzAlt = this.cartesianToSpherical(fourthPoint);\n      // console.log(\"Fourth Point AzAlt:\", fourthPointAzAlt.Az_degree, ',', fourthPointAzAlt.Alt_degree);\n\n      ////////////////////////////////////////////////\n\n      // 计算角度差值，考虑角度的循环性质\n      function calculateAngleDifference(angle1, angle2) {\n        let difference = angle2 - angle1;\n        while (difference > 180) difference -= 360;\n        while (difference < -180) difference += 360;\n        return difference;\n      }\n\n      let azimuthDifference = calculateAngleDifference(AzAlt_FakePolarPoint.Az_degree, AzAlt_PolarPoint.Az_degree);\n      let altitudeDifference = AzAlt_PolarPoint.Alt_degree - AzAlt_FakePolarPoint.Alt_degree;\n\n      // 应用差值到LastPoint\n      let fourthPointAzAlt = {\n        Az_degree: this.LastPoint_AzAlt.Az_degree + azimuthDifference,\n        Alt_degree: this.LastPoint_AzAlt.Alt_degree + altitudeDifference\n      };\n\n      // 确保方位角在0到360度之间\n      fourthPointAzAlt.Az_degree = (fourthPointAzAlt.Az_degree + 360) % 360;\n\n      // 确保高度角在-90到90度之间\n      fourthPointAzAlt.Alt_degree = Math.max(Math.min(fourthPointAzAlt.Alt_degree, 90), -90);\n\n      console.log(\"Fourth Point AzAlt:\", fourthPointAzAlt.Az_degree, ',', fourthPointAzAlt.Alt_degree);\n\n      this.$bus.$emit('ShowAzAltText', azimuthDifference, altitudeDifference, fourthPointAzAlt.Az_degree, fourthPointAzAlt.Alt_degree);\n\n      ////////////////////////////////////////////////\n\n      // 将角度转换为弧度\n      function degreesToRadians(degrees) {\n        return degrees * Math.PI / 180;\n      }\n\n      // 将球坐标转换为笛卡尔坐标\n      function sphericalToCartesian(azimuth, altitude) {\n        let az = degreesToRadians(azimuth);\n        let alt = degreesToRadians(altitude);\n        let x = Math.cos(alt) * Math.cos(az);\n        let y = Math.cos(alt) * Math.sin(az);\n        let z = Math.sin(alt);\n        return { x: x, y: y, z: z };\n      }\n\n      // 将第四个点转换为笛卡尔坐标\n      let fourthPointCartesian = sphericalToCartesian(fourthPointAzAlt.Az_degree, fourthPointAzAlt.Alt_degree);\n      console.log(\"Fourth Point Cartesian:\", fourthPointCartesian.x, ',', fourthPointCartesian.y, ',', fourthPointCartesian.z);\n\n      let MarkCircle_fourthPoint = this.AddMarkCircle(this.$stel, glLayer, 4, \"Target Point\");\n      mm = MarkCircle_fourthPoint.pos;\n      mm[0] = fourthPointCartesian.x;\n      mm[1] = fourthPointCartesian.y;\n      mm[2] = fourthPointCartesian.z;\n      MarkCircle_fourthPoint.pos = mm;\n      MarkCircle_fourthPoint.color = [1, 0, 0, 0.25];\n\n      this.Circles.push(MarkCircle_fourthPoint);\n\n      // 清空列表，准备下次计算\n      this.CartesianList = [];\n      this.MarkCircleNum = 0;\n    },\n\n    // 将角度转换为弧度\n    degreesToRadians(degrees) {\n      return degrees * Math.PI / 180;\n    },\n\n    // 将球坐标转换为笛卡尔坐标\n    sphericalToCartesian(azimuth, altitude) {\n      let az = this.degreesToRadians(azimuth);\n      let alt = this.degreesToRadians(altitude);\n      let x = Math.cos(alt) * Math.cos(az);\n      let y = Math.cos(alt) * Math.sin(az);\n      let z = Math.sin(alt);\n      return { x: x, y: y, z: z };\n    },\n\n    // 计算旋转四元数\n    computeQuaternion(from, to) {\n      let w = from.x * to.x + from.y * to.y + from.z * to.z + 1;\n      let x = from.y * to.z - from.z * to.y;\n      let y = from.z * to.x - from.x * to.z;\n      let z = from.x * to.y - from.y * to.x;\n\n      let norm = Math.sqrt(w * w + x * x + y * y + z * z);\n      return { w: w / norm, x: x / norm, y: y / norm, z: z / norm };\n    },\n\n    // 应用四元数旋转\n    applyQuaternion(point, quat) {\n      let x = quat.w * quat.w * point.x + 2 * quat.y * quat.w * point.z - 2 * quat.z * quat.w * point.y + quat.x * quat.x * point.x + 2 * quat.y * quat.x * point.y + 2 * quat.z * quat.x * point.z - quat.z * quat.z * point.x - quat.y * quat.y * point.x;\n      let y = 2 * quat.x * quat.y * point.x + quat.y * quat.y * point.y + 2 * quat.z * quat.y * point.z + 2 * quat.w * quat.z * point.x - quat.z * quat.z * point.y + quat.w * quat.w * point.y - 2 * quat.x * quat.w * point.z - quat.x * quat.x * point.y;\n      let z = 2 * quat.x * quat.z * point.x + 2 * quat.y * quat.z * point.y + quat.z * quat.z * point.z - 2 * quat.w * quat.y * point.x - quat.y * quat.y * point.z + 2 * quat.w * quat.x * point.y - quat.x * quat.x * point.z + quat.w * quat.w * point.z;\n      return { x: x, y: y, z: z };\n    },\n\n    // 将笛卡尔坐标转换回球坐标\n    cartesianToSpherical(cartesian) {\n      let r = Math.sqrt(cartesian.x ** 2 + cartesian.y ** 2 + cartesian.z ** 2);\n      let azimuth = Math.atan2(cartesian.y, cartesian.x);\n      let altitude = Math.asin(cartesian.z / r);\n      return {\n        Az_degree: azimuth * 180 / Math.PI,\n        Alt_degree: altitude * 180 / Math.PI\n      };\n    },\n\n    SolveFovMark(RaDec) {\n      console.log('RaDec[4]:', RaDec);\n\n      // let rectangle = this.AddMarkRectangle(this.$stel, glLayer, RaDec);\n\n      this.Circles.push(rectangle);\n\n    },\n\n    CalibratePolarAxis() {\n      this.$bus.$emit('CalibratePolarAxisMode');\n      // this.$bus.$emit('AppSendMessage', 'Vue_Command', 'StartLoopCapture');\n      this.nav = false;\n    },\n\n    RecalibratePolarAxis() {\n      // 清空列表，准备下次计算\n      this.CartesianList = [];\n      this.MarkCircleNum = 0;\n      this.RemoveAllCircles();\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ClearSloveResultList');\n    },\n\n\n\n    // 使用新的多边形方式绘制校准点\n    drawCalibrationPointPolygon(coordinates, color, name) {\n      console.log(`绘制校准点多边形: ${name}`, coordinates);\n\n      try {\n        // 验证输入参数\n        if (!coordinates || !Array.isArray(coordinates)) {\n          console.error('校准点坐标必须是数组');\n          return;\n        }\n\n        if (coordinates.length !== 5) {\n          console.error(`校准点坐标必须是5个点，当前有${coordinates.length}个点`);\n          return;\n        }\n\n        // 验证每个坐标点\n        for (let i = 0; i < coordinates.length; i++) {\n          const coord = coordinates[i];\n          if (!coord || typeof coord.ra === 'undefined' || typeof coord.dec === 'undefined') {\n            console.error(`校准点坐标${i}格式错误：`, coord);\n            return;\n          }\n\n          if (!this.isValidCoordinate(coord.ra) || !this.isValidCoordinate(coord.dec)) {\n            console.error(`校准点坐标${i}值无效：`, coord);\n            return;\n          }\n        }\n\n        // 使用新的多边形绘制方法\n        let calibrationPolygon = this.AddFieldOfViewPolygon(\n          this.$stel,\n          glLayer,\n          coordinates,\n          color,\n          name\n        );\n\n        if (calibrationPolygon) {\n          // 添加到校准点数组\n          if (!this.calibrationCircles) {\n            this.calibrationCircles = [];\n          }\n          this.calibrationCircles.push(calibrationPolygon);\n\n          console.log(`校准点多边形创建成功: ${name}`, calibrationPolygon);\n        } else {\n          console.error(`校准点多边形创建失败: ${name}`);\n        }\n\n      } catch (error) {\n        console.error('绘制校准点多边形时出错:', error);\n      }\n    },\n\n    // 清除所有校准点\n    clearCalibrationPoints() {\n      console.log('清除所有校准点');\n\n      // 确保数组存在\n      if (!this.calibrationCircles) {\n        this.calibrationCircles = [];\n      }\n      if (!this.adjustmentCircles) {\n        this.adjustmentCircles = [];\n      }\n\n      // 清除校准点\n      if (this.calibrationCircles.length > 0) {\n        console.log(`清除 ${this.calibrationCircles.length} 个校准点`);\n        this.calibrationCircles.forEach((circle, index) => {\n          try {\n            if (circle && glLayer) {\n              glLayer.remove(circle);\n              console.log(`成功清除校准点 ${index + 1}`);\n            }\n          } catch (error) {\n            console.warn(`清除校准点 ${index + 1} 时出错:`, error);\n          }\n        });\n        this.calibrationCircles = [];\n      }\n\n      // 清除调整点\n      if (this.adjustmentCircles.length > 0) {\n        console.log(`清除 ${this.adjustmentCircles.length} 个调整点`);\n        this.adjustmentCircles.forEach((circle, index) => {\n          try {\n            if (circle && glLayer) {\n              glLayer.remove(circle);\n              console.log(`成功清除调整点 ${index + 1}`);\n            }\n          } catch (error) {\n            console.warn(`清除调整点 ${index + 1} 时出错:`, error);\n          }\n        });\n        this.adjustmentCircles = [];\n      }\n\n      // 清除上一次位置\n      this.lastPosition = null;\n\n      // 清除目标点\n      if (this.targetPointCircle) {\n        try {\n          if (glLayer) {\n            glLayer.remove(this.targetPointCircle);\n            console.log('成功清除目标点');\n          }\n          this.targetPointCircle = null;\n        } catch (error) {\n          console.warn('清除目标点时出错:', error);\n        }\n      }\n\n      console.log('所有校准相关元素清除完成');\n    },\n\n\n    // 使用新的多边形方式绘制调整点\n    // 使用新的多边形方式绘制调整点（不在此处画圆）\n    drawAdjustmentPointsPolygon(currentCoordinates, targetCoordinates, currentColor, targetColor, isTimerUpdate) {\n      if (isTimerUpdate === undefined) isTimerUpdate = false;\n      console.log('绘制调整点多边形', { currentCoordinates, targetCoordinates });\n\n      try {\n        // 1) 清除之前的调整点\n        if (this.adjustmentCircles) {\n          this.adjustmentCircles.forEach(obj => {\n            try { glLayer.remove(obj); } catch (e) { console.warn('清除调整点时出错:', e); }\n          });\n        }\n        this.adjustmentCircles = [];\n\n        // 2) 绘制当前位置视场多边形\n        if (currentCoordinates && Array.isArray(currentCoordinates) && currentCoordinates.length === 5) {\n          console.log('绘制当前位置多边形');\n          const currentPolygon = this.AddFieldOfViewPolygon(\n            this.$stel,\n            glLayer,\n            currentCoordinates,\n            currentColor,\n            'Current'\n          );\n          if (currentPolygon) {\n            this.adjustmentCircles.push(currentPolygon);\n            console.log('当前位置多边形创建成功');\n          } else {\n            console.error('当前位置多边形创建失败');\n          }\n        } else {\n          console.warn('当前位置坐标无效，跳过绘制');\n        }\n\n        // 3) 视角转向（可选；不创建圆）\n        if (!isTimerUpdate && targetCoordinates && Array.isArray(targetCoordinates) && targetCoordinates.length === 5) {\n          try {\n            const centerRa = targetCoordinates.reduce((s, c) => s + c.ra, 0) / targetCoordinates.length;\n            const centerDec = targetCoordinates.reduce((s, c) => s + c.dec, 0) / targetCoordinates.length;\n            console.log(`视角转向目标: RA=${centerRa}, DEC=${centerDec}`);\n\n            // 用临时对象只做指向，不加入 layer\n            const targetObjConfig = {\n              id: 'temp_target_' + Date.now(),\n              model_data: {},\n              names: ['Target Position'],\n              types: ['Temporary'],\n              model: 'temporary'\n            };\n            const targetObj = this.$stel.createObj('circle', targetObjConfig);\n            let mm = targetObj.pos;\n            this.vec3_from_sphe(centerRa, centerDec, mm);\n            targetObj.pos = mm;\n            if (typeof targetObj.update === 'function') targetObj.update();\n\n            this.$stel.pointAndLock(targetObj, 1.0);\n            console.log('视角转向完成');\n\n            // 清理临时对象（未加入 layer，无需 remove）\n            setTimeout(() => { try { /* no-op */ } catch (_) { } }, 0);\n          } catch (error) {\n            console.error('视角转向出错:', error);\n          }\n        }\n\n      } catch (error) {\n        console.error('绘制调整点多边形时出错:', error);\n      }\n    },\n\n\n    // 绘制目标点圆形（坐标：RA/Dec，单位：度）\n    drawTargetPointCircle(targetRa, targetDec, color, name, text, clearlast) {\n      if (clearlast === undefined) clearlast = true; // 内部设置默认值\n      console.log('绘制目标点圆形', { targetRa, targetDec, color });\n\n      try {\n        // 1) 校验\n        if (!this.isValidCoordinate(targetRa) || !this.isValidCoordinate(targetDec)) {\n          console.error(text + '坐标无效:', { targetRa, targetDec });\n          return;\n        }\n\n        // 2) 清除之前的目标点\n        if (this.targetPointCircle && clearlast) {\n          try {\n            if (glLayer) {\n              glLayer.remove(this.targetPointCircle);\n              console.log('成功清除之前的' + name);\n            }\n          } catch (error) {\n            console.warn('清除之前的' + text + '时出错:', error);\n          }\n        }\n\n        // 3) 创建圆对象\n        const circle = this.AddMarkCircle(this.$stel, glLayer, 4, name); // frame=4：赤道系\n        if (!circle) {\n          console.error(text + '圆形创建失败');\n          return;\n        }\n\n        // 4) 位置（RA/Dec 度 → 3D 单位向量）\n        const mm = circle.pos;\n        this.vec3_from_sphe(targetRa, targetDec, mm);\n        circle.pos = mm;\n\n        // 5) 样式\n        if (color) {\n          const rgb = this.hexToRgb(color.stroke || color.fill || '#FF8C00');\n          const alpha = (color.fillOpacity || 0.3);\n          const borderAlpha = (color.strokeOpacity || 1.0);\n          circle.color = [rgb.r / 255, rgb.g / 255, rgb.b / 255, alpha];\n          circle.border_color = [rgb.r / 255, rgb.g / 255, rgb.b / 255, borderAlpha];\n        } else {\n          circle.color = [1, 0.55, 0, 0.3];\n          circle.border_color = [1, 0.55, 0, 1];\n        }\n        const size = 0.02;\n        circle.size = [size, size];\n\n        // 6) 更新 & 保存引用\n        if (typeof circle.update === 'function') circle.update();\n        this.targetPointCircle = circle;\n\n        console.log(text + '圆形创建成功', circle);\n      } catch (error) {\n        console.error('绘制' + text + '圆形时出错:', error);\n      }\n    },\n\n\n    // 绘制假极轴圆形\n    DrawFakePolarAxisCircle(targetRa, targetDec, color, name, text) {\n      console.log('绘制目标点圆形', { targetRa, targetDec, color });\n\n      try {\n        // 验证输入参数\n        if (!this.isValidCoordinate(targetRa) || !this.isValidCoordinate(targetDec)) {\n          console.error(text + '坐标无效:', { targetRa, targetDec });\n          return;\n        }\n\n        // 清除之前的目标点\n        if (this.fakePolarAxisCircle) {\n          try {\n            if (glLayer) {\n              glLayer.remove(this.fakePolarAxisCircle);\n              console.log('成功清除之前的' + name);\n            }\n          } catch (error) {\n            console.warn('清除之前的' + text + '时出错:', error);\n          }\n        }\n\n        // 创建目标点圆形\n        let targetCircle = this.AddMarkCircle(this.$stel, glLayer, 4, name);\n        if (targetCircle) {\n          // 设置目标点位置\n          let targetMm = targetCircle.pos;\n          this.vec3_from_sphe(targetRa, targetDec, targetMm);\n          targetCircle.pos = targetMm;\n\n          // 设置目标点颜色和样式\n          if (color) {\n            // 将十六进制颜色转换为RGB数组\n            const rgb = this.hexToRgb(color.stroke || color.fill || '#FF8C00');\n            const alpha = (color.fillOpacity || 0.3);\n            const borderAlpha = (color.strokeOpacity || 1.0);\n\n            targetCircle.color = [rgb.r / 255, rgb.g / 255, rgb.b / 255, alpha];\n            targetCircle.border_color = [rgb.r / 255, rgb.g / 255, rgb.b / 255, borderAlpha];\n          } else {\n            // 默认橙色\n            targetCircle.color = [1, 0.55, 0, 0.3];  // 橙色，半透明\n            targetCircle.border_color = [1, 0.55, 0, 1];  // 橙色边框\n          }\n\n          // 设置目标点大小\n          const targetSize = 0.02; // 固定小尺寸\n          targetCircle.size = [targetSize, targetSize];\n\n          // 保存目标点引用，用于后续清除\n          this.fakePolarAxisCircle = targetCircle;\n\n          console.log(text + '圆形创建成功', targetCircle);\n        } else {\n          console.error(text + '圆形创建失败');\n        }\n\n      } catch (error) {\n        console.error('绘制' + text + '圆形时出错:', error);\n      }\n    },\n\n    ShowConfirmDialog(Title, Text, ToDo) {\n      // window.location.reload();\n      this.nav = false;\n      this.$bus.$emit('ShowConfirmDialog', Title, Text, ToDo);\n    },\n\n    decrement(item) {\n      console.log('decrement:', item.value);\n      if (item.value > item.inputMin) {\n        item.value -= item.inputStep;\n      }\n    },\n\n    increment(item) {\n      console.log('increment:', item.value);\n      if (item.value < item.inputMax) {\n        item.value += item.inputStep;\n      }\n    },\n\n    PolarAxisMode(bool) {\n      this.isPolarAxisMode = bool;\n    },\n\n    handleGuiderCanvasClick(event) {\n      const canvas = this.$refs.guiderCanvas;\n      const rect = canvas.getBoundingClientRect();\n      const x = event.clientX - rect.left; // 点击坐标X\n      const y = event.clientY - rect.top;  // 点击坐标Y\n      console.log(`Clicked at: (${x}, ${y})`);\n      const CanvasWidth = window.innerWidth;\n      const CanvasHeight = window.innerHeight;\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderCanvasClick:' + CanvasWidth + ':' + CanvasHeight + ':' + x + ':' + y);\n    },\n    connectDriver() {\n      this.isConnecting = true;\n      // this.isOpenDevicePage = false;\n      this.startLoading();\n      const DeviceType = this.CurrentDriverType;\n      for (const device of this.devices) {\n        if (device.driverType === DeviceType && device.isConnected == false) {\n          const DriverName = device.driverName;\n          if (DriverName == '') {\n            this.SendConsoleLogMsg('No driver selected', 'warning');\n            this.isConnecting = false;\n            return;\n          }\n          this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConnectDriver:' + DriverName + ':' + DeviceType);\n          this.SendConsoleLogMsg('Start Connecting driver:' + DeviceType + ' ' + DriverName, 'info');\n          return;\n        }\n      }\n    },\n    connectDriverSuccess(devicetype) {\n      console.log('connectDriverSuccess:', devicetype);\n      this.SendConsoleLogMsg(\"connectDriverSuccess:\" + devicetype, 'info');\n      this.isConnecting = false;\n      if (this.drawer_2 == true) {\n        this.drawer_2 = false\n      }\n\n      this.stopLoading();\n    },\n    connectDriverFailed(message) {\n      console.log('connectDriverFailed:', message);\n      this.SendConsoleLogMsg(\"connectDriverFailed:\" + message, 'error');\n      this.isConnecting = false;\n      this.stopLoading();\n    },\n    disconnectDriver() {\n      const DeviceType = this.CurrentDriverType;\n      for (const device of this.devices) {\n        if (device.driverType === DeviceType && device.isConnected) {\n          this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DisconnectDevice:' + device.device + \":\" + DeviceType);\n        }\n      }\n    },\n    disconnectDriversuccess(devicetype) {\n      console.log('disconnectDevicesuccess:', devicetype);\n      this.drawer_2 = false\n      if (devicetype == \"all\") {\n        this.sendMessage('Vue_Command', 'disconnectAllDevice');\n        this.SendConsoleLogMsg('Disconnect All Device', 'info');\n        this.haveDeviceConnect = false;\n        this.$bus.$emit('MainCameraConnected', 0);\n        this.$bus.$emit('MountConnected', 0);\n        this.$bus.$emit('CFWConnected', 0);\n        this.$bus.$emit('GuiderConnected', 0);\n        this.clearDeviceList();\n        this.$bus.$emit('deleteDeviceTypeAllocationList', 'all');\n        return;\n      };\n\n      for (const device of this.devices) {\n        if (device.driverType === devicetype && device.isConnected) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n      for (const device of this.ToBeConnectDevice) {\n        if (device.driverType === devicetype) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n\n      this.$bus.$emit('deleteDeviceTypeAllocationList', devicetype);\n      if (devicetype == \"MainCamera\") {\n        this.$bus.$emit('MainCameraConnected', 0);\n      } else if (devicetype == \"Mount\") {\n        this.$bus.$emit('MountConnected', 0);\n      } else if (devicetype == \"CFW\") {\n        this.$bus.$emit('CFWConnected', 0);\n      } else if (devicetype == \"Guider\") {\n        this.$bus.$emit('GuiderConnected', 0);\n      }\n    },\n\n    disconnectDriverFail(devicetype) {\n      console.log('disconnectDeviceFail:', devicetype);\n      this.drawer_2 = false\n      if (devicetype == \"all\") {\n        this.sendMessage('Vue_Command', 'disconnectAllDevice');\n        this.SendConsoleLogMsg('Disconnect All Device', 'info');\n        this.haveDeviceConnect = false;\n        this.$bus.$emit('MainCameraConnected', 0);\n        this.$bus.$emit('MountConnected', 0);\n        this.$bus.$emit('CFWConnected', 0);\n        this.$bus.$emit('GuiderConnected', 0);\n        this.clearDeviceList();\n        this.$bus.$emit('deleteDeviceTypeAllocationList', 'all');\n        return;\n      };\n\n      for (const device of this.devices) {\n        if (device.driverType === devicetype && device.isConnected) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n      for (const device of this.ToBeConnectDevice) {\n        if (device.driverType === devicetype) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n\n      this.$bus.$emit('deleteDeviceTypeAllocationList', devicetype);\n      if (devicetype == \"MainCamera\") {\n        this.$bus.$emit('MainCameraConnected', 0);\n      } else if (devicetype == \"Mount\") {\n        this.$bus.$emit('MountConnected', 0);\n      } else if (devicetype == \"CFW\") {\n        this.$bus.$emit('CFWConnected', 0);\n      } else if (devicetype == \"Guider\") {\n        this.$bus.$emit('GuiderConnected', 0);\n      }\n    },\n    loadSelectedDriverList(deviceObject) {\n      console.log('loadSelectedDriverList:', deviceObject);\n      deviceObject.forEach(device => {\n        // 假设你想要打印每个设备对象的键值对\n        for (const [driverType, driverName] of Object.entries(device)) {\n          this.devices.forEach(device => {\n            if (device.driverType === driverType && device.isConnected == false) {\n              device.device = driverName;\n              device.driverName = driverName;\n            }\n          });\n        }\n      });\n    },\n    loadBindDeviceList(deviceObject) {\n      console.log('loadBindDeviceList:', deviceObject);\n      this.$bus.$emit('loadBindDeviceList', deviceObject);\n\n    },\n    loadBindDeviceTypeList(deviceTypeObject) {\n      console.log('loadBindDeviceTypeList:', deviceTypeObject);\n      this.$bus.$emit('loadBindDeviceTypeList', deviceTypeObject);\n      deviceTypeObject.forEach(deviceType => {\n        const { Type, DeviceName, DriverName, isbind } = deviceType;\n        this.updateDevicesConnect(Type, DeviceName, DriverName, isbind);\n      });\n    },\n    updateSelectedDriver(driverType) {\n\n      this.selectedDriver = null;\n      this.devices.forEach(device => {\n        if (device.driverType === driverType) {\n          this.selectedDriver = device.driverName\n        }\n      });\n      console.log('Current drivers:', this.selectedDriver);\n    },\n    startLoading() {\n      this.loadingDeviceSelection = true;\n    },\n    stopLoading() {\n      this.loadingDeviceSelection = false;\n    },\n    deleteDeviceAllocationList(deviceName) {\n      console.log('deleteDeviceAllocationList:', deviceName);\n      this.$bus.$emit('deleteDeviceAllocationList', deviceName);\n    },\n    UnBindingDevice(type, name, driverName) {\n      console.log('UnBindingDevice:', type, name, driverName);\n      this.updateDevicesConnect(type, name, driverName, false);\n    },\n\n    displayErrorImage() {\n      console.error(\"image is error, load errorImage.svg\");\n      const canvas = document.getElementById('mainCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n\n      image.onerror = () => {\n        console.error(\"Failed to load image from \" + image.src);\n        // 可以在这里添加备用图像或其他错误处理逻辑\n      };\n\n      // 确保ErrorImage是有效的URL\n      image.src = ErrorImage; // 请替换为实际的图像路径\n    },\n    handleError(message, location, error = null) {\n      const errorMsg = error ? `${message} at ${location}: ${error}` : `${message} at ${location}`;\n      console.error(errorMsg);\n      this.SendConsoleLogMsg(errorMsg, 'error');\n      this.displayErrorImage(); // 显示错误图像\n    },\n    showSelectdisconnectDriver(drivername) {\n      this.showDisconnectDialog = true;\n      this.currentDisconnectDriverName = drivername;\n    },\n    confirmDisconnect() {\n      this.sendMessage('Vue_Command', 'disconnectSelectDriver:' + this.currentDisconnectDriverName);\n      this.showDisconnectDialog = false;\n    },\n\n    // 主画布点击事件\n    handleMainCanvasClick(event) {\n      // this.SendConsoleLogMsg('触发鼠标点击事件:', 'info');\n      if (!this.enableMainCanvasClick || this.isDragging || this.drawImgData == null) return; // 如果画布不可点击，则不处理点击事件\n      // console.log('触发鼠标点击事件:', event);\n      const canvas = this.$refs.mainCanvas;\n      if (!canvas) return; // 确保 canvas 元素存在\n      const rect = canvas.getBoundingClientRect();// 获取 canvas 元素的边界矩形\n      const x = event.clientX - rect.left;\n      const y = event.clientY - rect.top;\n      console.log('Mouse clicked at:', x, y);\n      if (!this.isFocusLoopShooting) {\n        // 期望中心（画布坐标 → 传感器像素坐标）\n        const desiredCenterX = (x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2;\n        const desiredCenterY = (y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2;\n\n        // ROI 边长（像素，偶数化），来源于固定 RedBoxSideLength\n        let side = this.RedBoxSideLength / this.cameraBin;\n        side = Math.max(2, Math.floor(side));\n        if (side % 2 !== 0) side += 1; // 强制偶数\n\n        // 将 ROI 左上角按中心反推，并约束在图像范围内\n        const half = side / 2;\n        const imgW = this.mainCameraSizeX;\n        const imgH = this.mainCameraSizeY;\n\n        let roiX = desiredCenterX - half;\n        let roiY = desiredCenterY - half;\n\n        // 边界约束\n        const maxX = Math.max(0, imgW - side);\n        const maxY = Math.max(0, imgH - side);\n        roiX = Math.min(Math.max(0, roiX), maxX);\n        roiY = Math.min(Math.max(0, roiY), maxY);\n\n        // 偶数对齐位置\n        roiX = Math.floor(roiX);\n        roiY = Math.floor(roiY);\n        if (roiX % 2 !== 0) roiX += 1;\n        if (roiY % 2 !== 0) roiY += 1;\n\n        this.ROI_x = roiX;\n        this.ROI_y = roiY;\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendRedBoxState:' + this.RedBoxSideLength + ':' + this.ROI_x + ':' + this.ROI_y);\n      } else {\n        this.selectStarX = ((x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2 - this.ROI_x) * this.cameraBin; // 计算选择位置的x坐标\n        this.selectStarY = ((y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2 - this.ROI_y) * this.cameraBin; // 计算选择位置的y坐标\n\n        if (this.selectStarX >= 0 && this.selectStarX < this.RedBoxSideLength &&\n          this.selectStarY >= 0 && this.selectStarY < this.RedBoxSideLength) {\n          this.SendConsoleLogMsg('Select Star is in ROI', 'info');\n        } else {\n          this.SendConsoleLogMsg('Select Star is not in ROI', 'error');\n          this.selectStarX = -1;\n          this.selectStarY = -1;\n        }\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendSelectStars:' + this.selectStarX + ':' + this.selectStarY);\n      }\n      this.drawImageData();\n    },\n\n    // 主画布拖动\n    handleMouseDown(event) {\n      // this.SendConsoleLogMsg('触发鼠标按下事件:', 'info');\n      if (this.isDragging || this.drawImgData == null) return;\n      this.isDragging = true;\n      this.startX = event.clientX;\n      this.startY = event.clientY;\n      this.currentX = event.clientX;\n      this.currentY = event.clientY;\n\n      // 设置一个定时器，每100ms执行一次鼠标移动的逻辑\n      this.moveIntervalId = setInterval(() => {\n        if (!this.isDragging) return;\n\n        const dx = this.startX - this.currentX;\n        const dy = this.startY - this.currentY;\n        if (isNaN(dx) || isNaN(dy)) {\n          return;\n        }\n        let newVisibleX = this.visibleX + dx / window.innerWidth * this.visibleWidth;\n        let newVisibleY = this.visibleY + dy / window.innerHeight * this.visibleHeight;\n        if (newVisibleX < 0) {\n          newVisibleX = 0;\n        }\n        if (newVisibleY < 0) {\n          newVisibleY = 0;\n        }\n        if (newVisibleX > this.mainCameraSizeX) {\n          newVisibleX = this.mainCameraSizeX;\n        }\n        if (newVisibleY > this.mainCameraSizeY) {\n          newVisibleY = this.mainCameraSizeY;\n        }\n\n        this.visibleX = newVisibleX;\n        this.visibleY = newVisibleY;\n\n        this.startX = this.currentX;\n        this.startY = this.currentY;\n        this.drawImageData();\n        // this.SendConsoleLogMsg('拖动事件,拖动距离:' + dx + ',' + dy, 'info');\n      }, 100);\n    },\n    handleMouseMove(event) {\n      // this.SendConsoleLogMsg('触发鼠标移动事件:', 'info');\n      if (!this.isDragging) return;\n      this.currentX = event.clientX;\n      this.currentY = event.clientY;\n    },\n    handleMouseUp(event) {\n      // this.SendConsoleLogMsg('触发鼠标抬起事件:', 'info');\n      this.isDragging = false;\n\n      // 清除定时器\n      clearInterval(this.moveIntervalId);\n      this.moveIntervalId = null;\n    },\n    handleWheel(event) {\n      // this.SendConsoleLogMsg('触发鼠标滚轮事件:', 'info');\n      if (this.drawImgData == null) return;\n      const scaleChange = event.deltaY > 0 ? 0.1 : -0.1; // 根据滚轮的滚动方向，计算缩放比例的变化量\n      let newScale = this.scale + scaleChange; // 更新缩放比例\n      if (newScale < 0.1) {\n        newScale = 0.1;\n      }\n      if (newScale > 1) {\n        newScale = 1;\n      }\n\n      // 如果已经有一个待执行的缩放操作，则直接返回\n      if (this.pendingScaleChange) {\n        return;\n      }\n\n      // 标记有一个待执行的缩放操作\n      this.pendingScaleChange = true;\n\n      // 使用 requestAnimationFrame 来控制缩放操作的执行频率\n      requestAnimationFrame(() => {\n        if (newScale != this.scale) {\n          this.scale = newScale; // 更新缩放比例\n          this.$bus.$emit('setScale', this.scale);\n          this.drawImageData();\n          this.SendConsoleLogMsg('缩放比例变化,缩放比例:' + newScale, 'info');\n        } else {\n          this.SendConsoleLogMsg('缩放比例没有变化,缩放比例:' + this.scale, 'info');\n        }\n        this.pendingScaleChange = false; // 清除待执行的缩放操作标记\n      });\n    },\n\n    handleMainCanvasTouch(event) {\n      // this.SendConsoleLogMsg('触发触摸事件:', 'info');\n      if (!this.enableMainCanvasClick || this.isDragging || this.drawImgData == null) return; // 如果画布不可点击，则不处理点击事件\n      // console.log('触发触摸事件:', event);\n      if (!this.enableMainCanvasClick || !event.touches || event.touches.length === 0) return;\n      const canvas = this.$refs.mainCanvas;\n      if (!canvas) return; // 确保 canvas 元素存在\n      const touch = event.touches[0];\n      const rect = canvas.getBoundingClientRect();// 获取 canvas 元素的边界矩形\n      const x = touch.clientX - rect.left;\n      const y = touch.clientY - rect.top;\n      console.log('Touch at:', x, y);\n      event.preventDefault();// 阻止默认事件，如页面滚动\n      if (!this.isFocusLoopShooting) {\n        // 期望中心（画布坐标 → 传感器像素坐标）\n        const desiredCenterX = (x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2;\n        const desiredCenterY = (y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2;\n\n        // ROI 边长（像素，偶数化），来源于固定 RedBoxSideLength\n        let side = this.RedBoxSideLength / this.cameraBin;\n        side = Math.max(2, Math.floor(side));\n        if (side % 2 !== 0) side += 1; // 强制偶数\n\n        // 将 ROI 左上角按中心反推，并约束在图像范围内\n        const half = side / 2;\n        const imgW = this.mainCameraSizeX;\n        const imgH = this.mainCameraSizeY;\n\n        let roiX = desiredCenterX - half;\n        let roiY = desiredCenterY - half;\n\n        // 边界约束\n        const maxX = Math.max(0, imgW - side);\n        const maxY = Math.max(0, imgH - side);\n        roiX = Math.min(Math.max(0, roiX), maxX);\n        roiY = Math.min(Math.max(0, roiY), maxY);\n\n        // 偶数对齐位置\n        roiX = Math.floor(roiX);\n        roiY = Math.floor(roiY);\n        if (roiX % 2 !== 0) roiX += 1;\n        if (roiY % 2 !== 0) roiY += 1;\n\n        this.ROI_x = roiX;\n        this.ROI_y = roiY;\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendRedBoxState:' + this.RedBoxSideLength + ':' + this.ROI_x + ':' + this.ROI_y);\n      } else {\n        this.selectStarX = ((x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2 - this.ROI_x) * this.cameraBin; // 计算选择位置的x坐标\n        this.selectStarY = ((y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2 - this.ROI_y) * this.cameraBin; // 计算选择位置的y坐标\n\n        if (this.selectStarX >= 0 && this.selectStarX < this.RedBoxSideLength &&\n          this.selectStarY >= 0 && this.selectStarY < this.RedBoxSideLength) {\n          this.SendConsoleLogMsg('Select Star is in ROI', 'info');\n        } else {\n          this.SendConsoleLogMsg('Select Star is not in ROI', 'error');\n          this.selectStarX = -1;\n          this.selectStarY = -1;\n        }\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendSelectStars:' + this.selectStarX + ':' + this.selectStarY);\n      }\n      this.drawImageData();\n    },\n    handleTouchStart(event) {\n      if (this.drawImgData == null) return;\n      // this.SendConsoleLogMsg('触发触摸开始事件:', 'info');\n      if (event.touches.length === 1) { // 单指触摸，开始拖动\n        this.isOneTouch = true;\n        // this.SendConsoleLogMsg('触发单指触摸事件', 'info');\n        this.isDragging = true;\n        this.startTouchX[0] = event.touches[0].clientX;\n        this.startTouchY[0] = event.touches[0].clientY;\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        // 清除可能存在的双指触摸的定时器\n        if (this.zoomIntervalId) {\n          clearInterval(this.zoomIntervalId);\n          this.zoomIntervalId = null;\n        }\n\n\n        this.handleMainCanvasTouch(event);\n      } else if (event.touches.length >= 2) { // 双指触摸，开始缩放\n        this.isOneTouch = false;\n        // this.SendConsoleLogMsg('触发双指触摸事件', 'info');\n        this.isDragging = true;\n        // 计算两个触摸点之间的距离\n        const dx = this.currentTouchX[0] - this.currentTouchX[1];\n        const dy = this.currentTouchY[0] - this.currentTouchY[1];\n        this.startTouchDistance = Math.sqrt(dx * dx + dy * dy);\n        // 清除可能存在的单指触摸的定时器\n        if (this.moveIntervalId) {\n          clearInterval(this.moveIntervalId);\n          this.moveIntervalId = null;\n        }\n\n\n      } else {\n        // this.SendConsoleLogMsg('触发多指触摸事件，获取当前触摸点数量:' + event.touches.length, 'info');\n      }\n\n    },\n\n    handleTouchMove(event) {\n      // this.SendConsoleLogMsg('触发触摸移动事件:', 'info');\n      if (!this.isDragging || this.drawImgData == null) return;\n      if (event.touches.length == 1) {\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        if (this.zoomIntervalId) {\n          clearInterval(this.zoomIntervalId);\n          this.zoomIntervalId = null;\n        }\n        if (this.moveIntervalId != null) {\n          return;\n        }\n        // 设置一个定时器，每100ms执行一次触摸移动的逻辑\n        this.moveIntervalId = setInterval(() => {\n          // console.log('执行触摸移动!');\n          if (!this.isDragging || !this.isOneTouch) return;\n\n          const dx = this.startTouchX[0] - this.currentTouchX[0];\n          const dy = this.startTouchY[0] - this.currentTouchY[0];\n          if (isNaN(dx) || isNaN(dy)) {\n            return;\n          }\n          if (dx == 0 && dy == 0) {\n            return;\n          }\n\n          let newVisibleX = this.visibleX + dx / window.innerWidth * this.visibleWidth;\n          let newVisibleY = this.visibleY + dy / window.innerHeight * this.visibleHeight;\n          if (newVisibleX < 0) {\n            newVisibleX = 0;\n          }\n          if (newVisibleY < 0) {\n            newVisibleY = 0;\n          }\n          if (newVisibleX > this.mainCameraSizeX) {\n            newVisibleX = this.mainCameraSizeX;\n          }\n          if (newVisibleY > this.mainCameraSizeY) {\n            newVisibleY = this.mainCameraSizeY;\n          }\n\n          this.visibleX = newVisibleX;\n          this.visibleY = newVisibleY;\n\n          this.startTouchX[0] = this.currentTouchX[0];\n          this.startTouchY[0] = this.currentTouchY[0];\n\n          this.drawImageData();\n        }, 100);\n\n      } else if (event.touches.length >= 2) {\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        this.currentTouchX[1] = event.touches[1].clientX;\n        this.currentTouchY[1] = event.touches[1].clientY;\n\n        // 清除可能存在的单指触摸的定时器\n        if (this.moveIntervalId) {\n          clearInterval(this.moveIntervalId);\n          this.moveIntervalId = null;\n        }\n        if (this.zoomIntervalId != null) {\n          return;\n        }\n        // 设置一个定时器，每100ms执行一次缩放逻辑\n        this.zoomIntervalId = setInterval(() => {\n          if (!this.isDragging || !this.isOneTouch) return;\n          const dx = this.currentTouchX[0] - this.currentTouchX[1];\n          const dy = this.currentTouchY[0] - this.currentTouchY[1];\n          const distance = Math.sqrt(dx * dx + dy * dy);\n          this.SendConsoleLogMsg('距离变化 distance:' + distance, 'info');\n          if (this.startTouchDistance == 0) {\n            this.startTouchDistance = distance;\n          }\n          // 计算缩放比例的变化量\n          const scaleChange = distance / this.startTouchDistance;\n          this.SendConsoleLogMsg('距离变化比例 scaleChange:' + scaleChange, 'info');\n          let newScale = this.scale * scaleChange; // 更新缩放比例\n          if (newScale < 0.1) {\n            newScale = 0.1;\n          }\n          if (newScale > 1) {\n            newScale = 1;\n          }\n          if (newScale != this.scale) {\n            this.SendConsoleLogMsg('缩放比例变化,缩放比例:' + newScale, 'info');\n            this.scale = newScale; // 更新缩放比例\n            this.$bus.$emit('setScale', this.scale);\n            this.drawImageData();\n          } else {\n            this.SendConsoleLogMsg('缩放比例没有变化,缩放比例:' + this.scale, 'info');\n          }\n          this.startTouchDistance = distance; // 更新两个触摸点之间的距离\n        }, 100);\n      } else {\n        this.SendConsoleLogMsg('触发多指触摸事件，获取当前触摸点数量:' + event.touches.length, 'info');\n      }\n    },\n\n    handleTouchEnd(event) {\n      // this.SendConsoleLogMsg('触发触摸结束事件:', 'info');\n      this.isDragging = false; // 停止拖动\n      // 清除定时器\n      if (this.moveIntervalId) {\n        clearInterval(this.moveIntervalId);\n        this.moveIntervalId = null;\n      }\n      if (this.zoomIntervalId) {\n        clearInterval(this.zoomIntervalId);\n        this.zoomIntervalId = null;\n      }\n    },\n\n    ScaleChange(type) {\n      if (this.drawImgData == null) return;\n      if (type == '+') {\n        this.scale -= 0.1;\n      } else if (type == '-') {\n        this.scale += 0.1;\n      }\n      if (this.scale < 0.1) {\n        this.scale = 0.1;\n      }\n      if (this.scale > 1) {\n        this.scale = 1;\n      }\n      this.$bus.$emit('setScale', this.scale);\n      this.drawImageData();\n    },\n\n    // 显示ROI图像\n    showRoiImage(fileName, destX, destY) {\n      if (this.RedBoxSideLength == 0 || this.RedBoxSideLength == null) {\n        this.SendConsoleLogMsg('RedBoxSideLength is 0 or null', 'error');\n        return;\n      }\n      if (this.isProcessingImage) {\n        this.SendConsoleLogMsg('Image is being transmitted, current processing is slow, skipping one frame.', 'warning');\n        return;\n      }\n      this.isProcessingImage = true;\n      const imagePath = 'img/' + fileName;\n      // 创建一个AbortController实例来取消fetch请求\n      const fetchController = new AbortController();\n      const fetchSignal = fetchController.signal;\n\n      // const startDownloadTime = performance.now();\n\n      // 使用 fetch API 获取二进制数据\n      fetch(imagePath, { cache: 'no-store', signal: fetchSignal })\n        .then(response => response.arrayBuffer())\n        .then(buffer => {\n          // const endDownloadTime = performance.now();\n          // const downloadTime = endDownloadTime - startDownloadTime;\n          if (this.isFocusLoopShooting) this.$bus.$emit('AppSendMessage', 'Vue_Command', 'showRoiImageSuccess:true');\n          else this.$bus.$emit('AppSendMessage', 'Vue_Command', 'showRoiImageSuccess:false');\n          let time1 = performance.now();\n          let src, imgData, targetImg8;\n          try {\n            const uint16Array = new Uint16Array(buffer);\n            let newWidth = parseInt(this.RedBoxSideLength / this.cameraBin);\n            let newHeight = parseInt(this.RedBoxSideLength / this.cameraBin);\n            if (newWidth % 2 != 0) {\n              newWidth = newWidth - 1;\n            }\n            if (newHeight % 2 != 0) {\n              newHeight = newHeight - 1;\n            }\n            if (uint16Array.length !== newWidth * newHeight) {\n              this.SendConsoleLogMsg('uint16Array.length (' + uint16Array.length + ') !== newWidth * newHeight (' + newWidth * newHeight + ')', 'error');\n              return;\n            }\n            // 创建一个空的 Mat 对象\n            src = new cv.Mat(newHeight, newWidth, cv.CV_16UC1);\n            src.data16U.set(uint16Array);\n            let time2 = performance.now();\n            this.SendConsoleLogMsg('创建mat对象时间: ' + (time2 - time1).toFixed(0) + 'ms', 'info');\n            if (this.lastImageProcessParams.isColorCamera == 'true' || this.lastImageProcessParams.isColorCamera == 'True' || this.lastImageProcessParams.isColorCamera) {\n              targetImg8 = this.applyStretchAndGain(src, this.lastImageProcessParams.analysis, 'bayer', this.lastImageProcessParams.CFA, this.lastImageProcessParams.blackLevel, this.lastImageProcessParams.whiteLevel);\n\n            } else {\n              targetImg8 = this.applyStretchAndGain(src, this.lastImageProcessParams.analysis, 'gray', this.lastImageProcessParams.CFA, this.lastImageProcessParams.blackLevel, this.lastImageProcessParams.whiteLevel);\n     \n            }\n            time1 = performance.now();\n            this.SendConsoleLogMsg('applyStretchAndGain时间: ' + (time1 - time2).toFixed(0) + 'ms', 'info');\n            src.delete();\n            src = null;\n\n            // 将 Mat 对象转换回 ImageData 对象\n            imgData = new ImageData(new Uint8ClampedArray(targetImg8.data), targetImg8.cols, targetImg8.rows);\n            targetImg8.delete();\n            targetImg8 = null;\n            // 在指定位置开始绘制图像\n            // this.bufferCtx.clearRect(this.ROI_x, this.ROI_y, targetImg8.cols, targetImg8.rows);\n            this.bufferCtx.putImageData(imgData, this.ROI_x, this.ROI_y);\n            // this.SendConsoleLogMsg('绘制一次ROI数据:' + fileName + ':' + this.ROI_x + ':' + this.ROI_y, 'info');\n            // 标注识别到的星点位置\n            // time2 = performance.now();\n            // this.SendConsoleLogMsg('绘制在缓存画布耗时: ' + (time2 - time1).toFixed(0) + 'ms', 'info');\n            this.drawImageData();\n            // time1 = performance.now();\n            // this.SendConsoleLogMsg('drawImageData时间: ' + (time1 - time2).toFixed(0) + 'ms', 'info');\n            this.focuserPictureFileName = fileName;\n            // const processTime = performance.now() - downloadTime;\n            // this.SendConsoleLogMsg(`ROI的执行时间 下载: ${downloadTime.toFixed(0)}ms, 处理: ${processTime.toFixed(0)}ms`, 'info');\n\n          } catch (error) {\n            console.error(`处理图像失败: ${imagePath}`, error);\n          } finally {\n            // 确保 Mat 对象和 ImageData 对象被删除\n            if (src && !src.isDeleted()) {\n              src.delete();\n              src = null; // 添加这行代码，确保 src 对象被清理\n            }\n            if (targetImg8 && !targetImg8.isDeleted()) {\n              targetImg8.delete();\n              targetImg8 = null; // 添加这行代码，确保 originalImg8 对象被清理\n            }\n            // 确保 buffer 被清理\n            buffer = null;\n            this.isProcessingImage = false;\n          }\n        })\n        .catch(error => {\n          if (error.name === 'AbortError') {\n            console.log('Fetch request cancelled');\n          } else {\n            console.error(`获取图像失败: ${imagePath}`, error);\n          }\n          this.isProcessingImage = false;\n        });\n\n      // 在组件卸载时取消 fetch 请求\n      this.$once('hook:beforeDestroy', () => {\n        fetchController.abort();\n      });\n    },\n    setRedBoxState(length, x, y) {\n      this.SendConsoleLogMsg('setRedBoxState:' + length + ',' + x + ',' + y, 'info');\n      this.$bus.$emit('setRedBoxPosition', x, y);\n      this.$bus.$emit('setRedBoxSideLength', length);\n    },\n    setFocuserState(state) {\n      if (state === 'selectstars') {\n        this.isFocusLoopShooting = true;\n      } else {\n        this.isFocusLoopShooting = false;\n      }\n    },\n    setShowSelectStar(state) {\n      this.showSelectStar = state;\n    },\n    RedBoxSizeChange(length) {\n      this.RedBoxSideLength = parseInt(length);\n      // this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendRedBoxState:' + this.RedBoxSideLength + ':' + this.ROI_x + ':' + this.ROI_y);\n    },\n    setMainCameraParameters(parameters) {\n      for (const parameter in parameters) {\n        const item = this.MainCameraConfigItems.find(item => item.label === parameter);\n        if (item) {\n          item.value = parameters[parameter];\n        } else {\n          if (parameter == 'RedBoxSize') {\n            this.$bus.$emit('setRedBoxSideLength', parameters[parameter]);\n            this.RedBoxSideLength = parseInt(parameters[parameter]);\n          } else if (parameter == 'ROI_x') {\n            this.ROI_x = parseFloat(parameters[parameter]);\n          } else if (parameter == 'ROI_y') {\n            this.ROI_y = parseFloat(parameters[parameter]);\n          } \n          else {\n            console.error(`未找到参数：${parameter}`);\n          }\n        }\n      }\n      this.confirmConfiguration(this.MainCameraConfigItems);\n    },\n    showCanvas(canvas) {\n      if (canvas === 'Stel') {\n        this.currentcanvas = 'Stel';\n        this.showStelCanvas();\n      }\n      else if (canvas === 'MainCamera') {\n\n        this.currentcanvas = 'MainCamera';\n        this.showMainCameraCanvas();\n        this.drawImageData()\n      }\n      else if (canvas === 'GuiderCamera') {\n        this.currentcanvas = 'GuiderCamera';\n        this.showGuiderCameraCanvas();\n      } else {\n        this.SendConsoleLogMsg(\"unknown canvas: \" + canvas, 'error');\n      }\n    },\n    // 现有的加减函数需要修改\n    decrementAndNotify(item) {\n      if (item.value > item.inputMin) {\n        item.value -= item.inputStep;\n        this.handleConfigChange(item.label, item.value);\n      }\n    },\n\n    incrementAndNotify(item) {\n      if (item.value < item.inputMax) {\n        item.value += item.inputStep;\n        this.handleConfigChange(item.label, item.value);\n      }\n    },\n\n    // 通用的配置更改处理函数\n    handleConfigChange(label, value) {\n      console.log(`配置已更改: ${label} = ${value}`);\n      if (value !== '') {\n        // console.log(item.label, item.value);\n        this.SendConsoleLogMsg(label + ':' + value, 'info');\n        this.$bus.$emit(label, label + ':' + value);\n      } else if (value == '' && label === 'Focal Length (mm)') {\n        this.SendConsoleLogMsg(label + 'is NULL', 'info');\n        this.$bus.$emit(item.label, item.label + ':');\n      }\n    },\n    // 校准相关方法\n    startCalibrationProcess() {\n      this.calibrationInfo.isCalibrating = true;\n      this.calibrationInfo.calibrationState = 'running';\n      this.calibrationInfo.calibrationStep = 0;\n      this.calibrationInfo.calibrationMessage = this.$t('Preparing to start focuser travel calibration...');\n      console.log('App: Calibration started:', this.calibrationInfo);\n    },\n\n    updateCalibrationInfo(step, message, state) {\n      try {\n        this.calibrationInfo.calibrationStep = step;\n        // 如果消息是国际化键，则翻译它\n        if (message && typeof message === 'string') {\n          this.calibrationInfo.calibrationMessage = this.$t(message);\n        } else {\n          this.calibrationInfo.calibrationMessage = message;\n        }\n        if (state) {\n          this.calibrationInfo.calibrationState = state;\n        }\n        if (step === 0) {\n          this.calibrationInfo.isCalibrating = true;\n        }\n        console.log('App: Calibration info updated:', this.calibrationInfo);\n      } catch (error) {\n        console.error('Error in updateCalibrationInfo:', error);\n      }\n    },\n\n    endCalibration() {\n      this.calibrationInfo.isCalibrating = false;\n      this.calibrationInfo.calibrationState = 'idle';\n      this.calibrationInfo.calibrationStep = 0;\n      this.calibrationInfo.calibrationMessage = '';\n      console.log('App: Calibration ended');\n    },\n  },\n  computed: {\n    nav: {\n      get: function () {\n        console.log('nav:', this.$store.state.showNavigationDrawer);\n        return this.$store.state.showNavigationDrawer\n      },\n      set: function (v) {\n        if (this.$store.state.showNavigationDrawer !== v) {\n          console.log('nav:', this.$store.state.showNavigationDrawer);\n          this.$store.commit('toggleBool', 'showNavigationDrawer')\n        }\n      }\n    },\n    storeCurrentLocation: function () {\n      return this.$store.state.currentLocation\n    },\n    getQTClientVersionColor() {\n      if (this.QTClientVersion === 'Not connected') {\n        return 'rgba(255, 0, 0, 0.5)'; // 红色，透明度 0.5\n      } else {\n        return 'rgba(255, 255, 255, 0.5)'; // 默认白色，透明度 0.5\n      }\n    },\n    isMobile() {\n      var ua = navigator.userAgent || '';\n      var touch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);\n      var uaDataMobile = null;\n      // 兼容老浏览器：避免可选链\n      if (navigator.userAgentData && typeof navigator.userAgentData.mobile !== 'undefined') {\n        uaDataMobile = navigator.userAgentData.mobile;\n      }\n      var mobileLike = /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(ua);\n      return (uaDataMobile !== null ? uaDataMobile : mobileLike) && !!touch;\n    },\n    isDesktop() {\n      return !this.isMobile;\n    },\n  },\n  watch: {\n    storeCurrentLocation: function (loc) {\n      const DD2R = Math.PI / 180\n      this.$stel.core.observer.latitude = loc.lat * DD2R\n      this.$stel.core.observer.longitude = loc.lng * DD2R\n      this.$stel.core.observer.elevation = loc.alt\n\n      // At startup, we need to wait for the location to be set before deciding which\n      // startup time to set so that it's night time.\n      if (!this.startTimeIsSet) {\n        this.$stel.core.observer.utc = swh.getTimeAfterSunset(this.$stel)\n        this.startTimeIsSet = true\n      }\n      // Init of time and date is complete\n      this.$store.commit('setValue', { varName: 'initComplete', newValue: true })\n    },\n    $route: function () {\n      // react to route changes...\n      this.setStateFromQueryArgs()\n    },\n    CurrentDriverType(newVal) {\n      // 当 CurrentDriverType 变化时，更新 selectedDriver\n      this.updateSelectedDriver(newVal);\n    }\n  },\n  mounted: function () {\n    // // 阻止默认的触摸行为\n    // document.addEventListener('touchstart', this.preventDefault, { passive: false });\n    // document.addEventListener('touchmove', this.preventDefault, { passive: false });\n    // document.addEventListener('touchend', this.preventDefault, { passive: false });\n\n    // // 阻止默认的鼠标行为\n    // document.addEventListener('mousedown', this.preventDefault, { passive: false });\n    // document.addEventListener('mousemove', this.preventDefault, { passive: false });\n    // document.addEventListener('mouseup', this.preventDefault, { passive: false });\n\n    // // 阻止默认的滚轮行为\n    // document.addEventListener('wheel', this.preventDefault, { passive: false });\n\n    let that = this\n\n    this.getLocationHostName();\n\n    this.loadImageToCanvasMainCamera();\n    this.loadImageToCanvasGuiderCamera();\n\n    this.initCanvas();\n    this.addEventListeners();\n\n    for (const i in this.$stellariumWebPlugins()) {\n      const plugin = this.$stellariumWebPlugins()[i]\n      if (plugin.onAppMounted) {\n        plugin.onAppMounted(that)\n      }\n    }\n\n    this.connect();\n    this.setupNetworkStatusListener();\n\n    // 使用 Promise 检查 OpenCV.js 是否加载完成\n    this.loadOpenCv().then(() => {\n      if (!this._isDestroyed) { // 检查组件是否已销毁\n        console.log('OpenCV.js is ready');\n        this.onCvReady();  // 调用 OpenCV 准备好的回调\n      }\n    }).catch(error => {\n      console.error('Error loading OpenCV.js:', error);\n    });\n\n    // const script = document.createElement('script');\n    // script.src = 'https://docs.opencv.org/4.5.5/opencv.js';\n    // script.async = true;\n    // script.onload = () => this.onCvReady();\n    // document.head.appendChild(script);\n\n    import('@/assets/js/stellarium-web-engine.wasm').then(f => {\n      if (!this._isDestroyed) { // 再次检查组件是否已销毁\n        // Initialize the StelWebEngine viewer singleton\n        // After this call, the StelWebEngine state will always be available in vuex store\n        // in the $store.stel object in a reactive way (useful for vue components).\n        // To modify the state of the StelWebEngine, it's enough to call/set values directly on the $stel object\n        try {\n          swh.initStelWebEngine(that.$store, f.default, that.$refs.stelCanvas, function () {\n            // Start auto location detection (even if we don't use it)\n            swh.getGeolocation().then(p => swh.geoCodePosition(p, that)).then((loc) => {\n              that.$store.commit('setAutoDetectedLocation', loc)\n            }, (error) => { console.log(error) })\n\n            that.$stel.setFont('regular', process.env.BASE_URL + 'fonts/Roboto-Regular.ttf', 1.38)\n            that.$stel.setFont('bold', process.env.BASE_URL + 'fonts/Roboto-Bold.ttf', 1.38)\n            that.$stel.core.constellations.show_only_pointed = false\n\n            that.setStateFromQueryArgs()\n            that.guiComponent = 'Gui'\n            for (const i in that.$stellariumWebPlugins()) {\n              const plugin = that.$stellariumWebPlugins()[i]\n              if (plugin.onEngineReady) {\n                plugin.onEngineReady(that)\n              }\n            }\n\n            if (!that.dataSourceInitDone) {\n              // Set all default data sources\n              const core = that.$stel.core\n              core.stars.addDataSource({ url: process.env.BASE_URL + 'skydata/stars' })\n              core.stars.addDataSource({ url: process.env.BASE_URL + 'skydata/stars_base' })\n              core.stars.addDataSource({ url: process.env.BASE_URL + 'skydata/stars_extend' })\n              core.dss.addDataSource({ url: process.env.BASE_URL + 'skydata/dss/v1' })\n              // core.stars.addDataSource({ url: process.env.BASE_URL + 'skydata/stars' })\n\n              // Allow to specify a custom path for sky culture data\n              if (that.$route.query.sc) {\n                const key = that.$route.query.sc.substring(that.$route.query.sc.lastIndexOf('/') + 1)\n                core.skycultures.addDataSource({ url: that.$route.query.sc, key: key })\n                core.skycultures.current_id = key\n              } else {\n                core.skycultures.addDataSource({ url: process.env.BASE_URL + 'skydata/skycultures/western', key: 'western' })\n              }\n\n              core.dsos.addDataSource({ url: process.env.BASE_URL + 'skydata/dso' })\n              core.landscapes.addDataSource({ url: process.env.BASE_URL + 'skydata/landscapes/guereins', key: 'guereins' })\n              core.milkyway.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/milkyway' })\n              // core.dss.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/dss' })\n              core.minor_planets.addDataSource({ url: process.env.BASE_URL + 'skydata/mpcorb.dat', key: 'mpc_asteroids' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/moon', key: 'moon' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/sun', key: 'sun' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/moon', key: 'default' })\n              core.comets.addDataSource({ url: process.env.BASE_URL + 'skydata/CometEls.txt', key: 'mpc_comets' })\n              core.satellites.addDataSource({ url: process.env.BASE_URL + 'skydata/tle_satellite.jsonl.gz', key: 'jsonl/sat' })\n\n              // Mount Pointing\n              glStel = that.setGloabalStel(that.$stel);\n              glLayer = that.setGlobalLayer(that.$stel);\n              glTestCircle = that.testAddCircle(that.$stel, glLayer);\n\n            }\n          })\n        } catch (e) {\n          this.$store.commit('setValue', { varName: 'wasmSupport', newValue: false })\n        }\n      }\n    });\n\n    window.addEventListener('load', () => {\n      // 页面完全加载\n      this.SendConsoleLogMsg('页面已完全加载', 'info');\n      this.$bus.$emit('AppSendMessage', 'Process_Command_Return', 'VueClientVersion:' + process.env.VUE_APP_VERSION);\n    })\n\n    document.addEventListener('DOMContentLoaded', () => {\n      // DOM加载完成\n      this.SendConsoleLogMsg('DOM已加载完成', 'info');\n    })\n\n  },\n  // 在组件销毁时移除\n  beforeDestroy() {\n    document.removeEventListener('touchstart', this.preventDefault);\n    document.removeEventListener('touchmove', this.preventDefault);\n    document.removeEventListener('touchend', this.preventDefault);\n\n    document.removeEventListener('mousedown', this.preventDefault);\n    document.removeEventListener('mousemove', this.preventDefault);\n    document.removeEventListener('mouseup', this.preventDefault);\n\n    document.removeEventListener('wheel', this.preventDefault);\n\n    // 清理极轴校准相关的圆圈\n    if (this.calibrationCircles) {\n      this.calibrationCircles.forEach(circle => {\n        if (glLayer && circle) {\n          glLayer.remove(circle);\n        }\n      });\n      this.calibrationCircles = [];\n    }\n\n    if (this.adjustmentCircles) {\n      this.adjustmentCircles.forEach(circle => {\n        if (glLayer && circle) {\n          glLayer.remove(circle);\n        }\n      });\n      this.adjustmentCircles = [];\n    }\n\n    // 停止视场更新定时器\n    this.stopFieldUpdateTimer();\n  },\n\n\n}\n</script>\n\n<style>\nbody {\n  background-color: black;\n  /* 禁用文本选择 */\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n\n  /* 禁用触摸操作 */\n  /* touch-action: none;\n  -ms-touch-action: none; */\n\n  /* 禁用双击缩放 */\n  -webkit-tap-highlight-color: transparent;\n\n  /* 禁用滚动和缩放 */\n  overscroll-behavior: none;\n  -webkit-overflow-scrolling: touch;\n\n  /* 禁用长按菜单 */\n  -webkit-touch-callout: none;\n\n  /* 禁用图片拖拽 */\n  -webkit-user-drag: none;\n  -khtml-user-drag: none;\n  -moz-user-drag: none;\n  -o-user-drag: none;\n}\n\n/* 确保画布元素也继承这些属性 */\ncanvas {\n  /* touch-action: none;\n  -ms-touch-action: none; */\n  -webkit-tap-highlight-color: transparent;\n  -webkit-user-drag: none;\n}\n\n/* 禁用所有元素的默认触摸行为 */\n/* * {\n  touch-action: none;\n  -ms-touch-action: none;\n} */\n\na {\n  color: #82b1ff;\n}\n\na:link {\n  text-decoration-line: none;\n}\n\n.divider_menu {\n  margin-top: 8px;\n  margin-bottom: 8px;\n}\n\nhtml {\n  overflow-y: visible;\n}\n\nhtml,\nbody,\n#app {\n  overflow-y: visible !important;\n  overflow-x: visible;\n  position: fixed !important;\n  width: 100%;\n  height: 100%;\n  padding: 0 !important;\n  font-size: 10px;\n}\n\n.fullscreen {\n  overflow-y: hidden;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  padding: 0 !important;\n}\n\n.click-through {\n  pointer-events: none;\n}\n\n.get-click {\n  pointer-events: all;\n}\n\n.dialog {\n  background: transparent;\n}\n\n.menu__content {\n  background-color: transparent !important;\n}\n\n#stel {\n  height: 100%;\n  width: 100%;\n  position: absolute;\n}\n\n#stel-canvas {\n  width: 100%;\n  height: 100%;\n}\n\n#mainCamera-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n#guiderCamera-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.right_panel {\n  padding-right: 400px;\n}\n\n.v-btn {\n  margin-left: 8px;\n  margin-right: 8px;\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n\n.v-application--wrap {\n  min-height: 100% !important;\n}\n\n\n.my-custom-button {\n  background-color: #4CAF50;\n  /* 绿色背景 */\n  color: white;\n  /* 白色文字 */\n  padding: 15px 32px;\n  /* 内边距 */\n  text-align: center;\n  /* 文字居中 */\n  text-decoration: none;\n  /* 无文本装饰 */\n  display: inline-block;\n  /* 行内块显示 */\n  font-size: 16px;\n  /* 字体大小 */\n  margin: 4px 2px;\n  /* 外边距 */\n  cursor: pointer;\n  /* 鼠标样式 */\n  border: none;\n  /* 无边框 */\n}\n\n.connected-device {\n  color: #4dc251;\n}\n\n.btn-confirm {\n  width: 60px;\n  height: 30px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n}\n\n.btn-slider {\n  width: 20px;\n  height: 20px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n}\n\n.btn-confirm:active,\n.btn-slider:active {\n  transform: scale(0.95);\n  background-color: rgba(255, 255, 255, 0.5);\n}\n\n\n/* 配置项样式 */\n.config-item {\n  text-align: center;\n  width: 100%;\n  margin-bottom: 5px;\n}\n\n/* 配置项标题 */\n.config-title {\n  display: inline-block;\n  font-size: 15px;\n  color: rgba(255, 255, 255, 0.5);\n  user-select: none;\n  margin-top: 10px;\n  margin-bottom: 5px;\n}\n\n/* 配置输入框 */\n.config-input {\n  width: 150px;\n  display: inline-block;\n  margin: 5px 0;\n}\n\n/* 滑块容器 */\n.slider-container {\n  text-align: left;\n  height: 30px;\n  width: 150px;\n  display: inline-block;\n  margin-bottom: 20px;\n  position: relative;\n}\n\n/* 滑块标签 */\n.slider-label {\n  display: inline-block;\n  font-size: 15px;\n  color: rgba(255, 255, 255, 0.5);\n  user-select: none;\n  margin-bottom: 5px;\n}\n\n/* 滑块控制样式 */\n.slider-control {\n  position: absolute;\n  left: 30px;\n  width: calc(100% - 60px);\n}\n\n/* 提示控制样式 */\n.tip-field {\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  /* 左标签 | 中值 | 右复制 */\n  align-items: center;\n  gap: 8px;\n  padding: 8px 4px 4px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n  /* 与其他输入项的下划线保持一致 */\n}\n\n.tip-label {\n  color: var(--v-theme-primary, #42a5f5);\n  font-size: 0.9rem;\n  line-height: 1.2;\n  white-space: nowrap;\n}\n\n.tip-value {\n  font-size: 1.25rem;\n  font-weight: 600;\n  letter-spacing: 0.02em;\n  user-select: text;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", monospace;\n}\n\n.tip-copy {\n  margin-left: 4px;\n  opacity: 0.9;\n}\n\n/* 减少按钮样式 */\n.btn-minus {\n  position: absolute;\n  left: 5px;\n  transform: translateY(5px);\n}\n\n/* 增加按钮样式 */\n.btn-plus {\n  position: absolute;\n  right: 5px;\n  transform: translateY(5px);\n}\n\n/* 按钮内容居中 */\n.btn-content {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n}\n\n/* 按钮图标样式 */\n.btn-icon {\n  min-height: 10px;\n  pointer-events: none;\n}\n\n/* 开关样式 */\n.config-switch {\n  width: 150px;\n  display: inline-block;\n  margin-bottom: 0;\n  margin-top: 0;\n}\n\n/* 自定义滚动条样式 */\n.config-items-container::-webkit-scrollbar {\n  width: 6px;\n}\n\n.config-items-container::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 3px;\n}\n\n.config-items-container::-webkit-scrollbar-thumb {\n  background: rgba(255, 255, 255, 0.3);\n  border-radius: 3px;\n}\n\n.config-items-container::-webkit-scrollbar-thumb:hover {\n  background: rgba(255, 255, 255, 0.5);\n}\n\n/* Firefox滚动条样式 */\n.config-items-container {\n  scrollbar-width: thin;\n  scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.1);\n}\n\n/* 参数容器滚动条样式 */\n.params-container {\n  overflow-y: auto;\n  height: 100%;\n}\n\n.params-container::-webkit-scrollbar {\n  width: 6px;\n}\n\n.params-container::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 3px;\n}\n\n.params-container::-webkit-scrollbar-thumb {\n  background: white;\n  border-radius: 3px;\n}\n\n.params-container::-webkit-scrollbar-thumb:hover {\n  background: rgba(255, 255, 255, 0.8);\n}\n\n/* Firefox滚动条样式 */\n.params-container {\n  scrollbar-width: thin;\n  scrollbar-color: white rgba(0, 0, 0, 0.1);\n}\n\n/* 校准信息显示框样式 */\n.calibration-info-box {\n  position: fixed;\n  top: 50vh;\n  left: 50vw;\n  transform: translate(-50%, -50%);\n  background-color: rgba(0, 0, 0, 0.9);\n  backdrop-filter: blur(15px);\n  border: 2px solid rgba(255, 165, 0, 0.8);\n  border-radius: 15px;\n  padding: 25px;\n  z-index: 10001;\n  min-width: 350px;\n  max-width: 450px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n}\n\n.calibration-content {\n  text-align: center;\n  color: white;\n}\n\n.calibration-title {\n  font-size: 20px;\n  font-weight: bold;\n  margin-bottom: 20px;\n  color: #FFA500;\n  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.calibration-message {\n  font-size: 16px;\n  line-height: 1.6;\n  margin-bottom: 20px;\n  color: #FFFFFF;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n}\n\n.calibration-progress {\n  font-size: 14px;\n  color: #FFA500;\n  font-weight: bold;\n  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n}\n</style>"]}]}