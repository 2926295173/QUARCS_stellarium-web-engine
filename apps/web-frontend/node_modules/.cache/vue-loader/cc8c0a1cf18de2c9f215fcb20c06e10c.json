{"remainingRequest":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/components/location-mgr.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/components/location-mgr.vue","mtime":1749198887358},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/thread-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/babel-loader/lib/index.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js","mtime":1707125450000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzd2ggZnJvbSAnQC9hc3NldHMvc3dfaGVscGVycy5qcycKaW1wb3J0IHsgTE1hcCwgTFRpbGVMYXllciwgTE1hcmtlciwgTENpcmNsZSwgTFRvb2x0aXAsIExDb250cm9sWm9vbSB9IGZyb20gJ3Z1ZTItbGVhZmxldCcKaW1wb3J0IHsgTCB9IGZyb20gJ2xlYWZsZXQtY29udHJvbC1nZW9jb2Rlci9kaXN0L0NvbnRyb2wuR2VvY29kZXIuanMnCgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgbW9kZTogJ3BpY2snLAogICAgICBwaWNrTG9jYXRpb246IHVuZGVmaW5lZCwKICAgICAgc2VsZWN0ZWRLbm93bkxvY2F0aW9uOiB1bmRlZmluZWQsCiAgICAgIG1hcENlbnRlcjogWzQzLjYsIDEuNDMzM10sCiAgICAgIHVybDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyA/ICcvdGlsZXMve3p9L3t4fS97eX0ucG5nJyA6ICdodHRwOi8vbG9jYWxob3N0OjgwODAvdGlsZXMve3p9L3t4fS97eX0ucG5nJywKICAgICAgZmFsbGJhY2tVcmw6ICcvdGlsZXMve3p9L3t4fS97eX0ucG5nJywKICAgICAgc2VydmVyVXJsOiAnaHR0cDovL2xvY2FsaG9zdDo4MDgwL3RpbGVzL3t6fS97eH0ve3l9LnBuZycsCiAgICAgIG9ubGluZVVybDogJ2h0dHBzOi8ve3N9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nJwogICAgfQogIH0sCiAgcHJvcHM6IFsnc2hvd015TG9jYXRpb24nLCAna25vd25Mb2NhdGlvbnMnLCAnc3RhcnRMb2NhdGlvbicsICdyZWFsTG9jYXRpb24nXSwKICBjb21wdXRlZDogewogICAgZG9TaG93TXlMb2NhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5zaG93TXlMb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiB0aGlzLnNob3dNeUxvY2F0aW9uCiAgICB9LAogICAgcGlja0xvY2F0aW9uTW9kZTogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlID09PSAncGljaycKICAgIH0sCiAgICBrbm93bkxvY2F0aW9uTW9kZTogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlID09PSAna25vd24nCiAgICB9LAogICAgbG9jYXRpb25Gb3JEZXRhaWw6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMucGlja0xvY2F0aW9uTW9kZSAmJiB0aGlzLnBpY2tMb2NhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRMb2NhdGlvbgogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnBpY2tMb2NhdGlvbk1vZGUgPyB0aGlzLnBpY2tMb2NhdGlvbiA6IHRoaXMuc2VsZWN0ZWRLbm93bkxvY2F0aW9uCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgc3RhcnRMb2NhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnNldFBpY2tMb2NhdGlvbih0aGlzLnN0YXJ0TG9jYXRpb24pCiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiAoKSB7CiAgICBjb25zdCB0aGF0ID0gdGhpcwogICAgdGhpcy5zZXRQaWNrTG9jYXRpb24odGhpcy5zdGFydExvY2F0aW9uKQogICAgCiAgICAvLyDmo4DmtYvnk6bniYfmnI3liqHlmajlj6/nlKjmgKcKICAgIHRoaXMuY2hlY2tUaWxlQXZhaWxhYmlsaXR5KCkKICAgIAogICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICBjb25zdCBtYXAgPSB0aGlzLiRyZWZzLm15TWFwLm1hcE9iamVjdAogICAgICBtYXAuX29uUmVzaXplKCkKCiAgICAgIC8vIOa3u+WKoOemu+e6v+aQnOe0ouaOp+S7tgogICAgICB0aGlzLmFkZE9mZmxpbmVTZWFyY2hDb250cm9sKG1hcCkKICAgIH0pCiAgfSwKICBtZXRob2RzOiB7CiAgICBzZWxlY3RLbm93bkxvY2F0aW9uOiBmdW5jdGlvbiAobG9jKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRLbm93bkxvY2F0aW9uID0gbG9jCiAgICAgIHRoaXMuc2V0S25vd25Mb2NhdGlvbk1vZGUoKQogICAgICB0aGlzLm1hcENlbnRlciA9IFtsb2MubGF0LCBsb2MubG5nXQogICAgfSwKICAgIHVzZUxvY2F0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuJGVtaXQoJ2xvY2F0aW9uU2VsZWN0ZWQnLCB0aGlzLmxvY2F0aW9uRm9yRGV0YWlsKQogICAgICB0aGlzLiRlbWl0KCdyZXNldExvY2F0aW9uJywgdGhpcy5sb2NhdGlvbkZvckRldGFpbC5sYXQsIHRoaXMubG9jYXRpb25Gb3JEZXRhaWwubG5nKQogICAgfSwKICAgIHNldFBpY2tMb2NhdGlvbk1vZGU6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5tb2RlID0gJ3BpY2snCiAgICB9LAogICAgc2V0S25vd25Mb2NhdGlvbk1vZGU6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5tb2RlID0gJ2tub3duJwogICAgfSwKICAgIHNldFBpY2tMb2NhdGlvbjogZnVuY3Rpb24gKGxvYykgewogICAgICBpZiAobG9jLmFjY3VyYWN5IDwgMTAwKSB7CiAgICAgICAgZm9yIChjb25zdCBsIG9mIHRoaXMua25vd25Mb2NhdGlvbnMpIHsKICAgICAgICAgIGNvbnN0IGQgPSBzd2guZ2V0RGlzdGFuY2VGcm9tTGF0TG9uSW5NKGwubGF0LCBsLmxuZywgbG9jLmxhdCwgbG9jLmxuZykKICAgICAgICAgIGlmIChkIDwgMTAwKSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0S25vd25Mb2NhdGlvbihsKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIHBvcyA9IHsgbGF0OiBsb2MubGF0LCBsbmc6IGxvYy5sbmcgfQogICAgICB0aGlzLm1hcENlbnRlciA9IFtwb3MubGF0LCBwb3MubG5nXQogICAgICB0aGlzLnBpY2tMb2NhdGlvbiA9IGxvYwogICAgICB0aGlzLnNldFBpY2tMb2NhdGlvbk1vZGUoKQogICAgfSwKICAgIC8vIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvbiB0aGUgc21hbGwgY3Jvc3MgYnV0dG9uCiAgICBjZW50ZXJPblJlYWxQb3NpdGlvbjogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnNldFBpY2tMb2NhdGlvbih0aGlzLnJlYWxMb2NhdGlvbikKICAgIH0sCiAgICBkcmFnRW5kOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzCiAgICAgIHZhciBwb3MgPSB7IGxhdDogZXZlbnQudGFyZ2V0Ll9sYXRsbmcubGF0LCBsbmc6IGV2ZW50LnRhcmdldC5fbGF0bG5nLmxuZywgYWNjdXJhY3k6IDAgfQogICAgICBjb25zb2xlLmxvZygnZHJhZ0VuZCBwb3M6ICcgKyBwb3MubGF0ICsgJywnICtwb3MubG5nKQogICAgICBzd2guZ2VvQ29kZVBvc2l0aW9uKHBvcywgdGhhdCkudGhlbigocCkgPT4geyB0aGF0LnBpY2tMb2NhdGlvbiA9IHA7IHRoYXQuc2V0UGlja0xvY2F0aW9uTW9kZSgpIH0pCiAgICAgIHRoaXMuJGVtaXQoJ3Jlc2V0TG9jYXRpb24nLCBwb3MubGF0LCBwb3MubG5nKQogICAgfSwKICAgIGNoZWNrVGlsZUF2YWlsYWJpbGl0eTogZnVuY3Rpb24gKCkgewogICAgICBjb25zdCB0aGF0ID0gdGhpcwogICAgICAKICAgICAgLy8g5Zyo55Sf5Lqn546v5aKD5LiL5LyY5YWI5L2/55So6Z2Z5oCB55Om54mHCiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgdGhhdC50ZXN0U3RhdGljVGlsZXMoKS50aGVuKGlzQXZhaWxhYmxlID0+IHsKICAgICAgICAgIGlmIChpc0F2YWlsYWJsZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygn5L2/55So6Z2Z5oCB55Om54mH5paH5Lu2JykKICAgICAgICAgICAgdGhhdC51cmwgPSB0aGF0LmZhbGxiYWNrVXJsCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygn6Z2Z5oCB55Om54mH5LiN5Y+v55So77yM5bCd6K+VdGlsZeacjeWKoeWZqCcpCiAgICAgICAgICAgIHRoYXQudGVzdFRpbGVTZXJ2ZXIoKQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5byA5Y+R546v5aKD5LiL5LyY5YWI5bCd6K+VdGlsZeacjeWKoeWZqAogICAgICAgIHRoYXQudGVzdFRpbGVTZXJ2ZXIoKQogICAgICB9CiAgICB9LAogICAgCiAgICB0ZXN0U3RhdGljVGlsZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgdGhhdCA9IHRoaXMKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgLy8g5rWL6K+V5aSa5Liq57yp5pS+57qn5Yir55qE55Om54mH5piv5ZCm5a2Y5ZyoCiAgICAgICAgY29uc3QgdGVzdFVybHMgPSBbCiAgICAgICAgICAnL3RpbGVzLzAvMC8wLnBuZycsCiAgICAgICAgICAnL3RpbGVzLzEvMC8wLnBuZycsCiAgICAgICAgICAnL3RpbGVzLzIvMS8xLnBuZycKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgbGV0IHRlc3RDb3VudCA9IDAKICAgICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMAogICAgICAgIAogICAgICAgIHRlc3RVcmxzLmZvckVhY2godXJsID0+IHsKICAgICAgICAgIGZldGNoKHVybCwgeyBtZXRob2Q6ICdIRUFEJyB9KQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgdGVzdENvdW50KysKICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NDb3VudCsrCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIAogICAgICAgICAgICAgIGlmICh0ZXN0Q291bnQgPT09IHRlc3RVcmxzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgLy8g5aaC5p6c6Iez5bCR5LiA5Y2K55qE5rWL6K+V55Om54mH5Y+v55So77yM6K6k5Li66Z2Z5oCB55Om54mH5Y+v55SoCiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3NDb3VudCA+PSB0ZXN0VXJscy5sZW5ndGggLyAyKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0ZXN0Q291bnQrKwogICAgICAgICAgICAgIGlmICh0ZXN0Q291bnQgPT09IHRlc3RVcmxzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzQ291bnQgPj0gdGVzdFVybHMubGVuZ3RoIC8gMikKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICAvLyDotoXml7blpITnkIYKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGlmICh0ZXN0Q291bnQgPCB0ZXN0VXJscy5sZW5ndGgpIHsKICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSkKICAgICAgICAgIH0KICAgICAgICB9LCAyMDAwKQogICAgICB9KQogICAgfSwKICAgIAogICAgdGVzdFRpbGVTZXJ2ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgdGhhdCA9IHRoaXMKICAgICAgCiAgICAgIC8vIOa1i+ivlXRpbGXmnI3liqHlmajmmK/lkKblj6/nlKgKICAgICAgY29uc3QgdGVzdFVybCA9IHRoaXMuc2VydmVyVXJsLnJlcGxhY2UoJ3t6fScsICcwJykucmVwbGFjZSgne3h9JywgJzAnKS5yZXBsYWNlKCd7eX0nLCAnMCcpCiAgICAgIAogICAgICBmZXRjaCh0ZXN0VXJsLCB7IG1ldGhvZDogJ0hFQUQnLCB0aW1lb3V0OiAzMDAwIH0pCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aWxl5pyN5Yqh5Zmo5Y+v55SoJykKICAgICAgICAgICAgdGhhdC51cmwgPSB0aGF0LnNlcnZlclVybAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0aWxl5pyN5Yqh5Zmo5ZON5bqU6ZSZ6K+vJykKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygndGlsZeacjeWKoeWZqOS4jeWPr+eUqO+8jOS9v+eUqOmdmeaAgeeTpueJhzonLCBlcnJvcikKICAgICAgICAgIHRoYXQudXJsID0gdGhhdC5mYWxsYmFja1VybAogICAgICAgICAgCiAgICAgICAgICAvLyDlpoLmnpzpnZnmgIHnk6bniYfkuZ/kuI3lj6/nlKjvvIzmnIDlkI7lsJ3or5XlnKjnur/nk6bniYcKICAgICAgICAgIHRoYXQudGVzdFN0YXRpY1RpbGVzKCkudGhlbihpc0F2YWlsYWJsZSA9PiB7CiAgICAgICAgICAgIGlmICghaXNBdmFpbGFibGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5YiH5o2i5Yiw5Zyo57q/55Om54mH5pyN5YqhJykKICAgICAgICAgICAgICB0aGF0LnVybCA9IHRoYXQub25saW5lVXJsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH0sCiAgICBhZGRPZmZsaW5lU2VhcmNoQ29udHJvbDogZnVuY3Rpb24gKG1hcCkgewogICAgICBjb25zdCB0aGF0ID0gdGhpcwogICAgICAKICAgICAgLy8g5Yib5bu656a757q/5pCc57Si5o6n5Lu2CiAgICAgIGNvbnN0IHNlYXJjaENvbnRyb2wgPSBMLkNvbnRyb2wuZXh0ZW5kKHsKICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICBwb3NpdGlvbjogJ3RvcGxlZnQnCiAgICAgICAgfSwKICAgICAgICBvbkFkZDogZnVuY3Rpb24obWFwKSB7CiAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnbGVhZmxldC1jb250cm9sLWdlb2NvZGVyIGxlYWZsZXQtYmFyJykKICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxlYWZsZXQtY29udHJvbC1nZW9jb2Rlci1mb3JtIj4KICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9Iui+k+WFpeWdkOaghyAobGF0LGxuZykiIC8+CiAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iPuaQnOe0ojwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIGAKICAgICAgICAgIAogICAgICAgICAgY29uc3QgaW5wdXQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignaW5wdXQnKQogICAgICAgICAgY29uc3QgYnV0dG9uID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbicpCiAgICAgICAgICAKICAgICAgICAgIGJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoYXQuaGFuZGxlT2ZmbGluZVNlYXJjaChpbnB1dC52YWx1ZSkKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgaW5wdXQub25rZXlwcmVzcyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSB7CiAgICAgICAgICAgICAgdGhhdC5oYW5kbGVPZmZsaW5lU2VhcmNoKGlucHV0LnZhbHVlKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgIHJldHVybiBjb250YWluZXIKICAgICAgICB9CiAgICAgIH0pCiAgICAgIAogICAgICBuZXcgc2VhcmNoQ29udHJvbCgpLmFkZFRvKG1hcCkKICAgIH0sCiAgICBoYW5kbGVPZmZsaW5lU2VhcmNoOiBmdW5jdGlvbiAocXVlcnkpIHsKICAgICAgLy8g6Kej5p6Q5Z2Q5qCH6L6T5YWlICjmlK/mjIHlpJrnp43moLzlvI8pCiAgICAgIGNvbnN0IGNvb3JkUGF0dGVybiA9IC8oLT9cZCtcLj9cZCopWyxcc10rKC0/XGQrXC4/XGQqKS8KICAgICAgY29uc3QgbWF0Y2ggPSBxdWVyeS5tYXRjaChjb29yZFBhdHRlcm4pCiAgICAgIAogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICBjb25zdCBsYXQgPSBwYXJzZUZsb2F0KG1hdGNoWzFdKQogICAgICAgIGNvbnN0IGxuZyA9IHBhcnNlRmxvYXQobWF0Y2hbMl0pCiAgICAgICAgCiAgICAgICAgaWYgKGxhdCA+PSAtOTAgJiYgbGF0IDw9IDkwICYmIGxuZyA+PSAtMTgwICYmIGxuZyA8PSAxODApIHsKICAgICAgICAgIGNvbnN0IHBvcyA9IHsgbGF0OiBsYXQsIGxuZzogbG5nLCBhY2N1cmFjeTogMCB9CiAgICAgICAgICB0aGlzLm1hcENlbnRlciA9IFtsYXQsIGxuZ10KICAgICAgICAgIAogICAgICAgICAgY29uc3QgbG9jID0gewogICAgICAgICAgICBzaG9ydF9uYW1lOiBgJHtsYXQudG9GaXhlZCgzKX0sICR7bG5nLnRvRml4ZWQoMyl9YCwKICAgICAgICAgICAgY291bnRyeTogdGhpcy4kdCgnVW5rbm93bicpLAogICAgICAgICAgICBsbmc6IGxuZywKICAgICAgICAgICAgbGF0OiBsYXQsCiAgICAgICAgICAgIGFsdDogMCwKICAgICAgICAgICAgYWNjdXJhY3k6IDAsCiAgICAgICAgICAgIHN0cmVldF9hZGRyZXNzOiAnJwogICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgICB0aGlzLnBpY2tMb2NhdGlvbiA9IGxvYwogICAgICAgICAgdGhpcy5zZXRQaWNrTG9jYXRpb25Nb2RlKCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWxlcnQoJ+WdkOagh+iMg+WbtOmUmeivr++8mue6rOW6pigtOTDliLA5MCnvvIznu4/luqYoLTE4MOWIsDE4MCknKQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBhbGVydCgn6K+36L6T5YWl5pyJ5pWI55qE5Z2Q5qCH5qC85byP77ya57qs5bqmLOe7j+W6piAo5L6L5aaCOiA0MC4xLCAxMTYuMiknKQogICAgICB9CiAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7IExNYXAsIExUaWxlTGF5ZXIsIExNYXJrZXIsIExDaXJjbGUsIExUb29sdGlwLCBMQ29udHJvbFpvb20gfQp9Cg=="},{"version":3,"sources":["location-mgr.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"location-mgr.vue","sourceRoot":"src/components","sourcesContent":["// Stellarium Web - Copyright (c) 2022 - Stellarium Labs SRL\n//\n// This program is licensed under the terms of the GNU AGPL v3, or\n// alternatively under a commercial licence.\n//\n// The terms of the AGPL v3 license can be found in the main directory of this\n// repository.\n\n<template>\n  <div>\n    <v-row justify=\"space-around\">\n      <v-col cols=\"4\" v-if=\"doShowMyLocation\">\n        <v-list two-line subheader>\n          <v-subheader>{{ $t('My Locations') }}</v-subheader>\n          <v-list-item href=\"javascript:;\" v-for=\"item in knownLocations\" v-bind:key=\"item.id\" @click.native.stop=\"selectKnownLocation(item)\" :style=\"(item && knownLocationMode && selectedKnownLocation && item.id === selectedKnownLocation.id) ? 'background-color: #455a64' : ''\">\n            <v-list-item-icon>\n              <v-icon>mdi-map-marker</v-icon>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>{{ item.short_name }}</v-list-item-title>\n              <v-list-item-subtitle>{{ item.country }}</v-list-item-subtitle>\n            </v-list-item-content>\n          </v-list-item>\n        </v-list>\n      </v-col>\n      <v-col cols=\"doShowMyLocation ? 8 : 12\" >\n        <v-card class=\"blue-grey darken-2 white--text\">\n          <v-card-title primary-title>\n            <v-container fluid>\n              <v-row>\n                <v-col>\n                  <div>\n                    <div class=\"text-h5\" style=\"overflow: hidden; white-space: nowrap; text-overflow: ellipsis;\">{{ locationForDetail ? locationForDetail.short_name + ', ' + locationForDetail.country :  '-' }}</div>\n                    <v-btn @click.native.stop=\"useLocation()\" style=\"position: absolute; right: 20px\"><v-icon>mdi-chevron-right</v-icon> {{ $t('Use this location') }}</v-btn>\n                    <div class=\"grey--text text-subtitle-2\" v-if=\"locationForDetail.street_address\">{{ locationForDetail ? (locationForDetail.street_address ? locationForDetail.street_address : $t('Unknown Address')) : '-' }}</div>\n                    <div class=\"grey--text text-subtitle-2\">{{ locationForDetail ? locationForDetail.lat.toFixed(5) + ' ' + locationForDetail.lng.toFixed(5) : '-' }}</div>\n                  </div>\n                </v-col>\n              </v-row>\n            </v-container>\n          </v-card-title>\n          <div style=\"height: 375px\">\n              <!-- <v-btn light fab class=\"mx-0 pa-0\" @click.native.stop=\"centerOnRealPosition()\" style=\"position: absolute; z-index: 10000; bottom: 16px; right: 12px;\">\n                <v-icon>mdi-crosshairs-gps</v-icon>\n              </v-btn> -->\n            <l-map class=\"black--text\" ref=\"myMap\" :center=\"mapCenter\" :zoom=\"10\" style=\"width: 100%; height: 375px;\" :options=\"{zoomControl: false}\">\n              <l-control-zoom position=\"topright\"></l-control-zoom>\n              <l-tile-layer :url=\"url\" attribution='&copy; <a target=\"_blank\" rel=\"noopener\" href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'></l-tile-layer>\n              <l-marker :key=\"loc.id\"\n                  v-for=\"loc in knownLocations\"\n                  :lat-lng=\"[ loc.lat, loc.lng ]\"\n                  :clickable=\"true\"\n                  :opacity=\"(!pickLocationMode && selectedKnownLocation && selectedKnownLocation === loc ? 1.0 : 0.25)\"\n                  @click=\"selectKnownLocation(loc)\"\n                  :draggable=\"!pickLocationMode && selectedKnownLocation && selectedKnownLocation === loc\" @dragend=\"dragEnd\"\n                ></l-marker>\n              <l-circle v-if=\"startLocation\"\n                :lat-lng=\"[ startLocation.lat, startLocation.lng ]\"\n                :radius=\"startLocation.accuracy\"\n                :options=\"{\n                  strokeColor: '#0000FF',\n                  strokeOpacity: 0.5,\n                  strokeWeight: 1,\n                  fillColor: '#0000FF',\n                  fillOpacity: 0.08}\"></l-circle>\n              <l-marker v-if=\"pickLocationMode && pickLocation\" :lat-lng=\"[ pickLocation.lat, pickLocation.lng ]\"\n                :draggable=\"true\" @dragend=\"dragEnd\"><l-tooltip><div class=\"black--text\">Drag to adjust</div></l-tooltip></l-marker>\n            </l-map>\n          </div>\n        </v-card>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n\n<script>\nimport swh from '@/assets/sw_helpers.js'\nimport { LMap, LTileLayer, LMarker, LCircle, LTooltip, LControlZoom } from 'vue2-leaflet'\nimport { L } from 'leaflet-control-geocoder/dist/Control.Geocoder.js'\n\nexport default {\n  data: function () {\n    return {\n      mode: 'pick',\n      pickLocation: undefined,\n      selectedKnownLocation: undefined,\n      mapCenter: [43.6, 1.4333],\n      url: process.env.NODE_ENV === 'production' ? '/tiles/{z}/{x}/{y}.png' : 'http://localhost:8080/tiles/{z}/{x}/{y}.png',\n      fallbackUrl: '/tiles/{z}/{x}/{y}.png',\n      serverUrl: 'http://localhost:8080/tiles/{z}/{x}/{y}.png',\n      onlineUrl: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'\n    }\n  },\n  props: ['showMyLocation', 'knownLocations', 'startLocation', 'realLocation'],\n  computed: {\n    doShowMyLocation: function () {\n      return this.showMyLocation === undefined ? false : this.showMyLocation\n    },\n    pickLocationMode: function () {\n      return this.mode === 'pick'\n    },\n    knownLocationMode: function () {\n      return this.mode === 'known'\n    },\n    locationForDetail: function () {\n      if (this.pickLocationMode && this.pickLocation === undefined) {\n        return this.startLocation\n      }\n      return this.pickLocationMode ? this.pickLocation : this.selectedKnownLocation\n    }\n  },\n  watch: {\n    startLocation: function () {\n      this.setPickLocation(this.startLocation)\n    }\n  },\n  mounted: function () {\n    const that = this\n    this.setPickLocation(this.startLocation)\n    \n    // 检测瓦片服务器可用性\n    this.checkTileAvailability()\n    \n    this.$nextTick(() => {\n      const map = this.$refs.myMap.mapObject\n      map._onResize()\n\n      // 添加离线搜索控件\n      this.addOfflineSearchControl(map)\n    })\n  },\n  methods: {\n    selectKnownLocation: function (loc) {\n      this.selectedKnownLocation = loc\n      this.setKnownLocationMode()\n      this.mapCenter = [loc.lat, loc.lng]\n    },\n    useLocation: function () {\n      this.$emit('locationSelected', this.locationForDetail)\n      this.$emit('resetLocation', this.locationForDetail.lat, this.locationForDetail.lng)\n    },\n    setPickLocationMode: function () {\n      this.mode = 'pick'\n    },\n    setKnownLocationMode: function () {\n      this.mode = 'known'\n    },\n    setPickLocation: function (loc) {\n      if (loc.accuracy < 100) {\n        for (const l of this.knownLocations) {\n          const d = swh.getDistanceFromLatLonInM(l.lat, l.lng, loc.lat, loc.lng)\n          if (d < 100) {\n            this.selectKnownLocation(l)\n            return\n          }\n        }\n      }\n      var pos = { lat: loc.lat, lng: loc.lng }\n      this.mapCenter = [pos.lat, pos.lng]\n      this.pickLocation = loc\n      this.setPickLocationMode()\n    },\n    // Called when the user clicks on the small cross button\n    centerOnRealPosition: function () {\n      this.setPickLocation(this.realLocation)\n    },\n    dragEnd: function (event) {\n      var that = this\n      var pos = { lat: event.target._latlng.lat, lng: event.target._latlng.lng, accuracy: 0 }\n      console.log('dragEnd pos: ' + pos.lat + ',' +pos.lng)\n      swh.geoCodePosition(pos, that).then((p) => { that.pickLocation = p; that.setPickLocationMode() })\n      this.$emit('resetLocation', pos.lat, pos.lng)\n    },\n    checkTileAvailability: function () {\n      const that = this\n      \n      // 在生产环境下优先使用静态瓦片\n      if (process.env.NODE_ENV === 'production') {\n        that.testStaticTiles().then(isAvailable => {\n          if (isAvailable) {\n            console.log('使用静态瓦片文件')\n            that.url = that.fallbackUrl\n          } else {\n            console.log('静态瓦片不可用，尝试tile服务器')\n            that.testTileServer()\n          }\n        })\n      } else {\n        // 开发环境下优先尝试tile服务器\n        that.testTileServer()\n      }\n    },\n    \n    testStaticTiles: function () {\n      const that = this\n      return new Promise((resolve) => {\n        // 测试多个缩放级别的瓦片是否存在\n        const testUrls = [\n          '/tiles/0/0/0.png',\n          '/tiles/1/0/0.png',\n          '/tiles/2/1/1.png'\n        ]\n        \n        let testCount = 0\n        let successCount = 0\n        \n        testUrls.forEach(url => {\n          fetch(url, { method: 'HEAD' })\n            .then(response => {\n              testCount++\n              if (response.ok) {\n                successCount++\n              }\n              \n              if (testCount === testUrls.length) {\n                // 如果至少一半的测试瓦片可用，认为静态瓦片可用\n                resolve(successCount >= testUrls.length / 2)\n              }\n            })\n            .catch(() => {\n              testCount++\n              if (testCount === testUrls.length) {\n                resolve(successCount >= testUrls.length / 2)\n              }\n            })\n        })\n        \n        // 超时处理\n        setTimeout(() => {\n          if (testCount < testUrls.length) {\n            resolve(false)\n          }\n        }, 2000)\n      })\n    },\n    \n    testTileServer: function () {\n      const that = this\n      \n      // 测试tile服务器是否可用\n      const testUrl = this.serverUrl.replace('{z}', '0').replace('{x}', '0').replace('{y}', '0')\n      \n      fetch(testUrl, { method: 'HEAD', timeout: 3000 })\n        .then(response => {\n          if (response.ok) {\n            console.log('tile服务器可用')\n            that.url = that.serverUrl\n          } else {\n            throw new Error('tile服务器响应错误')\n          }\n        })\n        .catch(error => {\n          console.log('tile服务器不可用，使用静态瓦片:', error)\n          that.url = that.fallbackUrl\n          \n          // 如果静态瓦片也不可用，最后尝试在线瓦片\n          that.testStaticTiles().then(isAvailable => {\n            if (!isAvailable && process.env.NODE_ENV === 'development') {\n              console.log('切换到在线瓦片服务')\n              that.url = that.onlineUrl\n            }\n          })\n        })\n    },\n    addOfflineSearchControl: function (map) {\n      const that = this\n      \n      // 创建离线搜索控件\n      const searchControl = L.Control.extend({\n        options: {\n          position: 'topleft'\n        },\n        onAdd: function(map) {\n          const container = L.DomUtil.create('div', 'leaflet-control-geocoder leaflet-bar')\n          container.innerHTML = `\n            <div class=\"leaflet-control-geocoder-form\">\n              <input type=\"text\" placeholder=\"输入坐标 (lat,lng)\" />\n              <button type=\"button\">搜索</button>\n            </div>\n          `\n          \n          const input = container.querySelector('input')\n          const button = container.querySelector('button')\n          \n          button.onclick = function() {\n            that.handleOfflineSearch(input.value)\n          }\n          \n          input.onkeypress = function(e) {\n            if (e.key === 'Enter') {\n              that.handleOfflineSearch(input.value)\n            }\n          }\n          \n          return container\n        }\n      })\n      \n      new searchControl().addTo(map)\n    },\n    handleOfflineSearch: function (query) {\n      // 解析坐标输入 (支持多种格式)\n      const coordPattern = /(-?\\d+\\.?\\d*)[,\\s]+(-?\\d+\\.?\\d*)/\n      const match = query.match(coordPattern)\n      \n      if (match) {\n        const lat = parseFloat(match[1])\n        const lng = parseFloat(match[2])\n        \n        if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {\n          const pos = { lat: lat, lng: lng, accuracy: 0 }\n          this.mapCenter = [lat, lng]\n          \n          const loc = {\n            short_name: `${lat.toFixed(3)}, ${lng.toFixed(3)}`,\n            country: this.$t('Unknown'),\n            lng: lng,\n            lat: lat,\n            alt: 0,\n            accuracy: 0,\n            street_address: ''\n          }\n          \n          this.pickLocation = loc\n          this.setPickLocationMode()\n        } else {\n          alert('坐标范围错误：纬度(-90到90)，经度(-180到180)')\n        }\n      } else {\n        alert('请输入有效的坐标格式：纬度,经度 (例如: 40.1, 116.2)')\n      }\n    }\n  },\n  components: { LMap, LTileLayer, LMarker, LCircle, LTooltip, LControlZoom }\n}\n</script>\n\n<style>\n.leaflet-control-geocoder-form input {\n  caret-color:#000 !important;\n  color: #000 !important;\n}\n</style>\n"]}]}