{"remainingRequest":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/components/skysource-search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/components/skysource-search.vue","mtime":1739424155000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/thread-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/babel-loader/lib/index.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js","mtime":1707125450000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzd2ggZnJvbSAnQC9hc3NldHMvc3dfaGVscGVycy5qcycKaW1wb3J0IHZDbGlja091dHNpZGUgZnJvbSAndi1jbGljay1vdXRzaWRlJwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnCgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgYXV0b0NvbXBsZXRlQ2hvaWNlczogW10sCiAgICAgIHNlYXJjaFRleHQ6ICcnLAogICAgICBsYXN0UXVlcnk6IHVuZGVmaW5lZCwKICAgICAgRmlyc3RJdGVtOiBudWxsLAogICAgfQogIH0sCiAgcHJvcHM6IFsndmFsdWUnLCAnZmxvYXRpbmdMaXN0J10sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaFRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoVGV4dCA9PT0gJycpIHsKICAgICAgICB0aGlzLmF1dG9Db21wbGV0ZUNob2ljZXMgPSBbXQogICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gdW5kZWZpbmVkCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgdGhpcy5yZWZyZXNoKCkKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBsaXN0U3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZmxvYXRpbmdMaXN0ID8gJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgei1pbmRleDogMTAwMDsgbWFyZ2luLXRvcDogOHB4JyA6ICcnCiAgICB9LAogICAgc2hvd0xpc3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoVGV4dCAhPT0gJycKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRidXMuJG9uKCdTZWFyY2hOYW1lJyx0aGlzLlNlbGVjdGVkT2JqZWN0QnlOYW1lKTsKCiAgICAvLyB0aGlzLiRidXMuJG9uKCdpbnNlcnRPYmpOYW1lJyx0aGlzLlNlbGVjdGVkT2JqZWN0QnlOYW1lKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIFNlbGVjdGVkT2JqZWN0QnlOYW1lKHRleHQpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzCiAgICAgIGxldCBzdHIgPSB0ZXh0CiAgICAgIHN0ciA9IHN0ci50b1VwcGVyQ2FzZSgpCiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9ccysvZywgJycpCiAgICAgIC8vIGNvbnNvbGUubG9nKCdJbnB1dCBzZWFyY2ggcXVlcnk6ICcgKyBzdHIpCiAgICAgIHN3aC5xdWVyeVNreVNvdXJjZXMoc3RyLCAxMCkudGhlbihyZXN1bHRzID0+IHsKICAgICAgICB0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXMgPSByZXN1bHRzCiAgICAgICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCB0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCdMaXN0WycsIGksICddOicsIHRoaXMubmFtZUZvclNreVNvdXJjZSh0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXNbaV0pKQogICAgICAgIC8vIH0KICAgICAgICBjb25zdCBmaXJzdENob2ljZSA9IHRoYXQuYXV0b0NvbXBsZXRlQ2hvaWNlc1swXQogICAgICAgIHRoaXMuRmlyc3RJdGVtID0gZmlyc3RDaG9pY2UKICAgICAgICB0aGlzLmdldEZpcnN0SXRlbVJhRGVjKCkKICAgICAgICB0aGlzLnNvdXJjZUNsaWNrZWQoZmlyc3RDaG9pY2UpIC8vIOinpuWPkeeCueWHu+esrOS4gOS4quWFg+e0oOeahOaWueazlQogICAgICB9LCBlcnIgPT4geyBjb25zb2xlLmxvZyhlcnIpIH0pCiAgICB9LAogICAgZ2V0Rmlyc3RJdGVtUmFEZWMoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdGaXJzdEl0ZW1bJywgdGhpcy5yYWRlY0ZvclNreVNvdXJjZSh0aGlzLkZpcnN0SXRlbSksICddJykKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdUYXJnZXRSYURlYycsdGhpcy5yYWRlY0ZvclNreVNvdXJjZSh0aGlzLkZpcnN0SXRlbSkpCiAgICAgIHRoaXMuRmlyc3RJdGVtID0gbnVsbAogICAgfSwKICAgIHNvdXJjZUNsaWNrZWQ6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWwpCiAgICAgIHRoaXMucmVzZXRTZWFyY2goKQogICAgfSwKICAgIHJlc2V0U2VhcmNoOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2VhcmNoVGV4dCA9ICcnCiAgICB9LAogICAgcmVmcmVzaDogXy5kZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0aGF0ID0gdGhpcwogICAgICBsZXQgc3RyID0gdGhhdC5zZWFyY2hUZXh0CiAgICAgIHN0ciA9IHN0ci50b1VwcGVyQ2FzZSgpCiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9ccysvZywgJycpCiAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWFyY2hUZXh0OiAnICsgdGhhdC5zZWFyY2hUZXh0KQogICAgICAvLyBjb25zb2xlLmxvZygnSW5wdXQgc2VhcmNoIHF1ZXJ5OiAnICsgc3RyKQogICAgICBpZiAodGhpcy5sYXN0UXVlcnkgPT09IHN0cikgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gc3RyCiAgICAgIHN3aC5xdWVyeVNreVNvdXJjZXMoc3RyLCAxMCkudGhlbihyZXN1bHRzID0+IHsKICAgICAgICBpZiAoc3RyICE9PSB0aGF0Lmxhc3RRdWVyeSkgewogICAgICAgICAgY29uc29sZS5sb2coJ0NhbmNlbGxlZCBxdWVyeTogJyArIHN0cikKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICB0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXMgPSByZXN1bHRzCiAgICAgICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCB0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCdMaXN0WycsIGksICddOicsIHRoaXMubmFtZUZvclNreVNvdXJjZSh0aGF0LmF1dG9Db21wbGV0ZUNob2ljZXNbaV0pKQogICAgICAgIC8vIH0KICAgICAgfSwgZXJyID0+IHsgY29uc29sZS5sb2coZXJyKSB9KQogICAgfSwgMjAwKSwKICAgIG5hbWVGb3JTa3lTb3VyY2U6IGZ1bmN0aW9uIChzKSB7CiAgICAgIGNvbnN0IGNuID0gc3doLmNsZWFudXBPbmVTa3lTb3VyY2VOYW1lKHMubWF0Y2gpCiAgICAgIGNvbnN0IG4gPSBzd2gubmFtZUZvclNreVNvdXJjZShzKQogICAgICBpZiAoY24gPT09IG4pIHsKICAgICAgICByZXR1cm4gbgogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjbiArICcgKCcgKyBuICsgJyknCiAgICAgIH0KICAgIH0sCiAgICByYWRlY0ZvclNreVNvdXJjZTogZnVuY3Rpb24gKHMpIHsKICAgICAgbGV0IHsgcmEsIGRlYyB9ID0gc3doLnJhZGVjRm9yU2t5U291cmNlKHMpCiAgICAgIHJldHVybiAnUmE6JyArIHJhICsgJywnICsgJ0RlYzonICsgZGVjCiAgICB9LAogICAgdHlwZVRvTmFtZTogZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHN3aC5uYW1lRm9yU2t5U291cmNlVHlwZSh0KQogICAgfSwKICAgIGljb25Gb3JTa3lTb3VyY2U6IGZ1bmN0aW9uIChzKSB7CiAgICAgIHJldHVybiBzd2guaWNvbkZvclNreVNvdXJjZShzKQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gKCkgewogICAgdmFyIHRoYXQgPSB0aGlzCiAgICBjb25zdCBvbkNsaWNrID0gZSA9PiB7CiAgICAgIGlmICh0aGF0LnNlYXJjaFRleHQgIT09ICcnKSB7CiAgICAgICAgdGhhdC5zZWFyY2hUZXh0ID0gJycKICAgICAgfQogICAgfQogICAgY29uc3QgZ3VpUGFyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3RlbCcpIHx8IGRvY3VtZW50LmJvZHkKICAgIGd1aVBhcmVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xpY2ssIGZhbHNlKQogIH0sCiAgZGlyZWN0aXZlczogewogICAgY2xpY2tPdXRzaWRlOiB2Q2xpY2tPdXRzaWRlLmRpcmVjdGl2ZQogIH0KfQo="},{"version":3,"sources":["skysource-search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"skysource-search.vue","sourceRoot":"src/components","sourcesContent":["// Stellarium Web - Copyright (c) 2022 - Stellarium Labs SRL\n//\n// This program is licensed under the terms of the GNU AGPL v3, or\n// alternatively under a commercial licence.\n//\n// The terms of the AGPL v3 license can be found in the main directory of this\n// repository.\n\n<template>\n  <div style=\"position: relative;\" v-click-outside=\"resetSearch\">\n    <v-text-field ref=\"searchField\" prepend-icon=\"mdi-magnify\" :label=\"$t('Search...')\" v-model=\"searchText\" @keyup.native.esc=\"resetSearch()\" hide-details single-line></v-text-field>\n    <v-list dense v-if=\"showList\" two-line :style=\"listStyle\">\n      <v-list-item v-for=\"source in autoCompleteChoices\" :key=\"source.names[0]\" @click=\"sourceClicked(source)\">\n        <v-list-item-action>\n          <img :src=\"iconForSkySource(source)\"/>\n        </v-list-item-action>\n        <v-list-item-content>\n          <v-list-item-title>{{ nameForSkySource(source) }}</v-list-item-title>\n          <v-list-item-subtitle>{{ typeToName(source.types[0]) }}</v-list-item-subtitle>\n          <v-list-item-subtitle>{{ radecForSkySource(source) }}</v-list-item-subtitle>\n        </v-list-item-content>\n      </v-list-item>\n    </v-list>\n  </div>\n</template>\n\n<script>\nimport swh from '@/assets/sw_helpers.js'\nimport vClickOutside from 'v-click-outside'\nimport _ from 'lodash'\n\nexport default {\n  data: function () {\n    return {\n      autoCompleteChoices: [],\n      searchText: '',\n      lastQuery: undefined,\n      FirstItem: null,\n    }\n  },\n  props: ['value', 'floatingList'],\n  watch: {\n    searchText: function () {\n      if (this.searchText === '') {\n        this.autoCompleteChoices = []\n        this.lastQuery = undefined\n        return\n      }\n      this.refresh()\n    }\n  },\n  computed: {\n    listStyle: function () {\n      return this.floatingList ? 'position: absolute; z-index: 1000; margin-top: 8px' : ''\n    },\n    showList: function () {\n      return this.searchText !== ''\n    }\n  },\n  created() {\n    this.$bus.$on('SearchName',this.SelectedObjectByName);\n\n    // this.$bus.$on('insertObjName',this.SelectedObjectByName);\n  },\n  methods: {\n    SelectedObjectByName(text) {\n      var that = this\n      let str = text\n      str = str.toUpperCase()\n      str = str.replace(/\\s+/g, '')\n      // console.log('Input search query: ' + str)\n      swh.querySkySources(str, 10).then(results => {\n        that.autoCompleteChoices = results\n        // for (let i = 0; i < that.autoCompleteChoices.length; i++) {\n        //   console.log('List[', i, ']:', this.nameForSkySource(that.autoCompleteChoices[i]))\n        // }\n        const firstChoice = that.autoCompleteChoices[0]\n        this.FirstItem = firstChoice\n        this.getFirstItemRaDec()\n        this.sourceClicked(firstChoice) // 触发点击第一个元素的方法\n      }, err => { console.log(err) })\n    },\n    getFirstItemRaDec() {\n      console.log('FirstItem[', this.radecForSkySource(this.FirstItem), ']')\n      this.$bus.$emit('TargetRaDec',this.radecForSkySource(this.FirstItem))\n      this.FirstItem = null\n    },\n    sourceClicked: function (val) {\n      this.$emit('input', val)\n      this.resetSearch()\n    },\n    resetSearch: function () {\n      this.searchText = ''\n    },\n    refresh: _.debounce(function () {\n      var that = this\n      let str = that.searchText\n      str = str.toUpperCase()\n      str = str.replace(/\\s+/g, '')\n      // console.log('searchText: ' + that.searchText)\n      // console.log('Input search query: ' + str)\n      if (this.lastQuery === str) {\n        return\n      }\n      this.lastQuery = str\n      swh.querySkySources(str, 10).then(results => {\n        if (str !== that.lastQuery) {\n          console.log('Cancelled query: ' + str)\n          return\n        }\n        that.autoCompleteChoices = results\n        // for (let i = 0; i < that.autoCompleteChoices.length; i++) {\n        //   console.log('List[', i, ']:', this.nameForSkySource(that.autoCompleteChoices[i]))\n        // }\n      }, err => { console.log(err) })\n    }, 200),\n    nameForSkySource: function (s) {\n      const cn = swh.cleanupOneSkySourceName(s.match)\n      const n = swh.nameForSkySource(s)\n      if (cn === n) {\n        return n\n      } else {\n        return cn + ' (' + n + ')'\n      }\n    },\n    radecForSkySource: function (s) {\n      let { ra, dec } = swh.radecForSkySource(s)\n      return 'Ra:' + ra + ',' + 'Dec:' + dec\n    },\n    typeToName: function (t) {\n      return swh.nameForSkySourceType(t)\n    },\n    iconForSkySource: function (s) {\n      return swh.iconForSkySource(s)\n    }\n  },\n  mounted: function () {\n    var that = this\n    const onClick = e => {\n      if (that.searchText !== '') {\n        that.searchText = ''\n      }\n    }\n    const guiParent = document.querySelector('stel') || document.body\n    guiParent.addEventListener('click', onClick, false)\n  },\n  directives: {\n    clickOutside: vClickOutside.directive\n  }\n}\n</script>\n\n<style>\n\n</style>\n"]}]}