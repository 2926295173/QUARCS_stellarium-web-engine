{"remainingRequest":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/src/App.vue","mtime":1749191979333},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/thread-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/babel-loader/lib/index.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1707125360000},{"path":"/home/quarcs/workspace/QUARCS/QUARCS_stellarium-web-engine/apps/web-frontend/node_modules/vue-loader/lib/index.js","mtime":1707125450000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ2xvZGFzaCcKaW1wb3J0IEd1aSBmcm9tICdAL2NvbXBvbmVudHMvZ3VpLnZ1ZScKaW1wb3J0IEd1aUxvYWRlciBmcm9tICdAL2NvbXBvbmVudHMvZ3VpLWxvYWRlci52dWUnCmltcG9ydCBzd2ggZnJvbSAnQC9hc3NldHMvc3dfaGVscGVycy5qcycKaW1wb3J0IE1vbWVudCBmcm9tICdtb21lbnQnCmltcG9ydCBCYWNrZ3JvdW5kSW1hZ2UgZnJvbSAnQC9hc3NldHMvaW1hZ2VzL3N2Zy91aS9CYWNrZ3JvdW5kLnN2Zyc7CmltcG9ydCBFcnJvckltYWdlIGZyb20gJ0AvYXNzZXRzL2ltYWdlcy9zdmcvdWkvZXJyb3JJbWFnZS5zdmcnOwoKbGV0IGdsVGVzdENpcmNsZTsKbGV0IGdsTGF5ZXI7CmxldCBnbFN0ZWw7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YShjb250ZXh0KSB7CiAgICByZXR1cm4gewogICAgICBtZW51SXRlbXM6IFsKICAgICAgICB7IHRpdGxlOiB0aGlzLiR0KCdWaWV3IFNldHRpbmdzJyksIGljb246ICdtZGktc2V0dGluZ3MnLCBzdG9yZV92YXJfbmFtZTogJ3Nob3dWaWV3U2V0dGluZ3NEaWFsb2cnLCBzdG9yZV9zaG93X21lbnVfaXRlbTogJ3Nob3dWaWV3U2V0dGluZ3NNZW51SXRlbScgfSwKICAgICAgICB7IHRpdGxlOiB0aGlzLiR0KCdQbGFuZXRzIFRvbmlnaHQnKSwgaWNvbjogJ21kaS1wYW5vcmFtYS1maXNoZXllJywgc3RvcmVfdmFyX25hbWU6ICdzaG93UGxhbmV0c1Zpc2liaWxpdHlEaWFsb2cnLCBzdG9yZV9zaG93X21lbnVfaXRlbTogJ3Nob3dQbGFuZXRzVmlzaWJpbGl0eU1lbnVJdGVtJyB9LAogICAgICAgIHsgZGl2aWRlcjogdHJ1ZSB9CiAgICAgIF0uY29uY2F0KHRoaXMuZ2V0UGx1Z2luc01lbnVJdGVtcygpKS5jb25jYXQoWwogICAgICAgIHsgdGl0bGU6IHRoaXMuJHQoJ0RhdGEgQ3JlZGl0cycpLCBmb290ZXI6IHRydWUsIGljb246ICdtZGktY29weXJpZ2h0Jywgc3RvcmVfdmFyX25hbWU6ICdzaG93RGF0YUNyZWRpdHNEaWFsb2cnIH0KICAgICAgXSksCiAgICAgIG1lbnVDb21wb25lbnRzOiBbXS5jb25jYXQodGhpcy5nZXRQbHVnaW5zTWVudUNvbXBvbmVudHMoKSksCiAgICAgIGd1aUNvbXBvbmVudDogJ0d1aUxvYWRlcicsCiAgICAgIHN0YXJ0VGltZUlzU2V0OiBmYWxzZSwKICAgICAgaW5pdERvbmU6IGZhbHNlLAogICAgICBkYXRhU291cmNlSW5pdERvbmU6IGZhbHNlLAogICAgICBpbWFnZVNyYzogJ2h0dHBzOi8vaS5pbWd1ci5jb20vZWdBNUZJdi5qcGVnJywgLy8g5pu/5o2i5Li65L2g55qE5Zu+5YOP6Lev5b6ECiAgICAgIGN2UmVhZHk6IGZhbHNlLAogICAgICBjYW52YXNaSW5kZXhTdGVsOiAtMTAsCiAgICAgIGNhbnZhc1pJbmRleE1haW5DYW1lcmE6IC0xMSwKICAgICAgY2FudmFzWkluZGV4R3VpZGVyQ2FtZXJhOiAtMTIsCiAgICAgIGN1cnJlbnRjYW52YXM6ICdTdGVsJywKCiAgICAgIFdlYlNvY2tldFVybDogJycsCgogICAgICB3ZWJzb2NrZXQ6IG51bGwsCiAgICAgIG1lc3NhZ2U6ICcnLAogICAgICByZWNlaXZlZE1lc3NhZ2VzOiBbXSwvLyDlrZjlgqjmjqXmlLbliLDnmoTmtojmga8KICAgICAgc2VudE1lc3NhZ2VzOiBbXSwgLy8g5a2Y5YKo5bey5Y+R6YCB55qE5raI5oGvCiAgICAgIG1lc3NhZ2VDb3VudGVyOiAwLCAvLyDnlKjkuo7nlJ/miJDllK/kuIDnmoTmtojmga9JRAogICAgICB3ZWJzb2NrZXRTdGF0ZTogJ2Rpc2Nvbm5lY3RlZCcsIC8vIOa3u+WKoFdlYlNvY2tldOi/nuaOpeeKtuaAgQogICAgICBuZXR3b3JrRGlzY29ubmVjdGVkOiBmYWxzZSwgLy8g5re75Yqg572R57uc6L+e5o6l54q25oCBCgogICAgICBRVENsaWVudFZlcnNpb246ICdOb3QgY29ubmVjdGVkJywKICAgICAgVnVlQ2xpZW50VmVyc2lvbjogcHJvY2Vzcy5lbnYuVlVFX0FQUF9WRVJTSU9OLAoKICAgICAgLy8gaXNNZXNzYWdlQm94U2hvdzogZmFsc2UsCgogICAgICBDdXJyZW50RHJpdmVyVHlwZTogJycsCiAgICAgIERldmljZUlzQ29ubmVjdGVkOiBudWxsLAogICAgICBjb25maXJtRHJpdmVyVHlwZTogJycsCgogICAgICBNYWluQ2FtZXJhT2Zmc2V0TWluOiAwLAogICAgICBNYWluQ2FtZXJhT2Zmc2V0TWF4OiAwLAoKICAgICAgTWFpbkNhbWVyYUdhaW5NaW46IDAsCiAgICAgIE1haW5DYW1lcmFHYWluTWF4OiAwLAoKICAgICAgZGV2aWNlczogWwogICAgICAgIHsgbmFtZTogJ+WvvOaYn+mVnCcsIGRyaXZlclR5cGU6ICdHdWlkZXInLCB0eXBlOiAnQ0NEcycsIExpc3ROdW06ICIxIiwgaXNnZXQ6IGZhbHNlLCBkZXZpY2U6ICcnLCBCYXVkUmF0ZTogOTYwMCwgZHJpdmVyTmFtZTogJycsIGlzQ29ubmVjdGVkOiBmYWxzZSwgZGlhbG9nU3RhdGVWYXI6ICdzaG93RGV2aWNlU2V0dGluZ3NEaWFsb2dfR3VpZGVyJyB9LAogICAgICAgIHsgbmFtZTogJ+S4u+ebuOacuicsIGRyaXZlclR5cGU6ICdNYWluQ2FtZXJhJywgdHlwZTogJ0NDRHMnLCBMaXN0TnVtOiAiMjAiLCBpc2dldDogZmFsc2UsIGRldmljZTogJycsIEJhdWRSYXRlOiA5NjAwLCBkcml2ZXJOYW1lOiAnJywgaXNDb25uZWN0ZWQ6IGZhbHNlLCBkaWFsb2dTdGF0ZVZhcjogJ3Nob3dEZXZpY2VTZXR0aW5nc0RpYWxvZ19NYWluQ2FtZXJhJyB9LAogICAgICAgIHsgbmFtZTogJ+i1pOmBk+S7qicsIGRyaXZlclR5cGU6ICdNb3VudCcsIHR5cGU6ICdUZWxlc2NvcGVzJywgTGlzdE51bTogIjAiLCBpc2dldDogZmFsc2UsIGRldmljZTogJycsIEJhdWRSYXRlOiA5NjAwLCBkcml2ZXJOYW1lOiAnJywgaXNDb25uZWN0ZWQ6IGZhbHNlLCBkaWFsb2dTdGF0ZVZhcjogJ3Nob3dEZXZpY2VTZXR0aW5nc0RpYWxvZ19Nb3VudCcgfSwKICAgICAgICB7IG5hbWU6ICfmnJvov5zplZwnLCBkcml2ZXJUeXBlOiAnVGVsZXNjb3BlcycsIGRldmljZTogJycsIGlzQ29ubmVjdGVkOiBmYWxzZSB9LAogICAgICAgIHsgbmFtZTogJ+eUteWKqOiwg+eEpuWZqCcsIGRyaXZlclR5cGU6ICdGb2N1c2VyJywgdHlwZTogJ0ZvY3VzZXJzJywgTGlzdE51bTogIjIyIiwgaXNnZXQ6IGZhbHNlLCBkZXZpY2U6ICcnLCBCYXVkUmF0ZTogOTYwMCwgZHJpdmVyTmFtZTogJycsIGlzQ29ubmVjdGVkOiBmYWxzZSwgZGlhbG9nU3RhdGVWYXI6ICdzaG93RGV2aWNlU2V0dGluZ3NEaWFsb2dfRm9jdXNlcicgfSwKICAgICAgICB7IG5hbWU6ICfnlLXlrZDmnoHovbTplZwnLCBkcml2ZXJUeXBlOiAnUG9sZUNhbWVyYScsIHR5cGU6ICdDQ0RzJywgTGlzdE51bTogIjIiLCBpc2dldDogZmFsc2UsIGRldmljZTogJycsIEJhdWRSYXRlOiA5NjAwLCBkcml2ZXJOYW1lOiAnJywgaXNDb25uZWN0ZWQ6IGZhbHNlLCBkaWFsb2dTdGF0ZVZhcjogJ3Nob3dEZXZpY2VTZXR0aW5nc0RpYWxvZ19Qb2xlQ2FtZXJhJyB9LAogICAgICAgIHsgbmFtZTogJ+a7pOmVnOi9ricsIGRyaXZlclR5cGU6ICdDRlcnLCB0eXBlOiAnRmlsdGVyIFdoZWVscycsIExpc3ROdW06ICIyMSIsIGlzZ2V0OiBmYWxzZSwgZGV2aWNlOiAnJywgQmF1ZFJhdGU6IDk2MDAsIGRyaXZlck5hbWU6ICcnLCBpc0Nvbm5lY3RlZDogZmFsc2UsIGRpYWxvZ1N0YXRlVmFyOiAnc2hvd0RldmljZVNldHRpbmdzRGlhbG9nX0NGVycgfSwKICAgICAgXSwKCiAgICAgIC8vIENoYW5naW5nIHRoZSBsYWJlbCBuYW1lIGFsc28gcmVxdWlyZXMgY2hhbmdpbmcgdGhlIGVtaXQgc2lnbmFsIG5hbWUKICAgICAgR3VpZGVyQ29uZmlnSXRlbXM6IFsKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ0d1aWRlciBGb2NhbCBMZW5ndGggKG1tKScsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAndGV4dCcgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ011bHRpIFN0YXIgR3VpZGVyJywgdmFsdWU6IGZhbHNlLCBpbnB1dFR5cGU6ICdzd2l0Y2gnIH0sCiAgICAgICAgLy8geyBkcml2ZXJUeXBlOiAnR3VpZGVyJywgbGFiZWw6ICdHdWlkZXIgUGl4ZWwgc2l6ZScsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAndGV4dCd9LAogICAgICAgIHsgZHJpdmVyVHlwZTogJ0d1aWRlcicsIGxhYmVsOiAnR3VpZGVyIEdhaW4nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMTAwLCBpbnB1dFN0ZXA6IDEgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ0NhbGlicmF0aW9uIHN0ZXAgKG1zKScsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAndGV4dCcgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ1JhIEFnZ3Jlc3Npb24nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMTAwLCBpbnB1dFN0ZXA6IDEgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdHdWlkZXInLCBsYWJlbDogJ0RlYyBBZ2dyZXNzaW9uJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICdzbGlkZXInLCBpbnB1dE1pbjogMCwgaW5wdXRNYXg6IDEwMCwgaW5wdXRTdGVwOiAxIH0sCgogICAgICBdLAoKICAgICAgTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zOiBbCiAgICAgICAgLy8gdnVl5aSE55CG5Y+C5pWwCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnSW1hZ2VHYWluUicsIHZhbHVlOiAnMScsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMywgaW5wdXRTdGVwOiAwLjAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnSW1hZ2VHYWluQicsIHZhbHVlOiAnMScsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMywgaW5wdXRTdGVwOiAwLjAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnSW1hZ2VPZmZzZXQnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMjU1LCBpbnB1dFN0ZXA6IDAuMX0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnSW1hZ2VDRkEnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NlbGVjdCcsIHNlbGVjdFZhbHVlOiBbJ0dSJywgJ0dCJywgJ0JHJywgJ1JHR0InXSB9LAogICAgICAgIC8vIOehrOS7tuWkhOeQhuWPguaVsAogICAgICAgIHsgZHJpdmVyVHlwZTogJ01haW5DYW1lcmEnLCBsYWJlbDogJ0Jpbm5pbmcnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAxLCBpbnB1dE1heDogNCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnVGVtcGVyYXR1cmUnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAtNTAsIGlucHV0TWF4OiAzMCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnR2FpbicsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAnc2xpZGVyJywgaW5wdXRNaW46IDAsIGlucHV0TWF4OiAwLCBpbnB1dFN0ZXA6IDEgfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdNYWluQ2FtZXJhJywgbGFiZWw6ICdPZmZzZXQnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3NsaWRlcicsIGlucHV0TWluOiAwLCBpbnB1dE1heDogMCwgaW5wdXRTdGVwOiAxIH0sCiAgICAgICAgLy8geyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnUmVkQm94IFNpZGUgTGVuZ3RoIChweCknLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbMV0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbMl0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbM10nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbNF0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbNV0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbNl0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbN10nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbOF0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnTWFpbkNhbWVyYScsIGxhYmVsOiAnRXhwVGltZSBbOV0nLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCiAgICAgICAgLy8g5Zyo6L+Z6YeM5re75Yqg5pu05aSa55qE6YWN572u6aG5CiAgICAgIF0sCgogICAgICBNb3VudENvbmZpZ0l0ZW1zOiBbCgogICAgICBdLAoKICAgICAgVGVsZXNjb3Blc0NvbmZpZ0l0ZW1zOiBbCiAgICAgICAgeyBkcml2ZXJUeXBlOiAnVGVsZXNjb3BlcycsIG51bTogMSwgbGFiZWw6ICdGb2NhbCBMZW5ndGggKG1tKScsIHZhbHVlOiAnJywgaW5wdXRUeXBlOiAndGV4dCcgfSwKICAgICAgXSwKCiAgICAgIEZvY3VzZXJDb25maWdJdGVtczogWwogICAgICAgIC8vIHsgZHJpdmVyVHlwZTogJ0ZvY3VzZXInLCBudW06IDEsIGxhYmVsOiAnUmVkQm94IFNpZGUgTGVuZ3RoIChweCknLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnfSwKICAgICAgICB7IGRyaXZlclR5cGU6ICdGb2N1c2VyJywgbnVtOiAyLCBsYWJlbDogJ01pbiBTdGVwJywgdmFsdWU6ICcnLCBpbnB1dFR5cGU6ICd0ZXh0JyB9LAogICAgICAgIHsgZHJpdmVyVHlwZTogJ0ZvY3VzZXInLCBudW06IDIsIGxhYmVsOiAnU3luYyBGb2N1c2VyIFN0ZXAnLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0sCgogICAgICBdLAoKICAgICAgUG9sZUNhbWVyYUNvbmZpZ0l0ZW1zOiBbCgogICAgICBdLAoKICAgICAgQ0ZXQ29uZmlnSXRlbXM6IFsKCiAgICAgIF0sCgogICAgICBCZWZvcmVDaGFuZ2VDb25maWdJdGVtczogW10sCgoKCiAgICAgIGltYWdlRGF0YTogbnVsbCwKCiAgICAgIGhpc3RvZ3JhbUltYWdlOiBudWxsLAogICAgICBoaXN0b2dyYW1fbWluOiAwLCAgICAvLyDnm7Tmlrnlm77oh6rliqjmi4nkvLjnmoTmnIDlsI/lgLwKICAgICAgaGlzdG9ncmFtX21heDogMjU1LCAgLy8g55u05pa55Zu+6Ieq5Yqo5ouJ5Ly455qE5pyA5aSn5YC8CgogICAgICBjdXJyZW50SGlzdG9ncmFtTWluOiAwLAogICAgICBjdXJyZW50SGlzdG9ncmFtTWF4OiAyNTUsCgogICAgICBJbWFnZUdhaW5SOiAxLAogICAgICBJbWFnZUdhaW5COiAxLAoKICAgICAgSW1hZ2VPZmZzZXQ6IDAsCgogICAgICBJbWFnZUNGQTogJ0JHJywKCiAgICAgIENhbnZhc1dpZHRoOiAxOTIwLCAgLy8g5Li755S75biD5a695bqmCiAgICAgIENhbnZhc0hlaWdodDogMTA4MCwgLy8g5Li755S75biD6auY5bqmCgogICAgICBzY2FsZTogMSwgLy8g57yp5pS+5q+U5L6LCiAgICAgIHRyYW5zbGF0ZVg6IDAsIC8vIOW5s+enu3jlnZDmoIcKICAgICAgdHJhbnNsYXRlWTogMCwgLy8g5bmz56e7eeWdkOaghwogICAgICBidWZmZXJDYW52YXM6IG51bGwsIC8vIOWtmOWCqOeUu+W4gwogICAgICBidWZmZXJDdHg6IG51bGwsIC8vIOWtmOWCqOeUu+W4g+S4iuS4i+aWhwogICAgICB0ZW1wQ2FudmFzOiBudWxsLCAvLyDkuLTml7bnlLvluIMKICAgICAgdGVtcEN0eDogbnVsbCwgLy8g5Li05pe255S75biD5LiK5LiL5paHCgogICAgICB2aXNpYmxlV2lkdGg6IDAsIC8vIOWPr+ingeWMuuWfn+WuveW6pgogICAgICB2aXNpYmxlSGVpZ2h0OiAwLCAvLyDlj6/op4HljLrln5/pq5jluqYKICAgICAgdmlzaWJsZVg6IDAsIC8vIOWPr+ingeWMuuWfn3jlnZDmoIcKICAgICAgdmlzaWJsZVk6IDAsIC8vIOWPr+ingeWMuuWfn3nlnZDmoIcKICAgICAgaXNEcmFnZ2luZzogZmFsc2UsIC8vIOagh+iusOeUu+W4g+aYr+WQpuato+WcqOaLluWKqAogICAgICBwZW5kaW5nU2NhbGVDaGFuZ2U6IGZhbHNlLCAvLyDmoIforrDnlLvluIPmmK/lkKbmraPlnKjnvKnmlL4KCiAgICAgIHRvdWNoU3RhcnRYOiAwLCAvLyDop6bmkbjlvIDlp4t45Z2Q5qCHCiAgICAgIHRvdWNoU3RhcnRZOiAwLCAvLyDop6bmkbjlvIDlp4t55Z2Q5qCHCiAgICAgIHN0YXJ0RGlzdGFuY2U6IDAsIC8vIOinpuaRuOW8gOWni+i3neemuwoKICAgICAgbW92ZUludGVydmFsSWQ6IG51bGwsIC8vIOaLluWKqOWumuaXtuWZqAogICAgICB6b29tSW50ZXJ2YWxJZDogbnVsbCwgLy8g57yp5pS+5a6a5pe25ZmoCgoKICAgICAgaW1hZ2VXaWR0aDogMCwgLy8g5Zu+5YOP5a695bqmCiAgICAgIGltYWdlSGVpZ2h0OiAwLCAvLyDlm77lg4/pq5jluqYKICAgICAgZHJhd0ltZ0RhdGE6IG51bGwsCiAgICAgIE9yaWdpbmFsSW1hZ2U6IG51bGwsCiAgICAgIGRldGVjdFN0YXJzSW1nOiBudWxsLAoKICAgICAgaXNOb3REcmF3U3RhcnM6IHRydWUsCgogICAgICBtYWluQ2FtZXJhU2l6ZVg6IDAsCiAgICAgIG1haW5DYW1lcmFTaXplWTogMCwKCiAgICAgIEltYWdlUHJvcG9ydGlvbjogMCwKCiAgICAgIERldGVjdGVkU3RhcnNMaXN0OiBbXSwKICAgICAgRGV0ZWN0ZWRTdGFyc0ZpbmlzaDogZmFsc2UsCgogICAgICBDYXJ0ZXNpYW5MaXN0OiBbXSwKCiAgICAgIFBvbGFyUG9pbnRfQWx0aXR1ZGU6IDAsCgogICAgICBMYXN0UG9pbnRfQXpBbHQ6IG51bGwsCgogICAgICBNYXJrQ2lyY2xlTnVtOiAwLAoKICAgICAgTGFzdENpcmNsZV9SYURlYzogbnVsbCwKICAgICAgTGFzdENpcmNsZV9BekFsdDogbnVsbCwKCiAgICAgIENpcmNsZXM6IFtdLAoKICAgICAgZHJhd2VyXzI6IG51bGwsICAgIC8vIOiuvue9ruS+p+i+ueagj+eahOaYvuekuuS4jumakOiXjwoKICAgICAgZHJpdmVyczogW10sIC8vIOmpseWKqOmAiemhueaVsOe7hAogICAgICBzZWxlY3RlZERyaXZlcjogbnVsbCwgLy8g6YCJ5Lit55qE6amx5YqoCgogICAgICBkZXZpY2VzTGlzdDogW10sIC8vIOiuvuWkh+mAiemhueaVsOe7hAogICAgICBzZWxlY3RlZERldmljZTogbnVsbCwgLy8g6YCJ5Lit55qE6K6+5aSHCiAgICAgIFRvQmVDb25uZWN0RGV2aWNlOiBbXSwKCiAgICAgIGxvYWRpbmdTZWxlY3REcml2ZXI6IGZhbHNlLAogICAgICBsb2FkaW5nQ29ubmVjdEFsbERldmljZTogZmFsc2UsCgogICAgICBDdXJyZW50TG9jYXRpb25Mbmc6IDAsCiAgICAgIEN1cnJlbnRMb2NhdGlvbkxhdDogMCwKCiAgICAgIGhpc3RvZ3JhbURhdGE6IFtdLAoKICAgICAgSW1hZ2VBcnJheUJ1ZmZlcjogbnVsbCwKCiAgICAgIGlzT3BlbkRldmljZVBhZ2U6IGZhbHNlLCAvLyDorr7nva7orr7lpIfpobXpnaLmmK/lkKbmiZPlvIAKICAgICAgaXNPcGVuUG93ZXJQYWdlOiBmYWxzZSwgLy8g6K6+572u55S15rqQ6aG16Z2i5piv5ZCm5omT5byACgogICAgICBPdXRQdXRQb3dlcl8xX09OOiB0cnVlLAogICAgICBPdXRQdXRQb3dlcl8yX09OOiBmYWxzZSwKCiAgICAgIGlzUG9sYXJBeGlzTW9kZTogZmFsc2UsCgogICAgICBpc1RvdWNoaW5nOiBmYWxzZSwgLy8g5qCH6K6w5piv5ZCm5q2j5Zyo5aSE55CG6Kem5pG45LqL5Lu2CiAgICAgIENvbm5lY3RCdG5QcmVzc1RpbWVyOiBudWxsLAogICAgICBDb25uZWN0QnRubG9uZ1ByZXNzVGhyZXNob2xkOiAxMDAwLAogICAgICBpc0Nvbm5lY3RCdG5Mb25nUHJlc3M6IGZhbHNlLCAvLyDmoIforrDmmK/lkKbkuLrplb/mjIkKICAgICAgQ29ubmVjdEJ0bkNhbkNsaWNrOiB0cnVlLAoKCiAgICAgIGhhdmVEZXZpY2VDb25uZWN0OiBmYWxzZSwKICAgICAgaXNDb25uZWN0aW5nOiBmYWxzZSwgLy8g5re75Yqg6L+e5o6l54q25oCBCgogICAgICBkaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZDogZmFsc2UsCiAgICAgIGRpc2Nvbm5lY3RUaW1lb3V0OiBudWxsLAoKICAgICAgaXNEb3dubG9hZGluZ0ltYWdlOiBmYWxzZSwKICAgICAgaXNEb3dubG9hZGluZ0ltYWdlTmFtZTogJycsCiAgICAgIGlzV2FpdGluZ0xvZ2dlZDogZmFsc2UsIC8vIOa3u+WKoOetieW+heaXpeW/l+agh+W/lwoKICAgICAgc2hvd0Rpc2Nvbm5lY3REaWFsb2c6IGZhbHNlLAogICAgICBjdXJyZW50RGlzY29ubmVjdERyaXZlck5hbWU6ICcnLAoKICAgICAgZW5hYmxlTWFpbkNhbnZhc0NsaWNrOiBmYWxzZSwgLy8g5o6n5Yi255S75biD5piv5ZCm5Y+v5Lul54K55Ye777yM55So5p2l56e75Yqo6LCD54Sm6YCJ5oup5qGG5ZKM6YCJ5pifCgogICAgICBsYXN0SW1hZ2VQcm9jZXNzUGFyYW1zOiB7IC8vIOacgOWQjuWkhOeQhuWbvuWDj+eahOWPguaVsAogICAgICAgIGdhaW5SOiAxLAogICAgICAgIGdhaW5COiAxLAogICAgICAgIG9mZnNldDogMCwKICAgICAgICBDRkE6ICdCRycsCiAgICAgICAgbW9kZTogMSwKICAgICAgICBCOiAwLAogICAgICAgIFc6IDY1NTM1LAogICAgICAgIGN2bW9kZTogMCwKICAgICAgfSwKICAgICAgZm9jdXNlclBpY3R1cmVGaWxlTmFtZTogJycsICAvLyDnhKbot53lm77niYfmlofku7blkI0KICAgICAgaXNQcm9jZXNzaW5nSW1hZ2U6IGZhbHNlLCAgIC8vIOaOp+WItuaYr+WQpuato+WcqOWkhOeQhuWbvuWDjwogICAgICBpc0ZvY3VzTG9vcFNob290aW5nOiBmYWxzZSwgIC8vIOaOp+WItuaYr+WQpui/m+ihjFJPaeW+queOr+aLjeaRhAogICAgICAvLyBmb2N1c2VyUk9JU3RhcnNMaXN0OiBbXSwgIC8vIOeUqOadpeS/neWtmFJPSeWMuuWfn+eahOaYn+eCueWIl+ihqO+8jOWIhuWIq+S/neWtmHgseSxIRlIKICAgICAgc2VsZWN0U3Rhclg6IC0xLAogICAgICBzZWxlY3RTdGFyWTogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFyWDogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFyWTogLTEsCiAgICAgIERyYXdTZWxlY3RTdGFySEZSOiAtMSwKICAgICAgUk9JX3g6IC0xLCAgICAvLyDnlKjmnaXkv53lrZhST0nljLrln5/nmoR45Z2Q5qCHCiAgICAgIFJPSV95OiAtMSwgICAgLy8g55So5p2l5L+d5a2YUk9J5Yy65Z+f55qEeeWdkOaghwogICAgICBST0lfbGVuZ3RoOiAzMDAsIC8vIOeUqOadpeS/neWtmFJPSeWMuuWfn+eahOmVv+W6pgogICAgICBzaG93U2VsZWN0U3RhcjogZmFsc2UsCgogICAgICBpc09uZVRvdWNoOiBmYWxzZSwKICAgICAgY3VycmVudFRvdWNoWDogWzAsIDBdLAogICAgICBjdXJyZW50VG91Y2hZOiBbMCwgMF0sCiAgICAgIHN0YXJ0VG91Y2hYOiBbMCwgMF0sCiAgICAgIHN0YXJ0VG91Y2hZOiBbMCwgMF0sCiAgICAgIHN0YXJ0VG91Y2hEaXN0YW5jZTogMCwKCiAgICAgIC8vIOWumuS5ieazoueJueeOh+mAiemhuQogICAgICBCYXVkUmF0ZUl0ZW1zOiBbCiAgICAgICAgeyBsYWJlbDogJzk2MDAnLCB2YWx1ZTogOTYwMCB9LAogICAgICAgIHsgbGFiZWw6ICcxOTIwMCcsIHZhbHVlOiAxOTIwMCB9LAogICAgICAgIHsgbGFiZWw6ICczODQwMCcsIHZhbHVlOiAzODQwMCB9LAogICAgICAgIHsgbGFiZWw6ICc1NzYwMCcsIHZhbHVlOiA1NzYwMCB9LAogICAgICAgIHsgbGFiZWw6ICcxMTUyMDAnLCB2YWx1ZTogMTE1MjAwIH0sCiAgICAgICAgeyBsYWJlbDogJzIzMDQwMCcsIHZhbHVlOiAyMzA0MDAgfSwKICAgICAgXSwKICAgICAgQmF1ZFJhdGVTZWxlY3RlZDogOTYwMCwgLy8g5rOi54m5546H6YCJ5oupCiAgICAgIGNwdVRlbXA6IG51bGwsICAvLyBDUFXmuKnluqYKICAgICAgY3B1VXNhZ2U6IG51bGwsIC8vIENQVeS9v+eUqOeOhwogICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgR3VpLAogICAgR3VpTG9hZGVyLAogICAgLy8gTWVzc2FnZUJveCwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRidXMuJG9uKCdBcHBTZW5kTWVzc2FnZScsIHRoaXMuc2VuZE1lc3NhZ2UpOwogICAgdGhpcy4kYnVzLiRvbignQXBwVXBkYXRlRGV2aWNlcycsIHRoaXMudXBkYXRlRGV2aWNlcyk7CiAgICB0aGlzLiRidXMuJG9uKCdTd2l0Y2gtTWFpblBhZ2UnLCB0aGlzLmhhbmRsZUJ1dHRvblRlc3RDbGljayk7CiAgICB0aGlzLiRidXMuJG9uKCdBdXRvSGlzdG9ncmFtTnVtJywgdGhpcy5zZXRBdXRvSGlzdG9ncmFtTnVtKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0hhbmRsZUhpc3RvZ3JhbU51bScsIHRoaXMuYXBwbHlIaXN0U3RyZXRjaCk7CiAgICB0aGlzLiRidXMuJG9uKCdJbWFnZUdhaW5SJywgdGhpcy5JbWFnZUdhaW5TZXQpOwogICAgdGhpcy4kYnVzLiRvbignSW1hZ2VHYWluQicsIHRoaXMuSW1hZ2VHYWluU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ09mZnNldCcsIHRoaXMuSW1hZ2VPZmZzZXRTZXQpOwogICAgdGhpcy4kYnVzLiRvbignQmlubmluZycsIHRoaXMuQmlubmluZ1NldCk7CiAgICB0aGlzLiRidXMuJG9uKCdHYWluJywgdGhpcy5HYWluU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ09mZnNldCcsIHRoaXMuT2Zmc2V0U2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0ltYWdlQ0ZBJywgdGhpcy5JbWFnZUNGQVNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdUZW1wZXJhdHVyZScsIHRoaXMuQ2FtZXJhVGVtcGVyYXR1cmVTZXQpOwogICAgdGhpcy4kYnVzLiRvbignRm9jYWwgTGVuZ3RoIChtbSknLCB0aGlzLkZvY2FsTGVuZ3RoU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0d1aWRlciBGb2NhbCBMZW5ndGggKG1tKScsIHRoaXMuR3VpZGVyRm9jYWxMZW5ndGhTZXQpOwogICAgdGhpcy4kYnVzLiRvbignTXVsdGkgU3RhciBHdWlkZXInLCB0aGlzLk11bHRpU3Rhckd1aWRlclNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdHdWlkZXIgUGl4ZWwgc2l6ZScsIHRoaXMuR3VpZGVyUGl4ZWxTaXplU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0d1aWRlciBHYWluJywgdGhpcy5HdWlkZXJHYWluU2V0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ0NhbGlicmF0aW9uIHN0ZXAgKG1zKScsIHRoaXMuQ2FsaWJyYXRpb25EdXJhdGlvblNldCk7CiAgICB0aGlzLiRidXMuJG9uKCdSYSBBZ2dyZXNzaW9uJywgdGhpcy5SYUFnZ3Jlc3Npb25TZXQpOwogICAgdGhpcy4kYnVzLiRvbignRGVjIEFnZ3Jlc3Npb24nLCB0aGlzLkRlY0FnZ3Jlc3Npb25TZXQpOwogICAgdGhpcy4kYnVzLiRvbignU3luYyBGb2N1c2VyIFN0ZXAnLCB0aGlzLlN5bmNGb2N1c2VyU3RlcCk7CiAgICB0aGlzLiRidXMuJG9uKCdJbWFnZVByb3BvcnRpb24nLCB0aGlzLnNldEltYWdlUHJvcG9ydGlvbik7CiAgICB0aGlzLiRidXMuJG9uKCdNb3VudEdvdG8nLCB0aGlzLmxvb2thdGNpcmNsZSk7CiAgICB0aGlzLiRidXMuJG9uKCdTd2l0Y2hJbWFnZVRvU2hvdycsIHRoaXMuU3dpdGNoSW1hZ2VUb1Nob3cpOwogICAgdGhpcy4kYnVzLiRvbignUG9sYXJQb2ludEFsdGl0dWRlJywgdGhpcy5zZXRQb2xhclBvaW50QWx0aXR1ZGUpOwogICAgdGhpcy4kYnVzLiRvbignc2hvd1N0ZWxDYW52YXMnLCB0aGlzLnNob3dTdGVsQ2FudmFzKTsKICAgIHRoaXMuJGJ1cy4kb24oJ1JlY2FsaWJyYXRlUG9sYXJBeGlzJywgdGhpcy5SZWNhbGlicmF0ZVBvbGFyQXhpcyk7CiAgICB0aGlzLiRidXMuJG9uKCdDdXJyZW50RXhwVGltZUxpc3QnLCB0aGlzLkN1cnJlbnRFeHBUaW1lTGlzdCk7CiAgICB0aGlzLiRidXMuJG9uKCdkaXNjb25uZWN0QWxsRGV2aWNlJywgdGhpcy5kaXNjb25uZWN0QWxsRGV2aWNlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ0dldENvbm5lY3RlZERldmljZXMnLCB0aGlzLlJldHVybkNvbm5lY3RlZERldmljZXMpOwogICAgdGhpcy4kYnVzLiRvbignQ3VycmVudENGV0xpc3QnLCB0aGlzLkN1cnJlbnRDRldMaXN0KTsKICAgIHRoaXMuJGJ1cy4kb24oJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucycsIHRoaXMuY2FsY1doaXRlQmFsYW5jZUdhaW5zKTsKICAgIHRoaXMuJGJ1cy4kb24oJ1N3aXRjaE91dFB1dFBvd2VyJywgdGhpcy5Td2l0Y2hPdXRQdXRQb3dlcik7CiAgICB0aGlzLiRidXMuJG9uKCdQb2xhckF4aXNNb2RlJywgdGhpcy5Qb2xhckF4aXNNb2RlKTsKICAgIHRoaXMuJGJ1cy4kb24oJ1NlbmRDb25zb2xlTG9nTXNnJywgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyk7CiAgICAvLyB0aGlzLiRidXMuJG9uKCdEaXNjb25uZWN0RHJpdmVyU3VjY2VzcycsIHRoaXMuZGlzY29ubmVjdERyaXZlcnN1Y2Nlc3MpOwogICAgdGhpcy4kYnVzLiRvbignVW5CaW5kaW5nRGV2aWNlJywgdGhpcy5VbkJpbmRpbmdEZXZpY2UpOwogICAgdGhpcy4kYnVzLiRvbignQ2xvc2VXZWJWaWV3JywgdGhpcy5RdWl0VG9NYWluQXBwKQogICAgdGhpcy4kYnVzLiRvbignUmVkQm94U2l6ZUNoYW5nZScsIHRoaXMuUmVkQm94U2l6ZUNoYW5nZSk7CiAgICB0aGlzLiRidXMuJG9uKCdzZXRGb2N1c2VyU3RhdGUnLCB0aGlzLnNldEZvY3VzZXJTdGF0ZSk7ICAvLyDorr7nva7osIPnhKbnirbmgIHlkozov5vluqYKICAgIHRoaXMuJGJ1cy4kb24oJ3NldFNob3dTZWxlY3RTdGFyJywgdGhpcy5zZXRTaG93U2VsZWN0U3Rhcik7ICAvLyDorr7nva7mmK/lkKbmmL7npLrpgInmi6nmmJ/ngrkKICAgIHRoaXMuJGJ1cy4kb24oJ1NjYWxlQ2hhbmdlJywgdGhpcy5TY2FsZUNoYW5nZSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRMb2NhdGlvbkhvc3ROYW1lKCkgewogICAgICBjb25zdCBob3N0bmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTsKICAgICAgY29uc3QgcHJvdG9jb2wgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJ3dzczonIDogJ3dzOic7CiAgICAgIGNvbnN0IHBvcnQgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJzg2MDEnIDogJzg2MDAnOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdsb2NhdGlvbiBob3N0bmFtZTonICsgaG9zdG5hbWUsICdpbmZvJyk7CiAgICAgIHRoaXMuV2ViU29ja2V0VXJsID0gYCR7cHJvdG9jb2x9Ly8ke2hvc3RuYW1lfToke3BvcnR9YDsKICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldFVybDonLCB0aGlzLldlYlNvY2tldFVybCk7CiAgICB9LAogICAgZ2V0UVRDbGllbnRWZXJzaW9uKCkgewogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRRVENsaWVudFZlcnNpb24nKTsKICAgIH0sCiAgICBjb25uZWN0KCkgewogICAgICAvLyDmm7/mjaLkuLrkvaDnmoQgV2ViU29ja2V0IOacjeWKoeWZqOWcsOWdgAogICAgICAvLyB0aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQoJ3dzOi8vMTkyLjE2OC4yLjMxOjg2MDAnKTsgIC8vIHByb2Nlc3MuZW52LlZVRV9BUFBfV0VCU09DS0VUCiAgICAgIC8vIHRoaXMud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX1dFQlNPQ0tFVCk7CiAgICAgIGNvbnN0IHdzT3B0aW9ucyA9IHsKICAgICAgICByZWplY3RVbmF1dGhvcml6ZWQ6IGZhbHNlICAvLyDnpoHnlKjor4Hkuabpqozor4EKICAgICAgfTsKICAgICAgdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KHRoaXMuV2ViU29ja2V0VXJsLCBbXSwgd3NPcHRpb25zKTsKCiAgICAgIHRoaXMud2Vic29ja2V0Lm9ub3BlbiA9ICgpID0+IHsKICAgICAgICB0aGlzLndlYnNvY2tldFN0YXRlID0gJ2Nvbm5lY3RlZCc7CiAgICAgICAgdGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkID0gZmFsc2U7IC8vIFdlYlNvY2tldOi/nuaOpeaIkOWKn+aXtumHjee9rue9kee7nOi/nuaOpeeKtuaAgQogICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0VHJpZ2dlcmVkKSB7CiAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnV2ViU29ja2V0IGNvbm5lY3RlZCcsICdzdWNjZXNzJyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2hvd05ldFN0YXR1cycsICd0cnVlJyk7CiAgICAgICAgdGhpcy5TdGF0dXNSZWNvdmVyeSgpOwogICAgICAgIGNvbnNvbGUubG9nKCdwcm9jZXNzLmVudi5OT0RFX0VOVjonLCBwcm9jZXNzLmVudi5OT0RFX0VOVik7CiAgICAgIH07CiAgICAgIAogICAgICB0aGlzLndlYnNvY2tldC5vbm1lc3NhZ2UgPSAobWVzc2FnZSkgPT4gewogICAgICAgIC8vIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBSZWNlaXZlZCBtZXNzYWdlOicsIG1lc3NhZ2UuZGF0YSk7CgogICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSk7CgogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdRVF9SZXR1cm4nKSB7CiAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGEubWVzc2FnZS5zcGxpdCgnOicpOwogICAgICAgICAgbGV0IG1lc3NhZ2VUeXBlOwogICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgbWVzc2FnZVR5cGUgPSBwYXJ0c1swXTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1FIWUNDRCB8IOiOt+W+l+S/oeaBrygnK21lc3NhZ2VUeXBlKycpOicsIHBhcnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmtojmga/moLzlvI/plJnor6/vvIzml6Dms5XliIblibI6JywgZGF0YS5tZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbGV0IGFjY2VwdE1lc3NhZ2UgPSBmYWxzZTsKICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2Uuc3RhcnRzV2l0aCgnU3RhZ2luZ1NjaGVkdWxlRGF0YTonKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7CiAgICAgICAgICAgIGFjY2VwdE1lc3NhZ2UgPSB0cnVlOwogICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGEubWVzc2FnZS5zcGxpdCgnWycpOwoKICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGFydHMubGVuZ3RoOiAnLCBwYXJ0cy5sZW5ndGgpOwogICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU3RhZ2luZ1NjaGVkdWxlRGF0YScsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2Uuc3RhcnRzV2l0aCgnU2VuZERlYnVnTWVzc2FnZXwnKSkgewogICAgICAgICAgICBhY2NlcHRNZXNzYWdlID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgcGFydHMgPSBkYXRhLm1lc3NhZ2Uuc3BsaXQoJ3wnKTsKICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZW5kRGVidWdNZXNzYWdlJywgdHlwZSwgbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWFjY2VwdE1lc3NhZ2UpIHsKICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlVHlwZSkgewogICAgICAgICAgICAgIGNhc2UgJ0FkZERyaXZlcic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLkN1cnJlbnREcml2ZXJUeXBlOwogICAgICAgICAgICAgICAgICAvLyDliJvlu7rkuIDkuKrpqbHliqjlr7nosaEKICAgICAgICAgICAgICAgICAgY29uc3QgZHJpdmVyID0geyB0eXBlLCBsYWJlbCwgdmFsdWUgfTsKCiAgICAgICAgICAgICAgICAgIC8vIGlmICh0eXBlID09PSAnTWFpbkNhbWVyYScgJiYgbGFiZWwgPT09ICJRSFkgQ0NEMiIpIHsKICAgICAgICAgICAgICAgICAgLy8gICBicmVhazsKICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAvLyBpZiAodHlwZSA9PT0gJ0d1aWRlcicgJiYgbGFiZWwgPT09ICJRSFkgQ0NEIikgewogICAgICAgICAgICAgICAgICAvLyAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAvLyB9CgogICAgICAgICAgICAgICAgICAvLyDmo4Dmn6VsYWJlbOaYr+WQpuS4uiJRSFkgQ0NEIuaIliJRRm9jdXNlciLvvIzlpoLmnpzmmK/vvIzliJnmj5LlhaXliLDmlbDnu4TpppbkvY0KICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsID09PSAiUUhZIENDRCIgfHwgbGFiZWwgPT09ICJRRm9jdXNlciIgfHwgbGFiZWwgPT09ICJRSFkgQ0NEMiIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaXZlcnMudW5zaGlmdChkcml2ZXIpOyAvLyDlsIbmlrDpqbHliqjmt7vliqDliLDmlbDnu4TnmoTlvIDlp4vkvY3nva4KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaXZlcnMucHVzaChkcml2ZXIpOyAvLyDlsIbmlrDpqbHliqjmt7vliqDliLDmlbDnu4TnmoTmnKvlsL4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0FkZERldmljZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBBZGREZXZpY2U6ICcsIGxhYmVsKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc3QgdmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMuY29uZmlybURyaXZlclR5cGU7CiAgICAgICAgICAgICAgICAgIC8vIOWIm+W7uuS4gOS4qumpseWKqOWvueixoQogICAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2UgPSB7IHR5cGUsIGxhYmVsLCBsYWJlbCB9OwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUUhZQ0NEIHwgQWRkRGV2aWNlOiAnLCBkZXZpY2UpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ2FkZC1kZXZpY2UnLCBkZXZpY2UpOwogICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNMaXN0LnB1c2goZGV2aWNlKTsKCiAgICAgICAgICAgICAgICAgIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UgPSBbXTsKICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VzTGlzdC5mb3JFYWNoKGRldmljZXNMaXN0ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlc0xpc3QudHlwZSA9PT0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5Ub0JlQ29ubmVjdERldmljZS5wdXNoKGRldmljZXNMaXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VsZWN0RHJpdmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAndXBkYXRlRGV2aWNlc18nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBMaXN0TnVtID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEZXZpY2VzXyhMaXN0TnVtLCBuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdDb25uZWN0U3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlTmFtZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBkcml2ZXJOYW1lID0gcGFydHNbM107CgogICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlTmFtZSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgZGV2aWNlTmFtZSwgZHJpdmVyTmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEZXZpY2VzQ29ubmVjdCh0eXBlLCBkZXZpY2VOYW1lLCBkcml2ZXJOYW1lLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdDb25uZWN0RmFpbGVkJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcmVhc29uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KHJlYXNvbiwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ0Nvbm5lY3RBbGxEZXZpY2UgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTY2FuRmFpbGVkJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcmVhc29uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KHJlYXNvbiwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlbGVjdERyaXZlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0FkZERldmljZVR5cGUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBEZXZpY2VUeXBlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQWRkRGV2aWNlVHlwZScsIERldmljZVR5cGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0RldmljZVRvQmVBbGxvY2F0ZWQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBEZXZpY2VUeXBlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IERldmljZUluZGV4ID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IERldmljZU5hbWUgPSBwYXJ0c1szXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdEZXZpY2VUb0JlQWxsb2NhdGVkJywgRGV2aWNlSW5kZXgsIERldmljZU5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1Nob3dEZXZpY2VBbGxvY2F0aW9uV2luZG93JzoKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndG9nZ2xlRGV2aWNlQWxsb2NhdGlvblBhbmVsJyk7CiAgICAgICAgICAgICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0V4cG9zdXJlQ29tcGxldGVkJzoKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnRXhwb3N1cmVDb21wbGV0ZWQnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTYXZlSnBnU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJvaV94ID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJvaV95ID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJGJ1cy4kZW1pdCgnc2hvd1JvaUltYWdlJywgZmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICB0aGlzLnNob3dSb2lJbWFnZShmaWxlTmFtZSwgcm9pX3gsIHJvaV95KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTYXZlQmluU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMucmVhZEJpbkZpbGUoJ2ltZy8nICsgZmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICB0aGlzLkRldGVjdGVkU3RhcnNGaW5pc2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTYXZlR3VpZGVySW1hZ2VTdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQW5kRGlzcGxheUltYWdlKCdpbWcvJyArIGZpbGVOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdBZGRTY2F0dGVyQ2hhcnREYXRhJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgRGF0YV94ID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IERhdGFfeSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBuZXdEYXRhUG9pbnQgPSBbRGF0YV94LCBEYXRhX3ldOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FkZFNjYXR0ZXJDaGFydERhdGEnLCBuZXdEYXRhUG9pbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0FkZExpbmVDaGFydERhdGEnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBEYXRhX3ggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgRGF0YV9SYSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBEYXRhX0RlYyA9IHBhcnRzWzNdOwogICAgICAgICAgICAgICAgICBjb25zdCBuZXdEYXRhUG9pbnRfUmEgPSBbRGF0YV94LCBEYXRhX1JhXTsKICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RGF0YVBvaW50X0RlYyA9IFtEYXRhX3gsIERhdGFfRGVjXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBZGRMaW5lQ2hhcnREYXRhJywgbmV3RGF0YVBvaW50X1JhLCBuZXdEYXRhUG9pbnRfRGVjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTZXRMaW5lQ2hhcnRSYW5nZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRMaW5lQ2hhcnRSYW5nZScsIG1pbiwgbWF4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdHdWlkZXJTdGF0dXMnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJTdGF0dXMnLCBzdGF0dXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0ZvY3VzQ2hhbmdlU3BlZWRTdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgU3BlZWQgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdGb2N1c0NoYW5nZVNwZWVkU3VjY2VzcycsIFNwZWVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnRm9jdXNQb3NpdGlvbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEN1cnJlbnRQb3NpdGlvbiA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBUYXJnZXRQb3NpdGlvbiA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ZvY3VzUG9zaXRpb24nLCBDdXJyZW50UG9zaXRpb24sIFRhcmdldFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdGb2N1c01vdmVEb25lJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgQ3VycmVudFBvc2l0aW9uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IEZXSE0gPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdVcGRhdGVGV0hNJyxDdXJyZW50UG9zaXRpb24sIEZXSE0pOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2FkZERhdGFfUG9pbnQnLCBDdXJyZW50UG9zaXRpb24sIEZXSE0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2FkZE1pblBvaW50RGF0YV9Qb2ludCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwYXJzZUludChwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBwYXJzZUZsb2F0KHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdhZGRNaW5Qb2ludERhdGFfUG9pbnQnLCB4LCB5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ2FkZExpbmVEYXRhX1BvaW50JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhTGlzdCA9IHBhcnRzWzFdLnNwbGl0KCcsJyk7ICAvLyDlsIblrZfnrKbkuLLliIblibLmiJDmlbDnu4QKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb29yZGluYXRlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUxpc3QubGVuZ3RoLTE7IGkgKz0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gcGFyc2VJbnQoZGF0YUxpc3RbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gcGFyc2VGbG9hdChkYXRhTGlzdFtpICsgMV0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb29yZGluYXRlID0gW3gsIHldOwogICAgICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2FkZExpbmVEYXRhX1BvaW50JywgY29vcmRpbmF0ZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnTWFpbkNhbWVyYVNpemUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBTaXplWCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBTaXplWSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFTaXplJywgU2l6ZVgsIFNpemVZKTsKICAgICAgICAgICAgICAgICAgdGhpcy5tYWluQ2FtZXJhU2l6ZVggPSBTaXplWDsKICAgICAgICAgICAgICAgICAgdGhpcy5tYWluQ2FtZXJhU2l6ZVkgPSBTaXplWTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNYWluQ2FtZXJhQmlubmluZyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGJpbiA9IHBhcnNlSW50KHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQmlubmluZycsIGJpbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZml0UXVhZHJhdGljQ3VydmUnOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDbGVhcmZpdFF1YWRyYXRpY0N1cnZlJyk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8PSA2MDE7IHggKz0gMSkgewogICAgICAgICAgICAgICAgICBjb25zdCBhID0gcGFydHNbeF07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBhLnNwbGl0KCd8Jyk7CiAgICAgICAgICAgICAgICAgIGlmIChiLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHggPSBiWzBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBiWzFdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZml0UXVhZHJhdGljQ3VydmUnLCB4LCB5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2ZpdFF1YWRyYXRpY0N1cnZlX21pblBvaW50JzoKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZml0UXVhZHJhdGljQ3VydmVfbWluUG9pbnQnLCB4LCB5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlUGFyayc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFN3aXRjaCA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50UGFya1N3aXRjaCcsIFN3aXRjaCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlVHJhY2snOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBTd2l0Y2ggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudFRyYWNrU3dpdGNoJywgU3dpdGNoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNb3VudFNldFNwZWVkU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ25ld01vdW50U2xld1JhdGUnLCBudW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdUZWxlc2NvcGVQaWVyU2lkZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFNpZGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCd1cGRhdGVNb3VudFBpZXJTaWRlJywgU2lkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnVGVsZXNjb3BlVG90YWxTbGV3UmF0ZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50VG90YWxTbGV3UmF0ZScsIG51bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ1VwZGF0ZVNjaGVkdWxlUHJvY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFJvd051bSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCBQcm9jZXNzID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnVXBkYXRlU2NoZWR1bGVQcm9jZXNzJywgUm93TnVtLCBQcm9jZXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdFeHBUaW1lTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnaW5pdEV4cFRpbWVMaXN0JywgcGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdDYW1lcmFJbkV4cG9zdXJpbmcnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDYW1lcmFJbkV4cG9zdXJpbmcnLCBzdGF0dXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0F1dG9Gb2N1c092ZXInOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBdXRvRm9jdXNPdmVyJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ0ZXUG9zaXRpb25NYXgnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NldENGV1Bvc2l0aW9uTWF4JywgcGFydHNbMV0pOwoKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcGFydHNbMV07IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuQ0ZXQ29uZmlnSXRlbXMucHVzaCh7IGRyaXZlclR5cGU6ICdDRlcnLCBsYWJlbDogYENGVyBbJHtpfV1gLCB2YWx1ZTogJycsIGlucHV0VHlwZTogJ3RleHQnIH0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ2dldENGV0xpc3QnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnU2V0Q0ZXUG9zaXRpb25TdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRDRldQb3NpdGlvblN1Y2Nlc3MnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZ2V0Q0ZXTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnaW5pdENGV0xpc3QnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyU3dpdGNoU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJTd2l0Y2hTdGF0dXMnLCBwYXJ0c1sxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyTG9vcEV4cFN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyTG9vcEV4cFN0YXR1cycsIHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdUZWxlc2NvcGVSQURFQyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlQ2lyY2xlUG9zKHBhcnRzWzFdLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ1RlbGVzY29wZVN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlVGVsZXNjb3BlU3RhdHVzKHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdNYWluQ2FtZXJhU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVNYWluQ2FtZXJhU3RhdHVzKHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnTWFpbkNhbWVyYVRlbXBlcmF0dXJlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVNYWluQ2FtZXJhVGVtcGVyYXR1cmUocGFydHNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdTaG93QWxsSW1hZ2VGb2xkZXInOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dBbGxJbWFnZUZvbGRlcicsIHBhcnRzWzFdLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ0ltYWdlRmlsZXNOYW1lJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdJbWFnZUZpbGVzTmFtZScsIHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKCiAgICAgICAgICAgICAgY2FzZSAnVVNCQ2hlY2snOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBVU0JkYXRhID0gcGFydHNbMV0uc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VTQiBuYW1lOiAnLCBVU0JkYXRhWzBdKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VTQiBzcGFjZTogJywgVVNCZGF0YVsxXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1VTQiBuYW1lOicgKyBVU0JkYXRhWzBdLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdVU0Igc3BhY2U6JyArIFVTQmRhdGFbMV0sICdpbmZvJyk7CgogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1VTQl9OYW1lX1NhcGNlJywgVVNCZGF0YVswXSwgVVNCZGF0YVsxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnSW1hZ2VTYXZlRXJyb2UnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBFcnJvZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBpZiAoRXJyb2UgPT09ICdVU0ItTnVsbCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnTm8gVVNCIERyaXZlIERldGVjdGVkLicsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEVycm9lID09PSAnVVNCLU11bHRpcGxlJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdNdWx0aXBsZSBVU0IgZHJpdmVzIGRldGVjdGVkLCBwbGVhc2UgcmVtb3ZlIGV4Y2VzcyBVU0IgZHJpdmVzLicsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnRGV0ZWN0ZWRTdGFycyc6CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGV0ZWN0ZWQnLCBwYXJ0cy5sZW5ndGgsICdzdGFycy4nKTsKICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0RldGVjdGVkICcgKyBwYXJ0cy5sZW5ndGggKyAnIHN0YXJzLicsICdpbmZvJyk7CiAgICAgICAgICAgICAgICB0aGlzLkRldGVjdGVkU3RhcnNMaXN0ID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBwYXJ0c1tpXTsKICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IGEuc3BsaXQoJ3wnKTsKICAgICAgICAgICAgICAgICAgaWYgKGIubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IGJbMF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeSA9IGJbMV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGZyID0gYlsyXTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnU3RhcnMgYXQoJywgeCwgJywnLCB5LCAnKSB3aXRoIEhGUjonLCBoZnIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuRGV0ZWN0ZWRTdGFyc0xpc3QucHVzaCh7IHg6IHgsIHk6IHksIGhmcjogaGZyIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLkRldGVjdGVkU3RhcnNGaW5pc2ggPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NvbHZlSW1hZ2VSZXN1bHQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkgewogICAgICAgICAgICAgICAgICAvLyB0aGlzLlVwZGF0ZUNpcmNsZVBvcyhwYXJ0c1sxXSwgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU29sdmUgSW1hZ2UgUmVzdWx0KFJBX0RlZ3JlZSwgREVDX0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpOicsIHBhcnRzWzFdLCAnLCcsIHBhcnRzWzJdLCAnLCcsIHBhcnRzWzNdLCAnLCcsIHBhcnRzWzRdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU29sdmUgSW1hZ2UgUmVzdWx0KFJBX0RlZ3JlZSwgREVDX0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpOicgKyBwYXJ0c1sxXSArICcsJyArIHBhcnRzWzJdICsgJywnICsgcGFydHNbM10gKyAnLCcgKyBwYXJ0c1s0XSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgdGhpcy5Tb2x2ZVJlc3VsdE1hcmsocGFydHNbMV0sIHBhcnRzWzJdLCBwYXJ0c1szXSwgcGFydHNbNF0pOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoIkltYWdlU29sdmVGaW5pc2hlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFBhcnNpbmdQcm9ncmVzcycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTb2x2ZUZvdlJlc3VsdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA5KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFJhRGVjID0gWwogICAgICAgICAgICAgICAgICAgIHsgUmE6IHBhcnRzWzFdLCBEZWM6IHBhcnRzWzJdIH0sCiAgICAgICAgICAgICAgICAgICAgeyBSYTogcGFydHNbM10sIERlYzogcGFydHNbNF0gfSwKICAgICAgICAgICAgICAgICAgICB7IFJhOiBwYXJ0c1s1XSwgRGVjOiBwYXJ0c1s2XSB9LAogICAgICAgICAgICAgICAgICAgIHsgUmE6IHBhcnRzWzddLCBEZWM6IHBhcnRzWzhdIH0sCiAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgIHRoaXMuU29sdmVGb3ZNYXJrKFJhRGVjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdSZWFsVGltZVNvbHZlSW1hZ2VSZXN1bHQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU29sdmUgSW1hZ2UgUmVzdWx0KFJBX0RlZ3JlZSwgREVDX0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpOicsIHBhcnRzWzFdLCAnLCcsIHBhcnRzWzJdLCAnLCcsIHBhcnRzWzNdLCAnLCcsIHBhcnRzWzRdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU29sdmUgSW1hZ2UgUmVzdWx0KFJBX0RlZ3JlZSwgREVDX0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpOicgKyBwYXJ0c1sxXSArICcsJyArIHBhcnRzWzJdICsgJywnICsgcGFydHNbM10gKyAnLCcgKyBwYXJ0c1s0XSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5Tb2x2ZVJlc3VsdE1hcmtfUmVhbFRpbWUocGFydHNbMV0sIHBhcnRzWzJdLCBwYXJ0c1szXSwgcGFydHNbNF0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU29sdmVJbWFnZWZhaWxlZCc6CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnU29sdmUgaW1hZ2UgZmFpbGQuLi4nLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgiSW1hZ2VTb2x2ZUZpbmlzaGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRQYXJzaW5nUHJvZ3Jlc3MnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnTWFpbkNhbWVyYU9mZnNldFJhbmdlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmFPZmZzZXRSYW5nZTonLCBwYXJ0c1sxXSwgJywnLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ01haW5DYW1lcmFPZmZzZXRSYW5nZTonICsgcGFydHNbMV0gKyAnLCcgKyBwYXJ0c1syXSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgdGhpcy5NYWluQ2FtZXJhT2Zmc2V0TWluID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuTWFpbkNhbWVyYU9mZnNldE1heCA9IHBhcnRzWzJdOwoKICAgICAgICAgICAgICAgICAgY29uc3QgT2Zmc2V0SXRlbSA9IHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnT2Zmc2V0Jyk7CiAgICAgICAgICAgICAgICAgIGlmIChPZmZzZXRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmFPZmZzZXRSYW5nZTonLCBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFPZmZzZXRNaW4sIDEwKSwgJywnLCBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFPZmZzZXRNYXgsIDEwKSk7CiAgICAgICAgICAgICAgICAgICAgT2Zmc2V0SXRlbS5pbnB1dE1pbiA9IHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYU9mZnNldE1pbiwgMTApOwogICAgICAgICAgICAgICAgICAgIE9mZnNldEl0ZW0uaW5wdXRNYXggPSBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFPZmZzZXRNYXgsIDEwKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ01haW5DYW1lcmFHYWluUmFuZ2UnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbkNhbWVyYUdhaW5SYW5nZTonLCBwYXJ0c1sxXSwgJywnLCBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ01haW5DYW1lcmFHYWluUmFuZ2U6JyArIHBhcnRzWzFdICsgJywnICsgcGFydHNbMl0sICdpbmZvJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuTWFpbkNhbWVyYUdhaW5NaW4gPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5NYWluQ2FtZXJhR2Fpbk1heCA9IHBhcnRzWzJdOwoKICAgICAgICAgICAgICAgICAgY29uc3QgZ2Fpbkl0ZW0gPSB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ0dhaW4nKTsKICAgICAgICAgICAgICAgICAgaWYgKGdhaW5JdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmFHYWluUmFuZ2U6JywgcGFyc2VJbnQodGhpcy5NYWluQ2FtZXJhR2Fpbk1pbiwgMTApLCAnLCcsIHBhcnNlSW50KHRoaXMuTWFpbkNhbWVyYUdhaW5NYXgsIDEwKSk7CiAgICAgICAgICAgICAgICAgICAgZ2Fpbkl0ZW0uaW5wdXRNaW4gPSBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFHYWluTWluLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgZ2Fpbkl0ZW0uaW5wdXRNYXggPSBwYXJzZUludCh0aGlzLk1haW5DYW1lcmFHYWluTWF4LCAxMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdPdXRwdXRQb3dlclN0YXR1cyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChwYXJ0c1syXSwgMTApOwoKICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5PdXRQdXRQb3dlcl8xX09OID0gdmFsdWUgPT09IDE7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLk91dFB1dFBvd2VyXzJfT04gPSB2YWx1ZSA9PT0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BIRDJTdGFyQm94Vmlldyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQSEQyU3RhckJveFZpZXcnLCB2aWV3KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdQSEQyU3RhckNyb3NzVmlldyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQSEQyU3RhckNyb3NzVmlldycsIHZpZXcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BIRDJTdGFyQm94UG9zaXRpb24nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkgewogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1ggPSBwYXJzZUludChwYXJ0c1sxXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBQSEQySW1hZ2VTaXplX1kgPSBwYXJzZUludChwYXJ0c1syXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBCb3hfWCA9IHBhcnNlSW50KHBhcnRzWzNdLCAxMCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IEJveF9ZID0gcGFyc2VJbnQocGFydHNbNF0sIDEwKTsKICAgICAgICAgICAgICAgICAgdGhpcy5EcmF3UEhEMkJveChQSEQySW1hZ2VTaXplX1gsIFBIRDJJbWFnZVNpemVfWSwgQm94X1gsIEJveF9ZKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdQSEQyTXVsdGlTdGFyc1Bvc2l0aW9uJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgUEhEMkltYWdlU2l6ZV9YID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgUEhEMkltYWdlU2l6ZV9ZID0gcGFyc2VJbnQocGFydHNbMl0sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgQm94X1ggPSBwYXJzZUludChwYXJ0c1szXSwgMTApOwogICAgICAgICAgICAgICAgICBjb25zdCBCb3hfWSA9IHBhcnNlSW50KHBhcnRzWzRdLCAxMCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuRHJhd1BIRDJNdWx0aVN0YXJzKFBIRDJJbWFnZVNpemVfWCwgUEhEMkltYWdlU2l6ZV9ZLCBCb3hfWCwgQm94X1kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0NsZWFyUEhEMk11bHRpU3RhcnMnOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDbGVhclBIRDJNdWx0aVN0YXJzJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnUEhEMlN0YXJDcm9zc1Bvc2l0aW9uJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgUEhEMkltYWdlU2l6ZV9YID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgUEhEMkltYWdlU2l6ZV9ZID0gcGFyc2VJbnQocGFydHNbMl0sIDEwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgQ3Jvc3NfWCA9IHBhcnNlSW50KHBhcnRzWzNdLCAxMCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IENyb3NzX1kgPSBwYXJzZUludChwYXJ0c1s0XSwgMTApOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdQSEQyQ3Jvc3MoUEhEMkltYWdlU2l6ZV9YLCBQSEQySW1hZ2VTaXplX1ksIENyb3NzX1gsIENyb3NzX1kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1FUQ2xpZW50VmVyc2lvbic6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuUVRDbGllbnRWZXJzaW9uID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCgogICAgICAgICAgICAgIGNhc2UgJ0NhcHR1cmVJbWFnZVNhdmVTdGF0dXMnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ1JlcGVhdCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCh0aGlzLiR0KCdUaGVyZSBpcyBubyBuZWVkIHRvIHNhdmUgaXQgYWdhaW4nKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSAnU3VjY2VzcycpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCh0aGlzLiR0KCdJbWFnZSBzYXZlZCBzdWNjZXNzZnVsbHknKSwgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdOdWxsJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KHRoaXMuJHQoJ05vIGltYWdlcyB0byBzYXZlJyksICdlcnJvcicpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnSU5ESVNlcnZlckRlYnVnJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0lORElTZXJ2ZXJEZWJ1ZycsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0hvdHNwb3ROYW1lJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0hvdHNwb3ROYW1lJywgTmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnRWRpdEhvdHNwb3ROYW1lU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0VkaXRIb3RzcG90TmFtZVN1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdEU0xSc1NldHVwJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dEU0xSc1NldHVwJywgTmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ29uZmlndXJlUmVjb3ZlcnknOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBDb25maWdOYW1lID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIGNvbnN0IENvbmZpZ1ZhbHVlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb25maWd1cmU6JywgQ29uZmlnTmFtZSwgJywnLCBDb25maWdWYWx1ZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NvbmZpZ3VyZSBSZWNvdmVyeTonICsgcGFydHNbMV0gKyAnLCcgKyBwYXJ0c1syXSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KENvbmZpZ05hbWUsIENvbmZpZ1ZhbHVlKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ0ZvY2FsTGVuZ3RoJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuVGVsZXNjb3Blc0NvbmZpZ0l0ZW1zWzBdLnZhbHVlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09ICdUZWxlc2NvcGVzJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHNbMl0gPT09ICcnIHx8IHBhcnRzWzJdID09PSBOYU4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBwYXJ0c1syXSArICcgbW0nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdHdWlkZXJGb2NhbExlbmd0aCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLkd1aWRlckNvbmZpZ0l0ZW1zWzBdLnZhbHVlID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdHdWlkZXJGb2NhbExlbmd0aDonICsgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdDb29yZGluYXRlcycpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBbbGF0LCBsbmddID0gcGFydHNbMl0uc3BsaXQoJywnKS5tYXAoY29vcmQgPT4gcGFyc2VGbG9hdChjb29yZC50cmltKCkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlNldEN1cnJlbnRMb2NhdGlvbihsYXQsIGxuZyk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ011bHRpU3Rhckd1aWRlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLkd1aWRlckNvbmZpZ0l0ZW1zWzFdLnZhbHVlID0gKHBhcnRzWzJdID09PSAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnTXVsdGlTdGFyR3VpZGVyOicgKyBwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1sxXSA9PT0gJ0d1aWRlckdhaW4nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5HdWlkZXJDb25maWdJdGVtc1syXS52YWx1ZSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnR3VpZGVyR2FpbjonICsgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdDYWxpYnJhdGlvbkR1cmF0aW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbM10udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NhbGlicmF0aW9uRHVyYXRpb246JyArIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHBhcnRzWzFdID09PSAnUmFBZ2dyZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbNF0udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1JhQWdncmVzc2lvbjonICsgcGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09ICdEZWNBZ2dyZXNzaW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuR3VpZGVyQ29uZmlnSXRlbXNbNV0udmFsdWUgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0RlY0FnZ3Jlc3Npb246JyArIHBhcnRzWzJdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdDb25uZWN0RHJpdmVyU3VjY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3REcml2ZXJTdWNjZXNzKGRldmljZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnQ29ubmVjdERyaXZlckZhaWxlZCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0RHJpdmVyRmFpbGVkKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0Rpc2Nvbm5lY3REcml2ZXJTdWNjZXNzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdERyaXZlcnN1Y2Nlc3MoZGV2aWNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdEaXNjb25uZWN0RHJpdmVyRmFpbCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRyaXZlciA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3REcml2ZXJGYWlsKGRldmljZSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAnU2VsZWN0ZWREcml2ZXJMaXN0JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMykgewogICAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2VPYmplY3RzID0gcGFydHMuc2xpY2UoMSkucmVkdWNlKChhY2MsIHBhcnQsIGluZGV4LCBhcnJheSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAlIDIgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKHsgW2FycmF5W2luZGV4XV06IGFycmF5W2luZGV4ICsgMV0gfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7CiAgICAgICAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU2VsZWN0ZWREcml2ZXJMaXN0KGRldmljZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdCaW5kRGV2aWNlTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlT2JqZWN0cyA9IHBhcnRzLnNsaWNlKDEpLnJlZHVjZSgoYWNjLCBwYXJ0LCBpbmRleCwgYXJyYXkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggJSAyID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBhY2MucHVzaCh7IFthcnJheVtpbmRleF1dOiBhcnJheVtpbmRleCArIDFdIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjOwogICAgICAgICAgICAgICAgICB9LCBbXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEJpbmREZXZpY2VMaXN0KGRldmljZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgoKICAgICAgICAgICAgICBjYXNlICdCaW5kRGV2aWNlVHlwZUxpc3QnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSA1KSB7IC8vIOehruS/neiHs+WwkeacieS6lOS4quWPguaVsOWKoOS4iuWJjee8gAogICAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2VUeXBlT2JqZWN0cyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcnRzLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlVHlwZU9iamVjdCA9IHsKICAgICAgICAgICAgICAgICAgICAgIFR5cGU6IHBhcnRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgRGV2aWNlTmFtZTogcGFydHNbaSArIDFdLAogICAgICAgICAgICAgICAgICAgICAgRHJpdmVyTmFtZTogcGFydHNbaSArIDJdLAogICAgICAgICAgICAgICAgICAgICAgaXNiaW5kOiBwYXJ0c1tpICsgM10gPT0gInRydWUiID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZU9iamVjdHMucHVzaChkZXZpY2VUeXBlT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRCaW5kRGV2aWNlVHlwZUxpc3QoZGV2aWNlVHlwZU9iamVjdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZURldmljZUFsbG9jYXRpb25MaXN0JzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGV2aWNlTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZURldmljZUFsbG9jYXRpb25MaXN0KGRldmljZU5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZVR5cGUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgaWYgKGRldmljZVR5cGUgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCcsIGRldmljZVR5cGUpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2VUeXBlID09ICdDRlcnKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRldmljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRldmljZXNbaV0uZHJpdmVyVHlwZSA9PSAnQ0ZXJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VzW2ldLmRldmljZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uZHJpdmVyTmFtZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRldmljZXNbaV0uQmF1ZFJhdGUgPSA5NjAwOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NGV0Nvbm5lY3RlZCcsIDApOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1BhcnNlSW5mb0VtaXR0ZWQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1BhcnNlSW5mb0VtaXR0ZWQnLCBwcm9ncmVzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnR3VpZGVyVXBkYXRlU3RhdHVzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyVXBkYXRlU3RhdHVzJywgcGFyc2VJbnQoc3RhdHVzLCAxMCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0xvb3BTb2x2ZUltYWdlRmluaXNoZWQnOgogICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdMb29wU29sdmVJbWFnZUZpbmlzaGVkJyk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnZGlzY29ubmVjdERldmljZWhhc29ydGhlcmRldmljZSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGRyaXZlcm5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U2VsZWN0ZGlzY29ubmVjdERyaXZlcihkcml2ZXJuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdnZXRGb2N1c2VyTW92ZVN0YXRlJzoKICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZ2V0Rm9jdXNlck1vdmVTdGF0ZScpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ0ZvY3VzTW92ZVRvTGltaXQnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBlcnJvcmxvZyA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChlcnJvcmxvZywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnc3RhcnRGb2N1c0xvb3BTam9vdGluZ2ZpbGUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gcGFydHNbMV07CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc3RhcnRGb2N1c0xvb3BTam9vdGluZ2ZpbGUnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdzZXRGb2N1c2VyTG9vcGluZ1N0YXRlJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldEZvY3VzZXJMb29waW5nU3RhdGUnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZvY3VzTG9vcFNob290aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRm9jdXNMb29wU2hvb3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIC8vIGNhc2UgJ2ZvY3VzZXJST0lTdGFyc0xpc3QnOgogICAgICAgICAgICAgIC8vICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgIC8vICAgICBjb25zdCB4ID0gcGFydHNbMV07CiAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IHkgPSBwYXJ0c1syXTsKICAgICAgICAgICAgICAvLyAgICAgY29uc3QgSEZSID0gcGFydHNbM107CiAgICAgICAgICAgICAgLy8gICAgIHRoaXMuZm9jdXNlclJPSVN0YXJzTGlzdC5wdXNoKHsgeCwgeSwgSEZSIH0pOwogICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgIC8vICAgYnJlYWs7CgogICAgICAgICAgICAgIC8vIGNhc2UgJ2NsZWFyRm9jdXNlclJPSVN0YXJzTGlzdCc6CiAgICAgICAgICAgICAgLy8gICB0aGlzLmZvY3VzZXJST0lTdGFyc0xpc3QgPSBbXTsKICAgICAgICAgICAgICAvLyAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdzZXRTZWxlY3RTdGFyUG9zaXRpb24nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFyWCA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFyWSA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTZWxlY3RTdGFySEZSID0gcGFyc2VGbG9hdChwYXJ0c1szXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAnU2V0UmVkQm94U3RhdGUnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgdGhpcy5ST0lfeCA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLlJPSV95ID0gcGFyc2VGbG9hdChwYXJ0c1szXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UmVkQm94U3RhdGUobGVuZ3RoLCB0aGlzLlJPSV94LCB0aGlzLlJPSV95KTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+iuvue9rue6ouiJslJPSeahhjogJywgbGVuZ3RoLCB0aGlzLlJPSV94LCB0aGlzLlJPSV95KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdTZXRWaXNpYmxlQXJlYSc6CiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZVggPSBwYXJzZUZsb2F0KHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlWSA9IHBhcnNlRmxvYXQocGFydHNbMl0pOwogICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlID0gcGFyc2VGbG9hdChwYXJ0c1szXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0U2NhbGUnLCB0aGlzLnNjYWxlKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+iuvue9ruWPr+ingeWMuuWfnzogJywgdGhpcy52aXNpYmxlWCwgdGhpcy52aXNpYmxlWSwgdGhpcy5zY2FsZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ3VwZGF0ZSBWaXNpYmxlQXJlYSB4PScgKyB0aGlzLnZpc2libGVYICsgJywgeT0nICsgdGhpcy52aXNpYmxlWSArICcsIHNjYWxlPScgKyB0aGlzLnNjYWxlLCAnaW5mbycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1NldFNlbGVjdFN0YXJzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWCA9IHBhcnNlRmxvYXQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID0gcGFyc2VGbG9hdChwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ3VwZGF0ZSBTZWxlY3RTdGFycyB4PScgKyB0aGlzLnNlbGVjdFN0YXJYICsgJywgeT0nICsgdGhpcy5zZWxlY3RTdGFyWSwgJ2luZm8nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICd1cGRhdGVDUFVJbmZvJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgICAgbGV0IGNwdVRlbXAgPSBwYXJzZUZsb2F0KHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgICAgbGV0IGNwdVVzYWdlID0gcGFyc2VGbG9hdChwYXJ0c1syXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuY3B1VGVtcCA9IGlzTmFOKGNwdVRlbXApID8gbnVsbCA6IChjcHVUZW1wICUgMSA9PT0gMCA/IGNwdVRlbXAgOiBjcHVUZW1wLnRvRml4ZWQoMSkpOyAgLy8g5aaC5p6cIGNwdVRlbXAg5pivIE5hTu+8jOiuvue9ruS4uiBudWxs77yM5ZCm5YiZ5aaC5p6cIGNwdVRlbXAg5piv5pW05pWw77yM5bCx5LiN5L+d55WZ5bCP5pWw77yM5ZCm5YiZ5L+d55WZ5LiA5L2N5bCP5pWwCiAgICAgICAgICAgICAgICAgIHRoaXMuY3B1VXNhZ2UgPSBpc05hTihjcHVVc2FnZSkgPyBudWxsIDogKGNwdVVzYWdlICUgMSA9PT0gMCA/IGNwdVVzYWdlIDogY3B1VXNhZ2UudG9GaXhlZCgxKSk7ICAvLyDlpoLmnpwgY3B1VXNhZ2Ug5pivIE5hTu+8jOiuvue9ruS4uiBudWxs77yM5ZCm5YiZ5aaC5p6cIGNwdVVzYWdlIOaYr+aVtOaVsO+8jOWwseS4jeS/neeVmeWwj+aVsO+8jOWQpuWImeS/neeVmeS4gOS9jeWwj+aVsAogICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3VwZGF0ZUNQVUluZm8nLCB0aGlzLmNwdVRlbXAsIHRoaXMuY3B1VXNhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ1RpYW5XZW4nOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBub3RpY2VfdHlwZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICBjb25zdCByYSA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgICBjb25zdCBkZWMgPSBwYXJ0c1szXTsKICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdUaWFuV2VuJywgbm90aWNlX3R5cGUsIHJhLCBkZWMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgJ3NldE1haW5DYW1lcmFQYXJhbWV0ZXJzJzoKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMykgewogICAgICAgICAgICAgICAgICBsZXQgcGFyYW1ldGVycyA9IHt9OwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcnRzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVyID0gcGFydHNbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJ0c1tpICsgMV07CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc1twYXJhbWV0ZXJdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRNYWluQ2FtZXJhUGFyYW1ldGVycyhwYXJhbWV0ZXJzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICdsb2NhbE1lc3NhZ2UnOgogICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgICAgICAgICBjb25zdCBsYXQgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgICAgICAgY29uc3QgbG9uID0gcGFydHNbMl07CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhbmd1YWdlID0gcGFydHNbM107CiAgICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2xvY2FsTWVzc2FnZTogJyArIGxhdCArICcsJyArIGxvbiArICcsJyArIGxhbmd1YWdlLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICBpZiAobGFuZ3VhZ2UgPT0gJ3poJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2xpZW50TGFuZ3VhZ2UnLCAnY24nKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NsaWVudExhbmd1YWdlJywgJ2VuJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRMb2NhdGlvbkxhdEFuZExvbicsIGxhdCwgbG9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfmnKrlpITnkIblkb3ku6Q6ICcsIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdRVF9Db25maXJtJykgewogICAgICAgICAgLy8g5aSE55CG56Gu6K6k5raI5oGvCiAgICAgICAgICBjb25zdCBtZXNzYWdlSWQgPSBkYXRhLm1zZ2lkOwogICAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlUmVzcG9uc2UobWVzc2FnZUlkKTsKICAgICAgICB9ZWxzZSBpZiAoZGF0YS50eXBlID09PSAnUHJvY2Vzc19Db21tYW5kJykgewogICAgICAgICAgLy8g5aSE55CG6L+U5Zue5raI5oGvCiAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGEubWVzc2FnZS5zcGxpdCgnOicpOwogICAgICAgICAgaWYgKHBhcnRzWzBdID09PSAncXRTZXJ2ZXJJc092ZXInKSB7CiAgICAgICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdRVCBTZXJ2ZXIgaXMgb3ZlcicsICdlcnJvcicpOwogICAgICAgICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdyZXN0YXJ0JywgJ1FUIHNlcnZlciBlbmNvdW50ZXJlZCBhIHNlZ21lbnRhdGlvbiBmYXVsdCBvciBpcyBmcm96ZW4sIHBsZWFzZSByZXN0YXJ0IG9yIGV4aXQhJywncmVzdGFydFF0U2VydmVyJyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJlY2VpdmVkTWVzc2FnZXMucHVzaChkYXRhLm1lc3NhZ2UpOyAvLyDlsIbmjqXmlLbliLDnmoTmtojmga/mt7vliqDliLDmlbDnu4TkuK0KICAgICAgfTsKCiAgICAgIHRoaXMud2Vic29ja2V0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHsKICAgICAgICBjb25zdCBlcnJvckRldGFpbHMgPSB7CiAgICAgICAgICB0eXBlOiBlcnJvci50eXBlLAogICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICB1cmw6IHRoaXMuV2ViU29ja2V0VXJsLAogICAgICAgICAgcmVhZHlTdGF0ZTogdGhpcy53ZWJzb2NrZXQucmVhZHlTdGF0ZSwKICAgICAgICAgIHByb3RvY29sOiB0aGlzLndlYnNvY2tldC5wcm90b2NvbCwKICAgICAgICAgIGV4dGVuc2lvbnM6IHRoaXMud2Vic29ja2V0LmV4dGVuc2lvbnMKICAgICAgICB9OwogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYlNvY2tldCBFcnJvciBEZXRhaWxzOicsIGVycm9yRGV0YWlscyk7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnV2ViU29ja2V0IEVycm9yOiAnICsgSlNPTi5zdHJpbmdpZnkoZXJyb3JEZXRhaWxzKSwgJ2Vycm9yJyk7CiAgICAgICAgdGhpcy53ZWJzb2NrZXRTdGF0ZSA9ICdlcnJvcic7CiAgICAgICAgdGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIHRoaXMud2Vic29ja2V0Lm9uY2xvc2UgPSAoKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IFdlYlNvY2tldCBkaXNjb25uZWN0ZWQnKTsKICAgICAgICB0aGlzLndlYnNvY2tldFN0YXRlID0gJ2Rpc2Nvbm5lY3RlZCc7CiAgICAgICAgdGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkID0gdHJ1ZTsgLy8gV2ViU29ja2V06L+e5o6l5YWz6Zet5pe26K6+572u572R57uc6L+e5o6l54q25oCBCiAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IFdlYlNvY2tldCBkaXNjb25uZWN0ZWQnKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dOZXRTdGF0dXMnLCAnZmFsc2UnKTsKCiAgICAgICAgLy8g6K6+572u5LiA5Liq5a6a5pe25Zmo77yMMeenkuWQjuajgOafpee9kee7nOeKtuaAgQogICAgICAgIHRoaXMuZGlzY29ubmVjdFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGlmICh0aGlzLm5ldHdvcmtEaXNjb25uZWN0ZWQpIHsgLy8g5aaC5p6cMeenkuWQjuS7jeeEtuaWreW8gAogICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnV2ViU29ja2V0IGRpc2Nvbm5lY3RlZCcsICdlcnJvcicpOwogICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0VHJpZ2dlcmVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwKTsgLy8gMeenkuWQjuaJp+ihjAoKICAgICAgICAvLyDlkK/liqjoh6rliqjph43ov54KICAgICAgICB0aGlzLnJlY29ubmVjdFdlYlNvY2tldCgpOwogICAgICB9OwogICAgfSwKCiAgICAvLyDoh6rliqjph43ov54KICAgIHJlY29ubmVjdFdlYlNvY2tldCgpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IFdlYlNvY2tldCByZWNvbm5lY3RlZCcpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1dlYlNvY2tldCByZWNvbm5lY3RlZC4nLCAnaW5mbycpOwogICAgICAgIHRoaXMuY29ubmVjdCgpOwogICAgICB9LCAyMDAwKTsgLy8gMuenkuWQjuWwneivlemHjeaWsOi/nuaOpQogICAgfSwKICAgIC8vIOiHquWKqOmHjei/ngoKICAgIC8v55uR5ZCs572R57uc6L+e5o6l54q25oCBCiAgICBzZXR1cE5ldHdvcmtTdGF0dXNMaXN0ZW5lcigpIHsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsICgpID0+IHsKICAgICAgICAvLyDmo4Dmn6Xmlq3lvIDov57mjqXnmoTlrprml7blmajmmK/lkKblt7Lnu4/op6blj5EKICAgICAgICBpZiAodGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCkgewogICAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1dlYlNvY2tldCBjb25uZWN0ZWQnLCAnc3VjY2VzcycpOwogICAgICAgIH0KICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5kaXNjb25uZWN0VGltZW91dCk7IC8vIOa4hemZpOaWreW8gOi/nuaOpeeahOWumuaXtuWZqAogICAgICAgIHRoaXMubmV0d29ya0Rpc2Nvbm5lY3RlZCA9IGZhbHNlOyAvLyDnvZHnu5zmgaLlpI3ml7bph43nva7nvZHnu5zov57mjqXnirbmgIEKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dOZXRTdGF0dXMnLCAndHJ1ZScpOwogICAgICAgIHRoaXMuU3RhdHVzUmVjb3ZlcnkoKTsKICAgICAgICB0aGlzLnJlY29ubmVjdFdlYlNvY2tldCgpOyAvLyDnvZHnu5zmgaLlpI3lkI7oh6rliqjph43ov55XZWJTb2NrZXQKICAgICAgfSk7CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsICgpID0+IHsKICAgICAgICB0aGlzLm5ldHdvcmtEaXNjb25uZWN0ZWQgPSB0cnVlOyAvLyDnvZHnu5zmlq3lvIDml7borr7nva7nvZHnu5zov57mjqXnirbmgIEKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dOZXRTdGF0dXMnLCAnZmFsc2UnKTsKICAgICAgICB0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0VHJpZ2dlcmVkID0gZmFsc2U7IC8vIOWIneWni+WMluaWreW8gOi/nuaOpeWumuaXtuWZqOinpuWPkeagh+W/lwogICAgICAgIC8vIOiuvue9ruS4gOS4quWumuaXtuWZqO+8jDHnp5LlkI7mo4Dmn6XnvZHnu5znirbmgIEKICAgICAgICB0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICBpZiAodGhpcy5uZXR3b3JrRGlzY29ubmVjdGVkKSB7IC8vIOWmguaenDHnp5LlkI7ku43nhLbmlq3lvIAKICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCA9IHRydWU7IC8vIOagh+iusOWumuaXtuWZqOW3suinpuWPkQogICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnV2ViU29ja2V0IGRpc2Nvbm5lY3RlZCcsICdlcnJvcicpOwogICAgICAgICAgfQogICAgICAgIH0sIDEwMDApOyAvLyAx56eS5ZCO5omn6KGMCiAgICAgIH0pOwogICAgfSwKICAgIC8v55uR5ZCs572R57uc6L+e5o6l54q25oCBCgogICAgc2VuZE1lc3NhZ2UodHlwZSwgbWVzc2FnZSkgewogICAgICBjb25zb2xlLmxvZygiUUhZQ0NEIHwgc2VuZE1lc3NhZ2U6ICIsIG1lc3NhZ2UpOwoKICAgICAgY29uc3QgbWVzc2FnZUlkID0gdGhpcy5nZW5lcmF0ZU1lc3NhZ2VJZCgpOyAvLyDnlJ/miJDllK/kuIDnmoTmtojmga9JRAogICAgICBjb25zdCBtZXNzYWdlT2JqID0geyB0eXBlOiB0eXBlLCBtc2dpZDogbWVzc2FnZUlkLCBtZXNzYWdlOiBtZXNzYWdlIH07IC8vIOWIm+W7uuWMheWQq+exu+Wei+WSjOa2iOaBr+eahOWvueixoQogICAgICBjb25zdCBtZXNzYWdlSnNvbiA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VPYmopOyAvLyDlsIbmtojmga/lr7nosaHovazmjaLkuLogSlNPTiDlrZfnrKbkuLIKICAgICAgY29uc3QgbWVzc2FnZVN0YXRlID0geyBtc2dpZDogbWVzc2FnZUlkLCB0ZXh0OiBtZXNzYWdlSnNvbiwgc3VjY2VzczogZmFsc2UgfTsgLy8g5Yib5bu65YyF5ZCr5raI5oGv5ZKM54q25oCB5L+h5oGv55qE5a+56LGhCgogICAgICBpZiAodGhpcy53ZWJzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHsKICAgICAgICB0aGlzLndlYnNvY2tldC5zZW5kKG1lc3NhZ2VKc29uKTsKICAgICAgICAvLyBtZXNzYWdlU3RhdGUuc3VjY2VzcyA9IHRydWU7IC8vIOiuvue9rua2iOaBr+S4uuaIkOWKnwogICAgICB9CiAgICAgIHRoaXMuc2VudE1lc3NhZ2VzLnB1c2gobWVzc2FnZVN0YXRlKTsgLy8g5re75Yqg5raI5oGv5a+56LGh5Yiw5bey5Y+R6YCB55qE5raI5oGv5pWw57uECiAgICB9LAoKICAgIGdlbmVyYXRlTWVzc2FnZUlkKCkgewogICAgICAvLyDkvb/nlKjml7bpl7TmiLPlkozorqHmlbDlmajnlJ/miJDllK/kuIDnmoTmtojmga9JRAogICAgICByZXR1cm4gRGF0ZS5ub3coKSArICItIiArICh0aGlzLm1lc3NhZ2VDb3VudGVyKyspOwogICAgfSwKCiAgICBoYW5kbGVNZXNzYWdlUmVzcG9uc2UobWVzc2FnZUlkKSB7CiAgICAgIC8vIOagueaNrui/lOWbnueahOa2iOaBr0lE5pu05paw5raI5oGv5Y+R6YCB54q25oCBCiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gdGhpcy5zZW50TWVzc2FnZXNbdGhpcy5zZW50TWVzc2FnZXMubGVuZ3RoIC0gMV07CiAgICAgIGlmIChsYXN0TWVzc2FnZSAmJiBsYXN0TWVzc2FnZS5tc2dpZCA9PT0gbWVzc2FnZUlkKSB7CiAgICAgICAgbGFzdE1lc3NhZ2Uuc3VjY2VzcyA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgLy8g5raI5oGv5qGGCiAgICBjYWxsU2hvd01lc3NhZ2VCb3gobXNnLCB0eXBlKSB7CiAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBjYWxsU2hvd01lc3NhZ2VCb3g6JywgbXNnLCB0eXBlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhtc2csIHR5cGUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dNc2dCb3gnLCBtc2csIHR5cGUpOwogICAgfSwKICAgIC8vIOa2iOaBr+ahhgoKICAgIGxvY2F0aW9uQ2xpY2tlZDogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Z1ZV9Db21tYW5kJywgJ2xvY2FsTWVzc2FnZScpOyAvLyDojrflj5bkvY3nva7kv6Hmga8KICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCd0b2dnbGVCb29sJywgJ3Nob3dMb2NhdGlvbkRpYWxvZycpOwoKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdSZXNldFRpbWUnKTsKICAgIH0sCgogICAgU2V0Q3VycmVudExvY2F0aW9uKGxhdCwgbG5nKSB7CiAgICAgIGNvbnNvbGUubG9nKCdTZXRDdXJyZW50TG9jYXRpb246JywgbGF0LCAnLCcsIGxuZyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2VuZENvbnNvbGVMb2dNc2cnLCAnU2V0IEN1cnJlbnQgTG9jYXRpb246JyArIGxhdCArICcsJyArIGxuZywgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQb2xhclBvaW50QWx0aXR1ZGUnLCBsYXQpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3Jlc2V0TG9jYXRpb24nLCBsYXQsIGxuZyk7CiAgICAgIGNvbnN0IGxvYyA9IHsKICAgICAgICBzaG9ydF9uYW1lOiAnVW5rbm93bicsCiAgICAgICAgY291bnRyeTogJ1Vua25vd24nLAogICAgICAgIGxuZzogbG5nLAogICAgICAgIGxhdDogbGF0LAogICAgICAgIGFsdDogMCwKICAgICAgICBhY2N1cmFjeTogMCwKICAgICAgICBzdHJlZXRfYWRkcmVzczogJycKICAgICAgfQogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEN1cnJlbnRMb2NhdGlvbicsIGxvYyk7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dQb3NpdGlvbkluZm8nLCBsYXQsIGxuZyk7CgogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1Jlc2V0VGltZScpOwogICAgICB9LCAxMDAwKTsKICAgIH0sCiAgICAvLyDnirbmgIHmgaLlpI0KICAgIFN0YXR1c1JlY292ZXJ5KCkgewogICAgICAvLyB0aGlzLnNlbmRNZXNzYWdlKCdTZW5kQ29uc29sZUxvZ01zZycsICfnvZHnu5zov57mjqXmgaLlpI3vvIzmgaLlpI3lvZPliY3nirbmgIEhJywgJ3dhcm5pbmcnKTsKICAgICAgdGhpcy5nZXRRVENsaWVudFZlcnNpb24oKTsgICAgICAgICAgICAgICAgLy8g6I635Y+WUVRDbGllbnTniYjmnKwKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0Uk9JSW5mbycpOyAvLyDojrflj5ZST0nkv6Hmga8KICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnbG9jYWxNZXNzYWdlJyk7IC8vIOiOt+WPluS9jee9ruS/oeaBrwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRNYWluQ2FtZXJhUGFyYW1ldGVycycpOyAvLyDojrflj5bkuLvnm7jmnLrlj4LmlbAKICAgICAgdGhpcy5SZWNhbGlicmF0ZVBvbGFyQXhpcygpOyAvLyDph43mlrDmoKHlh4bmnoHovbQKICAgICAgLy8gdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0U3RhZ2luZ1NvbHZlUmVzdWx0Jyk7IC8vIOiOt+WPluWumuagh+e7k+aenAogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRGb2N1c2VyTG9vcGluZ1N0YXRlJyk7IC8vIOiOt+WPlueEpui3neWZqOW+queOr+eKtuaAgQogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRTdGFnaW5nU2NoZWR1bGVEYXRhJyk7IC8vIOiOt+WPluWumuagh+iuoeWIkuaVsOaNrgogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdnZXRTdGFnaW5nU29sdmVSZXN1bHQnKTsgLy8g6I635Y+W5a6a5qCH57uT5p6cCiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2dldEdQSU9zU3RhdHVzJyk7IC8vIOiOt+WPlkdQSU/nirbmgIEKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnZ2V0U3RhZ2luZ0ltYWdlJyk7IC8vIOiOt+WPluacgOWQjuaLjeaRhOeahOWbvuWDjwoKICAgICAgdGhpcy5kaXNjb25uZWN0VGltZW91dFRyaWdnZXJlZCA9IGZhbHNlOwogICAgfSwKCiAgICBvcGVuUG93ZXJNYW5hZ2VyUGFnZSgpIHsKICAgICAgdGhpcy5pc09wZW5EZXZpY2VQYWdlID0gZmFsc2U7CiAgICAgIHRoaXMuaXNPcGVuUG93ZXJQYWdlID0gdHJ1ZTsKCiAgICAgIHRoaXMuZHJhd2VyXzIgPSB0cnVlOwogICAgfSwKCiAgICBRdWl0VG9NYWluQXBwKCkgewogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdCcm9hZGNhc3RfTXNnJywgJ0Nsb3NlV2ViVmlldycpOwogICAgfSwKCiAgICBzZWxlY3REZXZpY2UoZGV2aWNlKSB7CiAgICAgIGlmICghdGhpcy5oYXZlRGV2aWNlQ29ubmVjdCB8fCAodGhpcy5oYXZlRGV2aWNlQ29ubmVjdCkgfHwgZGV2aWNlLmRyaXZlclR5cGUgPT09ICdUZWxlc2NvcGVzJykgewogICAgICAgIHRoaXMuaXNPcGVuRGV2aWNlUGFnZSA9IHRydWU7CiAgICAgICAgdGhpcy5pc09wZW5Qb3dlclBhZ2UgPSBmYWxzZTsKCiAgICAgICAgaWYgKGRldmljZS5pc2dldCA9PT0gZmFsc2UpIHsKICAgICAgICAgIC8vIGRldmljZS5pc2dldCA9IHRydWU7CiAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdTZWxlY3RJbmRpRHJpdmVyOicgKyBkZXZpY2UudHlwZSArICI6IiArIGRldmljZS5MaXN0TnVtKTsKICAgICAgICAgIHRoaXMuZHJpdmVycyA9IFtdOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5DdXJyZW50RHJpdmVyVHlwZSA9IGRldmljZS5kcml2ZXJUeXBlOwogICAgICAgIHRoaXMuRGV2aWNlSXNDb25uZWN0ZWQgPSBkZXZpY2UuaXNDb25uZWN0ZWQ7CiAgICAgICAgdGhpcy5CYXVkUmF0ZVNlbGVjdGVkID0gZGV2aWNlLkJhdWRSYXRlOwogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gJ1RlbGVzY29wZXMnKSB7CiAgICAgICAgICB0aGlzLkRldmljZUlzQ29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZHJhd2VyXzIgPSB0cnVlOwoKICAgICAgICB0aGlzLlRvQmVDb25uZWN0RGV2aWNlID0gW107CiAgICAgICAgdGhpcy5kZXZpY2VzTGlzdC5mb3JFYWNoKGRldmljZXNMaXN0ID0+IHsKICAgICAgICAgIGlmIChkZXZpY2VzTGlzdC50eXBlID09PSB0aGlzLkN1cnJlbnREcml2ZXJUeXBlKSB7CiAgICAgICAgICAgIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UucHVzaChkZXZpY2VzTGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1RoZSBkZXZpY2UgaXMgbm90IGNvbm5lY3RlZC4nLCAnZXJyb3InKTsKICAgICAgfQoKICAgIH0sCgogICAgQ3VycmVudENvbmZpZ0l0ZW1zKCkgewogICAgICBjb25zb2xlLmxvZygnQ3VycmVudENvbmZpZ0l0ZW1zOiAnLCB0aGlzLkN1cnJlbnREcml2ZXJUeXBlICsgJ0NvbmZpZ0l0ZW1zJyk7CiAgICAgIHN3aXRjaCAodGhpcy5DdXJyZW50RHJpdmVyVHlwZSkgewogICAgICAgIGNhc2UgJ0d1aWRlcic6CiAgICAgICAgICByZXR1cm4gdGhpcy5HdWlkZXJDb25maWdJdGVtczsKICAgICAgICBjYXNlICdNYWluQ2FtZXJhJzoKICAgICAgICAgIHJldHVybiB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtczsKICAgICAgICBjYXNlICdNb3VudCc6CiAgICAgICAgICByZXR1cm4gdGhpcy5Nb3VudENvbmZpZ0l0ZW1zOwogICAgICAgIGNhc2UgJ1RlbGVzY29wZXMnOgogICAgICAgICAgcmV0dXJuIHRoaXMuVGVsZXNjb3Blc0NvbmZpZ0l0ZW1zOwogICAgICAgIGNhc2UgJ0ZvY3VzZXInOgogICAgICAgICAgcmV0dXJuIHRoaXMuRm9jdXNlckNvbmZpZ0l0ZW1zOwogICAgICAgIGNhc2UgJ1BvbGVDYW1lcmEnOgogICAgICAgICAgcmV0dXJuIHRoaXMuUG9sZUNhbWVyYUNvbmZpZ0l0ZW1zOwogICAgICAgIGNhc2UgJ0NGVyc6CiAgICAgICAgICByZXR1cm4gdGhpcy5DRldDb25maWdJdGVtczsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAoKICAgIGNvbmZpcm1Ecml2ZXIoKSB7CiAgICAgIC8vIOehruWumumpseWKqOeahOmAu+i+kQogICAgICBjb25zb2xlLmxvZygiUUhZQ0NEIHwgY29uZmlybURyaXZlcjogIiwgdGhpcy5zZWxlY3RlZERyaXZlcik7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NvbmZpcm0gSW5kaSBEcml2ZXI6JyArIHRoaXMuc2VsZWN0ZWREcml2ZXIsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnQ29uZmlybUluZGlEcml2ZXI6JyArIHRoaXMuc2VsZWN0ZWREcml2ZXIgKyAnOicgKyB0aGlzLkJhdWRSYXRlU2VsZWN0ZWQpOwogICAgICB0aGlzLmNvbmZpcm1Ecml2ZXJUeXBlID0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZTsKICAgICAgdGhpcy5sb2FkaW5nU2VsZWN0RHJpdmVyID0gdHJ1ZTsKCiAgICAgIHRoaXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSB0aGlzLkN1cnJlbnREcml2ZXJUeXBlKSB7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gdGhpcy5zZWxlY3RlZERyaXZlcjsKICAgICAgICAgIGRldmljZS5kcml2ZXJOYW1lID0gdGhpcy5zZWxlY3RlZERyaXZlcjsKICAgICAgICAgIGRldmljZS5CYXVkUmF0ZSA9IHRoaXMuQmF1ZFJhdGVTZWxlY3RlZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyRHJpdmVyKCkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NsZWFySW5kaURyaXZlcicpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDbGVhciBJbmRpIERyaXZlcicsICdpbmZvJyk7CiAgICAgIHRoaXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSB0aGlzLkN1cnJlbnREcml2ZXJUeXBlKSB7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gJyc7CiAgICAgICAgICBkZXZpY2UuZHJpdmVyTmFtZSA9ICcnOwogICAgICAgICAgZGV2aWNlLkJhdWRSYXRlID0gOTYwMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNvbmZpcm1EZXZpY2UoKSB7CiAgICAgIC8vIOehruWumuiuvuWkh+eahOmAu+i+kQogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0NvbmZpcm1JbmRpRGV2aWNlOicgKyB0aGlzLnNlbGVjdGVkRGV2aWNlICsgJzonICsgdGhpcy5zZWxlY3RlZERyaXZlcik7CiAgICAgIC8vIHRoaXMuJGJ1cy4kZW1pdCgnQXBwVXBkYXRlRGV2aWNlcycsIHRoaXMuQ3VycmVudERyaXZlclR5cGUsIHRoaXMuc2VsZWN0ZWREZXZpY2UpOwogICAgICB0aGlzLnVwZGF0ZURldmljZXModGhpcy5DdXJyZW50RHJpdmVyVHlwZSwgdGhpcy5zZWxlY3RlZERldmljZSk7CiAgICB9LAoKICAgIHVwZGF0ZURldmljZXMoZHJpdmVyVHlwZSwgbmV3RGV2aWNlKSB7ICAgIC8vIOaJi+WKqOmAieaLqQogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZHJpdmVyVHlwZSkgewogICAgICAgICAgZGV2aWNlLmRldmljZSA9IG5ld0RldmljZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICB1cGRhdGVEZXZpY2VzXyhMaXN0TnVtLCBuZXdEZXZpY2UpIHsgICAgLy8g5LuO5paH5Lu25a+85YWlCiAgICAgIHRoaXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgaWYgKGRldmljZS5MaXN0TnVtID09PSBMaXN0TnVtKSB7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gbmV3RGV2aWNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMubG9hZGluZ0Nvbm5lY3RBbGxEZXZpY2UgPSBmYWxzZTsKICAgIH0sCgogICAgdXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgRGV2aWNlTmFtZSwgRHJpdmVyTmFtZSwgaXNCaW5kID0gdHJ1ZSkgeyAgICAvLyDov57mjqXmiJDlip8KICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygndXBkYXRlRGV2aWNlc0Nvbm5lY3QnICsgdHlwZSArICcgJyArIERldmljZU5hbWUgKyAnICcgKyBEcml2ZXJOYW1lICsgJyAnICsgaXNCaW5kLCAnaW5mbycpOwogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gdHlwZSkgewogICAgICAgICAgaWYgKGlzQmluZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBEZXZpY2VOYW1lOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGV2aWNlLmRldmljZSA9ICJOb3QgQmluZCBEZXZpY2UiOwogICAgICAgICAgfQogICAgICAgICAgZGV2aWNlLmRyaXZlck5hbWUgPSBEcml2ZXJOYW1lOwogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChEZXZpY2VOYW1lICsgJyBzdWNjZXNzIGNvbm5lY3RlZCcsICdzdWNjZXNzJyk7CiAgICAgIHRoaXMuaGF2ZURldmljZUNvbm5lY3QgPSB0cnVlOwogICAgICB0aGlzLmxvYWRpbmdDb25uZWN0QWxsRGV2aWNlID0gZmFsc2U7CgogICAgICBpZiAodHlwZSA9PT0gJ01haW5DYW1lcmEnKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmEgaXMgQ29ubmVjdGVkLicpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdNb3VudCcpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01vdW50IGlzIENvbm5lY3RlZC4nKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnQ0ZXJykgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMSk7CiAgICAgICAgY29uc29sZS5sb2coJ01vdW50IGlzIENvbm5lY3RlZC4nKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnRm9jdXNlcicpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0ZvY3VzZXJDb25uZWN0ZWQnLCAxKTsKICAgICAgICBjb25zb2xlLmxvZygnRm9jdXNlciBpcyBDb25uZWN0ZWQuJyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ0d1aWRlcicpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDEpOwogICAgICAgIGNvbnNvbGUubG9nKCdHdWlkZXIgaXMgQ29ubmVjdGVkLicpOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVEZXZpY2VzQ29ubmVjdDogJywgdHlwZSwgRGV2aWNlTmFtZSwgRHJpdmVyTmFtZSwgaXNCaW5kKTsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnRGV2aWNlQ29ubmVjdFN1Y2Nlc3MnLCB0eXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc0JpbmQpOwogICAgfSwKICAgIHN0YXJ0Q29ubmVjdEJ0blByZXNzKGV2ZW50KSB7CiAgICAgIC8vIOWmguaenOaYr+inpuaRuOS6i+S7tu+8jOagh+iusOW5tuWkhOeQhgogICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7CiAgICAgICAgdGhpcy5pc1RvdWNoaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcyA9IGZhbHNlOyAvLyDph43nva7plb/mjInmoIforrAKICAgICAgICB0aGlzLkNvbm5lY3RCdG5QcmVzc1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcyA9IHRydWU7IC8vIOagh+iusOS4uumVv+aMiQogICAgICAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuTG9uZ1ByZXNzKCk7CiAgICAgICAgfSwgdGhpcy5Db25uZWN0QnRubG9uZ1ByZXNzVGhyZXNob2xkKTsKICAgICAgfQogICAgICAvLyDlpoLmnpzmmK/pvKDmoIfkuovku7bvvIzkuJTmsqHmnInmraPlnKjov5vooYznmoTop6bmkbjkuovku7bvvIzliJnlpITnkIYKICAgICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlZG93bicgJiYgIXRoaXMuaXNUb3VjaGluZykgewogICAgICAgIHRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzID0gZmFsc2U7IC8vIOmHjee9rumVv+aMieagh+iusAogICAgICAgIHRoaXMuQ29ubmVjdEJ0blByZXNzVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzID0gdHJ1ZTsgLy8g5qCH6K6w5Li66ZW/5oyJCiAgICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RCdG5Mb25nUHJlc3MoKTsKICAgICAgICB9LCB0aGlzLkNvbm5lY3RCdG5sb25nUHJlc3NUaHJlc2hvbGQpOwogICAgICB9CiAgICB9LAogICAgZW5kQ29ubmVjdEJ0blByZXNzKGV2ZW50KSB7CiAgICAgIC8vIOWmguaenOaYr+inpuaRuOS6i+S7tu+8jOWkhOeQhuW5tumHjee9ruagh+iusAogICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3RvdWNoZW5kJykgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLkNvbm5lY3RCdG5QcmVzc1RpbWVyKTsgLy8g5riF6Zmk5a6a5pe25ZmoCiAgICAgICAgaWYgKCF0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcykgewogICAgICAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuQ2xpY2soKTsgLy8g5aaC5p6c5LiN5piv6ZW/5oyJ77yM5YiZ6Kem5Y+R54K55Ye75LqL5Lu2CiAgICAgICAgfQogICAgICAgIHRoaXMuQ29ubmVjdEJ0blByZXNzVGltZXIgPSBudWxsOyAvLyDph43nva7lrprml7blmagKICAgICAgICB0aGlzLmlzVG91Y2hpbmcgPSBmYWxzZTsgLy8g6YeN572u6Kem5pG45qCH6K6wCiAgICAgIH0KICAgICAgLy8g5aaC5p6c5piv6byg5qCH5LqL5Lu277yM5LiU5rKh5pyJ5q2j5Zyo6L+b6KGM55qE6Kem5pG45LqL5Lu277yM5YiZ5aSE55CGCiAgICAgIGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICdtb3VzZXVwJyAmJiAhdGhpcy5pc1RvdWNoaW5nKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuQ29ubmVjdEJ0blByZXNzVGltZXIpOyAvLyDmuIXpmaTlrprml7blmagKICAgICAgICBpZiAoIXRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzKSB7CiAgICAgICAgICB0aGlzLmhhbmRsZUNvbm5lY3RCdG5DbGljaygpOyAvLyDlpoLmnpzkuI3mmK/plb/mjInvvIzliJnop6blj5Hngrnlh7vkuovku7YKICAgICAgICB9CiAgICAgICAgdGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lciA9IG51bGw7IC8vIOmHjee9ruWumuaXtuWZqAogICAgICB9CiAgICB9LAogICAgaGFuZGxlQ29ubmVjdEJ0bkNsaWNrKCkgewogICAgICBpZiAodGhpcy5oYXZlRGV2aWNlQ29ubmVjdCkgewogICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdQbGVhc2UgZGlzY29ubmVjdCBhbGwgZGV2aWNlcyBmaXJzdC4nLCAnZXJyb3InKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLkNvbm5lY3RCdG5DYW5DbGljaykgcmV0dXJuOyAvLyDlpoLmnpzkuI3lj6/ngrnlh7vvvIznm7TmjqXov5Tlm54KICAgICAgdGhpcy5Db25uZWN0QnRuQ2FuQ2xpY2sgPSBmYWxzZTsgLy8g6K6+572u5Li65LiN5Y+v54K55Ye7CiAgICAgIGNvbnNvbGUubG9nKCJDb25uZWN0IEJ1dHRvbiBjbGlja2VkIik7CgogICAgICB0aGlzLmNvbm5lY3RBbGxEZXZpY2UoKTsKCiAgICAgIC8vIOaBouWkjeeCueWHu+adg+mZkAogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLkNvbm5lY3RCdG5DYW5DbGljayA9IHRydWU7CiAgICAgIH0sIDEwMDApOyAvLyAx56eS5ZCO5oGi5aSNCiAgICB9LAogICAgaGFuZGxlQ29ubmVjdEJ0bkxvbmdQcmVzcygpIHsKICAgICAgaWYgKHRoaXMuaGF2ZURldmljZUNvbm5lY3QpIHsKICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnUGxlYXNlIGRpc2Nvbm5lY3QgYWxsIGRldmljZXMgZmlyc3QuJywgJ2Vycm9yJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIOmVv+aMieS6i+S7tueahOWkhOeQhgogICAgICBjb25zb2xlLmxvZygiQ29ubmVjdCBCdXR0b24gbG9uZyBwcmVzc2VkIik7CgogICAgICB0aGlzLmF1dG9Db25uZWN0QWxsRGV2aWNlKCk7CiAgICB9LAogICAgY29ubmVjdEFsbERldmljZSgpIHsKICAgICAgY29uc29sZS5sb2coIlFIWUNDRCB8IGNvbm5lY3RBbGxEZXZpY2UuIik7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0Nvbm5lY3QgQWxsIERldmljZScsICdpbmZvJyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgICAgdGhpcy5sb2FkaW5nQ29ubmVjdEFsbERldmljZSA9IHRydWU7CiAgICB9LAogICAgYXV0b0Nvbm5lY3RBbGxEZXZpY2UoKSB7CiAgICAgIGNvbnNvbGUubG9nKCJRSFlDQ0QgfCBhdXRvQ29ubmVjdEFsbERldmljZS4iKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQXV0byBDb25uZWN0IEFsbCBEZXZpY2UnLCAnaW5mbycpOwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdhdXRvQ29ubmVjdEFsbERldmljZScpOwogICAgICB0aGlzLmxvYWRpbmdDb25uZWN0QWxsRGV2aWNlID0gdHJ1ZTsKICAgIH0sCgogICAgLy8gY29ubmVjdEFsbERldmljZSgpIHsKICAgIC8vICAgY29uc29sZS5sb2coIlFIWUNDRCB8IGNvbm5lY3RBbGxEZXZpY2UuIik7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0Nvbm5lY3QgQWxsIERldmljZScsICdpbmZvJyk7CiAgICAvLyAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgIC8vICAgdGhpcy5sb2FkaW5nQ29ubmVjdEFsbERldmljZSA9IHRydWU7CiAgICAvLyB9LAoKICAgIC8vIGF1dG9Db25uZWN0QWxsRGV2aWNlKCkgewogICAgLy8gICBjb25zb2xlLmxvZygiUUhZQ0NEIHwgYXV0b0Nvbm5lY3RBbGxEZXZpY2UuIik7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0F1dG8gQ29ubmVjdCBBbGwgRGV2aWNlJywgJ2luZm8nKTsKICAgIC8vICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnYXV0b0Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgIC8vICAgdGhpcy5sb2FkaW5nQ29ubmVjdEFsbERldmljZSA9IHRydWU7CiAgICAvLyB9LAoKICAgIC8vIHN0YXJ0Q29ubmVjdEJ0blByZXNzKCkgewogICAgLy8gICB0aGlzLmlzQ29ubmVjdEJ0bkxvbmdQcmVzcyA9IGZhbHNlOyAvLyDph43nva7plb/mjInmoIforrAKICAgIC8vICAgdGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgLy8gICAgIHRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzID0gdHJ1ZTsgLy8g5qCH6K6w5Li66ZW/5oyJCiAgICAvLyAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuTG9uZ1ByZXNzKCk7CiAgICAvLyAgIH0sIHRoaXMuQ29ubmVjdEJ0bmxvbmdQcmVzc1RocmVzaG9sZCk7CiAgICAvLyB9LAogICAgLy8gZW5kQ29ubmVjdEJ0blByZXNzKCkgewogICAgLy8gICBjbGVhclRpbWVvdXQodGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lcik7IC8vIOa4hemZpOWumuaXtuWZqAogICAgLy8gICBpZiAoIXRoaXMuaXNDb25uZWN0QnRuTG9uZ1ByZXNzKSB7CiAgICAvLyAgICAgdGhpcy5oYW5kbGVDb25uZWN0QnRuQ2xpY2soKTsgLy8g5aaC5p6c5LiN5piv6ZW/5oyJ77yM5YiZ6Kem5Y+R54K55Ye75LqL5Lu2CiAgICAvLyAgIH0KICAgIC8vICAgdGhpcy5Db25uZWN0QnRuUHJlc3NUaW1lciA9IG51bGw7IC8vIOmHjee9ruWumuaXtuWZqAogICAgLy8gfSwKICAgIC8vIGhhbmRsZUNvbm5lY3RCdG5DbGljaygpIHsKICAgIC8vICAgaWYgKHRoaXMuaGF2ZURldmljZUNvbm5lY3QpIHsKICAgIC8vICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveCgnUGxlYXNlIGRpc2Nvbm5lY3QgYWxsIGRldmljZXMgZmlyc3QuJywgJ2Vycm9yJyk7CiAgICAvLyAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIGlmICghdGhpcy5Db25uZWN0QnRuQ2FuQ2xpY2spIHJldHVybjsgLy8g5aaC5p6c5LiN5Y+v54K55Ye777yM55u05o6l6L+U5ZueCiAgICAvLyAgIHRoaXMuQ29ubmVjdEJ0bkNhbkNsaWNrID0gZmFsc2U7IC8vIOiuvue9ruS4uuS4jeWPr+eCueWHuwogICAgLy8gICBjb25zb2xlLmxvZygiQ29ubmVjdCBCdXR0b24gY2xpY2tlZCIpOwoKICAgIC8vICAgdGhpcy5jb25uZWN0QWxsRGV2aWNlKCk7CgogICAgLy8gICAvLyDmgaLlpI3ngrnlh7vmnYPpmZAKICAgIC8vICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAvLyAgICAgdGhpcy5Db25uZWN0QnRuQ2FuQ2xpY2sgPSB0cnVlOwogICAgLy8gICB9LCAxMDAwKTsgLy8gMeenkuWQjuaBouWkjQogICAgLy8gfSwKICAgIC8vIGhhbmRsZUNvbm5lY3RCdG5Mb25nUHJlc3MoKSB7CiAgICAvLyAgIGlmICh0aGlzLmhhdmVEZXZpY2VDb25uZWN0KSB7CiAgICAvLyAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ1BsZWFzZSBkaXNjb25uZWN0IGFsbCBkZXZpY2VzIGZpcnN0LicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybjsKICAgIC8vICAgfQogICAgLy8gICAvLyDplb/mjInkuovku7bnmoTlpITnkIYKICAgIC8vICAgY29uc29sZS5sb2coIkNvbm5lY3QgQnV0dG9uIGxvbmcgcHJlc3NlZCIpOwoKICAgIC8vICAgdGhpcy5hdXRvQ29ubmVjdEFsbERldmljZSgpOwogICAgLy8gfSwKCiAgICBkaXNjb25uZWN0QWxsRGV2aWNlKGNvbmZpcm0pIHsKICAgICAgLy8g5qOA5p+l5piv5ZCm5pyJ6K6+5aSH55qEIGlzQ29ubmVjdGVkIOWxnuaAp+S4uiB0cnVlCiAgICAgIC8vIGNvbnN0IGhhc0Nvbm5lY3RlZERldmljZXMgPSB0aGlzLmRldmljZXMuc29tZShkZXZpY2UgPT4gZGV2aWNlLmlzQ29ubmVjdGVkKTsKCiAgICAgIGlmICh0aGlzLmhhdmVEZXZpY2VDb25uZWN0KSB7CiAgICAgICAgaWYgKGNvbmZpcm0gPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdDb25maXJtJywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkaXNjb25uZWN0IGFsbCBkZXZpY2VzPycsICdkaXNjb25uZWN0QWxsRGV2aWNlJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0Rpc2Nvbm5lY3QgQWxsIERldmljZScsICdpbmZvJyk7CiAgICAgICAgICB0aGlzLmhhdmVEZXZpY2VDb25uZWN0ID0gZmFsc2U7CiAgICAgICAgICAvLyB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgICAgLy8gICBkZXZpY2UuaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgIC8vICAgLy8gZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgLy8gfSk7CgogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0NGV0Nvbm5lY3RlZCcsIDApOwogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdGb2N1c2VyQ29ubmVjdGVkJywgMCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDApOwogICAgICAgICAgdGhpcy5jbGFlckRldmljZUxpc3QoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYWxsU2hvd01lc3NhZ2VCb3goJ05vIGRldmljZXMgaGF2ZSBiZWVuIGNvbm5lY3RlZC4nLCAnZXJyb3InKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBjbGFlckRldmljZUxpc3QoKSB7CiAgICAvLyAgIHRoaXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAvLyAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAvLyAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAvLyAgICAgZGV2aWNlLmRldmljZSA9ICcnOyAKICAgIC8vICAgICBkZXZpY2UuZHJpdmVyTmFtZSA9ICcnOwogICAgLy8gICB9KTsKICAgIC8vICAgdGhpcy5Ub0JlQ29ubmVjdERldmljZSA9IFtdOwogICAgLy8gICB0aGlzLmRldmljZXNMaXN0ID0gW107CiAgICAvLyAgIHRoaXMuZHJpdmVycyA9IFtdOwogICAgLy8gICB0aGlzLiRidXMuJGVtaXQoJ2NsYWVyRGV2aWNlQWxsb2NhdGlvbkxpc3QnKTsKICAgIC8vIH0sCgogICAgY2xhZXJEZXZpY2VMaXN0KCkgewogICAgICB0aGlzLmRldmljZXMuZm9yRWFjaChkZXZpY2UgPT4gewogICAgICAgIGRldmljZS5kZXZpY2UgPSAiIjsKICAgICAgICBkZXZpY2UuaXNDb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICBkZXZpY2UuaXNnZXQgPSBmYWxzZTsKICAgICAgICBkZXZpY2UuZHJpdmVyTmFtZSA9ICcnOwogICAgICAgIGRldmljZS5CYXVkUmF0ZSA9IDk2MDA7CiAgICAgIH0pOwogICAgICB0aGlzLlRvQmVDb25uZWN0RGV2aWNlID0gW107CiAgICAgIHRoaXMuZGV2aWNlc0xpc3QgPSBbXTsKICAgICAgdGhpcy5kcml2ZXJzID0gW107CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnY2xhZXJEZXZpY2VBbGxvY2F0aW9uTGlzdCcpOwogICAgfSwKCiAgICBTd2l0Y2hPdXRQdXRQb3dlcihpbmRleCwgaXNQb3dlck9OKSB7CiAgICAgIGlmIChpc1Bvd2VyT04pIHsKICAgICAgICB0aGlzLmRyYXdlcl8yID0gZmFsc2U7CiAgICAgICAgdGhpcy5TaG93Q29uZmlybURpYWxvZygnT3V0cHV0IFBvd2VyOicgKyBpbmRleCwgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byB0dXJuIG9mZiB0aGlzIG91dHB1dCBwb3dlcj8nLCAnU3dpdGNoT3V0UHV0UG93ZXInKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1N3aXRjaE91dFB1dFBvd2VyOicgKyBpbmRleCk7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU3dpdGNoIE91dFB1dFBvd2VyJyArIGluZGV4LCAnaW5mbycpOwogICAgICB9CiAgICB9LAoKICAgIFJlc3RhcnRSYXNwYmVycnlQaSgpIHsKICAgICAgdGhpcy5kcmF3ZXJfMiA9IGZhbHNlOwogICAgICB0aGlzLlNob3dDb25maXJtRGlhbG9nKCdSZXN0YXJ0JywgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXN0YXJ0IHRoZSBSYXNwYmVycnkgUGk/JywgJ1Jlc3RhcnRSYXNwYmVycnlQaScpOwogICAgfSwKCiAgICBTaHV0ZG93blJhc3BiZXJyeVBpKCkgewogICAgICB0aGlzLmRyYXdlcl8yID0gZmFsc2U7CiAgICAgIHRoaXMuU2hvd0NvbmZpcm1EaWFsb2coJ1NodXQgRG93bicsICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gc2h1dCBkb3duIHRoZSBSYXNwYmVycnkgUGk/JywgJ1NodXRkb3duUmFzcGJlcnJ5UGknKTsKICAgIH0sCgogICAgUmV0dXJuQ29ubmVjdGVkRGV2aWNlcygpIHsKICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09ICdNYWluQ2FtZXJhJykgewogICAgICAgICAgaWYgKGRldmljZS5pc0Nvbm5lY3RlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFDb25uZWN0ZWQnLCAxKTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ01haW5DYW1lcmEgaXMgQ29ubmVjdGVkLicpOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdNYWluQ2FtZXJhIGlzIENvbm5lY3RlZC4nLCAnaW5mbycpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09ICdNb3VudCcpIHsKICAgICAgICAgIGlmIChkZXZpY2UuaXNDb25uZWN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudENvbm5lY3RlZCcsIDEpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnTW91bnQgaXMgQ29ubmVjdGVkLicpOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdNb3VudCBpcyBDb25uZWN0ZWQuJywgJ2luZm8nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdsb2FkU2VsZWN0ZWREcml2ZXJMaXN0Jyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2xvYWRCaW5kRGV2aWNlTGlzdCcpOwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdsb2FkQmluZERldmljZVR5cGVMaXN0Jyk7CiAgICB9LAoKICAgIE9wZW5JYW1nZUZvbGRlcigpIHsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdJbWFnZU1hbmFnZXJQYW5lbE9wZW4nKTsKICAgICAgdGhpcy5uYXYgPSBmYWxzZTsKICAgIH0sCgogICAgT3BlbkRlYnVnTG9nKCkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ3RvZ2dsZUlORElEZWJ1Z0RpYWxvZycpOwogICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgfSwKCiAgICBTZW5kQ29uc29sZUxvZ01zZyhtZXNzYWdlLCB0eXBlKSB7CiAgICAgIGlmICh0eXBlID09ICdlcnJvcicpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvcjogJyArIG1lc3NhZ2UpOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2VuZENvbnNvbGVMb2cnLCB0eXBlLCBtZXNzYWdlKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdpbmZvJykgewogICAgICAgIGNvbnNvbGUubG9nKCdJbmZvOiAnICsgbWVzc2FnZSk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZW5kQ29uc29sZUxvZycsIHR5cGUsIG1lc3NhZ2UpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3dhcm5pbmcnKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdXYXJuaW5nOiAnICsgbWVzc2FnZSk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZW5kQ29uc29sZUxvZycsIHR5cGUsIG1lc3NhZ2UpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdEZWJ1ZzogJyArIG1lc3NhZ2UpOwogICAgICB9CiAgICB9LAoKICAgIERldmljZUFsbG9jYXRpb24oKSB7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgndG9nZ2xlRGV2aWNlQWxsb2NhdGlvblBhbmVsJyk7CiAgICAgIHRoaXMubmF2ID0gZmFsc2U7CiAgICB9LAoKICAgIEN1cnJlbnRFeHBUaW1lTGlzdChpbmRleCwgdmFsdWUpIHsKICAgICAgY29uc3QgZXhwVGltZUluZGV4ID0gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ0V4cFRpbWUgWycgKyAoaW5kZXggKyAxKSArICddJyk7CiAgICAgIGlmIChleHBUaW1lSW5kZXggIT09IC0xKSB7IC8vIOehruS/neaJvuWIsOS6huWvueW6lOeahOmFjee9rumhuQogICAgICAgIC8vIOabtOaWsCBFeHBUaW1lMSDphY3nva7pobnnmoTlgLwKICAgICAgICB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtc1tleHBUaW1lSW5kZXhdLnZhbHVlID0gdmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXhwVGltZSBbJyArIGluZGV4ICsgJ10gY29uZmlndXJhdGlvbiBpdGVtIG5vdCBmb3VuZC4nKTsKICAgICAgfQogICAgfSwKCiAgICBDdXJyZW50Q0ZXTGlzdChpbmRleCwgdmFsdWUpIHsKICAgICAgY29uc3QgZXhwVGltZUluZGV4ID0gdGhpcy5DRldDb25maWdJdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnQ0ZXIFsnICsgKGluZGV4ICsgMSkgKyAnXScpOwogICAgICBpZiAoZXhwVGltZUluZGV4ICE9PSAtMSkgeyAvLyDnoa7kv53mib7liLDkuoblr7nlupTnmoTphY3nva7pobkKICAgICAgICAvLyDmm7TmlrAgRXhwVGltZTEg6YWN572u6aG555qE5YC8CiAgICAgICAgdGhpcy5DRldDb25maWdJdGVtc1tleHBUaW1lSW5kZXhdLnZhbHVlID0gdmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcignQ0ZXIFsnICsgaW5kZXggKyAnXSBjb25maWd1cmF0aW9uIGl0ZW0gbm90IGZvdW5kLicpOwogICAgICB9CiAgICB9LAoKICAgIC8vIGNvbmZpcm1Db25maWd1cmF0aW9uKGl0ZW0pIHsKICAgIC8vICAgY29uc29sZS5sb2coYFFIWUNDRCB8IGNvbmZpcm1Db25maWd1cmF0aW9uOiAke2l0ZW0udmFsdWV9YCk7CiAgICAvLyAgIHN3aXRjaCAoaXRlbS5kcml2ZXJUeXBlKSB7CiAgICAvLyAgICAgY2FzZSAnR3VpZGVyJzoKCiAgICAvLyAgICAgY2FzZSAnTWFpbkNhbWVyYSc6CiAgICAvLyAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCArICc6JyArIGl0ZW0udmFsdWUpOwogICAgLy8gICAgIGNhc2UgJ01vdW50JzoKCiAgICAvLyAgICAgY2FzZSAnVGVsZXNjb3BlJzoKCiAgICAvLyAgICAgY2FzZSAnRm9jdXNlcic6CiAgICAvLyAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdChpdGVtLmxhYmVsLCBpdGVtLnZhbHVlKTsgIC8vUmVkQm94IFNpZGUgTGVuZ3RoIChweCkKCiAgICAvLyAgICAgY2FzZSAnUG9sZUNhbWVyYSc6CgogICAgLy8gICAgIGNhc2UgJ0NGVyc6CiAgICAvLyAgICAgICBpZiAoaXRlbS5sYWJlbC5zdGFydHNXaXRoKCdDRlcgWycpKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXdmFsdWUnLCBpdGVtLmxhYmVsKyc6JytpdGVtLnZhbHVlKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGVsc2UgewogICAgLy8gICAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCsnOicraXRlbS52YWx1ZSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgIH0KICAgIC8vIH0sCgogICAgY29uZmlybUNvbmZpZ3VyYXRpb24oTGlzdCkgewogICAgICBMaXN0LmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhpdGVtLmxhYmVsLCBpdGVtLnZhbHVlKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coaXRlbS5sYWJlbCArICc6JyArIGl0ZW0udmFsdWUsICdpbmZvJyk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoaXRlbS5sYWJlbCwgaXRlbS5sYWJlbCArICc6JyArIGl0ZW0udmFsdWUpOwogICAgICAgIH1lbHNlIGlmIChpdGVtLnZhbHVlID09ICcnICYmIGl0ZW0ubGFiZWwgPT09ICdGb2NhbCBMZW5ndGggKG1tKScpewogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhpdGVtLmxhYmVsICsgJ2lzIE5VTEwnLCAnaW5mbycpOwogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KGl0ZW0ubGFiZWwsIGl0ZW0ubGFiZWwrICc6JyApOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KCdDb25maWd1cmF0aW9uIGhhcyBiZWVuIG1vZGlmaWVkIScsICdzdWNjZXNzJyk7CiAgICB9LAoKICAgIGxvYWRBbmREaXNwbGF5SW1hZ2UoaW1hZ2VQYXRoKSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWlkZXJDYW1lcmEtY2FudmFzJyk7CiAgICAgIC8vIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ2FtZXJhLWNhbnZhcycpOwogICAgICBpZiAoY2FudmFzLmdldENvbnRleHQpIHsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTsKCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGltZy53aWR0aDsKICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0OwogICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApOwogICAgICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdzaG93U29sdmVJbWFnZScsIGltZyk7CiAgICAgICAgfTsKCiAgICAgICAgLy8g5re75Yqg6ZSZ6K+v5aSE55CGCiAgICAgICAgaW1nLm9uZXJyb3IgPSAoZXJyb3IpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDliqDovb3lm77lg4/lpLHotKU6ICR7aW1hZ2VQYXRofWApOwogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhg5Yqg6L295Zu+5YOP5aSx6LSlOiAke2ltYWdlUGF0aH1gLCAnZXJyb3InKTsKICAgICAgICB9OwoKICAgICAgICBpbWcuc3JjID0gaW1hZ2VQYXRoOwogICAgICB9CiAgICB9LAoKICAgIEltYWdlR2FpblNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IGRvdWJsZVZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBkb3VibGUg57G75Z6LCgogICAgICBpZiAoc2lnbmFsID09PSAnSW1hZ2VHYWluUicpIHsKICAgICAgICAvLyDlpITnkIYgSW1hZ2VHYWluUiDkv6Hlj7cKICAgICAgICB0aGlzLkltYWdlR2FpblIgPSBkb3VibGVWYWx1ZTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZUdhaW5SIGlzIHNldCB0bzonICsgZG91YmxlVmFsdWUsICdpbmZvJyk7CiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnSW1hZ2VHYWluUjonICsgZG91YmxlVmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHNpZ25hbCA9PT0gJ0ltYWdlR2FpbkInKSB7CiAgICAgICAgLy8g5aSE55CGIEltYWdlR2FpbkIg5L+h5Y+3CiAgICAgICAgdGhpcy5JbWFnZUdhaW5CID0gZG91YmxlVmFsdWU7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnSW1hZ2VHYWluQiBpcyBzZXQgdG86JyArIGRvdWJsZVZhbHVlLCAnaW5mbycpOwogICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ0ltYWdlR2FpbkI6JyArIGRvdWJsZVZhbHVlKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBDYW1lcmFPZmZzZXRTZXQocGF5bG9hZCkgewogICAgLy8gICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgLy8gICBjb25zdCBkb3VibGVWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogZG91YmxlIOexu+WeiwoKICAgIC8vICAgY29uc29sZS5sb2coJ0NhbWVyYU9mZnNldCBpcyBzZXQgdG86JywgZG91YmxlVmFsdWUpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYW1lcmFPZmZzZXQgaXMgc2V0IHRvOicgKyBkb3VibGVWYWx1ZSwgJ2luZm8nKTsKICAgIC8vIH0sCgogICAgSW1hZ2VPZmZzZXRTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBkb3VibGVWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogZG91YmxlIOexu+WeiwoKICAgICAgdGhpcy5JbWFnZU9mZnNldCA9IGRvdWJsZVZhbHVlOwogICAgICBjb25zb2xlLmxvZygnSW1hZ2UgT2Zmc2V0IGlzIHNldCB0bzonLCBkb3VibGVWYWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0ltYWdlIE9mZnNldCBpcyBzZXQgdG86JyArIGRvdWJsZVZhbHVlLCAnaW5mbycpOwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdJbWFnZU9mZnNldDonICsgZG91YmxlVmFsdWUpOwogICAgfSwKCiAgICBCaW5uaW5nU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBJbnQg57G75Z6LCgogICAgICBjb25zb2xlLmxvZygnSW1hZ2UgQmlubmluZyBpcyBzZXQgdG86JywgSW50VmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdJbWFnZSBCaW5uaW5nIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ1NldEJpbm5pbmc6JyArIEludFZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdTZXRCaW5uaW5nTnVtJywgSW50VmFsdWUpOwogICAgfSwKCiAgICBHYWluU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBJbnQg57G75Z6LCgogICAgICBjb25zb2xlLmxvZygnQ2FtZXJhIEdhaW4gaXMgc2V0IHRvOicsIEludFZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FtZXJhIEdhaW4gaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2V0Q2FtZXJhR2FpbjonICsgSW50VmFsdWUpOwogICAgfSwKCiAgICBPZmZzZXRTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsgLy8g5bCG5YC86L2s5o2i5Li6IEludCDnsbvlnosKCiAgICAgIGNvbnNvbGUubG9nKCdDYW1lcmEgT2Zmc2V0IGlzIHNldCB0bzonLCBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhbWVyYSBPZmZzZXQgaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy5zZW5kTWVzc2FnZSgnVnVlX0NvbW1hbmQnLCAnU2V0Q2FtZXJhT2Zmc2V0OicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIEltYWdlQ0ZBU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKCiAgICAgIGlmIChbJ0dSJywgJ0dCJywgJ0JHJywgJ1JHR0InXS5pbmNsdWRlcyh2YWx1ZSkpIHsKICAgICAgICB0aGlzLkltYWdlQ0ZBID0gdmFsdWU7CiAgICAgICAgY29uc29sZS5sb2coJ0ltYWdlQ0ZBIGlzIHNldCB0bzonLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnSW1hZ2VDRkEgaXMgc2V0IHRvOicgKyB2YWx1ZSwgJ2luZm8nKTsKICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdJbWFnZUNGQTonICsgdmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKGBJbnZhbGlkIHZhbHVlIGZvciBJbWFnZUNGQTogJyR7dmFsdWV9Jy4gUGxlYXNlIHNldCBpdCB0byBvbmUgb2YgJ0dSJywgJ0dCJywgJ0JHJywgJ1JHR0InLmApOwogICAgICAgIHRoaXMuY2FsbFNob3dNZXNzYWdlQm94KGBJbnZhbGlkIHZhbHVlIGZvciBJbWFnZUNGQTogJyR7dmFsdWV9Jy4gUGxlYXNlIHNldCBpdCB0byBvbmUgb2YgJ0dSJywgJ0dCJywgJ0JHJywgJ1JHR0InLmAsICdlcnJvcicpOwogICAgICB9CiAgICB9LAoKICAgIENhbWVyYVRlbXBlcmF0dXJlU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7IC8vIOWwhuWAvOi9rOaNouS4uiBJbnQg57G75Z6LCgogICAgICBjb25zb2xlLmxvZygnQ2FtZXJhIFRlbXBlcmF0dXJlIGlzIHNldCB0bzonLCBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhbWVyYSBUZW1wZXJhdHVyZSBpcyBzZXQgdG86JyArIEludFZhbHVlLCAnaW5mbycpOwogICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdTZXRDYW1lcmFUZW1wZXJhdHVyZTonICsgSW50VmFsdWUpOwogICAgfSwKCiAgICBGb2NhbExlbmd0aFNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIAogICAgICBmb3IgKGNvbnN0IGRldmljZSBvZiB0aGlzLmRldmljZXMpIHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09ICdUZWxlc2NvcGVzJykgewogICAgICAgICAgCiAgICAgICAgICBpZiAodmFsdWUgPT09ICcnIHx8IHZhbHVlID09PSBOYU4pIHsKICAgICAgICAgICAgZGV2aWNlLmRldmljZSA9ICcnOwogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGb2NhbCBMZW5ndGggaXMgc2V0IHRvOicgKyAwLCAnaW5mbycpOwogICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ1NldEZvY2FsTGVuZ3RoTnVtJywgJycpOwogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOyAvLyDlsIblgLzovazmjaLkuLogSW50IOexu+WeiwogICAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gdmFsdWUgKyAnIG1tJzsKICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRm9jYWwgTGVuZ3RoIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnU2V0Rm9jYWxMZW5ndGhOdW0nLCBJbnRWYWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgoKICAgIH0sCgogICAgR3VpZGVyRm9jYWxMZW5ndGhTZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsgLy8g5bCG5YC86L2s5o2i5Li6IEludCDnsbvlnosKCiAgICAgIAogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdHdWlkZXIgRm9jYWwgTGVuZ3RoIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnR3VpZGVyRm9jYWxMZW5ndGg6JyArIEludFZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzYXZlVG9Db25maWdGaWxlOkd1aWRlckZvY2FsTGVuZ3RoOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIE11bHRpU3Rhckd1aWRlclNldChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ011bHRpIFN0YXIgR3VpZGVyIGlzIHNldCB0bzonICsgdmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnTXVsdGlTdGFyR3VpZGVyOicgKyB2YWx1ZSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2F2ZVRvQ29uZmlnRmlsZTpNdWx0aVN0YXJHdWlkZXI6JyArIHZhbHVlKTsKICAgIH0sCgogICAgR3VpZGVyUGl4ZWxTaXplU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgZG91YmxlVmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnR3VpZGVyIFBpeGVsIHNpemUgaXMgc2V0IHRvOicgKyBkb3VibGVWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdHdWlkZXJQaXhlbFNpemU6JyArIGRvdWJsZVZhbHVlKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzYXZlVG9Db25maWdGaWxlOkd1aWRlclBpeGVsU2l6ZTonICsgZG91YmxlVmFsdWUpOwogICAgfSwKCiAgICBHdWlkZXJHYWluU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0d1aWRlciBHYWluIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnR3VpZGVyR2FpbjonICsgSW50VmFsdWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NhdmVUb0NvbmZpZ0ZpbGU6R3VpZGVyR2FpbjonICsgSW50VmFsdWUpOwogICAgfSwKCiAgICBDYWxpYnJhdGlvbkR1cmF0aW9uU2V0KHBheWxvYWQpIHsKICAgICAgY29uc3QgW3NpZ25hbCwgdmFsdWVdID0gcGF5bG9hZC5zcGxpdCgnOicpOyAvLyDmi4bliIbkv6Hlj7flkozlgLwKICAgICAgY29uc3QgSW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0d1aWRlciBDYWxpYnJhdGlvbiBzdGVwIGlzIHNldCB0bzonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnQ2FsaWJyYXRpb25EdXJhdGlvbjonICsgSW50VmFsdWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NhdmVUb0NvbmZpZ0ZpbGU6Q2FsaWJyYXRpb25EdXJhdGlvbjonICsgSW50VmFsdWUpOwogICAgfSwKCiAgICBSYUFnZ3Jlc3Npb25TZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnUmEgQWdncmVzc2lvbiBpcyBzZXQgdG86JyArIEludFZhbHVlLCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1JhQWdncmVzc2lvbjonICsgSW50VmFsdWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NhdmVUb0NvbmZpZ0ZpbGU6UmFBZ2dyZXNzaW9uOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIERlY0FnZ3Jlc3Npb25TZXQocGF5bG9hZCkgewogICAgICBjb25zdCBbc2lnbmFsLCB2YWx1ZV0gPSBwYXlsb2FkLnNwbGl0KCc6Jyk7IC8vIOaLhuWIhuS/oeWPt+WSjOWAvAogICAgICBjb25zdCBJbnRWYWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRGVjIEFnZ3Jlc3Npb24gaXMgc2V0IHRvOicgKyBJbnRWYWx1ZSwgJ2luZm8nKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdEZWNBZ2dyZXNzaW9uOicgKyBJbnRWYWx1ZSk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnc2F2ZVRvQ29uZmlnRmlsZTpEZWNBZ2dyZXNzaW9uOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIFN5bmNGb2N1c2VyU3RlcChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IFtzaWduYWwsIHZhbHVlXSA9IHBheWxvYWQuc3BsaXQoJzonKTsgLy8g5ouG5YiG5L+h5Y+35ZKM5YC8CiAgICAgIGNvbnN0IEludFZhbHVlID0gcGFyc2VJbnQodmFsdWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTeW5jIEZvY3VzZXIgU3RlcDonICsgSW50VmFsdWUsICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnU3luY0ZvY3VzZXJTdGVwOicgKyBJbnRWYWx1ZSk7CiAgICB9LAoKICAgIGFzeW5jIHJlYWRCaW5GaWxlKGZpbGVOYW1lLCByZXRyeUNvdW50ID0gMSkgewogICAgICB3aGlsZSAodGhpcy5pc0Rvd25sb2FkaW5nSW1hZ2UpIHsKICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpOwogICAgICAgIGlmICghdGhpcy5pc1dhaXRpbmdMb2dnZWQpIHsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBpcyBhbHJlYWR5IGJlaW5nIHByb2Nlc3NlZC4gUGxlYXNlIHdhaXQgZm9yIHRoZSBwcmV2aW91cyBwcm9jZXNzIHRvIGNvbXBsZXRlLicsICd3YXJuaW5nJyk7CiAgICAgICAgICB0aGlzLmlzV2FpdGluZ0xvZ2dlZCA9IHRydWU7IC8vIOehruS/neWPquiusOW9leS4gOasoeetieW+heS/oeaBrwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlTmFtZSA9PT0gZmlsZU5hbWUpIHsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UoJyArIGZpbGVOYW1lICsgJykgaXMgYWxyZWFkeSBwcm9jZXNzZWQuJywgJ2luZm8nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gdHJ1ZTsKICAgICAgdGhpcy5pc1dhaXRpbmdMb2dnZWQgPSBmYWxzZTsgLy8g6YeN572u562J5b6F5pel5b+X5qCH5b+XCiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFJlYWQgaW1hZ2UoJyArIGZpbGVOYW1lICsgJykgZGF0YSBzdGFydC4nLCAnaW5mbycpOwoKICAgICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgdHJ5IHsKICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlsZU5hbWUgaXMgdmFsaWQKICAgICAgICBpZiAoIWZpbGVOYW1lIHx8IHR5cGVvZiBmaWxlTmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBmaWxlIG5hbWUgcHJvdmlkZWQnKTsKICAgICAgICB9CgogICAgICAgIC8vIEZldGNoIHdpdGggcHJvZ3Jlc3MgdHJhY2tpbmcKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGVOYW1lLCB7IGNhY2hlOiAnbm8tc3RvcmUnIH0pOwogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rLiBTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWApOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgY29udGVudExlbmd0aCA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LWxlbmd0aCcpOwogICAgICAgIGlmICghY29udGVudExlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb250ZW50LUxlbmd0aCBoZWFkZXIgaXMgbWlzc2luZycpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdG90YWwgPSBwYXJzZUludChjb250ZW50TGVuZ3RoLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKHRvdGFsKSB8fCB0b3RhbCA8PSAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY29udGVudC1sZW5ndGggdmFsdWUnKTsKICAgICAgICB9CgogICAgICAgIGxldCBsb2FkZWQgPSAwOwoKICAgICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpOwogICAgICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBSZWFkYWJsZVN0cmVhbSh7CiAgICAgICAgICBzdGFydDogKGNvbnRyb2xsZXIpID0+IHsKICAgICAgICAgICAgY29uc3QgcHVzaCA9ICgpID0+IHsKICAgICAgICAgICAgICByZWFkZXIucmVhZCgpLnRoZW4oKHsgZG9uZSwgdmFsdWUgfSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICAgICAgY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2FkZWQgKz0gdmFsdWUuYnl0ZUxlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHBlcmNlbnQgPSAobG9hZGVkIC8gdG90YWwpICogMTAwOwogICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQocGVyY2VudCkgJSAxMCA9PT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKGBQcm9ncmVzczogJHtNYXRoLnJvdW5kKHBlcmNlbnQpfSVgLCAnaW5mbycpOwogICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKE1hdGgucm91bmQocGVyY2VudCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhg5b2T5YmN6L+b5bqmOiAke01hdGgucm91bmQocGVyY2VudCl9JWAsICdpbmZvJyk7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUodmFsdWUpOwogICAgICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N0cmVhbSByZWFkaW5nIGVycm9yOicsIGVycm9yKTsKICAgICAgICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1N0cmVhbSByZWFkaW5nIGVycm9yOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKGVycm9yKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHVzaCgpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBuZXdSZXNwb25zZSA9IG5ldyBSZXNwb25zZShzdHJlYW0pOwogICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBuZXdSZXNwb25zZS5ibG9iKCk7CgogICAgICAgIC8vIEZpbGVSZWFkZXIgd2l0aCBwcm9ncmVzcyB0cmFja2luZwogICAgICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gKCkgPT4gewogICAgICAgICAgdGhpcy5JbWFnZUFycmF5QnVmZmVyID0gZmlsZVJlYWRlci5yZXN1bHQ7CgogICAgICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFJlYWQgaW1hZ2UgZGF0YSBlbmQ6ICcgKyBlbGFwc2VkVGltZSArICcgbXMnLCAnaW5mbycpOwogICAgICAgICAgaWYgKCF0aGlzLmlzUG9sYXJBeGlzTW9kZSkgewogICAgICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChgUmVhZCBpbWFnZSBkYXRhIGVuZDogJyR7ZWxhcHNlZFRpbWV9JyBtcy5gLCAnaW5mbycpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5pc0Rvd25sb2FkaW5nSW1hZ2VOYW1lID0gZmlsZU5hbWU7CiAgICAgICAgICB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIpOwogICAgICAgIH07CgogICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcignRmlsZVJlYWRlciBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGaWxlUmVhZGVyIGVycm9yOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7CiAgICAgICAgfTsKCiAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHdpdGggdGhlIGZldGNoIG9wZXJhdGlvbjonLCBlcnJvcik7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZSBmZXRjaCBvcGVyYXRpb246ICcgKyBlcnJvci5tZXNzYWdlLCAnZXJyb3InKTsKCiAgICAgICAgLy8g5LiL6L295aSx6LSl77yM6YeN6K+VCiAgICAgICAgaWYgKHJldHJ5Q291bnQgPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnUmV0cnlpbmcgZG93bmxvYWQuLi4nKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1JldHJ5aW5nIGRvd25sb2FkLi4uJywgJ3dhcm5pbmcnKTsKICAgICAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKDEwMCk7CiAgICAgICAgICBhd2FpdCB0aGlzLnJlYWRCaW5GaWxlKGZpbGVOYW1lLCByZXRyeUNvdW50IC0gMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ01heCByZXRyaWVzIHJlYWNoZWQuIERvd25sb2FkIGZhaWxlZC4nLCAnZXJyb3InKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5pc0Rvd25sb2FkaW5nSW1hZ2UgPSBmYWxzZTsgLy8g56Gu5L+d5Zyo5Lu75L2V5oOF5Ya15LiL6YO96YeN572u54q25oCBCiAgICAgIH0KICAgIH0sCiAgICAvLyBhc3luYyByZWFkQmluRmlsZShmaWxlTmFtZSwgcmV0cnlDb3VudCA9IDEpIHsKICAgIC8vICAgd2hpbGUgKHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlKSB7CiAgICAvLyAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTsKICAgIC8vICAgICBpZiAoIXRoaXMuaXNXYWl0aW5nTG9nZ2VkKSB7CiAgICAvLyAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UgaXMgYWxyZWFkeSBiZWluZyBwcm9jZXNzZWQuIFBsZWFzZSB3YWl0IGZvciB0aGUgcHJldmlvdXMgcHJvY2VzcyB0byBjb21wbGV0ZS4nLCAnd2FybmluZycpOwogICAgLy8gICAgICAgdGhpcy5pc1dhaXRpbmdMb2dnZWQgPSB0cnVlOyAvLyDnoa7kv53lj6rorrDlvZXkuIDmrKHnrYnlvoXkv6Hmga8KICAgIC8vICAgICB9CiAgICAvLyAgIH0KCiAgICAvLyAgIGlmICh0aGlzLmlzRG93bmxvYWRpbmdJbWFnZU5hbWUgPT09IGZpbGVOYW1lKSB7CiAgICAvLyAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGlzIGFscmVhZHkgcHJvY2Vzc2VkLicsICdpbmZvJyk7CiAgICAvLyAgICAgcmV0dXJuOwogICAgLy8gICB9CgogICAgLy8gICB0aGlzLmlzRG93bmxvYWRpbmdJbWFnZSA9IHRydWU7CiAgICAvLyAgIHRoaXMuaXNXYWl0aW5nTG9nZ2VkID0gZmFsc2U7IC8vIOmHjee9ruetieW+heaXpeW/l+agh+W/lwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBSZWFkIGltYWdlKCcgKyBmaWxlTmFtZSArICcpIGRhdGEgc3RhcnQuJywgJ2luZm8nKTsKCiAgICAvLyAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRyeSB7CiAgICAvLyAgICAgLy8gRmV0Y2ggd2l0aCBwcm9ncmVzcyB0cmFja2luZwogICAgLy8gICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZU5hbWUpOwogICAgLy8gICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgIC8vICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJyk7CiAgICAvLyAgICAgfQoKICAgIC8vICAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJyk7CiAgICAvLyAgICAgaWYgKCFjb250ZW50TGVuZ3RoKSB7CiAgICAvLyAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRlbnQtTGVuZ3RoIGhlYWRlciBpcyBtaXNzaW5nJyk7CiAgICAvLyAgICAgfQoKICAgIC8vICAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvbnRlbnRMZW5ndGgsIDEwKTsKICAgIC8vICAgICBsZXQgbG9hZGVkID0gMDsKCiAgICAvLyAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKICAgIC8vICAgICBjb25zdCBzdHJlYW0gPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgLy8gICAgICAgc3RhcnQ6IChjb250cm9sbGVyKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbnN0IHB1c2ggPSAoKSA9PiB7CiAgICAvLyAgICAgICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKCh7IGRvbmUsIHZhbHVlIH0pID0+IHsKICAgIC8vICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAvLyAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTsKICAgIC8vICAgICAgICAgICAgICAgcmV0dXJuOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAvLyAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gKGxvYWRlZCAvIHRvdGFsKSAqIDEwMDsKICAgIC8vICAgICAgICAgICAgIGlmIChNYXRoLnJvdW5kKHBlcmNlbnQpICUgMTAgPT09IDApIHsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZyhgUHJvZ3Jlc3M6ICR7TWF0aC5yb3VuZChwZXJjZW50KX0lYCwnaW5mbycpOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKE1hdGgucm91bmQocGVyY2VudCkpOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHZhbHVlKTsKICAgIC8vICAgICAgICAgICAgIHB1c2goKTsKICAgIC8vICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTdHJlYW0gcmVhZGluZyBlcnJvcjonLCBlcnJvcik7CiAgICAvLyAgICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKGVycm9yKTsKICAgIC8vICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgfTsKICAgIC8vICAgICAgICAgcHVzaCgpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0pOwoKICAgIC8vICAgICBjb25zdCBuZXdSZXNwb25zZSA9IG5ldyBSZXNwb25zZShzdHJlYW0pOwogICAgLy8gICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBuZXdSZXNwb25zZS5ibG9iKCk7CgogICAgLy8gICAgIC8vIEZpbGVSZWFkZXIgd2l0aCBwcm9ncmVzcyB0cmFja2luZwogICAgLy8gICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgLy8gICAgIGZpbGVSZWFkZXIub25sb2FkID0gKCkgPT4gewogICAgLy8gICAgICAgdGhpcy5JbWFnZUFycmF5QnVmZmVyID0gZmlsZVJlYWRlci5yZXN1bHQ7CgogICAgLy8gICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFJlYWQgaW1hZ2UgZGF0YSBlbmQ6ICcgKyBlbGFwc2VkVGltZSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAgICAgaWYgKCF0aGlzLmlzUG9sYXJBeGlzTW9kZSkgewogICAgLy8gICAgICAgICB0aGlzLmNhbGxTaG93TWVzc2FnZUJveChgUmVhZCBpbWFnZSBkYXRhIGVuZDogJyR7ZWxhcHNlZFRpbWV9JyBtcy5gLCAnaW5mbycpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgdGhpcy5pc0Rvd25sb2FkaW5nSW1hZ2VOYW1lID0gZmlsZU5hbWU7CiAgICAvLyAgICAgICB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIpOwogICAgLy8gICAgIH07CgogICAgLy8gICAgIGZpbGVSZWFkZXIub25lcnJvciA9IChlcnJvcikgPT4gewogICAgLy8gICAgICAgY29uc29sZS5lcnJvcignRmlsZVJlYWRlciBlcnJvcjonLCBlcnJvcik7CiAgICAvLyAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdGaWxlUmVhZGVyIGVycm9yOicgKyBlcnJvciwgJ2Vycm9yJyk7CiAgICAvLyAgICAgfTsKCiAgICAvLyAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTsKICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIC8vICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHdpdGggdGhlIGZldGNoIG9wZXJhdGlvbjonLCBlcnJvcik7CiAgICAvLyAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlcmUgd2FzIGEgcHJvYmxlbSB3aXRoIHRoZSBmZXRjaCBvcGVyYXRpb246JyArIGVycm9yLCAnZXJyb3InKTsKCiAgICAvLyAgICAgLy8g5LiL6L295aSx6LSl77yM6YeN6K+VCiAgICAvLyAgICAgaWYgKHJldHJ5Q291bnQgPiAwKSB7CiAgICAvLyAgICAgICBjb25zb2xlLmxvZygnUmV0cnlpbmcgZG93bmxvYWQuLi4nKTsKICAgIC8vICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1JldHJ5aW5nIGRvd25sb2FkLi4uJywgJ3dhcm5pbmcnKTsKICAgIC8vICAgICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7CiAgICAvLyAgICAgICB0aGlzLnVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKDEwMCk7CiAgICAvLyAgICAgICBhd2FpdCB0aGlzLnJlYWRCaW5GaWxlKGZpbGVOYW1lLCByZXRyeUNvdW50IC0gMSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9IGZpbmFsbHkgewogICAgLy8gICAgIHRoaXMuaXNEb3dubG9hZGluZ0ltYWdlID0gZmFsc2U7IC8vIOehruS/neWcqOS7u+S9leaDheWGteS4i+mDvemHjee9rueKtuaAgQogICAgLy8gICB9CiAgICAvLyB9LAoKICAgIHVwZGF0ZUNhcHR1cmVJbWFnZVByb2dyZXNzKG51bSkgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dDYXB0dXJlSW1hZ2VQcm9ncmVzcycsIG51bSk7CiAgICB9LAoKICAgIHNldEltYWdlUHJvcG9ydGlvbih2YWx1ZSkgewogICAgICB0aGlzLkltYWdlUHJvcG9ydGlvbiA9IHZhbHVlOwogICAgfSwKCiAgICAvLyBjaGVja0ltYWdlRGF0YShpbWcpIHsKICAgIC8vICAgLy8g5qOA5p+l5piv5ZCm5Li6IGN2Lk1hdCDnsbvlnosKICAgIC8vICAgaWYgKCEoaW1nIGluc3RhbmNlb2YgY3YuTWF0KSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBpcyBub3QgYSB2YWxpZCBjdi5NYXQgb2JqZWN0LicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5piv5ZCm5Li656m6CiAgICAvLyAgIGlmIChpbWcuZW1wdHkoKSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBpcyBlbXB0eS4nLCAnZXJyb3InKTsKICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAvLyAgIH0KCiAgICAvLyAgIC8vIOajgOafpeWbvuWDj+a3seW6puaYr+WQpuS4uiA4IOS9jeaIliAxNiDkvY0KICAgIC8vICAgY29uc3QgZGVwdGggPSBpbWcudHlwZSgpICYgY3YuQ1ZfTUFUX0RFUFRIX01BU0s7CiAgICAvLyAgIGlmIChkZXB0aCAhPT0gY3YuQ1ZfOFUgJiYgZGVwdGggIT09IGN2LkNWXzE2VSkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBkZXB0aCBpcyBub3QgOC1iaXQgb3IgMTYtYml0LicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5bC65a+45piv5ZCm5ZCI55CGCiAgICAvLyAgIGlmIChpbWcucm93cyA8PSAwIHx8IGltZy5jb2xzIDw9IDApIHsKICAgIC8vICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdUaGUgaW1hZ2UgZGltZW5zaW9ucyBhcmUgbm90IHZhbGlkLicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQoKICAgIC8vICAgLy8g5qOA5p+l5Zu+5YOP5pWw5o2u5piv5ZCm6LaF5Ye66IyD5Zu05oiW5YWo5Li6MAogICAgLy8gICBjb25zdCBkYXRhID0gaW1nLmRhdGE7CiAgICAvLyAgIGxldCBpc0FsbFplcm8gPSB0cnVlOwogICAgLy8gICBjb25zdCBtYXhWYWx1ZSA9IGRlcHRoID09PSBjdi5DVl84VSA/IDI1NSA6IDY1NTM1OwoKICAgIC8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICAgaWYgKGRhdGFbaV0gPCAwIHx8IGRhdGFbaV0gPiBtYXhWYWx1ZSkgewogICAgLy8gICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnVGhlIGltYWdlIGRhdGEgY29udGFpbnMgb3V0LW9mLXJhbmdlIHZhbHVlcy4nLCAnZXJyb3InKTsKICAgIC8vICAgICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgICB9CiAgICAvLyAgICAgaWYgKGRhdGFbaV0gIT09IDApIHsKICAgIC8vICAgICAgIGlzQWxsWmVybyA9IGZhbHNlOwogICAgLy8gICAgIH0KICAgIC8vICAgfQoKICAgIC8vICAgaWYgKGlzQWxsWmVybykgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1RoZSBpbWFnZSBkYXRhIGlzIGFsbCB6ZXJvLicsICdlcnJvcicpOwogICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgIC8vICAgfQogICAgLy8gICByZXR1cm4gdHJ1ZTsKICAgIC8vIH0sCgoKICAgIHByb2Nlc3NJbWFnZShpbWdBcnJheSkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHRvdGFsU3RhcnRUaW1lID0gbmV3IERhdGUoKTsgLy8g5oC75byA5aeL5pe26Ze0CgogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFByb2Nlc3MgaW1hZ2UgZGF0YSBzdGFydC4nLCAnaW5mbycpOwogICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CgogICAgICAgIGNvbnN0IHVpbnQxNkFycmF5ID0gbmV3IFVpbnQxNkFycmF5KGltZ0FycmF5KTsKCiAgICAgICAgLy8g6K6+572u55S75biD5a696auY5bi46YePCiAgICAgICAgY29uc3QgY2FudmFzV2lkdGggPSBwYXJzZUludCh0aGlzLm1haW5DYW1lcmFTaXplWCk7CiAgICAgICAgY29uc3QgY2FudmFzSGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5tYWluQ2FtZXJhU2l6ZVkpOwoKICAgICAgICAvLyDojrflj5bljp/lp4vnlLvluIPlkozkv67mlLnlkI7nmoTnlLvluIPku6Xlj4rlr7nlupTkuIrkuIvmlocKICAgICAgICBjb25zdCBtb2RpZmllZENhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ2FtZXJhLWNhbnZhcycpOwogICAgICAgIGNvbnN0IG1vZGlmaWVkQ3R4ID0gbW9kaWZpZWRDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgbW9kaWZpZWRDdHguY2xlYXJSZWN0KDAsIDAsIG1vZGlmaWVkQ2FudmFzLndpZHRoLCBtb2RpZmllZENhbnZhcy5oZWlnaHQpOwoKICAgICAgICBtb2RpZmllZENhbnZhcy53aWR0aCA9IGNhbnZhc1dpZHRoOwogICAgICAgIG1vZGlmaWVkQ2FudmFzLmhlaWdodCA9IGNhbnZhc0hlaWdodDsKCiAgICAgICAgbGV0IG1hdCA9IG5ldyBjdi5NYXQoY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgY3YuQ1ZfMTZVQzEpOwogICAgICAgIG1hdC5kYXRhMTZVLnNldCh1aW50MTZBcnJheSk7CgogICAgICAgIGNvbnN0IG1hdEVuZFRpbWUgPSBuZXcgRGF0ZSgpOyAvLyBtYXQg57uT5p2f5pe26Ze0CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FwdHVyZVRlc3RUaW1lIHwgTWF0IGNyZWF0aW9uIHRpbWU6ICcgKyAobWF0RW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgICAvLyDnlKjmiLfoh6rlrprkuYnlj4LmlbAKICAgICAgICBsZXQgZ2FpblIgPSB0aGlzLkltYWdlR2FpblI7CiAgICAgICAgbGV0IGdhaW5CID0gdGhpcy5JbWFnZUdhaW5COwogICAgICAgIGxldCBvZmZzZXQgPSB0aGlzLkltYWdlT2Zmc2V0OwogICAgICAgIGxldCBDRkEgPSB0aGlzLkltYWdlQ0ZBOwogICAgICAgIGxldCBtb2RlID0gMTsKCiAgICAgICAgLy8g5Y+C5pWwCiAgICAgICAgbGV0IEIgPSAwOwogICAgICAgIGxldCBXID0gNjU1MzU7CiAgICAgICAgbGV0IGN2bW9kZSA9IDA7CgogICAgICAgIGNvbnN0IHsgYmxhY2tMZXZlbCwgd2hpdGVMZXZlbCB9ID0gdGhpcy5HZXRBdXRvU3RyZXRjaCh1aW50MTZBcnJheSwgbW9kZSk7CiAgICAgICAgQiA9IGJsYWNrTGV2ZWw7CiAgICAgICAgVyA9IHdoaXRlTGV2ZWw7CiAgICAgICAgY29uc3QgR2V0QXV0b1N0cmV0Y2hFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gR2V0QXV0b1N0cmV0Y2gg57uT5p2f5pe26Ze0CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FwdHVyZVRlc3RUaW1lIHwgR2V0QXV0b1N0cmV0Y2ggdGltZTogJyArIChHZXRBdXRvU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpIC0gbWF0RW5kVGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAgIC8vIOagueaNrkNGQeiuvue9ruminOiJsui9rOaNouaooeW8jwogICAgICAgIGlmIChDRkEgPT09ICdHUicpIHsKICAgICAgICAgIGN2bW9kZSA9IGN2LkNPTE9SX0JheWVyR1IyUkdCQTsKICAgICAgICB9IGVsc2UgaWYgKENGQSA9PT0gJ0dCJykgewogICAgICAgICAgY3Ztb2RlID0gY3YuQ09MT1JfQmF5ZXJHQjJSR0JBOwogICAgICAgIH0gZWxzZSBpZiAoQ0ZBID09PSAnQkcnKSB7CiAgICAgICAgICBjdm1vZGUgPSBjdi5DT0xPUl9CYXllckJHMlJHQkE7CiAgICAgICAgfSBlbHNlIGlmIChDRkEgPT09ICdSR0dCJykgewogICAgICAgICAgY3Ztb2RlID0gY3YuQ09MT1JfQmF5ZXJSRzJSR0JBOwogICAgICAgIH0KCiAgICAgICAgLy8g5a+555uu5qCH5Zu+5YOP6L+b6KGM6aKc6Imy6L2s5o2iCiAgICAgICAgbGV0IGRzdCA9IG5ldyBjdi5NYXQoKTsKICAgICAgICB0cnkgewogICAgICAgICAgY3YuY3Z0Q29sb3IobWF0LCBkc3QsIGN2bW9kZSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoJ2N2dENvbG9yIOWHuumUmScsICdjdnRDb2xvcicsIGVycm9yKTsKICAgICAgICAgIG1hdC5kZWxldGUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGN2dENvbG9yRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIGN2dENvbG9yIOe7k+adn+aXtumXtAogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IGN2dENvbG9yIHRpbWU6ICcgKyAoY3Z0Q29sb3JFbmRUaW1lLmdldFRpbWUoKSAtIEdldEF1dG9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAgIG1hdC5kZWxldGUoKTsKCiAgICAgICAgLy8g6LCD5pW05Zu+5YOP5aSn5bCPCiAgICAgICAgLy8gY3YucmVzaXplKGRzdCwgcmVzaXplSW1nLCBuZXcgY3YuU2l6ZSh0aGlzLkNhbnZhc1dpZHRoLCB0aGlzLkNhbnZhc0hlaWdodCksIDAsIDAsIGN2LklOVEVSX0xJTkVBUik7CiAgICAgICAgLy8gZHN0LmRlbGV0ZSgpOwoKICAgICAgICAvLyBsZXQgb3JpZ2luYWxJbWc4ID0gdGhpcy5CaXQxNlRvOF9TdHJldGNoKHJlc2l6ZUltZywgQiwgVyk7CiAgICAgICAgLy8gcmVzaXplSW1nLmRlbGV0ZSgpOwoKICAgICAgICBsZXQgcmVzaXplSW1nID0gbmV3IGN2Lk1hdCgpOyAvLyDnlKjmnaXlrZjlgqjosIPmlbTlkI7nmoTlm77lg48KICAgICAgICBpZiAodGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgICAgICAgIC8vIOiwg+aVtOWbvuWDj+Wkp+WwjwogICAgICAgICAgY3YucmVzaXplKGRzdCwgcmVzaXplSW1nLCBuZXcgY3YuU2l6ZSh0aGlzLkNhbnZhc1dpZHRoLCB0aGlzLkNhbnZhc0hlaWdodCksIDAsIDAsIGN2LklOVEVSX0xJTkVBUik7CiAgICAgICAgICBkc3QuZGVsZXRlKCk7CgogICAgICAgICAgbGV0IG9yaWdpbmFsSW1nOCA9IHRoaXMuQml0MTZUbzhfU3RyZXRjaChyZXNpemVJbWcsIEIsIFcpOwogICAgICAgICAgcmVzaXplSW1nLmRlbGV0ZSgpOwoKICAgICAgICAgIGNvbnN0IEJpdDE2VG84X1N0cmV0Y2hFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gQml0MTZUbzhfU3RyZXRjaCDnu5PmnZ/ml7bpl7QKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IEJpdDE2VG84X1N0cmV0Y2ggdGltZTogJyArIChCaXQxNlRvOF9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkgLSBHZXRBdXRvU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgICAgIGxldCB0YXJnZXRJbWc4ID0gdGhpcy5JbWFnZVNvZnRBV0Iob3JpZ2luYWxJbWc4LCBnYWluUiwgZ2FpbkIsIG9mZnNldCk7CiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dTb2x2ZUltYWdlJywgdGFyZ2V0SW1nOCk7CgogICAgICAgICAgY29uc3QgSW1hZ2VTb2Z0QVdCRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIEltYWdlU29mdEFXQiDnu5PmnZ/ml7bpl7QKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IEltYWdlU29mdEFXQiB0aW1lOiAnICsgKEltYWdlU29mdEFXQkVuZFRpbWUuZ2V0VGltZSgpIC0gQml0MTZUbzhfU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdi5yZXNpemUoZHN0LCByZXNpemVJbWcsIG5ldyBjdi5TaXplKHRoaXMuQ2FudmFzV2lkdGgsIHRoaXMuQ2FudmFzSGVpZ2h0KSwgMCwgMCwgY3YuSU5URVJfTElORUFSKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXNpemVJbWcuZGF0YS5sZW5ndGg6ICcsIHJlc2l6ZUltZy5kYXRhLmxlbmd0aCk7CiAgICAgICAgICBjb25zb2xlLmxvZygncmVzaXplSW1nLmNvbHM6ICcsIHJlc2l6ZUltZy5jb2xzKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXNpemVJbWcucm93czogJywgcmVzaXplSW1nLnJvd3MpOwogICAgICAgICAgbGV0IG9yaWdpbmFsUmVzaXplSW1nOCA9IHRoaXMuQml0MTZUbzhfU3RyZXRjaChyZXNpemVJbWcsIEIsIFcpOwogICAgICAgICAgY29uc29sZS5sb2coJ29yaWdpbmFsUmVzaXplSW1nOC5kYXRhLmxlbmd0aDogJywgb3JpZ2luYWxSZXNpemVJbWc4LmRhdGEubGVuZ3RoKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCdvcmlnaW5hbFJlc2l6ZUltZzguY29sczogJywgb3JpZ2luYWxSZXNpemVJbWc4LmNvbHMpOwogICAgICAgICAgY29uc29sZS5sb2coJ29yaWdpbmFsUmVzaXplSW1nOC5yb3dzOiAnLCBvcmlnaW5hbFJlc2l6ZUltZzgucm93cyk7CiAgICAgICAgICB0aGlzLk9yaWdpbmFsSW1hZ2UgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShvcmlnaW5hbFJlc2l6ZUltZzguZGF0YSksIG9yaWdpbmFsUmVzaXplSW1nOC5jb2xzLCBvcmlnaW5hbFJlc2l6ZUltZzgucm93cyk7CiAgICAgICAgICByZXNpemVJbWcuZGVsZXRlKCk7CiAgICAgICAgICBjb25zb2xlLmxvZygnZHN0LmRhdGEubGVuZ3RoOiAnLCBkc3QuZGF0YS5sZW5ndGgpOwogICAgICAgICAgY29uc29sZS5sb2coJ2RzdC5jb2xzOiAnLCBkc3QuY29scyk7CiAgICAgICAgICBjb25zb2xlLmxvZygnZHN0LnJvd3M6ICcsIGRzdC5yb3dzKTsKICAgICAgICAgIGxldCBvcmlnaW5hbEltZzggPSB0aGlzLkJpdDE2VG84X1N0cmV0Y2goZHN0LCBCLCBXKTsKICAgICAgICAgIGRzdC5kZWxldGUoKTsKCiAgICAgICAgICBjb25zdCBCaXQxNlRvOF9TdHJldGNoRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIEJpdDE2VG84X1N0cmV0Y2gg57uT5p2f5pe26Ze0CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBCaXQxNlRvOF9TdHJldGNoIHRpbWU6ICcgKyAoQml0MTZUbzhfU3RyZXRjaEVuZFRpbWUuZ2V0VGltZSgpIC0gR2V0QXV0b1N0cmV0Y2hFbmRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAgICAgICAvLyBsZXQgdGFyZ2V0SW1nOCA9IHRoaXMuSW1hZ2VTb2Z0QVdCKG9yaWdpbmFsSW1nOCwgZ2FpblIsIGdhaW5CLCBvZmZzZXQpOwoKICAgICAgICAgIC8vIGNvbnN0IEltYWdlU29mdEFXQkVuZFRpbWUgPSBuZXcgRGF0ZSgpOyAvLyBJbWFnZVNvZnRBV0Ig57uT5p2f5pe26Ze0CiAgICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdDYXB0dXJlVGVzdFRpbWUgfCBJbWFnZVNvZnRBV0IgdGltZTogJyArIChJbWFnZVNvZnRBV0JFbmRUaW1lLmdldFRpbWUoKSAtIEJpdDE2VG84X1N0cmV0Y2hFbmRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKICAgICAgICAgIAogICAgICAgICAgLy8gb3JpZ2luYWxJbWc4LmRlbGV0ZSgpOwoKICAgICAgICAgIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcyA9IHsKICAgICAgICAgICAgZ2FpblI6IGdhaW5SLAogICAgICAgICAgICBnYWluQjogZ2FpbkIsCiAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0LAogICAgICAgICAgICBDRkE6IENGQSwKICAgICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgICAgQjogQiwKICAgICAgICAgICAgVzogVywKICAgICAgICAgICAgY3Ztb2RlOiBjdm1vZGUsCiAgICAgICAgICB9OwoKICAgICAgICAgIG1vZGlmaWVkQ2FudmFzLndpZHRoID0gdGhpcy5DYW52YXNXaWR0aDsKICAgICAgICAgIG1vZGlmaWVkQ2FudmFzLmhlaWdodCA9IHRoaXMuQ2FudmFzSGVpZ2h0OwogICAgICAgICAgbGV0IGNvbG9yRGF0YSA9IG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KG9yaWdpbmFsSW1nOC5kYXRhKSwgb3JpZ2luYWxJbWc4LmNvbHMsIG9yaWdpbmFsSW1nOC5yb3dzKTsKICAgICAgICAgIHRoaXMuZHJhd0ltZ0RhdGEgPSBjb2xvckRhdGE7CiAgICAgICAgICAvLyDorr7nva7nvJPlhrLnlLvluIPlrr3pq5gKICAgICAgICAgIHRoaXMuYnVmZmVyQ2FudmFzLndpZHRoID0gY29sb3JEYXRhLndpZHRoOwogICAgICAgICAgdGhpcy5idWZmZXJDYW52YXMuaGVpZ2h0ID0gY29sb3JEYXRhLmhlaWdodDsKICAgICAgICAgIC8vIOe7mOWItue8k+WtmOeUu+W4g+WbvuWDjwogICAgICAgICAgdGhpcy5idWZmZXJDdHgucHV0SW1hZ2VEYXRhKGNvbG9yRGF0YSwgMCwgMCk7CiAgICAgICAgICAvLyDnu5jliLbkuLvnlLvluIPlm77lg48KICAgICAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwoKICAgICAgICAgIGNvbnN0IERyYXdJbWFnZURhdGFFbmRUaW1lID0gbmV3IERhdGUoKTsgLy8gRHJhd0ltYWdlRGF0YSDnu5PmnZ/ml7bpl7QKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IERyYXdJbWFnZURhdGEgdGltZTogJyArIChEcmF3SW1hZ2VEYXRhRW5kVGltZS5nZXRUaW1lKCkgLSBCaXQxNlRvOF9TdHJldGNoRW5kVGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0NhcHR1cmVUZXN0VGltZSB8IFByb2Nlc3MgaW1hZ2UgZGF0YSBlbmQ6JyArIGVsYXBzZWRUaW1lICsgJyBtaWxsaXNlY29uZHMnLCAnaW5mbycpOwoKICAgICAgICAgIC8vIGNvbnN0IHRvdGFsRW5kVGltZSA9IG5ldyBEYXRlKCk7IC8vIOaAu+e7k+adn+aXtumXtAogICAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnQ2FwdHVyZVRlc3RUaW1lIHwgVG90YWwgcHJvY2VzcyBpbWFnZSBkYXRhIHRpbWU6ICcgKyAodG90YWxFbmRUaW1lLmdldFRpbWUoKSAtIHRvdGFsU3RhcnRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dDYXB0dXJlSW1hZ2UnKTsKICAgICAgICAgIHRoaXMuTWFrZUhpc3RvZ3JhbShjb2xvckRhdGEpOwogICAgICAgICAgdGhpcy5oaXN0b2dyYW1JbWFnZSA9IGNvbG9yRGF0YTsKCiAgICAgICAgICBjb25zdCBjaGVja0RldGVjdGVkU3RhcnNGaW5pc2ggPSAoKSA9PiB7CiAgICAgICAgICAgIGlmICh0aGlzLkRldGVjdGVkU3RhcnNGaW5pc2gpIHsKICAgICAgICAgICAgICB0aGlzLmRldGVjdFN0YXJzSW1nID0gdGhpcy5EcmF3RGV0ZWN0U3RhcnModGFyZ2V0SW1nOCwgdGhpcy5EZXRlY3RlZFN0YXJzTGlzdCk7CiAgICAgICAgICAgICAgdGFyZ2V0SW1nOC5kZWxldGUoKTsKICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbChjaGVja0RldGVjdGVkU3RhcnNGaW5pc2gsIDEwMDApOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgKHRoaXMuaXNOb3REcmF3U3RhcnMpIHsKICAgICAgICAvLyAgIHRoaXMuZHJhd0ltYWdlRGF0YSh0aGlzLmRyYXdJbWdEYXRhKTsKICAgICAgICAvLyB9IGVsc2UgewogICAgICAgIC8vICAgaWYgKHRoaXMuZGV0ZWN0U3RhcnNJbWcgIT0gbnVsbCkgewogICAgICAgIC8vICAgICB0aGlzLmRyYXdJbWFnZURhdGEodGhpcy5kZXRlY3RTdGFyc0ltZyk7CiAgICAgICAgLy8gICB9IGVsc2UgewogICAgICAgIC8vICAgICB0aGlzLmRyYXdJbWFnZURhdGEodGhpcy5kcmF3SW1nRGF0YSk7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfQoKICAgICAgICAvLyBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwogICAgICAgIC8vIGNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKCiAgICAgICAgLy8gY29uc3QgbWluVHJhbnNsYXRlWCA9IHRoaXMuaW1hZ2VXaWR0aCAtIHRoaXMuQ2FudmFzV2lkdGg7CiAgICAgICAgLy8gY29uc3QgbWluVHJhbnNsYXRlWSA9IHRoaXMuaW1hZ2VIZWlnaHQgLSB0aGlzLkNhbnZhc0hlaWdodDsKCiAgICAgICAgLy8gLy8g6K6h566X5Yid5aeL55qEIFNjYWxlSW1hZ2VTaXplX1gg5ZKMIFNjYWxlSW1hZ2VTaXplX1kKICAgICAgICAvLyB0aGlzLlNjYWxlSW1hZ2VTaXplX1ggPSBNYXRoLmZsb29yKG1pblRyYW5zbGF0ZVggLyB0aGlzLkNhbnZhc1dpZHRoICogd2luZG93V2lkdGggKyB3aW5kb3dXaWR0aCk7CiAgICAgICAgLy8gdGhpcy5TY2FsZUltYWdlU2l6ZV9ZID0gTWF0aC5mbG9vcihtaW5UcmFuc2xhdGVZIC8gdGhpcy5DYW52YXNIZWlnaHQgKiB3aW5kb3dIZWlnaHQgKyB3aW5kb3dIZWlnaHQpOwoKICAgICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ1NjYWxlSW1hZ2VTaXplJywgdGhpcy5TY2FsZUltYWdlU2l6ZV9YLCB0aGlzLlNjYWxlSW1hZ2VTaXplX1kpOwoKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aGlzLmhhbmRsZUVycm9yKCdQcm9jZXNzIGltYWdlIGRhdGEgZXJyb3InLCAncHJvY2Vzc0ltYWdlJywgZXJyb3IpOwogICAgICAgIGlmIChtYXQpIHsKICAgICAgICAgIG1hdC5kZWxldGUoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc2l6ZUltZykgewogICAgICAgICAgcmVzaXplSW1nLmRlbGV0ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAob3JpZ2luYWxJbWc4KSB7CiAgICAgICAgICBvcmlnaW5hbEltZzguZGVsZXRlKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0YXJnZXRJbWc4KSB7CiAgICAgICAgICB0YXJnZXRJbWc4LmRlbGV0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvLyBoaXN0b2dyYW1TdHJldGNoKGltYWdlRGF0YSwgbWluLCBtYXgpIHsKICAgIC8vICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgIC8vICAgLy8gQ29udmVydCBJbWFnZURhdGEgdG8gY3YuTWF0CiAgICAvLyAgIGNvbnN0IGltYWdlID0gY3YubWF0RnJvbUltYWdlRGF0YShpbWFnZURhdGEpOwogICAgLy8gICBsZXQgVGltZTEgPSBuZXcgRGF0ZSgpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdoaXN0b2dyYW1TdHJldGNoIHwg6L2s5o2i5Zu+5YOP5pWw5o2u5pe26Ze0OiAnICsgKFRpbWUxLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIFBlcmZvcm0gdGhlIGhpc3RvZ3JhbSBzdHJldGNoCiAgICAvLyAgIGNvbnN0IGNoYW5uZWxzID0gbmV3IGN2Lk1hdFZlY3RvcigpOwogICAgLy8gICBjdi5zcGxpdChpbWFnZSwgY2hhbm5lbHMpOyAvLyBTcGxpdCBjaGFubmVscyAoQkdSKSBpbnRvIHNlcGFyYXRlIE1hdCBvYmplY3RzCiAgICAvLyAgIGxldCBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDliIblibLpgJrpgZPml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBDYWxjdWxhdGUgYWxwaGEgYW5kIGJldGEgZm9yIGVhY2ggY2hhbm5lbAogICAgLy8gICBsZXQgYWxwaGEgPSAyNTUuMCAvIChtYXggLSBtaW4pOwogICAgLy8gICBsZXQgYmV0YSA9IC1taW4gKiBhbHBoYTsKCiAgICAvLyAgIGlmIChhbHBoYSA8IDApIHsKICAgIC8vICAgICBhbHBoYSA9IDA7CiAgICAvLyAgICAgYmV0YSA9IDA7CiAgICAvLyAgIH0gZWxzZSBpZiAoYWxwaGEgPiAyNTUpIHsKICAgIC8vICAgICBhbHBoYSA9IDI1NTsKICAgIC8vICAgICBiZXRhID0gMDsKICAgIC8vICAgfQogICAgLy8gICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDorqHnrpdhbHBoYeWSjGJldGHml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBJdGVyYXRlIG92ZXIgZWFjaCBjaGFubmVsIGFuZCBhcHBseSBoaXN0b2dyYW0gc3RyZXRjaGluZwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYW5uZWxzLnNpemUoKTsgaSsrKSB7CiAgICAvLyAgICAgbGV0IGNoYW5uZWwgPSBjaGFubmVscy5nZXQoaSk7CgoKICAgIC8vICAgICAvLyBBcHBseSBoaXN0b2dyYW0gc3RyZXRjaGluZyB0byB0aGUgY2hhbm5lbAogICAgLy8gICAgIGNoYW5uZWwuY29udmVydFRvKGNoYW5uZWwsIC0xLCBhbHBoYSwgYmV0YSk7CgogICAgLy8gICAgIC8vIFJlbGVhc2UgdGhlIG1lbW9yeSBvZiBjaGFubmVsCiAgICAvLyAgICAgY2hhbm5lbC5kZWxldGUoKTsKICAgIC8vICAgfQogICAgLy8gICBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDlkITpgJrpgZPmi4nkvLjml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBNZXJnZSB0aGUgY2hhbm5lbHMgYmFjayBpbnRvIGEgc2luZ2xlIGltYWdlCiAgICAvLyAgIGNvbnN0IHN0cmV0Y2hJbWFnZSA9IG5ldyBjdi5NYXQoKTsKICAgIC8vICAgY3YubWVyZ2UoY2hhbm5lbHMsIHN0cmV0Y2hJbWFnZSk7CiAgICAvLyAgIFRpbWUxID0gbmV3IERhdGUoKTsKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnaGlzdG9ncmFtU3RyZXRjaCB8IOWQiOW5tumAmumBk+aXtumXtDogJyArIChUaW1lMS5nZXRUaW1lKCkgLSBUaW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIFJlbGVhc2UgdGhlIG1lbW9yeSBvZiBjaGFubmVscyBhbmQgTWF0VmVjdG9yCiAgICAvLyAgIGNoYW5uZWxzLmRlbGV0ZSgpOwoKICAgIC8vICAgLy8gQ29udmVydCBjdi5NYXQgYmFjayB0byBJbWFnZURhdGEKICAgIC8vICAgY29uc3Qgc3RyZXRjaGVkSW1hZ2VEYXRhID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoc3RyZXRjaEltYWdlLmRhdGEpLCBzdHJldGNoSW1hZ2UuY29scywgc3RyZXRjaEltYWdlLnJvd3MpOwogICAgLy8gICBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDovazmjaLlm77lg4/mlbDmja7ml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICAvLyBDbGVhbiB1cAogICAgLy8gICBpbWFnZS5kZWxldGUoKTsKICAgIC8vICAgc3RyZXRjaEltYWdlLmRlbGV0ZSgpOwogICAgLy8gICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2hpc3RvZ3JhbVN0cmV0Y2ggfCDph4rmlL7lhoXlrZjml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdoaXN0b2dyYW1TdHJldGNoIHwg5oC75pe26Ze0OiAnICsgKFRpbWUxLmdldFRpbWUoKSAtIHN0YXJ0VGltZS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIHJldHVybiBzdHJldGNoZWRJbWFnZURhdGE7CiAgICAvLyB9LAoKICAgIGhpc3RvZ3JhbVN0cmV0Y2goaW1hZ2VEYXRhLCBtaW4sIG1heCkgewogICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICAvLyBDYWxjdWxhdGUgYWxwaGEgYW5kIGJldGEKICAgICAgbGV0IGFscGhhID0gMjU1LjAgLyAobWF4IC0gbWluKTsKICAgICAgbGV0IGJldGEgPSAtbWluICogYWxwaGE7CgogICAgICBpZiAoYWxwaGEgPCAwKSB7CiAgICAgICAgYWxwaGEgPSAwOwogICAgICAgIGJldGEgPSAwOwogICAgICB9IGVsc2UgaWYgKGFscGhhID4gMjU1KSB7CiAgICAgICAgYWxwaGEgPSAyNTU7CiAgICAgICAgYmV0YSA9IDA7CiAgICAgIH0KCiAgICAgIC8vIEFwcGx5IGhpc3RvZ3JhbSBzdHJldGNoaW5nIGRpcmVjdGx5IG9uIEltYWdlRGF0YQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsgLy8gRm9yIGVhY2ggY29sb3IgY2hhbm5lbAogICAgICAgICAgbGV0IHZhbHVlID0gaW1hZ2VEYXRhLmRhdGFbaSArIGpdOwogICAgICAgICAgdmFsdWUgPSB2YWx1ZSAqIGFscGhhICsgYmV0YTsKICAgICAgICAgIGltYWdlRGF0YS5kYXRhW2kgKyBqXSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgdmFsdWUpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdoaXN0b2dyYW1TdHJldGNoIHwg5oC75pe26Ze0OiAnICsgKGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKICAgICAgcmV0dXJuIGltYWdlRGF0YTsKICAgIH0sCiAgICBsb2NhbFdoaXRlQmFsYW5jZUFkanVzdG1lbnQoaW1hZ2VEYXRhLCBnYWluUiwgZ2FpbkIsIG9mZnNldCkgewogICAgICAvLyDliIbnprvpgJrpgZMKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuZGF0YS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7IC8vIEZvciBlYWNoIGNvbG9yIGNoYW5uZWwKICAgICAgICAgIGlmIChqID09IDApIHsKICAgICAgICAgICAgdmFsdWUgPSBpbWFnZURhdGEuZGF0YVtpICsgal07CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiBnYWluQiArIG9mZnNldDsKICAgICAgICAgIH0gZWxzZSBpZiAoaiA9PSAyKSB7CiAgICAgICAgICAgIHZhbHVlID0gaW1hZ2VEYXRhLmRhdGFbaSArIGpdOwogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogZ2FpblIgKyBvZmZzZXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YWx1ZSA9IGltYWdlRGF0YS5kYXRhW2kgKyBqXTsKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSAqIDEgKyBvZmZzZXQ7CiAgICAgICAgICB9CiAgICAgICAgICBpbWFnZURhdGEuZGF0YVtpICsgal0gPSBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIHZhbHVlKSk7CiAgICAgICAgfQogICAgICB9CgoKICAgICAgcmV0dXJuIGltYWdlRGF0YTsKICAgIH0sCgogICAgaW5pdENhbnZhcygpIHsKICAgICAgdGhpcy5idWZmZXJDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgdGhpcy5idWZmZXJDdHggPSB0aGlzLmJ1ZmZlckNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwoKICAgICAgdGhpcy50ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIHRoaXMudGVtcEN0eCA9IHRoaXMudGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgfSwKCiAgICAvLyovKi8qLyovKi8qLyovKi8qLyovKi8KICAgIFN3aXRjaEltYWdlVG9TaG93KGlzT3JpZ2luYWwpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ1Nob3cgT3JpZ2luYWwgSW1hZ2U6ICcsIGlzT3JpZ2luYWwpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTaG93IE9yaWdpbmFsIEltYWdlOicgKyBpc09yaWdpbmFsLCAnaW5mbycpOwogICAgICB0aGlzLmlzTm90RHJhd1N0YXJzID0gaXNPcmlnaW5hbDsKICAgICAgaWYgKGlzT3JpZ2luYWwpIHsKICAgICAgICAvLyBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlVG91Y2hPck1vdXNlRG93bik7CiAgICAgICAgdGhpcy5lbmFibGVNYWluQ2FudmFzQ2xpY2sgPSBmYWxzZTsKICAgICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlVG91Y2hPck1vdXNlRG93bik7CiAgICAgICAgdGhpcy5lbmFibGVNYWluQ2FudmFzQ2xpY2sgPSB0cnVlOwogICAgICAgIC8vIHRoaXMuZHJhd0ltYWdlRGF0YSh0aGlzLmRldGVjdFN0YXJzSW1nKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBkcmF3SW1hZ2VEYXRhKCkgewogICAgLy8gICBpZiAodGhpcy5idWZmZXJDYW52YXMgPT0gbnVsbCkgewogICAgLy8gICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgZXJyb3I6IGJ1ZmZlckNhbnZhcyBpcyBudWxsIG9yIHVuZGVmaW5lZC4nLCAnZXJyb3InKTsKICAgIC8vICAgICByZXR1cm47CiAgICAvLyAgIH0KICAgIC8vICAgLy8g5Y+v55So55u45YWz5Y+C5pWwCiAgICAvLyAgIC8vIHdpbmRvdy5pbm5lcldpZHRoOyAvLyDnqpflj6Plrr3luqYKICAgIC8vICAgLy8gd2luZG93LmlubmVySGVpZ2h0OyAvLyDnqpflj6Ppq5jluqYKICAgIC8vICAgLy8gdGhpcy5zY2FsZSDnvKnmlL7mr5TkvosKICAgIC8vICAgLy8gdGhpcy50cmFuc2xhdGVYIOW5s+enu3jlnZDmoIcKICAgIC8vICAgLy8gdGhpcy50cmFuc2xhdGVZIOW5s+enu3nlnZDmoIcKICAgIC8vICAgLy8gdGhpcy5DYW52YXNXaWR0aCDkuLvnlLvluIPlrr3luqYgMTkyMAogICAgLy8gICAvLyB0aGlzLkNhbnZhc0hlaWdodCDkuLvnlLvluIPpq5jluqYgMTA4MAogICAgLy8gICAvLyB0aGlzLm1haW5DYW1lcmFTaXplWCDljp/lp4vlm77lg4/lrr3luqYKICAgIC8vICAgLy8gdGhpcy5tYWluQ2FtZXJhU2l6ZVkg5Y6f5aeL5Zu+5YOP6auY5bqmCiAgICAvLyAgIC8vIHRoaXMuYnVmZmVyQ2FudmFzLndpZHRoIOe8k+WGsueUu+W4g+WuveW6pgogICAgLy8gICAvLyB0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQg57yT5Yay55S75biD6auY5bqmCiAgICAvLyAgIC8vIHRoaXMuSW1hZ2VQcm9wb3J0aW9uIOWbvuWDj+avlOS+iwogICAgLy8gICAvLyB0aGlzLlJPSV94IFJPSeeahHjlnZDmoIcKICAgIC8vICAgLy8gdGhpcy5ST0lfeSBST0nnmoR55Z2Q5qCHCiAgICAvLyAgIC8vIHRoaXMuUk9JX2xlbmd0aCBST0nnmoTplb/luqYKCiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKCflvZPliY3nlLvluIPlj4LmlbA6XG4gYnVmZmVyQ2FudmFzLndpZHRoOiAnLCB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCwgJ1xuIGJ1ZmZlckNhbnZhcy5oZWlnaHQ6ICcsIHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCwgJ1xuIEltYWdlUHJvcG9ydGlvbjogJywgdGhpcy5JbWFnZVByb3BvcnRpb24sICdcbiBzY2FsZTogJywgdGhpcy5zY2FsZSwgJ1xuIHZpc2libGVYOiAnLCB0aGlzLnZpc2libGVYLCAnXG4gdmlzaWJsZVk6ICcsIHRoaXMudmlzaWJsZVksICdcbiB2aXNpYmxlV2lkdGg6ICcsIHRoaXMudmlzaWJsZVdpZHRoLCAnXG4gdmlzaWJsZUhlaWdodDogJywgdGhpcy52aXNpYmxlSGVpZ2h0LCAnXG4gUk9JX3g6ICcsIHRoaXMuUk9JX3gsICdcbiBST0lfeTogJywgdGhpcy5ST0lfeSwgJ1xuIFJPSV9sZW5ndGg6ICcsIHRoaXMuUk9JX2xlbmd0aCk7CgogICAgLy8gICBsZXQgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgIC8vICAgbGV0IFRpbWUxID0gbmV3IERhdGUoKTsKCiAgICAvLyAgIC8vIOiuoeeul+WPr+ingeWMuuWfnwogICAgLy8gICBjb25zdCBuZXdWaXNpYmxlV2lkdGggPSB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCAqIHRoaXMuc2NhbGU7CiAgICAvLyAgIGNvbnN0IG5ld1Zpc2libGVIZWlnaHQgPSBuZXdWaXNpYmxlV2lkdGggLyB0aGlzLkltYWdlUHJvcG9ydGlvbjsKCiAgICAvLyAgIC8vIOiuoeeul+WPr+ingeWMuuWfn3jlnZDmoIcKICAgIC8vICAgbGV0IG5ld1Zpc2libGVYID0gdGhpcy52aXNpYmxlWDsKICAgIC8vICAgLy8g6K6h566X5Y+v6KeB5Yy65Z+feeWdkOaghwogICAgLy8gICBsZXQgbmV3VmlzaWJsZVkgPSB0aGlzLnZpc2libGVZOwoKICAgIC8vICAgLy8g6YG/5YWN5Zu+5YOP6LaK55WMCiAgICAvLyAgIGlmIChuZXdWaXNpYmxlWCAtIG5ld1Zpc2libGVXaWR0aCAvIDIgPCAwKSB7CiAgICAvLyAgICAgbmV3VmlzaWJsZVggPSBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgLy8gICB9IGVsc2UgaWYgKG5ld1Zpc2libGVYICsgbmV3VmlzaWJsZVdpZHRoIC8gMiA+IHRoaXMuYnVmZmVyQ2FudmFzLndpZHRoKSB7CiAgICAvLyAgICAgbmV3VmlzaWJsZVggPSB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCAtIG5ld1Zpc2libGVXaWR0aCAvIDI7CiAgICAvLyAgIH0KCiAgICAvLyAgIGlmIChuZXdWaXNpYmxlWSAtIG5ld1Zpc2libGVIZWlnaHQgLyAyIDwgMCkgewogICAgLy8gICAgIG5ld1Zpc2libGVZID0gbmV3VmlzaWJsZUhlaWdodCAvIDI7CiAgICAvLyAgIH0gZWxzZSBpZiAobmV3VmlzaWJsZVkgKyBuZXdWaXNpYmxlSGVpZ2h0IC8gMiA+IHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCkgewogICAgLy8gICAgIG5ld1Zpc2libGVZID0gdGhpcy5idWZmZXJDYW52YXMuaGVpZ2h0IC0gbmV3VmlzaWJsZUhlaWdodCAvIDI7CiAgICAvLyAgIH0KCiAgICAvLyAgIC8vIOabtOaWsFJPSeWMuuWfnwogICAgLy8gICAvLyDorqHnrpflj6/op4HljLrln5/nmoTovrnnlYwKICAgIC8vICAgY29uc3QgdmlzaWJsZUxlZnQgPSBuZXdWaXNpYmxlWCAtIG5ld1Zpc2libGVXaWR0aCAvIDI7CiAgICAvLyAgIGNvbnN0IHZpc2libGVSaWdodCA9IG5ld1Zpc2libGVYICsgbmV3VmlzaWJsZVdpZHRoIC8gMjsKICAgIC8vICAgY29uc3QgdmlzaWJsZVRvcCA9IG5ld1Zpc2libGVZIC0gbmV3VmlzaWJsZUhlaWdodCAvIDI7CiAgICAvLyAgIGNvbnN0IHZpc2libGVCb3R0b20gPSBuZXdWaXNpYmxlWSArIG5ld1Zpc2libGVIZWlnaHQgLyAyOwoKICAgIC8vICAgLy8g6K6h566XIFJPSSDljLrln5/nmoTovrnnlYwKICAgIC8vICAgY29uc3Qgcm9pTGVmdCA9IHRoaXMuUk9JX3g7CiAgICAvLyAgIGNvbnN0IHJvaVJpZ2h0ID0gdGhpcy5ST0lfeCArIHRoaXMuUk9JX2xlbmd0aDsKICAgIC8vICAgY29uc3Qgcm9pVG9wID0gdGhpcy5ST0lfeTsKICAgIC8vICAgY29uc3Qgcm9pQm90dG9tID0gdGhpcy5ST0lfeSArIHRoaXMuUk9JX2xlbmd0aDsKCiAgICAvLyAgIC8vIOWIpOaWrSBST0kg5Yy65Z+f5piv5ZCm5Zyo5Y+v6KeB5Yy65Z+f5YaFCiAgICAvLyAgIGNvbnN0IGlzUm9pSW5WaXNpYmxlID0gcm9pUmlnaHQgPj0gdmlzaWJsZUxlZnQgJiYgcm9pTGVmdCA8PSB2aXNpYmxlUmlnaHQgJiYgcm9pQm90dG9tID49IHZpc2libGVUb3AgJiYgcm9pVG9wIDw9IHZpc2libGVCb3R0b207CgogICAgLy8gICAvLyDorqHnrpcgUk9JIOWMuuWfn+WcqOWxj+W5leS4iueahOS9jee9ru+8jOS4reW/g+eCueWdkOaghwogICAgLy8gICBjb25zdCByb2lTY3JlZW5YID0gKHRoaXMuUk9JX3ggLSB2aXNpYmxlTGVmdCkgKiAod2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGgpICsgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgLy8gICBjb25zdCByb2lTY3JlZW5ZID0gKHRoaXMuUk9JX3kgLSB2aXNpYmxlVG9wKSAqICh3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0KSArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lckhlaWdodCAvIG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgLy8gICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdST0kg5Yy65Z+f5Zyo5bGP5bmV5LiK55qE5L2N572uOiAnICsgcm9pU2NyZWVuWCArICcqJyArIHJvaVNjcmVlblkgKyAn6ZW/5bqmICcgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJXaWR0aCAvIG5ld1Zpc2libGVXaWR0aCArICcqJyArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lckhlaWdodCAvIG5ld1Zpc2libGVIZWlnaHQsICdpbmZvJyk7CiAgICAvLyAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UmVkQm94TGVuZ3RoJywgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGgsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lckhlaWdodCAvIG5ld1Zpc2libGVIZWlnaHQpOwogICAgLy8gICB0aGlzLiRidXMuJGVtaXQoJ3NldFJlZEJveFBvc2l0aW9uJywgcm9pU2NyZWVuWCwgcm9pU2NyZWVuWSk7CiAgICAvLyAgIC8vIGlmIChpc1JvaUluVmlzaWJsZSkgewogICAgLy8gICAvLyAgIGNvbnNvbGUubG9nKCdST0kg5Yy65Z+f5Zyo5Y+v6KeB5Yy65Z+f5YaFLCBSZWRCb3hTaWRlTGVuZ3RoOiAnLCB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJXaWR0aCAvIG5ld1Zpc2libGVXaWR0aCwgJywgJywgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVySGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodCk7CiAgICAvLyAgIC8vIH0gZWxzZSB7CiAgICAvLyAgIC8vICAgY29uc29sZS5sb2coJ1JPSSDljLrln5/kuI3lnKjlj6/op4HljLrln5/lhoUsIFJlZEJveFNpZGVMZW5ndGg6ICcsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoLCAnLCAnLCB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0KTsKICAgIC8vICAgLy8gfQoKICAgIC8vICAgbGV0IFRpbWUyID0gbmV3IERhdGUoKTsKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnZHJhd0ltYWdlRGF0YSB8IOiuoeeul+ebuOWFs+WPguaVsOaXtumXtDogJyArIChUaW1lMi5nZXRUaW1lKCkgLSBUaW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIERyYXcgYnVmZmVyIGNhbnZhcyBvbiBtYWluIGNhbnZhcwogICAgLy8gICBjb25zdCBjYW52YXMgPSB0aGlzLiRyZWZzLm1haW5DYW52YXM7CiAgICAvLyAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgLy8gICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAvLyAgIC8vIOiOt+WPlue7mOWItueahOWbvuWDj+aVsOaNrgogICAgLy8gICBsZXQgaW1hZ2VEYXRhID0gdGhpcy5idWZmZXJDdHguZ2V0SW1hZ2VEYXRhKG5ld1Zpc2libGVYIC0gbmV3VmlzaWJsZVdpZHRoIC8gMiwgbmV3VmlzaWJsZVkgLSBuZXdWaXNpYmxlSGVpZ2h0IC8gMiwgbmV3VmlzaWJsZVdpZHRoLCBuZXdWaXNpYmxlSGVpZ2h0KTsKCiAgICAvLyAgIFRpbWUxID0gbmV3IERhdGUoKTsKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnZHJhd0ltYWdlRGF0YSB8IOiOt+WPlue7mOWItueahOWbvuWDj+aVsOaNruaXtumXtDogJyArIChUaW1lMS5nZXRUaW1lKCkgLSBUaW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgLy8gICAvLyBpZiAodGhpcy5jdXJyZW50SGlzdG9ncmFtTWF4ICE9IDI1NSB8fCB0aGlzLmN1cnJlbnRIaXN0b2dyYW1NaW4gIT0gMCkgewogICAgLy8gICAvLyAgIGltYWdlRGF0YSA9IHRoaXMuaGlzdG9ncmFtU3RyZXRjaChpbWFnZURhdGEsIHRoaXMuY3VycmVudEhpc3RvZ3JhbU1pbiwgdGhpcy5jdXJyZW50SGlzdG9ncmFtTWF4KTsKICAgIC8vICAgLy8gfQoKICAgIC8vICAgVGltZTIgPSBuZXcgRGF0ZSgpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdkcmF3SW1hZ2VEYXRhIHwg55u05pa55Zu+5ouJ5Ly45pe26Ze0OiAnICsgKFRpbWUyLmdldFRpbWUoKSAtIFRpbWUxLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKICAgICAgCiAgICAgIAogICAgLy8gICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgY2FudmFzIHRvIGRyYXcgdGhlIEltYWdlRGF0YQogICAgLy8gICBsZXQgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgLy8gICB0ZW1wQ2FudmFzLndpZHRoID0gaW1hZ2VEYXRhLndpZHRoOwogICAgLy8gICB0ZW1wQ2FudmFzLmhlaWdodCA9IGltYWdlRGF0YS5oZWlnaHQ7CiAgICAvLyAgIGxldCB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgLy8gICB0ZW1wQ3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwoKICAgIC8vICAgVGltZTEgPSBuZXcgRGF0ZSgpOwogICAgLy8gICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdkcmF3SW1hZ2VEYXRhIHwg5Yib5bu65Li05pe255S75biD5bm257uY5Yi25pe26Ze0OiAnICsgKFRpbWUxLmdldFRpbWUoKSAtIFRpbWUyLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAvLyAgIC8vIERyYXcgdGhlIEltYWdlRGF0YSBvbiB0aGUgbWFpbiBjYW52YXMKICAgIC8vICAgY3R4LmRyYXdJbWFnZSh0ZW1wQ2FudmFzLCAwLCAwLCB0ZW1wQ2FudmFzLndpZHRoLCB0ZW1wQ2FudmFzLmhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKCiAgICAvLyAgIFRpbWUyID0gbmV3IERhdGUoKTsKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnZHJhd0ltYWdlRGF0YSB8IOe7mOWItuWbvuWDj+aXtumXtDogJyArIChUaW1lMi5nZXRUaW1lKCkgLSBUaW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CiAgICAvLyAgIC8vIGN0eC5kcmF3SW1hZ2UodGhpcy5idWZmZXJDYW52YXMsIG5ld1Zpc2libGVYIC0gbmV3VmlzaWJsZVdpZHRoIC8gMiwgbmV3VmlzaWJsZVkgLSBuZXdWaXNpYmxlSGVpZ2h0IC8gMiwgbmV3VmlzaWJsZVdpZHRoLCBuZXdWaXNpYmxlSGVpZ2h0LCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgLy8gICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnu5jliLblm77lg48s5Y+v6KeB5Yy65Z+fOicgKyBuZXdWaXNpYmxlWCArICcsJyArIG5ld1Zpc2libGVZICsgJywnICsgbmV3VmlzaWJsZVdpZHRoICsgJywnICsgbmV3VmlzaWJsZUhlaWdodCwgJ2luZm8nKTsKICAgIC8vICAgdGhpcy52aXNpYmxlWCA9IG5ld1Zpc2libGVYOwogICAgLy8gICB0aGlzLnZpc2libGVZID0gbmV3VmlzaWJsZVk7CiAgICAvLyAgIHRoaXMudmlzaWJsZVdpZHRoID0gbmV3VmlzaWJsZVdpZHRoOwogICAgLy8gICB0aGlzLnZpc2libGVIZWlnaHQgPSBuZXdWaXNpYmxlSGVpZ2h0OwoKICAgIC8vICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRDdXJyZW50TWFpbkNhbnZhc0hhc0ltYWdlJywgdHJ1ZSk7IC8vIOWPkemAgee7meeUteiwg++8jOeUqOS6juWIpOaWreaYr+WQpuWPr+S7pei/m+ihjOW+queOr+aLjeaRhAogICAgLy8gICAvLyDlj5HpgIHmtojmga/nu5lRVOWuouaIt+err++8jOeUqOS6juS/oeaBr+WbvuaghwogICAgLy8gICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NlbmRSZWRCb3hTdGF0ZTonICsgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICsgJzonICsgdGhpcy5ST0lfeCArICc6JyArIHRoaXMuUk9JX3kpOwogICAgLy8gICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NlbmRWaXNpYmxlQXJlYTonICsgdGhpcy52aXNpYmxlWCArICc6JyArIHRoaXMudmlzaWJsZVkgKyAnOicgKyB0aGlzLnNjYWxlKTsKICAgICAgCiAgICAvLyAgIC8vIOWmguaenOmAieaLqeS6huaYn+eCue+8jOWImeagueaNrumAieaLqeS9jee9ru+8jOWcqFJPSeWMuuWfn+S4ree7mOWItuS4gOS4quWchgogICAgLy8gICBpZiAodGhpcy5EcmF3U2VsZWN0U3RhclggIT0gLTEgJiYgdGhpcy5EcmF3U2VsZWN0U3RhclkgIT0gLTEgJiYgdGhpcy5zaG93U2VsZWN0U3RhcikgewogICAgLy8gICAgIGxldCByYWRpdXMsIGNhbnZhc1N0YXJYLCBjYW52YXNTdGFyWSwgY29sb3I7CiAgICAvLyAgICAgLy8g5aaC5p6c5pyJ5pif54K5CiAgICAvLyAgICAgaWYgKHRoaXMuRHJhd1NlbGVjdFN0YXJIRlIgIT0gLTEpIHsKICAgIC8vICAgICAgIHJhZGl1cyA9IHRoaXMuRHJhd1NlbGVjdFN0YXJIRlIvdGhpcy5zY2FsZSoyOwogICAgLy8gICAgICAgY2FudmFzU3RhclggPSAodGhpcy5EcmF3U2VsZWN0U3RhclggKyB0aGlzLlJPSV94IC0gdmlzaWJsZUxlZnQpICogY3R4LmNhbnZhcy53aWR0aCAvIG5ld1Zpc2libGVXaWR0aDsKICAgIC8vICAgICAgIGNhbnZhc1N0YXJZID0gKHRoaXMuRHJhd1NlbGVjdFN0YXJZICsgdGhpcy5ST0lfeSAtIHZpc2libGVUb3ApICogY3R4LmNhbnZhcy5oZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0OwogICAgLy8gICAgICAgY29sb3IgPSAnZ3JlZW4nOyAvLyDmnInmmJ/ngrnvvIznu5jliLbnu7/oibLnmoTlnIYKICAgIC8vICAgICB9IGVsc2UgewogICAgLy8gICAgICAgLy8g5ZCm5YiZ77yM5Zyo6YCJ5oup55qE5L2N572u57uY5Yi25LiA5Liq5ZyGCiAgICAvLyAgICAgICByYWRpdXMgPSAxMC90aGlzLnNjYWxlOyAvLyDkvaDlj6/ku6XmoLnmja7pnIDopoHosIPmlbTov5nkuKrlgLwKICAgIC8vICAgICAgIGNhbnZhc1N0YXJYID0gKHRoaXMuRHJhd1NlbGVjdFN0YXJYICsgdGhpcy5ST0lfeCAtIHZpc2libGVMZWZ0KSAqIGN0eC5jYW52YXMud2lkdGggLyBuZXdWaXNpYmxlV2lkdGg7CiAgICAvLyAgICAgICBjYW52YXNTdGFyWSA9ICh0aGlzLkRyYXdTZWxlY3RTdGFyWSArIHRoaXMuUk9JX3kgLSB2aXNpYmxlVG9wKSAqIGN0eC5jYW52YXMuaGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodDsKICAgIC8vICAgICAgIGNvbG9yID0gJ3JlZCc7IC8vIOaXoOaYn+eCue+8jOe7mOWItue6ouiJsueahOWchgogICAgLy8gICAgIH0KCiAgICAvLyAgICAgLy8g6I635Y+W57uY5Yi25ZyG55qE5L2N572u55qE5Zu+5YOP5pWw5o2uCiAgICAvLyAgICAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YShjYW52YXNTdGFyWCAtIHJhZGl1cywgY2FudmFzU3RhclkgLSByYWRpdXMsIDIgKiByYWRpdXMsIDIgKiByYWRpdXMpOwogICAgLy8gICAgIC8vIOWPkemAgeWbvuWDj+aVsOaNrue7meaYvuekuuahhgogICAgLy8gICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2VsZWN0U3RhckltYWdlJywgaW1hZ2VEYXRhKTsKCiAgICAvLyAgICAgLy8g5Zyo5oyH5a6a5L2N572u5byA5aeL57uY5Yi25ZyGCiAgICAvLyAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgLy8gICAgIGN0eC5hcmMoY2FudmFzU3RhclgsIGNhbnZhc1N0YXJZLCByYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTsKICAgIC8vICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgIC8vICAgICBjdHgubGluZVdpZHRoID0gMzsKICAgIC8vICAgICBjdHguc3Ryb2tlKCk7CiAgICAvLyAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgLy8gICB9CgogICAgLy8gICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDnu5jliLbmmJ/ngrnml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgIC8vICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnZHJhd0ltYWdlRGF0YSB8IOaAu+aXtumXtDogJyArIChUaW1lMS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgLy8gfSwKCiAgICAKICAgZHJhd0ltYWdlRGF0YSgpIHsKICAgICAgaWYgKHRoaXMuYnVmZmVyQ2FudmFzID09IG51bGwpIHsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdkcmF3SW1hZ2VEYXRhIGVycm9yOiBidWZmZXJDYW52YXMgaXMgbnVsbCBvciB1bmRlZmluZWQuJywgJ2Vycm9yJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIOWPr+eUqOebuOWFs+WPguaVsAogICAgICAvLyB3aW5kb3cuaW5uZXJXaWR0aDsgLy8g56qX5Y+j5a695bqmCiAgICAgIC8vIHdpbmRvdy5pbm5lckhlaWdodDsgLy8g56qX5Y+j6auY5bqmCiAgICAgIC8vIHRoaXMuc2NhbGUg57yp5pS+5q+U5L6LCiAgICAgIC8vIHRoaXMudHJhbnNsYXRlWCDlubPnp7t45Z2Q5qCHCiAgICAgIC8vIHRoaXMudHJhbnNsYXRlWSDlubPnp7t55Z2Q5qCHCiAgICAgIC8vIHRoaXMuQ2FudmFzV2lkdGgg5Li755S75biD5a695bqmIDE5MjAKICAgICAgLy8gdGhpcy5DYW52YXNIZWlnaHQg5Li755S75biD6auY5bqmIDEwODAKICAgICAgLy8gdGhpcy5tYWluQ2FtZXJhU2l6ZVgg5Y6f5aeL5Zu+5YOP5a695bqmCiAgICAgIC8vIHRoaXMubWFpbkNhbWVyYVNpemVZIOWOn+Wni+WbvuWDj+mrmOW6pgogICAgICAvLyB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCDnvJPlhrLnlLvluIPlrr3luqYKICAgICAgLy8gdGhpcy5idWZmZXJDYW52YXMuaGVpZ2h0IOe8k+WGsueUu+W4g+mrmOW6pgogICAgICAvLyB0aGlzLkltYWdlUHJvcG9ydGlvbiDlm77lg4/mr5TkvosKICAgICAgLy8gdGhpcy5ST0lfeCBST0nnmoR45Z2Q5qCHCiAgICAgIC8vIHRoaXMuUk9JX3kgUk9J55qEeeWdkOaghwogICAgICAvLyB0aGlzLlJPSV9sZW5ndGggUk9J55qE6ZW/5bqmCgogICAgICAvLyBjb25zb2xlLmxvZygn5b2T5YmN55S75biD5Y+C5pWwOlxuIGJ1ZmZlckNhbnZhcy53aWR0aDogJywgdGhpcy5idWZmZXJDYW52YXMud2lkdGgsICdcbiBidWZmZXJDYW52YXMuaGVpZ2h0OiAnLCB0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQsICdcbiBJbWFnZVByb3BvcnRpb246ICcsIHRoaXMuSW1hZ2VQcm9wb3J0aW9uLCAnXG4gc2NhbGU6ICcsIHRoaXMuc2NhbGUsICdcbiB2aXNpYmxlWDogJywgdGhpcy52aXNpYmxlWCwgJ1xuIHZpc2libGVZOiAnLCB0aGlzLnZpc2libGVZLCAnXG4gdmlzaWJsZVdpZHRoOiAnLCB0aGlzLnZpc2libGVXaWR0aCwgJ1xuIHZpc2libGVIZWlnaHQ6ICcsIHRoaXMudmlzaWJsZUhlaWdodCwgJ1xuIFJPSV94OiAnLCB0aGlzLlJPSV94LCAnXG4gUk9JX3k6ICcsIHRoaXMuUk9JX3ksICdcbiBST0lfbGVuZ3RoOiAnLCB0aGlzLlJPSV9sZW5ndGgpOwoKICAgICAgbGV0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgIGxldCBUaW1lMSA9IG5ldyBEYXRlKCk7CgogICAgICAvLyDorqHnrpflj6/op4HljLrln58KICAgICAgY29uc3QgbmV3VmlzaWJsZVdpZHRoID0gdGhpcy5idWZmZXJDYW52YXMud2lkdGggKiB0aGlzLnNjYWxlOwogICAgICBjb25zdCBuZXdWaXNpYmxlSGVpZ2h0ID0gbmV3VmlzaWJsZVdpZHRoIC8gdGhpcy5JbWFnZVByb3BvcnRpb247CgogICAgICAvLyDorqHnrpflj6/op4HljLrln5945Z2Q5qCHCiAgICAgIGxldCBuZXdWaXNpYmxlWCA9IHRoaXMudmlzaWJsZVg7CiAgICAgIC8vIOiuoeeul+WPr+ingeWMuuWfn3nlnZDmoIcKICAgICAgbGV0IG5ld1Zpc2libGVZID0gdGhpcy52aXNpYmxlWTsKCiAgICAgIC8vIOmBv+WFjeWbvuWDj+i2iueVjAogICAgICBpZiAobmV3VmlzaWJsZVggLSBuZXdWaXNpYmxlV2lkdGggLyAyIDwgMCkgewogICAgICAgIG5ld1Zpc2libGVYID0gbmV3VmlzaWJsZVdpZHRoIC8gMjsKICAgICAgfSBlbHNlIGlmIChuZXdWaXNpYmxlWCArIG5ld1Zpc2libGVXaWR0aCAvIDIgPiB0aGlzLmJ1ZmZlckNhbnZhcy53aWR0aCkgewogICAgICAgIG5ld1Zpc2libGVYID0gdGhpcy5idWZmZXJDYW52YXMud2lkdGggLSBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgICB9CgogICAgICBpZiAobmV3VmlzaWJsZVkgLSBuZXdWaXNpYmxlSGVpZ2h0IC8gMiA8IDApIHsKICAgICAgICBuZXdWaXNpYmxlWSA9IG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICB9IGVsc2UgaWYgKG5ld1Zpc2libGVZICsgbmV3VmlzaWJsZUhlaWdodCAvIDIgPiB0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQpIHsKICAgICAgICBuZXdWaXNpYmxlWSA9IHRoaXMuYnVmZmVyQ2FudmFzLmhlaWdodCAtIG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICB9CgogICAgICAvLyDmm7TmlrBST0nljLrln58KICAgICAgLy8g6K6h566X5Y+v6KeB5Yy65Z+f55qE6L6555WMCiAgICAgIGNvbnN0IHZpc2libGVMZWZ0ID0gbmV3VmlzaWJsZVggLSBuZXdWaXNpYmxlV2lkdGggLyAyOwogICAgICBjb25zdCB2aXNpYmxlUmlnaHQgPSBuZXdWaXNpYmxlWCArIG5ld1Zpc2libGVXaWR0aCAvIDI7CiAgICAgIGNvbnN0IHZpc2libGVUb3AgPSBuZXdWaXNpYmxlWSAtIG5ld1Zpc2libGVIZWlnaHQgLyAyOwogICAgICBjb25zdCB2aXNpYmxlQm90dG9tID0gbmV3VmlzaWJsZVkgKyBuZXdWaXNpYmxlSGVpZ2h0IC8gMjsKCiAgICAgIC8vIOiuoeeulyBST0kg5Yy65Z+f55qE6L6555WMCiAgICAgIGNvbnN0IHJvaUxlZnQgPSB0aGlzLlJPSV94OwogICAgICBjb25zdCByb2lSaWdodCA9IHRoaXMuUk9JX3ggKyB0aGlzLlJPSV9sZW5ndGg7CiAgICAgIGNvbnN0IHJvaVRvcCA9IHRoaXMuUk9JX3k7CiAgICAgIGNvbnN0IHJvaUJvdHRvbSA9IHRoaXMuUk9JX3kgKyB0aGlzLlJPSV9sZW5ndGg7CgogICAgICAvLyDliKTmlq0gUk9JIOWMuuWfn+aYr+WQpuWcqOWPr+ingeWMuuWfn+WGhQogICAgICBjb25zdCBpc1JvaUluVmlzaWJsZSA9IHJvaVJpZ2h0ID49IHZpc2libGVMZWZ0ICYmIHJvaUxlZnQgPD0gdmlzaWJsZVJpZ2h0ICYmIHJvaUJvdHRvbSA+PSB2aXNpYmxlVG9wICYmIHJvaVRvcCA8PSB2aXNpYmxlQm90dG9tOwoKICAgICAgLy8g6K6h566XIFJPSSDljLrln5/lnKjlsY/luZXkuIrnmoTkvY3nva7vvIzkuK3lv4PngrnlnZDmoIcKICAgICAgY29uc3Qgcm9pU2NyZWVuWCA9ICh0aGlzLlJPSV94IC0gdmlzaWJsZUxlZnQpICogKHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoKSArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoIC8gMjsKICAgICAgY29uc3Qgcm9pU2NyZWVuWSA9ICh0aGlzLlJPSV95IC0gdmlzaWJsZVRvcCkgKiAod2luZG93LmlubmVySGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodCkgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0IC8gMjsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnUk9JIOWMuuWfn+WcqOWxj+W5leS4iueahOS9jee9rjogJyArIHJvaVNjcmVlblggKyAnKicgKyByb2lTY3JlZW5ZICsgJ+mVv+W6piAnICsgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGggKyAnKicgKyB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0LCAnaW5mbycpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFJlZEJveExlbmd0aCcsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lcldpZHRoIC8gbmV3VmlzaWJsZVdpZHRoLCB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJIZWlnaHQgLyBuZXdWaXNpYmxlSGVpZ2h0KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRSZWRCb3hQb3NpdGlvbicsIHJvaVNjcmVlblgsIHJvaVNjcmVlblkpOwogICAgICAvLyBpZiAoaXNSb2lJblZpc2libGUpIHsKICAgICAgLy8gICBjb25zb2xlLmxvZygnUk9JIOWMuuWfn+WcqOWPr+ingeWMuuWfn+WGhSwgUmVkQm94U2lkZUxlbmd0aDogJywgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVyV2lkdGggLyBuZXdWaXNpYmxlV2lkdGgsICcsICcsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAqIHdpbmRvdy5pbm5lckhlaWdodCAvIG5ld1Zpc2libGVIZWlnaHQpOwogICAgICAvLyB9IGVsc2UgewogICAgICAvLyAgIGNvbnNvbGUubG9nKCdST0kg5Yy65Z+f5LiN5Zyo5Y+v6KeB5Yy65Z+f5YaFLCBSZWRCb3hTaWRlTGVuZ3RoOiAnLCB0aGlzLlJlZEJveFNpZGVMZW5ndGggKiB3aW5kb3cuaW5uZXJXaWR0aCAvIG5ld1Zpc2libGVXaWR0aCwgJywgJywgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICogd2luZG93LmlubmVySGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodCk7CiAgICAgIC8vIH0KCiAgICAgIGxldCBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDorqHnrpfnm7jlhbPlj4LmlbDml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICAvLyBEcmF3IGJ1ZmZlciBjYW52YXMgb24gbWFpbiBjYW52YXMKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5tYWluQ2FudmFzOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICAvLyDojrflj5bnu5jliLbnmoTlm77lg4/mlbDmja4KICAgICAgLy8gbGV0IGltYWdlRGF0YSA9IHRoaXMuYnVmZmVyQ3R4LmdldEltYWdlRGF0YShuZXdWaXNpYmxlWCAtIG5ld1Zpc2libGVXaWR0aCAvIDIsIG5ld1Zpc2libGVZIC0gbmV3VmlzaWJsZUhlaWdodCAvIDIsIG5ld1Zpc2libGVXaWR0aCwgbmV3VmlzaWJsZUhlaWdodCk7CgogICAgICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDojrflj5bnu5jliLbnmoTlm77lg4/mlbDmja7ml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICAKICAgICAgLy8gQ3JlYXRlIGEgdGVtcG9yYXJ5IGNhbnZhcyB0byBkcmF3IHRoZSBJbWFnZURhdGEKICAgICAgdGhpcy50ZW1wQ3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLnRlbXBDYW52YXMud2lkdGgsIHRoaXMudGVtcENhbnZhcy5oZWlnaHQpOwogICAgICB0aGlzLnRlbXBDYW52YXMud2lkdGggPSBjYW52YXMud2lkdGg7CiAgICAgIHRoaXMudGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwogICAgICB0aGlzLnRlbXBDdHguZHJhd0ltYWdlKHRoaXMuYnVmZmVyQ2FudmFzLCBuZXdWaXNpYmxlWCAtIG5ld1Zpc2libGVXaWR0aCAvIDIsIG5ld1Zpc2libGVZIC0gbmV3VmlzaWJsZUhlaWdodCAvIDIsIG5ld1Zpc2libGVXaWR0aCwgbmV3VmlzaWJsZUhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKCiAgICAgIFRpbWUxID0gbmV3IERhdGUoKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnZHJhd0ltYWdlRGF0YSB8IOWIm+W7uuS4tOaXtueUu+W4g+W5tue7mOWItuaXtumXtDogJyArIChUaW1lMS5nZXRUaW1lKCkgLSBUaW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICBsZXQgaW1hZ2VEYXRhID0gdGhpcy50ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLnRlbXBDYW52YXMud2lkdGgsIHRoaXMudGVtcENhbnZhcy5oZWlnaHQpOwoKICAgICAgaWYgKHRoaXMuY3VycmVudEhpc3RvZ3JhbU1heCAhPSAyNTUgfHwgdGhpcy5jdXJyZW50SGlzdG9ncmFtTWluICE9IDApIHsKICAgICAgICBpbWFnZURhdGEgPSB0aGlzLmhpc3RvZ3JhbVN0cmV0Y2goaW1hZ2VEYXRhLCB0aGlzLmN1cnJlbnRIaXN0b2dyYW1NaW4sIHRoaXMuY3VycmVudEhpc3RvZ3JhbU1heCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLkltYWdlR2FpblIgIT0gMSB8fCB0aGlzLkltYWdlR2FpbkIgIT0gMSB8fCB0aGlzLkltYWdlT2Zmc2V0ICE9IDApIHsKICAgICAgICBpbWFnZURhdGEgPSB0aGlzLmxvY2FsV2hpdGVCYWxhbmNlQWRqdXN0bWVudChpbWFnZURhdGEsIHRoaXMuSW1hZ2VHYWluUiwgdGhpcy5JbWFnZUdhaW5CLCB0aGlzLkltYWdlT2Zmc2V0KTsKICAgICAgfQogICAgICB0aGlzLnRlbXBDdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7CgogICAgICBUaW1lMiA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDnm7Tmlrnlm77mi4nkvLjml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gVGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICAvLyBEcmF3IHRoZSBJbWFnZURhdGEgb24gdGhlIG1haW4gY2FudmFzCiAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZW1wQ2FudmFzLCAwLCAwLCB0aGlzLnRlbXBDYW52YXMud2lkdGgsIHRoaXMudGVtcENhbnZhcy5oZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgICBUaW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDnu5jliLblm77lg4/ml7bpl7Q6ICcgKyAoVGltZTEuZ2V0VGltZSgpIC0gVGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwogICAgICAvLyBjdHguZHJhd0ltYWdlKHRoaXMuYnVmZmVyQ2FudmFzLCBuZXdWaXNpYmxlWCAtIG5ld1Zpc2libGVXaWR0aCAvIDIsIG5ld1Zpc2libGVZIC0gbmV3VmlzaWJsZUhlaWdodCAvIDIsIG5ld1Zpc2libGVXaWR0aCwgbmV3VmlzaWJsZUhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn57uY5Yi25Zu+5YOPLOWPr+ingeWMuuWfnzonICsgbmV3VmlzaWJsZVggKyAnLCcgKyBuZXdWaXNpYmxlWSArICcsJyArIG5ld1Zpc2libGVXaWR0aCArICcsJyArIG5ld1Zpc2libGVIZWlnaHQsICdpbmZvJyk7CiAgICAgIHRoaXMudmlzaWJsZVggPSBuZXdWaXNpYmxlWDsKICAgICAgdGhpcy52aXNpYmxlWSA9IG5ld1Zpc2libGVZOwogICAgICB0aGlzLnZpc2libGVXaWR0aCA9IG5ld1Zpc2libGVXaWR0aDsKICAgICAgdGhpcy52aXNpYmxlSGVpZ2h0ID0gbmV3VmlzaWJsZUhlaWdodDsKCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0Q3VycmVudE1haW5DYW52YXNIYXNJbWFnZScsIHRydWUpOyAvLyDlj5HpgIHnu5nnlLXosIPvvIznlKjkuo7liKTmlq3mmK/lkKblj6/ku6Xov5vooYzlvqrnjq/mi43mkYQKICAgICAgLy8g5Y+R6YCB5raI5oGv57uZUVTlrqLmiLfnq6/vvIznlKjkuo7kv6Hmga/lm77moIcKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzZW5kUmVkQm94U3RhdGU6JyArIHRoaXMuUmVkQm94U2lkZUxlbmd0aCArICc6JyArIHRoaXMuUk9JX3ggKyAnOicgKyB0aGlzLlJPSV95KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzZW5kVmlzaWJsZUFyZWE6JyArIHRoaXMudmlzaWJsZVggKyAnOicgKyB0aGlzLnZpc2libGVZICsgJzonICsgdGhpcy5zY2FsZSk7CiAgICAgIAogICAgICAvLyDlpoLmnpzpgInmi6nkuobmmJ/ngrnvvIzliJnmoLnmja7pgInmi6nkvY3nva7vvIzlnKhST0nljLrln5/kuK3nu5jliLbkuIDkuKrlnIYKICAgICAgaWYgKHRoaXMuRHJhd1NlbGVjdFN0YXJYICE9IC0xICYmIHRoaXMuRHJhd1NlbGVjdFN0YXJZICE9IC0xICYmIHRoaXMuc2hvd1NlbGVjdFN0YXIpIHsKICAgICAgICBsZXQgcmFkaXVzLCBjYW52YXNTdGFyWCwgY2FudmFzU3RhclksIGNvbG9yOwogICAgICAgIC8vIOWmguaenOacieaYn+eCuQogICAgICAgIGlmICh0aGlzLkRyYXdTZWxlY3RTdGFySEZSICE9IC0xKSB7CiAgICAgICAgICByYWRpdXMgPSB0aGlzLkRyYXdTZWxlY3RTdGFySEZSL3RoaXMuc2NhbGUqMjsKICAgICAgICAgIGNhbnZhc1N0YXJYID0gKHRoaXMuRHJhd1NlbGVjdFN0YXJYICsgdGhpcy5ST0lfeCAtIHZpc2libGVMZWZ0KSAqIGN0eC5jYW52YXMud2lkdGggLyBuZXdWaXNpYmxlV2lkdGg7CiAgICAgICAgICBjYW52YXNTdGFyWSA9ICh0aGlzLkRyYXdTZWxlY3RTdGFyWSArIHRoaXMuUk9JX3kgLSB2aXNpYmxlVG9wKSAqIGN0eC5jYW52YXMuaGVpZ2h0IC8gbmV3VmlzaWJsZUhlaWdodDsKICAgICAgICAgIGNvbG9yID0gJ2dyZWVuJzsgLy8g5pyJ5pif54K577yM57uY5Yi257u/6Imy55qE5ZyGCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOWQpuWIme+8jOWcqOmAieaLqeeahOS9jee9rue7mOWItuS4gOS4quWchgogICAgICAgICAgcmFkaXVzID0gMTAvdGhpcy5zY2FsZTsgLy8g5L2g5Y+v5Lul5qC55o2u6ZyA6KaB6LCD5pW06L+Z5Liq5YC8CiAgICAgICAgICBjYW52YXNTdGFyWCA9ICh0aGlzLkRyYXdTZWxlY3RTdGFyWCArIHRoaXMuUk9JX3ggLSB2aXNpYmxlTGVmdCkgKiBjdHguY2FudmFzLndpZHRoIC8gbmV3VmlzaWJsZVdpZHRoOwogICAgICAgICAgY2FudmFzU3RhclkgPSAodGhpcy5EcmF3U2VsZWN0U3RhclkgKyB0aGlzLlJPSV95IC0gdmlzaWJsZVRvcCkgKiBjdHguY2FudmFzLmhlaWdodCAvIG5ld1Zpc2libGVIZWlnaHQ7CiAgICAgICAgICBjb2xvciA9ICdyZWQnOyAvLyDml6DmmJ/ngrnvvIznu5jliLbnuqLoibLnmoTlnIYKICAgICAgICB9CgogICAgICAgIC8vIOiOt+WPlue7mOWItuWchueahOS9jee9rueahOWbvuWDj+aVsOaNrgogICAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoY2FudmFzU3RhclggLSByYWRpdXMsIGNhbnZhc1N0YXJZIC0gcmFkaXVzLCAyICogcmFkaXVzLCAyICogcmFkaXVzKTsKICAgICAgICAvLyDlj5HpgIHlm77lg4/mlbDmja7nu5nmmL7npLrmoYYKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NlbGVjdFN0YXJJbWFnZScsIGltYWdlRGF0YSk7CgogICAgICAgIC8vIOWcqOaMh+WumuS9jee9ruW8gOWni+e7mOWItuWchgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHguYXJjKGNhbnZhc1N0YXJYLCBjYW52YXNTdGFyWSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDM7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgfQoKICAgICAgVGltZTIgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdkcmF3SW1hZ2VEYXRhIHwg57uY5Yi25pif54K55pe26Ze0OiAnICsgKFRpbWUyLmdldFRpbWUoKSAtIFRpbWUxLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2RyYXdJbWFnZURhdGEgfCDmgLvml7bpl7Q6ICcgKyAoVGltZTIuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKICAgIH0sCgogICAgYWRkRXZlbnRMaXN0ZW5lcnMoKSB7CiAKICAgIH0sCgogICAgLy8g6IqC5rWB5Ye95pWwCiAgICB0aHJvdHRsZShmdW5jLCBkZWxheSkgewogICAgICBsZXQgbGFzdEV4ZWN1dGVkID0gMDsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7CiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgICBpZiAobm93IC0gbGFzdEV4ZWN1dGVkID49IGRlbGF5KSB7CiAgICAgICAgICBmdW5jLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgICAgbGFzdEV4ZWN1dGVkID0gbm93OwogICAgICAgIH0KICAgICAgfTsKICAgIH0sCgogICAgSW1hZ2VTb2Z0QVdCKGltZzgsIGdhaW5SLCBnYWluQiwgb2Zmc2V0KSB7CiAgICAgIC8vIOWIhuemu+mAmumBkwogICAgICBsZXQgY2hhbm5lbHMgPSBuZXcgY3YuTWF0VmVjdG9yKCk7CiAgICAgIGN2LnNwbGl0KGltZzgsIGNoYW5uZWxzKTsKCiAgICAgIGNvbnN0IGIgPSBjaGFubmVscy5nZXQoMCk7CiAgICAgIGNvbnN0IGcgPSBjaGFubmVscy5nZXQoMSk7CiAgICAgIGNvbnN0IHIgPSBjaGFubmVscy5nZXQoMik7CgogICAgICAvLyDoh6rpgILlupTnm7Tmlrnlm77lnYfooaHljJYKICAgICAgY29uc3QgY2xhaGUgPSBuZXcgY3YuQ0xBSEUoMi4wLCBuZXcgY3YuU2l6ZSg4LCA4KSk7CiAgICAgIGNsYWhlLmFwcGx5KGIsIGIpOwogICAgICBjbGFoZS5hcHBseShnLCBnKTsKICAgICAgY2xhaGUuYXBwbHkociwgcik7CgogICAgICAvLyDlupTnlKjlop7nm4rlkozlgY/nva4KICAgICAgci5jb252ZXJ0VG8ociwgLTEsIGdhaW5SLCBvZmZzZXQpOwogICAgICBiLmNvbnZlcnRUbyhiLCAtMSwgZ2FpbkIsIG9mZnNldCk7CiAgICAgIGcuY29udmVydFRvKGcsIC0xLCAxLCBvZmZzZXQpOyAvLyDlr7nnu7/oibLpgJrpgZPlupTnlKjlgY/nva7kvYbkuI3mlLnlj5jlop7nm4oKCiAgICAgIC8vIOabtOaWsCBjaGFubmVscyDkuK3nmoTpgJrpgZPmlbDmja4KICAgICAgY2hhbm5lbHMuc2V0KDAsIGIpOwogICAgICBjaGFubmVscy5zZXQoMSwgZyk7CiAgICAgIGNoYW5uZWxzLnNldCgyLCByKTsKCiAgICAgIC8vIOWQiOW5tumAmumBkwogICAgICBsZXQgbWVyZ2VkSW1nID0gbmV3IGN2Lk1hdCgpOwogICAgICBjdi5tZXJnZShjaGFubmVscywgbWVyZ2VkSW1nKTsKCiAgICAgIC8vIOmHiuaUvui1hOa6kAogICAgICBiLmRlbGV0ZSgpOyAvLyDph4rmlL4gYgogICAgICBnLmRlbGV0ZSgpOyAvLyDph4rmlL4gZwogICAgICByLmRlbGV0ZSgpOyAvLyDph4rmlL4gcgogICAgICBjaGFubmVscy5kZWxldGUoKTsKICAgICAgY2xhaGUuZGVsZXRlKCk7IC8vIOmHiuaUviBjbGFoZQoKCgogICAgICByZXR1cm4gbWVyZ2VkSW1nOwogICAgfSwKCiAgICAvLyBCaXQxNlRvOF9TdHJldGNoKGltZzE2LCBCLCBXKSB7CiAgICAvLyAgIGNvbnNvbGUubG9nKCdCaXQxNlRvOF9TdHJldGNoIHwgQiA9ICcgKyBCICsgJywgVyA9ICcgKyBXKTsKICAgIC8vICAgbGV0IGltZzggPSBuZXcgY3YuTWF0KCk7CiAgICAvLyAgIGltZzguY3JlYXRlKGltZzE2LnJvd3MsIGltZzE2LmNvbHMsIGN2LkNWXzhVQzQpOwogICAgLy8gICBpbWcxNi5jb252ZXJ0VG8oaW1nOCwgY3YuQ1ZfOFUsIDI1NS4wIC8gKFcgLSBCKSwgLUIgKiAyNTUuMCAvIChXIC0gQikpOwoKICAgIC8vICAgY29uc3QgcmVzdWx0ID0gaW1nOC5jbG9uZSgpOyAvLyDlhYvpmoYgaW1nOCDku6Xov5Tlm57nu5PmnpwKICAgIC8vICAgaW1nOC5kZWxldGUoKTsgLy8g6YeK5pS+IGltZzgKCiAgICAvLyAgIHJldHVybiByZXN1bHQ7CiAgICAvLyB9LAogICAgQml0MTZUbzhfU3RyZXRjaChpbWcxNiwgQiwgVykgewogICAgICBjb25zb2xlLmxvZygnQml0MTZUbzhfU3RyZXRjaCB8IEIgPSAnICsgQiArICcsIFcgPSAnICsgVyk7CiAgICAgIGxldCBpbWc4ID0gbmV3IGN2Lk1hdChpbWcxNi5yb3dzLCBpbWcxNi5jb2xzLCBjdi5DVl84VUM0KTsKICAgICAgaW1nMTYuY29udmVydFRvKGltZzgsIGN2LkNWXzhVLCAyNTUuMCAvIChXIC0gQiksIC1CICogMjU1LjAgLyAoVyAtIEIpKTsKICAgICAgcmV0dXJuIGltZzg7CiAgICB9LAoKICAgIERyYXdEZXRlY3RTdGFycyhpbWFnZSwgU3RhcnMpIHsKICAgICAgY29uc29sZS5sb2coJ0RyYXcgY2lyY2xlIG9uIHRoZSBDYXB0dXJlIEltYWdlKCcsIGltYWdlLmNvbHMsICcsJywgaW1hZ2Uucm93cywgJykuJyk7CiAgICAgIGlmICghKGltYWdlIGluc3RhbmNlb2YgY3YuTWF0KSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBpbWFnZSBkYXRhJyk7CiAgICAgIH0KICAgICAgU3RhcnMuZm9yRWFjaChzdGFyID0+IHsKICAgICAgICBsZXQgY2VudGVyWCA9IE1hdGgucm91bmQoc3Rhci54IC8gKHRoaXMubWFpbkNhbWVyYVNpemVYIC8gaW1hZ2UuY29scykpOwogICAgICAgIGxldCBjZW50ZXJZID0gTWF0aC5yb3VuZChzdGFyLnkgLyAodGhpcy5tYWluQ2FtZXJhU2l6ZVkgLyBpbWFnZS5yb3dzKSk7CiAgICAgICAgbGV0IHJhZGl1cyA9IE1hdGgucm91bmQoc3Rhci5oZnIpOwoKICAgICAgICBjb25zb2xlLmxvZygnRHJhdyBjaXJjbGUgYXQoJywgY2VudGVyWCwgJywnLCBjZW50ZXJZLCAnKSB3aXRoIHJhZGl1czonLCByYWRpdXMpOwoKICAgICAgICBsZXQgY2VudGVyID0gbmV3IGN2LlBvaW50KGNlbnRlclgsIGNlbnRlclkpOwogICAgICAgIGxldCBjb2xvciA9IG5ldyBjdi5TY2FsYXIoMjU1LCAwLCAwLCAyNTUpOwogICAgICAgIGxldCB0aGlja25lc3MgPSAyOyAvLyDlnIblnIjljprluqYKCiAgICAgICAgY3YuY2lyY2xlKGltYWdlLCBjZW50ZXIsIHJhZGl1cywgY29sb3IsIHRoaWNrbmVzcyk7CgogICAgICAgIC8vIOa3u+WKoCBoZnIg5YC85Yiw5ZyG55qE5LiK5pa5CiAgICAgICAgLy8g56Gu5L+dIHN0YXIuaGZyIOaYr+S4gOS4quaVsOWtlwogICAgICAgIGxldCBoZnJWYWx1ZSA9IHBhcnNlRmxvYXQoc3Rhci5oZnIpOwogICAgICAgIGlmIChpc05hTihoZnJWYWx1ZSkpIHsKICAgICAgICAgIGhmclZhbHVlID0gMDsgLy8g5aaC5p6cIHN0YXIuaGZyIOS4jeiDvei9rOaNouS4uuaVsOWtl++8jOWImem7mOiupOWAvOiuvuS4ujAKICAgICAgICB9CgogICAgICAgIC8vIOS/neeVmeWIsOWwj+aVsOeCueWQjjLkvY0KICAgICAgICBsZXQgdGV4dCA9IGhmclZhbHVlLnRvRml4ZWQoMik7CiAgICAgICAgbGV0IGZvbnRGYWNlID0gY3YuRk9OVF9IRVJTSEVZX1NJTVBMRVg7CiAgICAgICAgbGV0IGZvbnRTY2FsZSA9IDE7CiAgICAgICAgbGV0IHRleHRDb2xvciA9IG5ldyBjdi5TY2FsYXIoMjU1LCAwLCAwLCAyNTUpOwogICAgICAgIGxldCB0ZXh0VGhpY2tuZXNzID0gMjsKCiAgICAgICAgLy8g5omL5Yqo6K6+572u5paH5pys55qE5L2N572u77yM5YGH6K6+5a2X5L2T6auY5bqm5aSn57qm5Li6MTDlg4/ntKAKICAgICAgICBsZXQgdGV4dFggPSBjZW50ZXJYIC0gKHRleHQubGVuZ3RoICogMTApOyAvLyDkvLDnrpfmr4/kuKrlrZfnrKblrr3luqbkuLo15YOP57SgCiAgICAgICAgbGV0IHRleHRZID0gY2VudGVyWSAtIHJhZGl1cyAtIDM7IC8vIOWchueahOS4iuaWuSAzIOWDj+e0oAoKICAgICAgICAvLyDlnKjlm77lg4/kuIrnu5jliLbmlofmnKwKICAgICAgICBjdi5wdXRUZXh0KGltYWdlLCB0ZXh0LCBuZXcgY3YuUG9pbnQodGV4dFgsIHRleHRZKSwgZm9udEZhY2UsIGZvbnRTY2FsZSwgdGV4dENvbG9yLCB0ZXh0VGhpY2tuZXNzKTsKICAgICAgfSk7CgogICAgICBjb25zdCBpbWFnZURhdGEgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShpbWFnZS5kYXRhKSwgaW1hZ2UuY29scywgaW1hZ2Uucm93cyk7CgogICAgICByZXR1cm4gaW1hZ2VEYXRhOwogICAgfSwKCiAgICBEcmF3UEhEMkJveChQSEQySW1hZ2VTaXplX1gsIFBIRDJJbWFnZVNpemVfWSwgQm94X1gsIEJveF9ZKSB7CiAgICAgIGNvbnN0IHJhdGlvWm9vbVggPSBQSEQySW1hZ2VTaXplX1ggLyB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgY29uc3QgcmF0aW9ab29tWSA9IFBIRDJJbWFnZVNpemVfWSAvIHdpbmRvdy5pbm5lckhlaWdodDsKCiAgICAgIGNvbnN0IEJveFdpZHRoID0gMjAgLyByYXRpb1pvb21YOwogICAgICBjb25zdCBCb3hIZWlnaHQgPSAyMCAvIHJhdGlvWm9vbVk7CgogICAgICBjb25zdCBCb3hTdGFydFggPSBCb3hfWCAvIHJhdGlvWm9vbVggLSBCb3hXaWR0aCAvIDI7CiAgICAgIGNvbnN0IEJveFN0YXJ0WSA9IEJveF9ZIC8gcmF0aW9ab29tWSAtIEJveEhlaWdodCAvIDI7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ1BIRDJCb3hQb3NpdGlvbicsIEJveFN0YXJ0WCwgQm94U3RhcnRZLCBCb3hXaWR0aCwgQm94SGVpZ2h0KTsKICAgIH0sCgogICAgRHJhd1BIRDJDcm9zcyhQSEQySW1hZ2VTaXplX1gsIFBIRDJJbWFnZVNpemVfWSwgQ3Jvc3NfWCwgQ3Jvc3NfWSkgewogICAgICBjb25zdCByYXRpb1pvb21YID0gUEhEMkltYWdlU2l6ZV9YIC8gd2luZG93LmlubmVyV2lkdGg7CiAgICAgIGNvbnN0IHJhdGlvWm9vbVkgPSBQSEQySW1hZ2VTaXplX1kgLyB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogICAgICBjb25zdCBDcm9zc1N0YXJ0WCA9IENyb3NzX1ggLyByYXRpb1pvb21YOwogICAgICBjb25zdCBDcm9zc1N0YXJ0WSA9IENyb3NzX1kgLyByYXRpb1pvb21ZOwoKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQSEQyQ3Jvc3NQb3NpdGlvbicsIENyb3NzU3RhcnRYLCBDcm9zc1N0YXJ0WSk7CiAgICB9LAoKICAgIERyYXdQSEQyTXVsdGlTdGFycyhQSEQySW1hZ2VTaXplX1gsIFBIRDJJbWFnZVNpemVfWSwgU3Rhcl9YLCBTdGFyX1kpIHsKICAgICAgY29uc3QgcmF0aW9ab29tWCA9IFBIRDJJbWFnZVNpemVfWCAvIHdpbmRvdy5pbm5lcldpZHRoOwogICAgICBjb25zdCByYXRpb1pvb21ZID0gUEhEMkltYWdlU2l6ZV9ZIC8gd2luZG93LmlubmVySGVpZ2h0OwoKICAgICAgY29uc3QgU3RhclN0YXJ0WCA9IFN0YXJfWCAvIHJhdGlvWm9vbVggLSAxMiAvIDI7CiAgICAgIGNvbnN0IFN0YXJTdGFydFkgPSBTdGFyX1kgLyByYXRpb1pvb21ZIC0gMTIgLyAyOwoKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdQSEQyTXVsdGlTdGFyc1Bvc2l0aW9uJywgU3RhclN0YXJ0WCwgU3RhclN0YXJ0WSk7CiAgICB9LAoKICAgIEdldEF1dG9TdHJldGNoKGltZ0RhdGEsIG1vZGUpIHsKICAgICAgaWYgKGltZ0RhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHsgYmxhY2tMZXZlbDogMCwgd2hpdGVMZXZlbDogNjU1MzUgfTsKICAgICAgfQoKICAgICAgY29uc3QgbGVuZ3RoID0gaW1nRGF0YS5sZW5ndGg7CiAgICAgIGxldCBtZWFuID0gMDsKICAgICAgbGV0IE0yID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBkZWx0YSA9IGltZ0RhdGFbaV0gLSBtZWFuOwogICAgICAgIG1lYW4gKz0gZGVsdGEgLyAoaSArIDEpOwogICAgICAgIE0yICs9IGRlbHRhICogKGltZ0RhdGFbaV0gLSBtZWFuKTsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2UgPSBNMiAvIGxlbmd0aDsKICAgICAgY29uc3Qgc3RkID0gTWF0aC5zcXJ0KHZhcmlhbmNlKTsKCiAgICAgIGxldCBhLCBiOwogICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBhID0gMzsKICAgICAgICAgIGIgPSA1OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgYSA9IDI7CiAgICAgICAgICBiID0gNTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGEgPSAzOwogICAgICAgICAgYiA9IDg7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYSA9IDI7CiAgICAgICAgICBiID0gODsKICAgICAgfQoKICAgICAgbGV0IGJ4ID0gTWF0aC5tYXgoMCwgbWVhbiAtIHN0ZCAqIGEpOwogICAgICBsZXQgd3ggPSBNYXRoLm1pbig2NTUzNSwgbWVhbiArIHN0ZCAqIGIpOwoKICAgICAgbGV0IGJsYWNrTGV2ZWwgPSBNYXRoLnJvdW5kKGJ4KTsKICAgICAgbGV0IHdoaXRlTGV2ZWwgPSBNYXRoLnJvdW5kKHd4KTsKCiAgICAgIGlmIChibGFja0xldmVsID49IHdoaXRlTGV2ZWwpIHsKICAgICAgICBibGFja0xldmVsID0gd2hpdGVMZXZlbCAtIDE7CiAgICAgIH0KCiAgICAgIHJldHVybiB7IGJsYWNrTGV2ZWwsIHdoaXRlTGV2ZWwgfTsKICAgIH0sCgogICAgZmV0Y2hJbWFnZShpbWFnZVBhdGgpIHsKICAgICAgY29uc3QgdXJsID0gaW1hZ2VQYXRoOwogICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnYmxvYic7IC8vIOiuvue9ruWTjeW6lOexu+Wei+S4uiBibG9iCgogICAgICB4aHIub25sb2FkID0gKCkgPT4gewogICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIGNvbnN0IGltYWdlVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTCh4aHIucmVzcG9uc2UpOwogICAgICAgICAgLy8g5Zyo6L+Z6YeM77yM5oKo5Y+v5Lul5bCGIGltYWdlVXJsIOiuvue9ruWIsOafkOS4qiA8aW1nPiDlhYPntKDkuIrvvIzmiJbogIXlgZrlhbbku5blpITnkIYKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2hvd0NhcHR1cmVJbWFnZScpOwogICAgICAgICAgdGhpcy5kaXNwbGF5SW1hZ2VPbkNhbnZhcyhpbWFnZVVybCk7IC8vIOWwhuWbvuWDj+aYvuekuuWcqENhbnZhc+S4igogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggdGhlIGltYWdlLiBTdGF0dXM6JywgeGhyLnN0YXR1cyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgeGhyLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcignVGhlcmUgd2FzIGFuIGVycm9yIGZldGNoaW5nIHRoZSBpbWFnZS4nKTsKICAgICAgfTsKCiAgICAgIHhoci5vcGVuKCdHRVQnLCB1cmwsIHRydWUpOwogICAgICB4aHIuc2VuZCgpOwogICAgfSwKCiAgICBkaXNwbGF5SW1hZ2VPbkNhbnZhcyhpbWFnZVVybCkgewogICAgICBjb25zdCBzaG93Y2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5DYW1lcmEtY2FudmFzJyk7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdUZXN0Q2FudmFzJyk7CiAgICAgIGNvbnN0IHNob3djdHggPSBzaG93Y2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBzaG93Y2FudmFzLndpZHRoID0gdGhpcy5DYW52YXNXaWR0aDsKICAgICAgc2hvd2NhbnZhcy5oZWlnaHQgPSB0aGlzLkNhbnZhc0hlaWdodDsKICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IGNhbnZhcyBzaXplOicsIHNob3djYW52YXMud2lkdGgsIHNob3djYW52YXMuaGVpZ2h0KTsKCiAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICBpbWcuc2V0QXR0cmlidXRlKCdjcm9zc09yaWdpbicsICcnKTsKICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICB0aGlzLmhpc3RvZ3JhbUltYWdlID0gaW1nOwoKICAgICAgICAvLyDorqHnrpflm77lg4/nmoTnvKnmlL7mr5Tkvovku6Xkvb/lhbbpk7rmu6Hlm7rlrprlpKflsI/nmoQgQ2FudmFzCiAgICAgICAgY29uc3Qgc2NhbGVXaWR0aCA9IHNob3djYW52YXMud2lkdGggLyBpbWcud2lkdGg7CiAgICAgICAgY29uc3Qgc2NhbGVIZWlnaHQgPSBzaG93Y2FudmFzLmhlaWdodCAvIGltZy5oZWlnaHQ7CgogICAgICAgIGNvbnN0IHdpZHRoID0gaW1nLndpZHRoICogc2NhbGVXaWR0aDsKICAgICAgICBjb25zdCBoZWlnaHQgPSBpbWcuaGVpZ2h0ICogc2NhbGVIZWlnaHQ7CgogICAgICAgIC8vIOa4heepuiBDYW52YXMKICAgICAgICBzaG93Y3R4LmNsZWFyUmVjdCgwLCAwLCBzaG93Y2FudmFzLndpZHRoLCBzaG93Y2FudmFzLmhlaWdodCk7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBzaG93Y2FudmFzLndpZHRoLCBzaG93Y2FudmFzLmhlaWdodCk7CgogICAgICAgIC8vIOWcqCBDYW52YXMg5LiK57uY5Yi25Zu+5YOPCiAgICAgICAgc2hvd2N0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IGNyb3NzT3JpZ2luOicsIGltZy5jcm9zc09yaWdpbik7CiAgICAgICAgdGhpcy5pbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgY29uc29sZS5sb2coJ1FIWUNDRCB8IGltYWdlRGF0YTonLCB0aGlzLmltYWdlRGF0YSk7CiAgICAgICAgdGhpcy5NYWtlSGlzdG9ncmFtKHRoaXMuaW1hZ2VEYXRhKTsKICAgICAgfTsKICAgICAgaW1nLnNyYyA9IGltYWdlVXJsOwogICAgfSwKCiAgICBNYWtlSGlzdG9ncmFtKGltYWdlRGF0YSkgewogICAgICBjb25zb2xlLmxvZygnTWFrZUhpc3RvZ3JhbScpOwoKICAgICAgLy8g6K6h566X5LiJ5Liq6YCa6YGT55qE55u05pa55Zu+CiAgICAgIHRoaXMuaGlzdG9ncmFtRGF0YSA9IHRoaXMuY2FsY3VsYXRlSGlzdG9ncmFtKGltYWdlRGF0YSk7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dIaXN0b2dyYW0nLCB0aGlzLmhpc3RvZ3JhbURhdGEpOwogICAgfSwKCiAgICBjYWxjdWxhdGVIaXN0b2dyYW0oaW1hZ2VEYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKCdRSFlDQ0QgfCBjYWxjdWxhdGVIaXN0b2dyYW0nKTsKICAgICAgY29uc3QgaGlzdG9ncmFtID0gWwogICAgICAgIEFycmF5KDI1NikuZmlsbCgwKSwgLy8g5a2Y5YKo6JOd6Imy6YCa6YGT55u05pa55Zu+CiAgICAgICAgQXJyYXkoMjU2KS5maWxsKDApLCAvLyDlrZjlgqjnu7/oibLpgJrpgZPnm7Tmlrnlm74KICAgICAgICBBcnJheSgyNTYpLmZpbGwoMCkgIC8vIOWtmOWCqOe6ouiJsumAmumBk+ebtOaWueWbvgogICAgICBdOwoKICAgICAgLy8g5YiG5Yir6K6h566X5LiJ5Liq6YCa6YGT55qE55u05pa55Zu+CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICBjb25zdCByID0gaW1hZ2VEYXRhLmRhdGFbaV07CiAgICAgICAgY29uc3QgZyA9IGltYWdlRGF0YS5kYXRhW2kgKyAxXTsKICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbaSArIDJdOwoKICAgICAgICAvLyDmm7TmlrDmr4/kuKrpgJrpgZPnmoTnm7Tmlrnlm74KICAgICAgICBoaXN0b2dyYW1bMF1bYl0rKzsKICAgICAgICBoaXN0b2dyYW1bMV1bZ10rKzsKICAgICAgICBoaXN0b2dyYW1bMl1bcl0rKzsKICAgICAgfQoKICAgICAgcmV0dXJuIGhpc3RvZ3JhbTsKICAgIH0sCgogICAgYXBwbHlIaXN0U3RyZXRjaChNaW4sIE1heCkgewogICAgICB0aGlzLmN1cnJlbnRIaXN0b2dyYW1NaW4gPSBNaW47CiAgICAgIHRoaXMuY3VycmVudEhpc3RvZ3JhbU1heCA9IE1heDsKICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2hhbmdlRGlhbFBvc2l0aW9uJywgTWluLCBNYXgpOwogICAgfSwKCiAgICBzZXRBdXRvSGlzdG9ncmFtTnVtKG1pbiwgbWF4KSB7CiAgICAgIHRoaXMuaGlzdG9ncmFtX21pbiA9IG1pbjsKICAgICAgdGhpcy5oaXN0b2dyYW1fbWF4ID0gbWF4OwogICAgICB0aGlzLmN1cnJlbnRIaXN0b2dyYW1NaW4gPSBtaW47CiAgICAgIHRoaXMuY3VycmVudEhpc3RvZ3JhbU1heCA9IG1heDsKICAgIH0sCgogICAgY2FsY1doaXRlQmFsYW5jZUdhaW5zKCkgewogICAgICAvLyBjb25zdCBHYWlucyA9IHRoaXMuY2FsY3VsYXRlV2hpdGVCYWxhbmNlR2FpbnModGhpcy5oaXN0b2dyYW1EYXRhLCB0aGlzLkltYWdlT2Zmc2V0KTsKICAgICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgY29uc3QgR2FpbnMgPSB0aGlzLmNhbGN1bGF0ZVdoaXRlQmFsYW5jZUdhaW5zKCk7CiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdjYWxjV2hpdGVCYWxhbmNlR2FpbnMgfCDmgLvml7bpl7Q6ICcgKyAoZW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgdGhpcy5JbWFnZUdhaW5SID0gR2FpbnMuR2FpblI7CiAgICAgIHRoaXMuSW1hZ2VHYWluQiA9IEdhaW5zLkdhaW5COwoKICAgICAgY29uc3QgR2FpblJJbmRleCA9IHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdJbWFnZUdhaW5SJyk7CiAgICAgIGlmIChHYWluUkluZGV4ICE9PSAtMSkgeyAvLyDnoa7kv53mib7liLDkuoblr7nlupTnmoTphY3nva7pobkKICAgICAgICAvLyDmm7TmlrAgRXhwVGltZTEg6YWN572u6aG555qE5YC8CiAgICAgICAgdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXNbR2FpblJJbmRleF0udmFsdWUgPSB0aGlzLkltYWdlR2FpblI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcignSW1hZ2VHYWluUiBjb25maWd1cmF0aW9uIGl0ZW0gbm90IGZvdW5kLicpOwogICAgICB9CgogICAgICBjb25zdCBHYWluQkluZGV4ID0gdGhpcy5NYWluQ2FtZXJhQ29uZmlnSXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ0ltYWdlR2FpbkInKTsKICAgICAgaWYgKEdhaW5CSW5kZXggIT09IC0xKSB7IC8vIOehruS/neaJvuWIsOS6huWvueW6lOeahOmFjee9rumhuQogICAgICAgIC8vIOabtOaWsCBFeHBUaW1lMSDphY3nva7pobnnmoTlgLwKICAgICAgICB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtc1tHYWluQkluZGV4XS52YWx1ZSA9IHRoaXMuSW1hZ2VHYWluQjsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdJbWFnZUdhaW5CIGNvbmZpZ3VyYXRpb24gaXRlbSBub3QgZm91bmQuJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgICAvLyB0aGlzLnByb2Nlc3NJbWFnZSh0aGlzLkltYWdlQXJyYXlCdWZmZXIpOwogICAgfSwKCiAgICAvLyBjYWxjdWxhdGVXaGl0ZUJhbGFuY2VHYWlucyhoaXN0b2dyYW0sIG9mZnNldCkgewogICAgLy8gICBsZXQgc3VtUiA9IDAsIHN1bUcgPSAwLCBzdW1CID0gMDsKICAgIC8vICAgbGV0IGNvdW50UiA9IDAsIGNvdW50RyA9IDAsIGNvdW50QiA9IDA7CgogICAgLy8gICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAvLyAgIC8vICAgc3VtUiArPSBoaXN0b2dyYW1bMl1baV0gKiBpOwogICAgLy8gICAvLyAgIHN1bUcgKz0gaGlzdG9ncmFtWzFdW2ldICogaTsKICAgIC8vICAgLy8gICBzdW1CICs9IGhpc3RvZ3JhbVswXVtpXSAqIGk7CgogICAgLy8gICAvLyAgIGNvdW50UiArPSBoaXN0b2dyYW1bMl1baV07CiAgICAvLyAgIC8vICAgY291bnRHICs9IGhpc3RvZ3JhbVsxXVtpXTsKICAgIC8vICAgLy8gICBjb3VudEIgKz0gaGlzdG9ncmFtWzBdW2ldOwogICAgLy8gICAvLyB9CgogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAvLyAgICAgLy8gU3VidHJhY3Qgb2Zmc2V0IGZyb20gcGl4ZWwgdmFsdWUKICAgIC8vICAgICBjb25zdCBhZGp1c3RlZFIgPSBNYXRoLm1heChpIC0gb2Zmc2V0LCAwKTsKICAgIC8vICAgICBjb25zdCBhZGp1c3RlZEcgPSBNYXRoLm1heChpIC0gb2Zmc2V0LCAwKTsKICAgIC8vICAgICBjb25zdCBhZGp1c3RlZEIgPSBNYXRoLm1heChpIC0gb2Zmc2V0LCAwKTsKCiAgICAvLyAgICAgc3VtUiArPSBoaXN0b2dyYW1bMl1baV0gKiBhZGp1c3RlZFI7CiAgICAvLyAgICAgc3VtRyArPSBoaXN0b2dyYW1bMV1baV0gKiBhZGp1c3RlZEc7CiAgICAvLyAgICAgc3VtQiArPSBoaXN0b2dyYW1bMF1baV0gKiBhZGp1c3RlZEI7CgogICAgLy8gICAgIGNvdW50UiArPSBoaXN0b2dyYW1bMl1baV07CiAgICAvLyAgICAgY291bnRHICs9IGhpc3RvZ3JhbVsxXVtpXTsKICAgIC8vICAgICBjb3VudEIgKz0gaGlzdG9ncmFtWzBdW2ldOwogICAgLy8gICB9CgogICAgLy8gICBjb25zdCBtZWFuUiA9IHN1bVIgLyBjb3VudFI7CiAgICAvLyAgIGNvbnN0IG1lYW5HID0gc3VtRyAvIGNvdW50RzsKICAgIC8vICAgY29uc3QgbWVhbkIgPSBzdW1CIC8gY291bnRCOwoKICAgIC8vICAgLy8gQ2FsY3VsYXRlIGdhaW5zCiAgICAvLyAgIGNvbnN0IEdhaW5SID0gbWVhbkcgLyBtZWFuUjsKICAgIC8vICAgY29uc3QgR2FpbkIgPSBtZWFuRyAvIG1lYW5COwoKICAgIC8vICAgY29uc29sZS5sb2coYEdhaW5SOiAke0dhaW5SfSwgR2FpbkI6ICR7R2FpbkJ9YCk7CiAgICAvLyAgIHJldHVybiB7IEdhaW5SLCBHYWluQiB9OwogICAgLy8gfSwKCiAgICBjYWxjdWxhdGVXaGl0ZUJhbGFuY2VHYWlucygpIHsKICAgICAgaWYgKCEodGhpcy5PcmlnaW5hbEltYWdlIGluc3RhbmNlb2YgSW1hZ2VEYXRhKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBpbWFnZSBkYXRhJyk7CiAgICAgIH0KCiAgICAgIGxldCB0aW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIC8vIOWIm+W7uuS4gOS4quaWsOeahCBjdi5NYXQg5a+56LGhCiAgICAgIGxldCBpbWc4ID0gY3YubWF0RnJvbUltYWdlRGF0YSh0aGlzLk9yaWdpbmFsSW1hZ2UpOwogICAgICBsZXQgdGltZTIgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdjYWxjV2hpdGVCYWxhbmNlR2FpbnMgfCDliJvlu7ogY3YuTWF0IOWvueixoeaXtumXtDogJyArICh0aW1lMi5nZXRUaW1lKCkgLSB0aW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICBsZXQgZ2FpblIgPSB0aGlzLkltYWdlR2FpblI7CiAgICAgIGxldCBnYWluQiA9IHRoaXMuSW1hZ2VHYWluQjsKICAgICAgbGV0IG9mZnNldCA9IHRoaXMuSW1hZ2VPZmZzZXQ7CgogICAgICBjb25zdCBjaGFubmVscyA9IG5ldyBjdi5NYXRWZWN0b3IoKTsKICAgICAgY3Yuc3BsaXQoaW1nOCwgY2hhbm5lbHMpOwogICAgICB0aW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOWIhuWJsumAmumBk+aXtumXtDogJyArICh0aW1lMS5nZXRUaW1lKCkgLSB0aW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICBjb25zdCBiID0gY2hhbm5lbHMuZ2V0KDApOwogICAgICBjb25zdCBnID0gY2hhbm5lbHMuZ2V0KDEpOwogICAgICBjb25zdCByID0gY2hhbm5lbHMuZ2V0KDIpOwogICAgICB0aW1lMiA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOiOt+WPlumAmumBk+aXtumXtDogJyArICh0aW1lMi5nZXRUaW1lKCkgLSB0aW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAvLyDoh6rpgILlupTnm7Tmlrnlm77lnYfooaHljJYKICAgICAgY29uc3QgY2xhaGUgPSBuZXcgY3YuQ0xBSEUoMi4wLCBuZXcgY3YuU2l6ZSg4LCA4KSk7CiAgICAgIGNsYWhlLmFwcGx5KGIsIGIpOwogICAgICBjbGFoZS5hcHBseShnLCBnKTsKICAgICAgY2xhaGUuYXBwbHkociwgcik7CiAgICAgIHRpbWUxID0gbmV3IERhdGUoKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnY2FsY1doaXRlQmFsYW5jZUdhaW5zIHwg6Ieq6YCC5bqU55u05pa55Zu+5Z2H6KGh5YyW5pe26Ze0OiAnICsgKHRpbWUxLmdldFRpbWUoKSAtIHRpbWUyLmdldFRpbWUoKSkgKyAnIG1zJywgJ2luZm8nKTsKCiAgICAgIC8vIOS9v+eUqOS4reS9jeaVsOiuoeeul+WinuebigogICAgICBjb25zdCBtZWRpYW5CID0gbmV3IGN2Lk1hdCgpOwogICAgICBjb25zdCBtZWRpYW5HID0gbmV3IGN2Lk1hdCgpOwogICAgICBjb25zdCBtZWRpYW5SID0gbmV3IGN2Lk1hdCgpOwogICAgICBjdi5tZWRpYW5CbHVyKGIsIG1lZGlhbkIsIDUpOwogICAgICBjdi5tZWRpYW5CbHVyKGcsIG1lZGlhbkcsIDUpOwogICAgICBjdi5tZWRpYW5CbHVyKHIsIG1lZGlhblIsIDUpOwogICAgICB0aW1lMiA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOS4reS9jeaVsOiuoeeul+WinuebiuaXtumXtDogJyArICh0aW1lMi5nZXRUaW1lKCkgLSB0aW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICBjb25zdCBhdmdCID0gY3YubWVhbihtZWRpYW5CKVswXTsKICAgICAgY29uc3QgYXZnRyA9IGN2Lm1lYW4obWVkaWFuRylbMF07CiAgICAgIGNvbnN0IGF2Z1IgPSBjdi5tZWFuKG1lZGlhblIpWzBdOwoKICAgICAgdGltZTEgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdjYWxjV2hpdGVCYWxhbmNlR2FpbnMgfCDorqHnrpflop7nm4rml7bpl7Q6ICcgKyAodGltZTEuZ2V0VGltZSgpIC0gdGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgZ2FpblIgPSBNYXRoLm1pbihNYXRoLm1heChhdmdHIC8gYXZnUiwgMC4xKSwgMyk7CiAgICAgIGdhaW5CID0gTWF0aC5taW4oTWF0aC5tYXgoYXZnRyAvIGF2Z0IsIDAuMSksIDMpOwoKICAgICAgLy8g5bqU55So5aKe55uK5ZKM5YGP572uCiAgICAgIHIuY29udmVydFRvKHIsIC0xLCBnYWluUiwgb2Zmc2V0KTsKICAgICAgYi5jb252ZXJ0VG8oYiwgLTEsIGdhaW5CLCBvZmZzZXQpOwogICAgICBnLmNvbnZlcnRUbyhnLCAtMSwgMSwgb2Zmc2V0KTsgLy8g5a+557u/6Imy6YCa6YGT5bqU55So5YGP572u5L2G5LiN5pS55Y+Y5aKe55uKCgogICAgICB0aW1lMiA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOW6lOeUqOWinuebiuWSjOWBj+e9ruaXtumXtDogJyArICh0aW1lMi5nZXRUaW1lKCkgLSB0aW1lMS5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAvLyDmm7TmlrAgY2hhbm5lbHMg5Lit55qE6YCa6YGT5pWw5o2uCiAgICAgIGNoYW5uZWxzLnNldCgwLCBiKTsKICAgICAgY2hhbm5lbHMuc2V0KDEsIGcpOwogICAgICBjaGFubmVscy5zZXQoMiwgcik7CgogICAgICB0aW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOabtOaWsCBjaGFubmVscyDkuK3nmoTpgJrpgZPmlbDmja7ml7bpl7Q6ICcgKyAodGltZTEuZ2V0VGltZSgpIC0gdGltZTIuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgLy8g5ZCI5bm26YCa6YGT5ZueIGltZzgKICAgICAgY3YubWVyZ2UoY2hhbm5lbHMsIGltZzgpOwoKICAgICAgdGltZTIgPSBuZXcgRGF0ZSgpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdjYWxjV2hpdGVCYWxhbmNlR2FpbnMgfCDlkIjlubbpgJrpgZPml7bpl7Q6ICcgKyAodGltZTIuZ2V0VGltZSgpIC0gdGltZTEuZ2V0VGltZSgpKSArICcgbXMnLCAnaW5mbycpOwoKICAgICAgYi5kZWxldGUoKTsKICAgICAgZy5kZWxldGUoKTsKICAgICAgci5kZWxldGUoKTsKICAgICAgbWVkaWFuQi5kZWxldGUoKTsKICAgICAgbWVkaWFuRy5kZWxldGUoKTsKICAgICAgbWVkaWFuUi5kZWxldGUoKTsKICAgICAgY2hhbm5lbHMuZGVsZXRlKCk7CgogICAgICB0aW1lMSA9IG5ldyBEYXRlKCk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ2NhbGNXaGl0ZUJhbGFuY2VHYWlucyB8IOWIoOmZpOmAmumBk+aXtumXtDogJyArICh0aW1lMS5nZXRUaW1lKCkgLSB0aW1lMi5nZXRUaW1lKCkpICsgJyBtcycsICdpbmZvJyk7CgogICAgICAvLyBpZiAodGhpcy5pc1BvbGFyQXhpc01vZGUpIHsKICAgICAgLy8gICB0aGlzLiRidXMuJGVtaXQoJ3Nob3dTb2x2ZUltYWdlJywgaW1nOCk7CiAgICAgIC8vIH0KICAgICAgLy8gZWxzZSB7CiAgICAgIC8vICAgLy8g5Yib5bu655So5LqO57uY5Yi255qEIEltYWdlRGF0YSDlr7nosaHvvIzlubblnKjkv67mlLnlkI7nmoTnlLvluIPkuIrnu5jliLblm77lg48KICAgICAgLy8gICBsZXQgY29sb3JEYXRhID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoaW1nOC5kYXRhKSwgaW1nOC5jb2xzLCBpbWc4LnJvd3MpOwogICAgICAvLyAgIGltZzguZGVsZXRlKCk7CiAgICAgIC8vICAgdGhpcy5kcmF3SW1nRGF0YSA9IGNvbG9yRGF0YTsKICAgICAgLy8gICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKCiAgICAgIC8vICAgdGhpcy4kYnVzLiRlbWl0KCdzaG93Q2FwdHVyZUltYWdlJyk7CgogICAgICAvLyAgIHRoaXMuTWFrZUhpc3RvZ3JhbShjb2xvckRhdGEpOwogICAgICAvLyAgIHRoaXMuaGlzdG9ncmFtSW1hZ2UgPSBjb2xvckRhdGE7CgogICAgICAvLyB9CiAgICAgIHJldHVybiB7IEdhaW5SOiBnYWluUiwgR2FpbkI6IGdhaW5CIH07CiAgICB9LAoKICAgIGxvYWRPcGVuQ3YoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgaWYgKHR5cGVvZiBjdiA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIC8vIOWmguaenCBjdiDmnKrlrprkuYnvvIzlsJ3or5XliqDovb0gT3BlbkNWLmpzCiAgICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgIHNjcmlwdC5zcmMgPSAnL29wZW5jdi5qcyc7IC8vIOS9v+eUqCBwdWJsaWMg5paH5Lu25aS55Lit55qE6Lev5b6ECiAgICAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlOwogICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfTsKICAgICAgICAgIHNjcmlwdC5vbmVycm9yID0gKGVycm9yKSA9PiB7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICB9OwogICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDlpoLmnpwgY3Yg5bey5a6a5LmJ77yM55u05o6l6Kej5p6QCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLy8gbG9hZE9wZW5DdigpIHsKICAgIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIC8vICAgICBpZiAodHlwZW9mIGN2ID09PSAndW5kZWZpbmVkJykgewogICAgLy8gICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAvLyAgICAgICBzY3JpcHQuc3JjID0gJ2h0dHBzOi8vZG9jcy5vcGVuY3Yub3JnLzQuNS41L29wZW5jdi5qcyc7CiAgICAvLyAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlOwogICAgLy8gICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgIC8vICAgICAgICAgaWYgKHR5cGVvZiBjdiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIC8vICAgICAgICAgICByZXNvbHZlKCk7CiAgICAvLyAgICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignRmFpbGVkIHRvIGxvYWQgT3BlbkNWLmpzJykpOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBzY3JpcHQub25lcnJvciA9IChlcnJvcikgPT4gewogICAgLy8gICAgICAgICByZWplY3QoZXJyb3IpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgLy8gICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICByZXNvbHZlKCk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKICAgIC8vIH0sCgogICAgb25DdlJlYWR5KCkgewoKICAgICAgLy8gVGVzdCBpZiBzb21lIG9mIG9wZW5jdiBtZXRob2QgY2FuIHdvcmsuCiAgICAgIGlmIChjdikgewogICAgICAgIGNvbnNvbGUubG9nKCJRSFlDQ0QgfCBPcGVuQ1YuanMgaXMgcmVhZHkuIik7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnT3BlbkNWLmpzIGlzIHJlYWR5LicsICdpbmZvJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coIlFIWUNDRCB8IEZhaWxlZCB0byBsb2FkIE9wZW5DVi5qcyIpOwogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ0ZhaWxlZCB0byBsb2FkIE9wZW5DVi5qcy4nLCAnZXJyb3InKTsKICAgICAgfQoKICAgICAgdGhpcy5jdlJlYWR5ID0gdHJ1ZTsKICAgIH0sCgoKICAgIGxvYWRJbWFnZVRvQ2FudmFzTWFpbkNhbWVyYTogZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNhbWVyYS1jYW52YXMnKTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7CiAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAvLyDojrflj5borr7lpIflg4/ntKDmr5QKICAgICAgICBjb25zdCBkZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKCiAgICAgICAgLy8g6LCD5pW055S75biD5bC65a+45Lul6YCC5bqU6auY5riF5pi+56S6CiAgICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGggKiBkZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQgKiBkZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIGN0eC5zY2FsZShkZXZpY2VQaXhlbFJhdGlvLCBkZXZpY2VQaXhlbFJhdGlvKTsgLy8g57yp5pS+Y3R45Lul6YCC5bqU6auY5riF55S75biDCgogICAgICAgIC8vIOe7mOWItuWbvuWDjwogICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICB9OwogICAgICBpbWFnZS5zcmMgPSBCYWNrZ3JvdW5kSW1hZ2U7CiAgICB9LAogICAgbG9hZEltYWdlVG9DYW52YXNHdWlkZXJDYW1lcmE6IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d1aWRlckNhbWVyYS1jYW52YXMnKTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7CiAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAvLyDojrflj5borr7lpIflg4/ntKDmr5QKICAgICAgICBjb25zdCBkZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKCiAgICAgICAgLy8g6LCD5pW055S75biD5bC65a+45Lul6YCC5bqU6auY5riF5pi+56S6CiAgICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGggKiBkZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQgKiBkZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIGN0eC5zY2FsZShkZXZpY2VQaXhlbFJhdGlvLCBkZXZpY2VQaXhlbFJhdGlvKTsgLy8g57yp5pS+Y3R45Lul6YCC5bqU6auY5riF55S75biDCgogICAgICAgIC8vIOe7mOWItuWbvuWDjwogICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICB9OwogICAgICBpbWFnZS5zcmMgPSBCYWNrZ3JvdW5kSW1hZ2U7CiAgICB9LAoKCiAgICBzaG93R3VpZGVyQ2FtZXJhQ2FudmFzKCkgewogICAgICAvLyDliqjmgIHmm7TmlrB6LWluZGV4CiAgICAgIHRoaXMuY2FudmFzWkluZGV4U3RlbCA9IC0xMDsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhNYWluQ2FtZXJhID0gLTExOwogICAgICB0aGlzLmNhbnZhc1pJbmRleEd1aWRlckNhbWVyYSA9IDA7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UGFyc2luZ1Byb2dyZXNzJywgZmFsc2UpOwoKICAgICAgLy8gdGhpcy5jb252ZXJ0VG9HcmF5c2NhbGUoKTsKICAgIH0sCgogICAgc2hvd1N0ZWxDYW52YXMoKSB7CiAgICAgIGlmICh0aGlzLmlzUG9sYXJBeGlzTW9kZSkgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UGFyc2luZ1Byb2dyZXNzJywgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRQYXJzaW5nUHJvZ3Jlc3MnLCBmYWxzZSk7CiAgICAgIH0KICAgICAgdGhpcy5jYW52YXNaSW5kZXhTdGVsID0gMDsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhNYWluQ2FtZXJhID0gLTEwOwogICAgICB0aGlzLmNhbnZhc1pJbmRleEd1aWRlckNhbWVyYSA9IC0xMTsKICAgIH0sCgogICAgc2hvd01haW5DYW1lcmFDYW52YXMoKSB7CiAgICAgIHRoaXMuY2FudmFzWkluZGV4U3RlbCA9IC0xMDsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhNYWluQ2FtZXJhID0gMDsKICAgICAgdGhpcy5jYW52YXNaSW5kZXhHdWlkZXJDYW1lcmEgPSAtMTE7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UGFyc2luZ1Byb2dyZXNzJywgZmFsc2UpOwogICAgfSwKCgogICAgaGFuZGxlQnV0dG9uVGVzdENsaWNrKCkgewogICAgICAvLyB0aGlzLmNoYW5nZU9yZGVyKCk7CiAgICAgIGlmICh0aGlzLmN1cnJlbnRjYW52YXMgPT09ICdTdGVsJykgewogICAgICAgIHRoaXMuY3VycmVudGNhbnZhcyA9ICdNYWluQ2FtZXJhJzsKICAgICAgICB0aGlzLnNob3dNYWluQ2FtZXJhQ2FudmFzKCk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhpcy5jdXJyZW50Y2FudmFzID09PSAnTWFpbkNhbWVyYScpIHsKICAgICAgICB0aGlzLmN1cnJlbnRjYW52YXMgPSAnR3VpZGVyQ2FtZXJhJzsKICAgICAgICB0aGlzLnNob3dHdWlkZXJDYW1lcmFDYW52YXMoKTsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGlzLmN1cnJlbnRjYW52YXMgPT09ICdHdWlkZXJDYW1lcmEnKSB7CiAgICAgICAgdGhpcy5jdXJyZW50Y2FudmFzID0gJ1N0ZWwnOwogICAgICAgIHRoaXMuc2hvd1N0ZWxDYW52YXMoKTsKICAgICAgfQogICAgfSwKCiAgICBnZXRQbHVnaW5zTWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7CiAgICAgIGxldCByZXMgPSBbXQogICAgICBmb3IgKGNvbnN0IGkgaW4gdGhpcy4kc3RlbGxhcml1bVdlYlBsdWdpbnMoKSkgewogICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKClbaV0KICAgICAgICBpZiAocGx1Z2luLm1lbnVJdGVtcykgewogICAgICAgICAgcmVzID0gcmVzLmNvbmNhdChwbHVnaW4ubWVudUl0ZW1zKQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9LAogICAgZ2V0UGx1Z2luc01lbnVDb21wb25lbnRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIGxldCByZXMgPSBbXQogICAgICBmb3IgKGNvbnN0IGkgaW4gdGhpcy4kc3RlbGxhcml1bVdlYlBsdWdpbnMoKSkgewogICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKClbaV0KICAgICAgICBpZiAocGx1Z2luLm1lbnVDb21wb25lbnRzKSB7CiAgICAgICAgICByZXMgPSByZXMuY29uY2F0KHBsdWdpbi5tZW51Q29tcG9uZW50cykKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfSwKICAgIHRvZ2dsZVN0b3JlVmFsdWU6IGZ1bmN0aW9uIChzdG9yZVZhck5hbWUpIHsKICAgICAgdGhpcy5uYXYgPSBmYWxzZTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCd0b2dnbGVCb29sJywgc3RvcmVWYXJOYW1lKQogICAgfSwKICAgIGdldFN0b3JlVmFsdWU6IGZ1bmN0aW9uIChzdG9yZVZhck5hbWUpIHsKICAgICAgcmV0dXJuIF8uZ2V0KHRoaXMuJHN0b3JlLnN0YXRlLCBzdG9yZVZhck5hbWUpCiAgICB9LAogICAgc2V0U3RhdGVGcm9tUXVlcnlBcmdzOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlIG9ic2VydmluZyBwYW5lbCBtdXN0IGJlIGRpc3BsYXllZAogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFZhbHVlJywgeyB2YXJOYW1lOiAnc2hvd1NpZGVQYW5lbCcsIG5ld1ZhbHVlOiB0aGlzLiRyb3V0ZS5wYXRoLnN0YXJ0c1dpdGgoJy9wLycpIH0pCgogICAgICAvLyBTZXQgdGhlIGNvcmUncyBzdGF0ZSBmcm9tIFVSTCBxdWVyeSBhcmd1bWVudHMgc3VjaAogICAgICAvLyBhcyBkYXRlLCBsb2NhdGlvbiwgdmlldyBkaXJlY3Rpb24gJiBmb3YKICAgICAgbGV0IHRoYXQgPSB0aGlzCgogICAgICBpZiAoIXRoaXMuaW5pdERvbmUpIHsKICAgICAgICB0aGlzLiRzdGVsLmNvcmUudGltZV9zcGVlZCA9IDEKICAgICAgICBsZXQgZCA9IG5ldyBEYXRlKCkKICAgICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkuZGF0ZSkgewogICAgICAgICAgZCA9IG5ldyBNb21lbnQodGhpcy4kcm91dGUucXVlcnkuZGF0ZSkudG9EYXRlKCkKICAgICAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci51dGMgPSBkLmdldE1KRCgpCiAgICAgICAgICB0aGlzLnN0YXJ0VGltZUlzU2V0ID0gdHJ1ZQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LmxuZyAmJiB0aGlzLiRyb3V0ZS5xdWVyeS5sYXQpIHsKICAgICAgICAgIGNvbnN0IHBvcyA9IHsgbGF0OiBOdW1iZXIodGhpcy4kcm91dGUucXVlcnkubGF0KSwgbG5nOiBOdW1iZXIodGhpcy4kcm91dGUucXVlcnkubG5nKSwgYWx0OiB0aGlzLiRyb3V0ZS5xdWVyeS5lbGV2ID8gTnVtYmVyKHRoaXMuJHJvdXRlLnF1ZXJ5LmVsZXYpIDogMCwgYWNjdXJhY3k6IDEgfQogICAgICAgICAgc3doLmdlb0NvZGVQb3NpdGlvbihwb3MsIHRoYXQpLnRoZW4oKGxvYykgPT4gewogICAgICAgICAgICB0aGF0LiRzdG9yZS5jb21taXQoJ3NldEN1cnJlbnRMb2NhdGlvbicsIGxvYykKICAgICAgICAgIH0sIChlcnJvcikgPT4geyBjb25zb2xlLmxvZyhlcnJvcikgfSkKICAgICAgICB9CgogICAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci55YXcgPSB0aGlzLiRyb3V0ZS5xdWVyeS5heiA/IE51bWJlcih0aGlzLiRyb3V0ZS5xdWVyeS5heikgKiBNYXRoLlBJIC8gMTgwIDogMAogICAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci5waXRjaCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmFsdCA/IE51bWJlcih0aGlzLiRyb3V0ZS5xdWVyeS5hbHQpICogTWF0aC5QSSAvIDE4MCA6IDMwICogTWF0aC5QSSAvIDE4MAogICAgICAgIHRoaXMuJHN0ZWwuY29yZS5mb3YgPSB0aGlzLiRyb3V0ZS5xdWVyeS5mb3YgPyBOdW1iZXIodGhpcy4kcm91dGUucXVlcnkuZm92KSAqIE1hdGguUEkgLyAxODAgOiAxMjAgKiBNYXRoLlBJIC8gMTgwCgogICAgICAgIHRoaXMuaW5pdERvbmUgPSB0cnVlCiAgICAgIH0KCiAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXRoLnN0YXJ0c1dpdGgoJy9za3lzb3VyY2UvJykpIHsKICAgICAgICBjb25zdCBuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHRoaXMuJHJvdXRlLnBhdGguc3Vic3RyaW5nKDExKSkKICAgICAgICBjb25zb2xlLmxvZygnV2lsbCBzZWxlY3Qgb2JqZWN0OiAnICsgbmFtZSkKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdXaWxsIHNlbGVjdCBvYmplY3Q6ICcgKyBuYW1lLCAnaW5mbycpOwogICAgICAgIHJldHVybiBzd2gubG9va3VwU2t5U291cmNlQnlOYW1lKG5hbWUpLnRoZW4oc3MgPT4gewogICAgICAgICAgaWYgKCFzcykgewogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICAgIGxldCBvYmogPSBzd2guc2t5U291cmNlMlN3ZU9iaihzcykKICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgIG9iaiA9IHRoaXMuJHN0ZWwuY3JlYXRlT2JqKHNzLm1vZGVsLCBzcykKICAgICAgICAgICAgdGhpcy4kc2VsZWN0aW9uTGF5ZXIuYWRkKG9iaikKICAgICAgICAgIH0KICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybmluZygiQ2FuJ3QgZmluZCBvYmplY3QgaW4gU1dFOiAiICsgc3MubmFtZXNbMF0pCiAgICAgICAgICB9CiAgICAgICAgICBzd2guc2V0U3dlT2JqQXNTZWxlY3Rpb24ob2JqKQogICAgICAgIH0sIGVyciA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICBjb25zb2xlLmxvZygiQ291bGRuJ3QgZmluZCBza3lzb3VyY2UgZm9yIG5hbWU6ICIgKyBuYW1lKQogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygiQ291bGRuJ3QgZmluZCBza3lzb3VyY2UgZm9yIG5hbWU6ICIgKyBuYW1lLCAnZXJyb3InKTsKICAgICAgICB9KQogICAgICB9CiAgICB9LAoKICAgIGxvb2thdGNpcmNsZSgpIHsKICAgICAgLy8gZ2xTdGVsLmNvcmUuc2VsZWN0aW9uID0gZ2xUZXN0Q2lyY2xlOwogICAgICBnbFN0ZWwucG9pbnRBbmRMb2NrKGdsVGVzdENpcmNsZSk7CiAgICB9LAoKICAgIHNldEdsb2FiYWxTdGVsOiBmdW5jdGlvbiAoc3RlbCkgewogICAgICByZXR1cm4gc3RlbDsKICAgIH0sCgogICAgc2V0R2xvYmFsTGF5ZXI6IGZ1bmN0aW9uIChzdGVsKSB7CiAgICAgIHJldHVybiBzdGVsLmNyZWF0ZUxheWVyKHsgaWQ6ICd0ZXN0TGF5ZXJTdGFycycsIHo6IDcsIHZpc2libGU6IHRydWUgfSk7CiAgICB9LAoKICAgIHZlYzNfZnJvbV9zcGhlOiBmdW5jdGlvbiAocmFfZGVncmVlLCBkZWNfZGVncmVlLCBvdXQpIHsKICAgICAgY29uc3QgY3AgPSBNYXRoLmNvcyhkZWNfZGVncmVlICogTWF0aC5QSSAvIDE4MCk7CiAgICAgIG91dFswXSA9IE1hdGguY29zKHJhX2RlZ3JlZSAqIE1hdGguUEkgLyAxODApICogY3A7CiAgICAgIG91dFsxXSA9IE1hdGguc2luKHJhX2RlZ3JlZSAqIE1hdGguUEkgLyAxODApICogY3A7CiAgICAgIG91dFsyXSA9IE1hdGguc2luKGRlY19kZWdyZWUgKiBNYXRoLlBJIC8gMTgwKTsKICAgIH0sCgogICAgdGVzdEFkZENpcmNsZTogZnVuY3Rpb24gKHN0ZWwsIGxheWVyKSB7CiAgICAgIGNvbnNvbGUubG9nKCJBZGQgYSBjaXJjbGUgc3RhciBuZWFyIHBvbGFyaXMiKTsKCiAgICAgIGxldCBjaXJjbGUgPSBzdGVsLmNyZWF0ZU9iaignY2lyY2xlJywgeyBpZDogJ215IGNpcmNsZSAgJywgbW9kZWxfZGF0YToge30gfSk7CgogICAgICBjaXJjbGUudXBkYXRlKCk7CiAgICAgIGxheWVyLmFkZChjaXJjbGUpOwoKICAgICAgLy8gU2VsZWN0CiAgICAgIHN0ZWwuY29yZS5zZWxlY3Rpb24gPSBjaXJjbGU7CiAgICAgIHN0ZWwucG9pbnRBbmRMb2NrKGNpcmNsZSk7CgogICAgICAvLyBDaXJjbGUgUHJvcGVydHkKICAgICAgbGV0IG1tID0gY2lyY2xlLnBvczsKICAgICAgdGhpcy52ZWMzX2Zyb21fc3BoZSgyLjUyOTcxLCA4OS4yNjQxLCBtbSk7CiAgICAgIGNpcmNsZS5wb3MgPSBtbTsKICAgICAgY29uc29sZS5sb2coImNpcmNsZSBwb3M6IiArIG1tKTsKICAgICAgY2lyY2xlLmxhYmVsID0gIiI7CiAgICAgIGNpcmNsZS5mcmFtZSA9IDE7CiAgICAgIGNpcmNsZS5zaXplID0gWzAuMDUsIDAuMDVdOwogICAgICBjaXJjbGUuY29sb3IgPSBbMCwgMSwgMCwgMC4yNV07CiAgICAgIGNpcmNsZS5ib3JkZXJfY29sb3IgPSBbMCwgMSwgMCwgMV07CgogICAgICByZXR1cm4gY2lyY2xlOwogICAgfSwKCiAgICBVcGRhdGVDaXJjbGVQb3MoUmFfZGVncmVlLCBEZWNfZGVncmVlKSB7CiAgICAgIGxldCBtbSA9IGdsVGVzdENpcmNsZS5wb3M7CiAgICAgIHRoaXMudmVjM19mcm9tX3NwaGUoUmFfZGVncmVlLCBEZWNfZGVncmVlLCBtbSk7CiAgICAgIGdsVGVzdENpcmNsZS5wb3MgPSBtbTsKICAgIH0sCgogICAgVXBkYXRlVGVsZXNjb3BlU3RhdHVzKHN0YXR1cykgewogICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50U3RhdHVzJywgc3RhdHVzKTsKICAgICAgaWYgKHN0YXR1cyA9PT0gJ1NsZXdpbmcnKSB7CiAgICAgICAgZ2xUZXN0Q2lyY2xlLmNvbG9yID0gWzEsIDAsIDAsIDAuMjVdOwogICAgICAgIGdsVGVzdENpcmNsZS5ib3JkZXJfY29sb3IgPSBbMSwgMCwgMCwgMV07CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgZ2xUZXN0Q2lyY2xlLmNvbG9yID0gWzAsIDEsIDAsIDAuMjVdOwogICAgICAgIGdsVGVzdENpcmNsZS5ib3JkZXJfY29sb3IgPSBbMCwgMSwgMCwgMV07CiAgICAgIH0KICAgIH0sCgogICAgVXBkYXRlTWFpbkNhbWVyYVN0YXR1cyhzdGF0dXMpIHsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhU3RhdHVzJywgc3RhdHVzKTsKICAgICAgaWYgKHN0YXR1cyA9PT0gJ0V4cG9zdXJpbmcnKSB7CgogICAgICB9CiAgICAgIGVsc2UgewoKICAgICAgfQogICAgfSwKCiAgICBVcGRhdGVNYWluQ2FtZXJhVGVtcGVyYXR1cmUodmFsdWUpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ01haW4gQ2FtZXJhIFRlbXBlcmF0dXJlOicsIHZhbHVlICsgJ8KwJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYVRlbXBlcmF0dXJlJywgdmFsdWUpOwogICAgfSwKCiAgICBzZXRQb2xhclBvaW50QWx0aXR1ZGUoQWx0aXR1ZGUpIHsKICAgICAgdGhpcy5Qb2xhclBvaW50X0FsdGl0dWRlID0gQWx0aXR1ZGU7CiAgICAgIGNvbnNvbGUubG9nKCdQb2xhciBQb2ludCBBbHRpdHVkZTonLCB0aGlzLlBvbGFyUG9pbnRfQWx0aXR1ZGUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdQb2xhciBQb2ludCBBbHRpdHVkZTonICsgdGhpcy5Qb2xhclBvaW50X0FsdGl0dWRlLCAnaW5mbycpOwogICAgfSwKCiAgICBBZGRNYXJrQ2lyY2xlOiBmdW5jdGlvbiAoc3RlbCwgbGF5ZXIsIGZyYW1lLCBsYWJlbCkgewogICAgICBsZXQgY2lyY2xlID0gc3RlbC5jcmVhdGVPYmooJ2NpcmNsZScsIHsgaWQ6ICdteSBjaXJjbGUgICcsIG1vZGVsX2RhdGE6IHt9IH0pOwoKICAgICAgY2lyY2xlLnVwZGF0ZSgpOwogICAgICBsYXllci5hZGQoY2lyY2xlKTsKCiAgICAgIC8vIFNlbGVjdAogICAgICBzdGVsLmNvcmUuc2VsZWN0aW9uID0gY2lyY2xlOwogICAgICBzdGVsLnBvaW50QW5kTG9jayhjaXJjbGUpOwoKICAgICAgLy8gQ2lyY2xlIFByb3BlcnR5CiAgICAgIGxldCBtbSA9IGNpcmNsZS5wb3M7CiAgICAgIHRoaXMudmVjM19mcm9tX3NwaGUoMi41Mjk3MSwgODkuMjY0MSwgbW0pOwogICAgICBjaXJjbGUucG9zID0gbW07CiAgICAgIGNpcmNsZS5sYWJlbCA9IGxhYmVsOwogICAgICBjaXJjbGUuZnJhbWUgPSBmcmFtZTsKICAgICAgY2lyY2xlLnNpemUgPSBbMC4wNCwgMC4wNF07CiAgICAgIGNpcmNsZS5jb2xvciA9IFsxLCAxLCAxLCAwLjVdOwogICAgICBjaXJjbGUuYm9yZGVyX2NvbG9yID0gWzEsIDEsIDEsIDFdOwoKICAgICAgcmV0dXJuIGNpcmNsZTsKICAgIH0sCgogICAgQWRkTWFya1JlY3RhbmdsZTogZnVuY3Rpb24gKHN0ZWwsIGxheWVyLCBSYURlYykgewogICAgICBsZXQgbGluZSA9IHN0ZWwuY3JlYXRlT2JqKCdnZW9qc29uJywgewogICAgICAgIGRhdGE6IHsKICAgICAgICAgICJ0eXBlIjogIkZlYXR1cmVDb2xsZWN0aW9uIiwKICAgICAgICAgICJmZWF0dXJlcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICJ0eXBlIjogIkZlYXR1cmUiLAogICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgInN0cm9rZSI6ICIjRkZGRkZGIiwKICAgICAgICAgICAgICAgICJzdHJva2Utb3BhY2l0eSI6IDEsCiAgICAgICAgICAgICAgICAiZmlsbCI6ICIjMUU5MEZGIiwKICAgICAgICAgICAgICAgICJmaWxsLW9wYWNpdHkiOiAwLjI1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAiZ2VvbWV0cnkiOiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJQb2x5Z29uIiwKICAgICAgICAgICAgICAgICJjb29yZGluYXRlcyI6IFsKICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIC8vIFsxMzkuNzYsIDM1LjUyXSwgWzEzOS4zMiwgMzMuNDFdLCBbMTQwLjkyLCAzMy4wOF0sIFsxNDEuMzUsIDM1LjE5XSwgWzEzOS43NiwgMzUuNTJdCiAgICAgICAgICAgICAgICAgICAgW3BhcnNlRmxvYXQoUmFEZWNbMF0uUmEpLCBwYXJzZUZsb2F0KFJhRGVjWzBdLkRlYyldLCBbcGFyc2VGbG9hdChSYURlY1sxXS5SYSksIHBhcnNlRmxvYXQoUmFEZWNbMV0uRGVjKV0sCiAgICAgICAgICAgICAgICAgICAgW3BhcnNlRmxvYXQoUmFEZWNbMl0uUmEpLCBwYXJzZUZsb2F0KFJhRGVjWzJdLkRlYyldLCBbcGFyc2VGbG9hdChSYURlY1szXS5SYSksIHBhcnNlRmxvYXQoUmFEZWNbM10uRGVjKV0sCiAgICAgICAgICAgICAgICAgICAgW3BhcnNlRmxvYXQoUmFEZWNbMF0uUmEpLCBwYXJzZUZsb2F0KFJhRGVjWzBdLkRlYyldCiAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICBdCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGxpbmUudXBkYXRlKCk7CiAgICAgIGxheWVyLmFkZChsaW5lKTsKCiAgICAgIHJldHVybiBsaW5lOwogICAgfSwKCiAgICBnZXRDaWVjbGVBekFsdChDaXJjbGUpIHsKICAgICAgbGV0IG9icyA9IHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlcjsKICAgICAgbGV0IGNpcnMgPSB0aGlzLiRzdGVsLmNvbnZlcnRGcmFtZShvYnMsICdJQ1JGJywgJ0NJUlMnLCBDaXJjbGUuZ2V0SW5mbygncmFkZWMnKSk7CiAgICAgIGxldCBvYnNlcnZlZCA9IHRoaXMuJHN0ZWwuY29udmVydEZyYW1lKG9icywgJ0NJUlMnLCAnT0JTRVJWRUQnLCBjaXJzKTsKICAgICAgLy8gY29uc3QgYXphbHQgPSB0aGlzLiRzdGVsLmMycyh0aGlzLiRzdGVsLmNvbnZlcnRGcmFtZSh0aGlzLiRzdGVsLmNvcmUub2JzZXJ2ZXIsICdJQ1JGJywgJ09CU0VSVkVEJywgb2JqLmdldEluZm8oJ3JhZGVjJykpKQogICAgICBsZXQgYXphbHQgPSB0aGlzLiRzdGVsLmMycyhvYnNlcnZlZCk7CiAgICAgIGxldCBheiA9IHRoaXMuJHN0ZWwuYW5wKGF6YWx0WzBdKTsKICAgICAgbGV0IGFsdCA9IHRoaXMuJHN0ZWwuYW5wKGF6YWx0WzFdKTsKCiAgICAgIGNvbnN0IGF6X3JhZiA9IHRoaXMuJHN0ZWwuYTJhZihheiwgMSk7CiAgICAgIGNvbnN0IEF6X2RlZ3JlZSA9IChhel9yYWYuZGVncmVlcyA8IDAgPyBhel9yYWYuZGVncmVlcyArIDE4MCA6IGF6X3JhZi5kZWdyZWVzKSArIGF6X3JhZi5hcmNtaW51dGVzIC8gNjAgKyBhel9yYWYuYXJjc2Vjb25kcyAvIDM2MDA7CgogICAgICBjb25zdCBhbHRfcmFmID0gdGhpcy4kc3RlbC5hMmFmKGFsdCwgMSk7CiAgICAgIGNvbnN0IEFsdF9kZWdyZWUgPSBhbHRfcmFmLmRlZ3JlZXMgKyBhbHRfcmFmLmFyY21pbnV0ZXMgLyA2MCArIGFsdF9yYWYuYXJjc2Vjb25kcyAvIDM2MDA7CgogICAgICBjb25zb2xlLmxvZygnQXpBbHQ6JywgQXpfZGVncmVlLCBBbHRfZGVncmVlKTsKCiAgICAgIHJldHVybiB7IEF6X2RlZ3JlZSwgQWx0X2RlZ3JlZSB9OwogICAgfSwKCiAgICBTb2x2ZVJlc3VsdE1hcmsoUmFEZWdyZWUsIERlY0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpIHsKICAgICAgbGV0IE1hcmtDaXJjbGVfUmFEZWMgPSB0aGlzLkFkZE1hcmtDaXJjbGUodGhpcy4kc3RlbCwgZ2xMYXllciwgMSwgIlJhRGVjIik7CiAgICAgIGxldCBtbSA9IE1hcmtDaXJjbGVfUmFEZWMucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKFJhRGVncmVlLCBEZWNEZWdyZWUsIG1tKTsKICAgICAgTWFya0NpcmNsZV9SYURlYy5wb3MgPSBtbTsKICAgICAgY29uc29sZS5sb2coIlJhRGVjIGNpcmNsZSBjb29yZGluYXRlczoiICsgbW0pOwoKICAgICAgY29uc3QgQXpBbHQgPSB0aGlzLmdldENpZWNsZUF6QWx0KE1hcmtDaXJjbGVfUmFEZWMpOwogICAgICBnbExheWVyLnJlbW92ZShNYXJrQ2lyY2xlX1JhRGVjKTsKCiAgICAgIHRoaXMuTWFya0NpcmNsZU51bSsrOwogICAgICBsZXQgTGFiZWwgPSAiQXpBbHRfVnVlXyIgKyB0aGlzLk1hcmtDaXJjbGVOdW07CgogICAgICBsZXQgTWFya0NpcmNsZV9BbHRBeiA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCA0LCBMYWJlbCk7CiAgICAgIG1tID0gTWFya0NpcmNsZV9BbHRBei5wb3M7CiAgICAgIHRoaXMudmVjM19mcm9tX3NwaGUoQXpBbHQuQXpfZGVncmVlLCBBekFsdC5BbHRfZGVncmVlLCBtbSk7CiAgICAgIE1hcmtDaXJjbGVfQWx0QXoucG9zID0gbW07CiAgICAgIGNvbnNvbGUubG9nKCJBekFsdF9WdWUgY2lyY2xlIGNvb3JkaW5hdGVzOiIgKyBtbSk7CgogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSB4OiIgKyBtbVswXSk7CiAgICAgIGNvbnNvbGUubG9nKCJBekFsdF9WdWUgY2lyY2xlIHk6IiArIG1tWzFdKTsKICAgICAgY29uc29sZS5sb2coIkF6QWx0X1Z1ZSBjaXJjbGUgejoiICsgbW1bMl0pOwoKICAgICAgdGhpcy5MYXN0UG9pbnRfQXpBbHQgPSB0aGlzLmdldENpZWNsZUF6QWx0KE1hcmtDaXJjbGVfQWx0QXopOwoKICAgICAgdGhpcy5DYWxjdWxhdGlvblBvbGFyUG9pbnQobW0pOwoKICAgICAgLy8g5bCG5Yib5bu655qE5ZyG5a2Y5YKo5Yiw5pWw57uE5LitCiAgICAgIC8vIHRoaXMuQ2lyY2xlcy5wdXNoKE1hcmtDaXJjbGVfUmFEZWMpOwogICAgICB0aGlzLkNpcmNsZXMucHVzaChNYXJrQ2lyY2xlX0FsdEF6KTsKCiAgICB9LAoKICAgIFJlbW92ZUFsbENpcmNsZXMoKSB7CiAgICAgIHRoaXMuQ2lyY2xlcy5mb3JFYWNoKGNpcmNsZSA9PiB7CiAgICAgICAgZ2xMYXllci5yZW1vdmUoY2lyY2xlKTsKICAgICAgfSk7CiAgICAgIHRoaXMuQ2lyY2xlcyA9IFtdOwogICAgfSwKCiAgICBTb2x2ZVJlc3VsdE1hcmtfUmVhbFRpbWUoUmFEZWdyZWUsIERlY0RlZ3JlZSwgQXppbXV0aCwgQWx0aXR1ZGUpIHsKICAgICAgdGhpcy5MYXN0Q2lyY2xlX1JhRGVjID0gdGhpcy5BZGRNYXJrQ2lyY2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIDEsICJSYURlYyIpOwogICAgICBsZXQgbW0gPSB0aGlzLkxhc3RDaXJjbGVfUmFEZWMucG9zOwogICAgICB0aGlzLnZlYzNfZnJvbV9zcGhlKFJhRGVncmVlLCBEZWNEZWdyZWUsIG1tKTsKICAgICAgdGhpcy5MYXN0Q2lyY2xlX1JhRGVjLnBvcyA9IG1tOwogICAgICBjb25zb2xlLmxvZygiUmFEZWMgY2lyY2xlIGNvb3JkaW5hdGVzOiIgKyBtbSk7CgogICAgICBjb25zdCBBekFsdCA9IHRoaXMuZ2V0Q2llY2xlQXpBbHQodGhpcy5MYXN0Q2lyY2xlX1JhRGVjKTsKICAgICAgZ2xMYXllci5yZW1vdmUodGhpcy5MYXN0Q2lyY2xlX1JhRGVjKTsKCiAgICAgIGlmICh0aGlzLkxhc3RDaXJjbGVfQXpBbHQgIT09IG51bGwgJiYgdGhpcy5MYXN0Q2lyY2xlX0F6QWx0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBnbExheWVyLnJlbW92ZSh0aGlzLkxhc3RDaXJjbGVfQXpBbHQpOwogICAgICB9CiAgICAgIHRoaXMuTGFzdENpcmNsZV9BekFsdCA9IHRoaXMuQWRkTWFya0NpcmNsZSh0aGlzLiRzdGVsLCBnbExheWVyLCA0LCAnQ3VycmVudCcpOwogICAgICBtbSA9IHRoaXMuTGFzdENpcmNsZV9BekFsdC5wb3M7CiAgICAgIHRoaXMudmVjM19mcm9tX3NwaGUoQXpBbHQuQXpfZGVncmVlLCBBekFsdC5BbHRfZGVncmVlLCBtbSk7CiAgICAgIHRoaXMuTGFzdENpcmNsZV9BekFsdC5wb3MgPSBtbTsKICAgICAgdGhpcy5MYXN0Q2lyY2xlX0F6QWx0LmNvbG9yID0gWzAsIDEsIDEsIDAuMjVdOwogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSBjb29yZGluYXRlczoiICsgbW0pOwoKICAgICAgY29uc29sZS5sb2coIkF6QWx0X1Z1ZSBjaXJjbGUgeDoiICsgbW1bMF0pOwogICAgICBjb25zb2xlLmxvZygiQXpBbHRfVnVlIGNpcmNsZSB5OiIgKyBtbVsxXSk7CiAgICAgIGNvbnNvbGUubG9nKCJBekFsdF9WdWUgY2lyY2xlIHo6IiArIG1tWzJdKTsKCiAgICAgIHRoaXMuQ3VycmVudF9BekFsdCA9IHRoaXMuZ2V0Q2llY2xlQXpBbHQodGhpcy5MYXN0Q2lyY2xlX0F6QWx0KTsKICAgICAgY29uc29sZS5sb2coIkN1cnJlbnQgQXpBbHQ6IiwgdGhpcy5DdXJyZW50X0F6QWx0LkF6X2RlZ3JlZSwgdGhpcy5DdXJyZW50X0F6QWx0LkFsdF9kZWdyZWUpOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dDdXJyZW50QXpBbHRUZXh0JywgdGhpcy5DdXJyZW50X0F6QWx0LkF6X2RlZ3JlZSwgdGhpcy5DdXJyZW50X0F6QWx0LkFsdF9kZWdyZWUpOwogICAgfSwKCgogICAgQ2FsY3VsYXRpb25Qb2xhclBvaW50KGNvb3JkaW5hdGUpIHsKICAgICAgdGhpcy5DYXJ0ZXNpYW5MaXN0LnB1c2goY29vcmRpbmF0ZSk7CgogICAgICBpZiAodGhpcy5DYXJ0ZXNpYW5MaXN0Lmxlbmd0aCA8IDMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnSGlkZVNpbmdsZVNvbHZlQnRuJyk7CgogICAgICAvLyDojrflj5bkuInkuKrngrnnmoTlnZDmoIcKICAgICAgY29uc3QgcDEgPSB0aGlzLkNhcnRlc2lhbkxpc3RbMF07CiAgICAgIGNvbnN0IHAyID0gdGhpcy5DYXJ0ZXNpYW5MaXN0WzFdOwogICAgICBjb25zdCBwMyA9IHRoaXMuQ2FydGVzaWFuTGlzdFsyXTsKCiAgICAgIC8vIOiuoeeul+S4pOS4quWQkemHjwogICAgICBjb25zdCB2MSA9IFsKICAgICAgICBwMlswXSAtIHAxWzBdLAogICAgICAgIHAyWzFdIC0gcDFbMV0sCiAgICAgICAgcDJbMl0gLSBwMVsyXQogICAgICBdOwoKICAgICAgY29uc3QgdjIgPSBbCiAgICAgICAgcDNbMF0gLSBwMVswXSwKICAgICAgICBwM1sxXSAtIHAxWzFdLAogICAgICAgIHAzWzJdIC0gcDFbMl0KICAgICAgXTsKCiAgICAgIC8vIOiuoeeul+azleWQkemHjwogICAgICBjb25zdCBub3JtYWwgPSBbCiAgICAgICAgdjFbMV0gKiB2MlsyXSAtIHYxWzJdICogdjJbMV0sCiAgICAgICAgdjFbMl0gKiB2MlswXSAtIHYxWzBdICogdjJbMl0sCiAgICAgICAgdjFbMF0gKiB2MlsxXSAtIHYxWzFdICogdjJbMF0KICAgICAgXTsKCiAgICAgIC8vIOiuoeeul+azleWQkemHj+eahOmVv+W6pgogICAgICBjb25zdCBub3JtYWxMZW5ndGggPSBNYXRoLnNxcnQobm9ybWFsWzBdICoqIDIgKyBub3JtYWxbMV0gKiogMiArIG5vcm1hbFsyXSAqKiAyKTsKCiAgICAgIC8vIOW9kuS4gOWMluazleWQkemHjwogICAgICBjb25zdCB1bml0Tm9ybWFsID0gWwogICAgICAgIG5vcm1hbFswXSAvIG5vcm1hbExlbmd0aCwKICAgICAgICBub3JtYWxbMV0gLyBub3JtYWxMZW5ndGgsCiAgICAgICAgbm9ybWFsWzJdIC8gbm9ybWFsTGVuZ3RoCiAgICAgIF07CgogICAgICAvLyDlgYforr7nkIPnmoTljYrlvoTkuLpy77yM5ZyG5b+D5Li6KDAsIDAsIDApCiAgICAgIGNvbnN0IHIgPSAxOyAvLyDmoLnmja7kvaDnmoTlrp7pmYXmg4XlhrXosIPmlbQKCiAgICAgIC8vIOiuoeeul+S4jueQg+mdoueahOS6pOeCuQogICAgICBjb25zdCBpbnRlcnNlY3Rpb24xID0gWwogICAgICAgIHVuaXROb3JtYWxbMF0gKiByLAogICAgICAgIHVuaXROb3JtYWxbMV0gKiByLAogICAgICAgIHVuaXROb3JtYWxbMl0gKiByCiAgICAgIF07CgogICAgICBjb25zdCBpbnRlcnNlY3Rpb24yID0gWwogICAgICAgIC11bml0Tm9ybWFsWzBdICogciwKICAgICAgICAtdW5pdE5vcm1hbFsxXSAqIHIsCiAgICAgICAgLXVuaXROb3JtYWxbMl0gKiByCiAgICAgIF07CgogICAgICBjb25zb2xlLmxvZygnSW50ZXJzZWN0aW9uIFBvaW50czonLCBpbnRlcnNlY3Rpb24xLCBpbnRlcnNlY3Rpb24yKTsKCiAgICAgIC8vIOmAieaLqeemuygwLDAsMSnmm7Tov5HnmoTkuqTngrkKICAgICAgY29uc3QgY2xvc2VySW50ZXJzZWN0aW9uID0gaW50ZXJzZWN0aW9uMVsyXSA+IDAgPyBpbnRlcnNlY3Rpb24xIDogaW50ZXJzZWN0aW9uMjsKCiAgICAgIGxldCBNYXJrQ2lyY2xlX0Zha2VQb2xhclBvaW50ID0gdGhpcy5BZGRNYXJrQ2lyY2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIDQsICJGYWtlUG9sYXJQb2ludCIpOwogICAgICBsZXQgbW0gPSBNYXJrQ2lyY2xlX0Zha2VQb2xhclBvaW50LnBvczsKICAgICAgbW1bMF0gPSBjbG9zZXJJbnRlcnNlY3Rpb25bMF07CiAgICAgIG1tWzFdID0gY2xvc2VySW50ZXJzZWN0aW9uWzFdOwogICAgICBtbVsyXSA9IGNsb3NlckludGVyc2VjdGlvblsyXTsKICAgICAgTWFya0NpcmNsZV9GYWtlUG9sYXJQb2ludC5wb3MgPSBtbTsKICAgICAgY29uc29sZS5sb2coIkZha2VQb2xhclBvaW50IGNpcmNsZSBjb29yZGluYXRlczoiICsgbW0pOwoKICAgICAgY29uc3QgQXpBbHRfRmFrZVBvbGFyUG9pbnQgPSB0aGlzLmdldENpZWNsZUF6QWx0KE1hcmtDaXJjbGVfRmFrZVBvbGFyUG9pbnQpOwoKICAgICAgY29uc29sZS5sb2coIkZha2UgUG9sYXIgUG9pbnQgQXpBbHQ6IiwgQXpBbHRfRmFrZVBvbGFyUG9pbnQuQXpfZGVncmVlLCAnLCcsIEF6QWx0X0Zha2VQb2xhclBvaW50LkFsdF9kZWdyZWUpOwoKICAgICAgdGhpcy5DaXJjbGVzLnB1c2goTWFya0NpcmNsZV9GYWtlUG9sYXJQb2ludCk7CgogICAgICBsZXQgQXpBbHRfUG9sYXJQb2ludCA9IHsKICAgICAgICBBel9kZWdyZWU6IDAsCiAgICAgICAgQWx0X2RlZ3JlZTogdGhpcy5Qb2xhclBvaW50X0FsdGl0dWRlCiAgICAgIH07CgogICAgICAvLyBjb25zb2xlLmxvZygiUmVhbCBQb2xhciBQb2ludCBBekFsdDoiLCBBekFsdF9Qb2xhclBvaW50LkF6X2RlZ3JlZSwgJywnLCBBekFsdF9Qb2xhclBvaW50LkFsdF9kZWdyZWUpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdSZWFsIFBvbGFyIFBvaW50IEF6QWx0OicgKyBBekFsdF9Qb2xhclBvaW50LkF6X2RlZ3JlZSArICcsJyArIEF6QWx0X1BvbGFyUG9pbnQuQWx0X2RlZ3JlZSwgJ2luZm8nKTsKICAgICAgLy8gY29uc29sZS5sb2coIkxhc3QgUG9pbnQgQXpBbHQ6IiwgdGhpcy5MYXN0UG9pbnRfQXpBbHQuQXpfZGVncmVlLCB0aGlzLkxhc3RQb2ludF9BekFsdC5BbHRfZGVncmVlKTsKICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTGFzdCBQb2ludCBBekFsdDonICsgdGhpcy5MYXN0UG9pbnRfQXpBbHQuQXpfZGVncmVlICsgJywnICsgdGhpcy5MYXN0UG9pbnRfQXpBbHQuQWx0X2RlZ3JlZSwgJ2luZm8nKTsKCiAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgLy8gLy8g5bCG55CD5Z2Q5qCH6L2s5o2i5Li656yb5Y2h5bCU5Z2Q5qCHCiAgICAgIC8vIGxldCBmYWtlUG9sYXJQb2ludCA9IHRoaXMuc3BoZXJpY2FsVG9DYXJ0ZXNpYW4oQXpBbHRfRmFrZVBvbGFyUG9pbnQuQXpfZGVncmVlLCBBekFsdF9GYWtlUG9sYXJQb2ludC5BbHRfZGVncmVlKTsKICAgICAgLy8gbGV0IHBvbGFyUG9pbnQgPSB0aGlzLnNwaGVyaWNhbFRvQ2FydGVzaWFuKEF6QWx0X1BvbGFyUG9pbnQuQXpfZGVncmVlLCBBekFsdF9Qb2xhclBvaW50LkFsdF9kZWdyZWUpOwogICAgICAvLyBsZXQgbGFzdFBvaW50ID0gdGhpcy5zcGhlcmljYWxUb0NhcnRlc2lhbih0aGlzLkxhc3RQb2ludF9BekFsdC5Bel9kZWdyZWUsIHRoaXMuTGFzdFBvaW50X0F6QWx0LkFsdF9kZWdyZWUpOwoKICAgICAgLy8gLy8g6K6h566X5peL6L2s5Zub5YWD5pWwCiAgICAgIC8vIGxldCBxdWF0ZXJuaW9uID0gdGhpcy5jb21wdXRlUXVhdGVybmlvbihmYWtlUG9sYXJQb2ludCwgcG9sYXJQb2ludCk7CgogICAgICAvLyAvLyDlupTnlKjml4vovawKICAgICAgLy8gbGV0IGZvdXJ0aFBvaW50ID0gdGhpcy5hcHBseVF1YXRlcm5pb24obGFzdFBvaW50LCBxdWF0ZXJuaW9uKTsKCiAgICAgIC8vIC8vIOWwhue7k+aenOi9rOaNouWbnueQg+WdkOaghwogICAgICAvLyBsZXQgZm91cnRoUG9pbnRBekFsdCA9IHRoaXMuY2FydGVzaWFuVG9TcGhlcmljYWwoZm91cnRoUG9pbnQpOwogICAgICAvLyBjb25zb2xlLmxvZygiRm91cnRoIFBvaW50IEF6QWx0OiIsIGZvdXJ0aFBvaW50QXpBbHQuQXpfZGVncmVlLCAnLCcsIGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSk7CgogICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgIC8vIOiuoeeul+inkuW6puW3ruWAvO+8jOiAg+iZkeinkuW6pueahOW+queOr+aAp+i0qAogICAgICBmdW5jdGlvbiBjYWxjdWxhdGVBbmdsZURpZmZlcmVuY2UoYW5nbGUxLCBhbmdsZTIpIHsKICAgICAgICBsZXQgZGlmZmVyZW5jZSA9IGFuZ2xlMiAtIGFuZ2xlMTsKICAgICAgICB3aGlsZSAoZGlmZmVyZW5jZSA+IDE4MCkgZGlmZmVyZW5jZSAtPSAzNjA7CiAgICAgICAgd2hpbGUgKGRpZmZlcmVuY2UgPCAtMTgwKSBkaWZmZXJlbmNlICs9IDM2MDsKICAgICAgICByZXR1cm4gZGlmZmVyZW5jZTsKICAgICAgfQoKICAgICAgbGV0IGF6aW11dGhEaWZmZXJlbmNlID0gY2FsY3VsYXRlQW5nbGVEaWZmZXJlbmNlKEF6QWx0X0Zha2VQb2xhclBvaW50LkF6X2RlZ3JlZSwgQXpBbHRfUG9sYXJQb2ludC5Bel9kZWdyZWUpOwogICAgICBsZXQgYWx0aXR1ZGVEaWZmZXJlbmNlID0gQXpBbHRfUG9sYXJQb2ludC5BbHRfZGVncmVlIC0gQXpBbHRfRmFrZVBvbGFyUG9pbnQuQWx0X2RlZ3JlZTsKCiAgICAgIC8vIOW6lOeUqOW3ruWAvOWIsExhc3RQb2ludAogICAgICBsZXQgZm91cnRoUG9pbnRBekFsdCA9IHsKICAgICAgICBBel9kZWdyZWU6IHRoaXMuTGFzdFBvaW50X0F6QWx0LkF6X2RlZ3JlZSArIGF6aW11dGhEaWZmZXJlbmNlLAogICAgICAgIEFsdF9kZWdyZWU6IHRoaXMuTGFzdFBvaW50X0F6QWx0LkFsdF9kZWdyZWUgKyBhbHRpdHVkZURpZmZlcmVuY2UKICAgICAgfTsKCiAgICAgIC8vIOehruS/neaWueS9jeinkuWcqDDliLAzNjDluqbkuYvpl7QKICAgICAgZm91cnRoUG9pbnRBekFsdC5Bel9kZWdyZWUgPSAoZm91cnRoUG9pbnRBekFsdC5Bel9kZWdyZWUgKyAzNjApICUgMzYwOwoKICAgICAgLy8g56Gu5L+d6auY5bqm6KeS5ZyoLTkw5YiwOTDluqbkuYvpl7QKICAgICAgZm91cnRoUG9pbnRBekFsdC5BbHRfZGVncmVlID0gTWF0aC5tYXgoTWF0aC5taW4oZm91cnRoUG9pbnRBekFsdC5BbHRfZGVncmVlLCA5MCksIC05MCk7CgogICAgICBjb25zb2xlLmxvZygiRm91cnRoIFBvaW50IEF6QWx0OiIsIGZvdXJ0aFBvaW50QXpBbHQuQXpfZGVncmVlLCAnLCcsIGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSk7CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dBekFsdFRleHQnLCBhemltdXRoRGlmZmVyZW5jZSwgYWx0aXR1ZGVEaWZmZXJlbmNlLCBmb3VydGhQb2ludEF6QWx0LkF6X2RlZ3JlZSwgZm91cnRoUG9pbnRBekFsdC5BbHRfZGVncmVlKTsKCiAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgLy8g5bCG6KeS5bqm6L2s5o2i5Li65byn5bqmCiAgICAgIGZ1bmN0aW9uIGRlZ3JlZXNUb1JhZGlhbnMoZGVncmVlcykgewogICAgICAgIHJldHVybiBkZWdyZWVzICogTWF0aC5QSSAvIDE4MDsKICAgICAgfQoKICAgICAgLy8g5bCG55CD5Z2Q5qCH6L2s5o2i5Li656yb5Y2h5bCU5Z2Q5qCHCiAgICAgIGZ1bmN0aW9uIHNwaGVyaWNhbFRvQ2FydGVzaWFuKGF6aW11dGgsIGFsdGl0dWRlKSB7CiAgICAgICAgbGV0IGF6ID0gZGVncmVlc1RvUmFkaWFucyhhemltdXRoKTsKICAgICAgICBsZXQgYWx0ID0gZGVncmVlc1RvUmFkaWFucyhhbHRpdHVkZSk7CiAgICAgICAgbGV0IHggPSBNYXRoLmNvcyhhbHQpICogTWF0aC5jb3MoYXopOwogICAgICAgIGxldCB5ID0gTWF0aC5jb3MoYWx0KSAqIE1hdGguc2luKGF6KTsKICAgICAgICBsZXQgeiA9IE1hdGguc2luKGFsdCk7CiAgICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSwgejogeiB9OwogICAgICB9CgogICAgICAvLyDlsIbnrKzlm5vkuKrngrnovazmjaLkuLrnrJvljaHlsJTlnZDmoIcKICAgICAgbGV0IGZvdXJ0aFBvaW50Q2FydGVzaWFuID0gc3BoZXJpY2FsVG9DYXJ0ZXNpYW4oZm91cnRoUG9pbnRBekFsdC5Bel9kZWdyZWUsIGZvdXJ0aFBvaW50QXpBbHQuQWx0X2RlZ3JlZSk7CiAgICAgIGNvbnNvbGUubG9nKCJGb3VydGggUG9pbnQgQ2FydGVzaWFuOiIsIGZvdXJ0aFBvaW50Q2FydGVzaWFuLngsICcsJywgZm91cnRoUG9pbnRDYXJ0ZXNpYW4ueSwgJywnLCBmb3VydGhQb2ludENhcnRlc2lhbi56KTsKCiAgICAgIGxldCBNYXJrQ2lyY2xlX2ZvdXJ0aFBvaW50ID0gdGhpcy5BZGRNYXJrQ2lyY2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIDQsICJUYXJnZXQgUG9pbnQiKTsKICAgICAgbW0gPSBNYXJrQ2lyY2xlX2ZvdXJ0aFBvaW50LnBvczsKICAgICAgbW1bMF0gPSBmb3VydGhQb2ludENhcnRlc2lhbi54OwogICAgICBtbVsxXSA9IGZvdXJ0aFBvaW50Q2FydGVzaWFuLnk7CiAgICAgIG1tWzJdID0gZm91cnRoUG9pbnRDYXJ0ZXNpYW4uejsKICAgICAgTWFya0NpcmNsZV9mb3VydGhQb2ludC5wb3MgPSBtbTsKICAgICAgTWFya0NpcmNsZV9mb3VydGhQb2ludC5jb2xvciA9IFsxLCAwLCAwLCAwLjI1XTsKCiAgICAgIHRoaXMuQ2lyY2xlcy5wdXNoKE1hcmtDaXJjbGVfZm91cnRoUG9pbnQpOwoKICAgICAgLy8g5riF56m65YiX6KGo77yM5YeG5aSH5LiL5qyh6K6h566XCiAgICAgIHRoaXMuQ2FydGVzaWFuTGlzdCA9IFtdOwogICAgICB0aGlzLk1hcmtDaXJjbGVOdW0gPSAwOwogICAgfSwKCiAgICAvLyDlsIbop5LluqbovazmjaLkuLrlvKfluqYKICAgIGRlZ3JlZXNUb1JhZGlhbnMoZGVncmVlcykgewogICAgICByZXR1cm4gZGVncmVlcyAqIE1hdGguUEkgLyAxODA7CiAgICB9LAoKICAgIC8vIOWwhueQg+WdkOagh+i9rOaNouS4uuesm+WNoeWwlOWdkOaghwogICAgc3BoZXJpY2FsVG9DYXJ0ZXNpYW4oYXppbXV0aCwgYWx0aXR1ZGUpIHsKICAgICAgbGV0IGF6ID0gdGhpcy5kZWdyZWVzVG9SYWRpYW5zKGF6aW11dGgpOwogICAgICBsZXQgYWx0ID0gdGhpcy5kZWdyZWVzVG9SYWRpYW5zKGFsdGl0dWRlKTsKICAgICAgbGV0IHggPSBNYXRoLmNvcyhhbHQpICogTWF0aC5jb3MoYXopOwogICAgICBsZXQgeSA9IE1hdGguY29zKGFsdCkgKiBNYXRoLnNpbihheik7CiAgICAgIGxldCB6ID0gTWF0aC5zaW4oYWx0KTsKICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSwgejogeiB9OwogICAgfSwKCiAgICAvLyDorqHnrpfml4vovazlm5vlhYPmlbAKICAgIGNvbXB1dGVRdWF0ZXJuaW9uKGZyb20sIHRvKSB7CiAgICAgIGxldCB3ID0gZnJvbS54ICogdG8ueCArIGZyb20ueSAqIHRvLnkgKyBmcm9tLnogKiB0by56ICsgMTsKICAgICAgbGV0IHggPSBmcm9tLnkgKiB0by56IC0gZnJvbS56ICogdG8ueTsKICAgICAgbGV0IHkgPSBmcm9tLnogKiB0by54IC0gZnJvbS54ICogdG8uejsKICAgICAgbGV0IHogPSBmcm9tLnggKiB0by55IC0gZnJvbS55ICogdG8ueDsKCiAgICAgIGxldCBub3JtID0gTWF0aC5zcXJ0KHcgKiB3ICsgeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgICAgcmV0dXJuIHsgdzogdyAvIG5vcm0sIHg6IHggLyBub3JtLCB5OiB5IC8gbm9ybSwgejogeiAvIG5vcm0gfTsKICAgIH0sCgogICAgLy8g5bqU55So5Zub5YWD5pWw5peL6L2sCiAgICBhcHBseVF1YXRlcm5pb24ocG9pbnQsIHF1YXQpIHsKICAgICAgbGV0IHggPSBxdWF0LncgKiBxdWF0LncgKiBwb2ludC54ICsgMiAqIHF1YXQueSAqIHF1YXQudyAqIHBvaW50LnogLSAyICogcXVhdC56ICogcXVhdC53ICogcG9pbnQueSArIHF1YXQueCAqIHF1YXQueCAqIHBvaW50LnggKyAyICogcXVhdC55ICogcXVhdC54ICogcG9pbnQueSArIDIgKiBxdWF0LnogKiBxdWF0LnggKiBwb2ludC56IC0gcXVhdC56ICogcXVhdC56ICogcG9pbnQueCAtIHF1YXQueSAqIHF1YXQueSAqIHBvaW50Lng7CiAgICAgIGxldCB5ID0gMiAqIHF1YXQueCAqIHF1YXQueSAqIHBvaW50LnggKyBxdWF0LnkgKiBxdWF0LnkgKiBwb2ludC55ICsgMiAqIHF1YXQueiAqIHF1YXQueSAqIHBvaW50LnogKyAyICogcXVhdC53ICogcXVhdC56ICogcG9pbnQueCAtIHF1YXQueiAqIHF1YXQueiAqIHBvaW50LnkgKyBxdWF0LncgKiBxdWF0LncgKiBwb2ludC55IC0gMiAqIHF1YXQueCAqIHF1YXQudyAqIHBvaW50LnogLSBxdWF0LnggKiBxdWF0LnggKiBwb2ludC55OwogICAgICBsZXQgeiA9IDIgKiBxdWF0LnggKiBxdWF0LnogKiBwb2ludC54ICsgMiAqIHF1YXQueSAqIHF1YXQueiAqIHBvaW50LnkgKyBxdWF0LnogKiBxdWF0LnogKiBwb2ludC56IC0gMiAqIHF1YXQudyAqIHF1YXQueSAqIHBvaW50LnggLSBxdWF0LnkgKiBxdWF0LnkgKiBwb2ludC56ICsgMiAqIHF1YXQudyAqIHF1YXQueCAqIHBvaW50LnkgLSBxdWF0LnggKiBxdWF0LnggKiBwb2ludC56ICsgcXVhdC53ICogcXVhdC53ICogcG9pbnQuejsKICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSwgejogeiB9OwogICAgfSwKCiAgICAvLyDlsIbnrJvljaHlsJTlnZDmoIfovazmjaLlm57nkIPlnZDmoIcKICAgIGNhcnRlc2lhblRvU3BoZXJpY2FsKGNhcnRlc2lhbikgewogICAgICBsZXQgciA9IE1hdGguc3FydChjYXJ0ZXNpYW4ueCAqKiAyICsgY2FydGVzaWFuLnkgKiogMiArIGNhcnRlc2lhbi56ICoqIDIpOwogICAgICBsZXQgYXppbXV0aCA9IE1hdGguYXRhbjIoY2FydGVzaWFuLnksIGNhcnRlc2lhbi54KTsKICAgICAgbGV0IGFsdGl0dWRlID0gTWF0aC5hc2luKGNhcnRlc2lhbi56IC8gcik7CiAgICAgIHJldHVybiB7CiAgICAgICAgQXpfZGVncmVlOiBhemltdXRoICogMTgwIC8gTWF0aC5QSSwKICAgICAgICBBbHRfZGVncmVlOiBhbHRpdHVkZSAqIDE4MCAvIE1hdGguUEkKICAgICAgfTsKICAgIH0sCgogICAgU29sdmVGb3ZNYXJrKFJhRGVjKSB7CiAgICAgIGNvbnNvbGUubG9nKCdSYURlY1s0XTonLCBSYURlYyk7CgogICAgICBsZXQgcmVjdGFuZ2xlID0gdGhpcy5BZGRNYXJrUmVjdGFuZ2xlKHRoaXMuJHN0ZWwsIGdsTGF5ZXIsIFJhRGVjKTsKCiAgICAgIHRoaXMuQ2lyY2xlcy5wdXNoKHJlY3RhbmdsZSk7CgogICAgfSwKCiAgICBDYWxpYnJhdGVQb2xhckF4aXMoKSB7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ2FsaWJyYXRlUG9sYXJBeGlzTW9kZScpOwogICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ1N0YXJ0TG9vcENhcHR1cmUnKTsKICAgICAgdGhpcy5uYXYgPSBmYWxzZTsKICAgIH0sCgogICAgUmVjYWxpYnJhdGVQb2xhckF4aXMoKSB7CiAgICAgIC8vIOa4heepuuWIl+ihqO+8jOWHhuWkh+S4i+asoeiuoeeulwogICAgICB0aGlzLkNhcnRlc2lhbkxpc3QgPSBbXTsKICAgICAgdGhpcy5NYXJrQ2lyY2xlTnVtID0gMDsKICAgICAgdGhpcy5SZW1vdmVBbGxDaXJjbGVzKCk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnQ2xlYXJTbG92ZVJlc3VsdExpc3QnKTsKICAgIH0sCgogICAgU2hvd0NvbmZpcm1EaWFsb2coVGl0bGUsIFRleHQsIFRvRG8pIHsKICAgICAgLy8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICB0aGlzLm5hdiA9IGZhbHNlOwogICAgICB0aGlzLiRidXMuJGVtaXQoJ1Nob3dDb25maXJtRGlhbG9nJywgVGl0bGUsIFRleHQsIFRvRG8pOwogICAgfSwKCiAgICBkZWNyZW1lbnQoaXRlbSkgewogICAgICBjb25zb2xlLmxvZygnZGVjcmVtZW50OicsIGl0ZW0udmFsdWUpOwogICAgICBpZiAoaXRlbS52YWx1ZSA+IGl0ZW0uaW5wdXRNaW4pIHsKICAgICAgICBpdGVtLnZhbHVlIC09IGl0ZW0uaW5wdXRTdGVwOwogICAgICB9CiAgICB9LAoKICAgIGluY3JlbWVudChpdGVtKSB7CiAgICAgIGNvbnNvbGUubG9nKCdpbmNyZW1lbnQ6JywgaXRlbS52YWx1ZSk7CiAgICAgIGlmIChpdGVtLnZhbHVlIDwgaXRlbS5pbnB1dE1heCkgewogICAgICAgIGl0ZW0udmFsdWUgKz0gaXRlbS5pbnB1dFN0ZXA7CiAgICAgIH0KICAgIH0sCgogICAgUG9sYXJBeGlzTW9kZShib29sKSB7CiAgICAgIHRoaXMuaXNQb2xhckF4aXNNb2RlID0gYm9vbDsKICAgIH0sCgogICAgaGFuZGxlR3VpZGVyQ2FudmFzQ2xpY2soZXZlbnQpIHsKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5ndWlkZXJDYW52YXM7CiAgICAgIGNvbnN0IHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIGNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OyAvLyDngrnlh7vlnZDmoIdYCiAgICAgIGNvbnN0IHkgPSBldmVudC5jbGllbnRZIC0gcmVjdC50b3A7ICAvLyDngrnlh7vlnZDmoIdZCiAgICAgIGNvbnNvbGUubG9nKGBDbGlja2VkIGF0OiAoJHt4fSwgJHt5fSlgKTsKICAgICAgY29uc3QgQ2FudmFzV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgY29uc3QgQ2FudmFzSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ0d1aWRlckNhbnZhc0NsaWNrOicgKyBDYW52YXNXaWR0aCArICc6JyArIENhbnZhc0hlaWdodCArICc6JyArIHggKyAnOicgKyB5KTsKICAgIH0sCiAgICBjb25uZWN0RHJpdmVyKCkgewogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IHRydWU7CiAgICAgIC8vIHRoaXMuaXNPcGVuRGV2aWNlUGFnZSA9IGZhbHNlOwogICAgICB0aGlzLnN0YXJ0TG9hZGluZygpOwogICAgICBjb25zdCBEZXZpY2VUeXBlID0gdGhpcy5DdXJyZW50RHJpdmVyVHlwZTsKICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBEZXZpY2VUeXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCA9PSBmYWxzZSkgewogICAgICAgICAgY29uc3QgRHJpdmVyTmFtZSA9IGRldmljZS5kcml2ZXJOYW1lOwogICAgICAgICAgaWYgKERyaXZlck5hbWUgPT0gJycpIHsKICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnTm8gZHJpdmVyIHNlbGVjdGVkJywgJ3dhcm5pbmcnKTsKICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdDb25uZWN0RHJpdmVyOicgKyBEcml2ZXJOYW1lICsgJzonICsgRGV2aWNlVHlwZSk7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdTdGFydCBDb25uZWN0aW5nIGRyaXZlcjonICsgRGV2aWNlVHlwZSArICcgJyArIERyaXZlck5hbWUsICdpbmZvJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY29ubmVjdERyaXZlclN1Y2Nlc3MoZGV2aWNldHlwZSkgewogICAgICBjb25zb2xlLmxvZygnY29ubmVjdERyaXZlclN1Y2Nlc3M6JywgZGV2aWNldHlwZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coImNvbm5lY3REcml2ZXJTdWNjZXNzOiIgKyBkZXZpY2V0eXBlLCAnaW5mbycpOwogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IGZhbHNlOwogICAgICBpZiAodGhpcy5kcmF3ZXJfMiA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5kcmF3ZXJfMiA9IGZhbHNlCiAgICAgIH0KCiAgICAgIHRoaXMuc3RvcExvYWRpbmcoKTsKICAgIH0sCiAgICBjb25uZWN0RHJpdmVyRmFpbGVkKG1lc3NhZ2UpIHsKICAgICAgY29uc29sZS5sb2coJ2Nvbm5lY3REcml2ZXJGYWlsZWQ6JywgbWVzc2FnZSk7CiAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coImNvbm5lY3REcml2ZXJGYWlsZWQ6IiArIG1lc3NhZ2UsICdlcnJvcicpOwogICAgICB0aGlzLmlzQ29ubmVjdGluZyA9IGZhbHNlOwogICAgICB0aGlzLnN0b3BMb2FkaW5nKCk7CiAgICB9LAogICAgZGlzY29ubmVjdERyaXZlcigpIHsKICAgICAgY29uc3QgRGV2aWNlVHlwZSA9IHRoaXMuQ3VycmVudERyaXZlclR5cGU7CiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuZGV2aWNlcykgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gRGV2aWNlVHlwZSAmJiBkZXZpY2UuaXNDb25uZWN0ZWQpIHsKICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQXBwU2VuZE1lc3NhZ2UnLCAnVnVlX0NvbW1hbmQnLCAnRGlzY29ubmVjdERldmljZTonICsgZGV2aWNlLmRldmljZSArICI6IiArIERldmljZVR5cGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRpc2Nvbm5lY3REcml2ZXJzdWNjZXNzKGRldmljZXR5cGUpIHsKICAgICAgY29uc29sZS5sb2coJ2Rpc2Nvbm5lY3REZXZpY2VzdWNjZXNzOicsIGRldmljZXR5cGUpOwogICAgICB0aGlzLmRyYXdlcl8yID0gZmFsc2UKICAgICAgaWYgKGRldmljZXR5cGUgPT0gImFsbCIpIHsKICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCdWdWVfQ29tbWFuZCcsICdkaXNjb25uZWN0QWxsRGV2aWNlJyk7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnRGlzY29ubmVjdCBBbGwgRGV2aWNlJywgJ2luZm8nKTsKICAgICAgICB0aGlzLmhhdmVEZXZpY2VDb25uZWN0ID0gZmFsc2U7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNYWluQ2FtZXJhQ29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdNb3VudENvbm5lY3RlZCcsIDApOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLmNsYWVyRGV2aWNlTGlzdCgpOwogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZGVsZXRlRGV2aWNlVHlwZUFsbG9jYXRpb25MaXN0JywgJ2FsbCcpOwogICAgICAgIHJldHVybjsKICAgICAgfTsKCiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuZGV2aWNlcykgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZGV2aWNldHlwZSAmJiBkZXZpY2UuaXNDb25uZWN0ZWQpIHsKICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gZGV2aWNlLmRyaXZlck5hbWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIHRoaXMuVG9CZUNvbm5lY3REZXZpY2UpIHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09IGRldmljZXR5cGUpIHsKICAgICAgICAgIGRldmljZS5pc0Nvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAgZGV2aWNlLmlzZ2V0ID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuZGV2aWNlID0gZGV2aWNlLmRyaXZlck5hbWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLiRidXMuJGVtaXQoJ2RlbGV0ZURldmljZVR5cGVBbGxvY2F0aW9uTGlzdCcsIGRldmljZXR5cGUpOwogICAgICBpZiAoZGV2aWNldHlwZSA9PSAiTWFpbkNhbWVyYSIpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJNb3VudCIpIHsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgIH0gZWxzZSBpZiAoZGV2aWNldHlwZSA9PSAiQ0ZXIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnQ0ZXQ29ubmVjdGVkJywgMCk7CiAgICAgIH0gZWxzZSBpZiAoZGV2aWNldHlwZSA9PSAiR3VpZGVyIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnR3VpZGVyQ29ubmVjdGVkJywgMCk7CiAgICAgIH0KICAgIH0sCgogICAgZGlzY29ubmVjdERyaXZlckZhaWwoZGV2aWNldHlwZSkgewogICAgICBjb25zb2xlLmxvZygnZGlzY29ubmVjdERldmljZUZhaWw6JywgZGV2aWNldHlwZSk7CiAgICAgIHRoaXMuZHJhd2VyXzIgPSBmYWxzZQogICAgICBpZiAoZGV2aWNldHlwZSA9PSAiYWxsIikgewogICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RBbGxEZXZpY2UnKTsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdEaXNjb25uZWN0IEFsbCBEZXZpY2UnLCAnaW5mbycpOwogICAgICAgIHRoaXMuaGF2ZURldmljZUNvbm5lY3QgPSBmYWxzZTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01haW5DYW1lcmFDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ01vdW50Q29ubmVjdGVkJywgMCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDRldDb25uZWN0ZWQnLCAwKTsKICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0d1aWRlckNvbm5lY3RlZCcsIDApOwogICAgICAgIHRoaXMuY2xhZXJEZXZpY2VMaXN0KCk7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdkZWxldGVEZXZpY2VUeXBlQWxsb2NhdGlvbkxpc3QnLCAnYWxsJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9OwoKICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5kZXZpY2VzKSB7CiAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBkZXZpY2V0eXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCkgewogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuaXNnZXQgPSBmYWxzZTsKICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkZXZpY2UuZHJpdmVyTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgdGhpcy5Ub0JlQ29ubmVjdERldmljZSkgewogICAgICAgIGlmIChkZXZpY2UuZHJpdmVyVHlwZSA9PT0gZGV2aWNldHlwZSkgewogICAgICAgICAgZGV2aWNlLmlzQ29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgICBkZXZpY2UuaXNnZXQgPSBmYWxzZTsKICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkZXZpY2UuZHJpdmVyTmFtZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnZGVsZXRlRGV2aWNlVHlwZUFsbG9jYXRpb25MaXN0JywgZGV2aWNldHlwZSk7CiAgICAgIGlmIChkZXZpY2V0eXBlID09ICJNYWluQ2FtZXJhIikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTWFpbkNhbWVyYUNvbm5lY3RlZCcsIDApOwogICAgICB9IGVsc2UgaWYgKGRldmljZXR5cGUgPT0gIk1vdW50IikgewogICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnTW91bnRDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJDRlciKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdDRldDb25uZWN0ZWQnLCAwKTsKICAgICAgfSBlbHNlIGlmIChkZXZpY2V0eXBlID09ICJHdWlkZXIiKSB7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdHdWlkZXJDb25uZWN0ZWQnLCAwKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRTZWxlY3RlZERyaXZlckxpc3QoZGV2aWNlT2JqZWN0KSB7CiAgICAgIGNvbnNvbGUubG9nKCdsb2FkU2VsZWN0ZWREcml2ZXJMaXN0OicsIGRldmljZU9iamVjdCk7CiAgICAgIGRldmljZU9iamVjdC5mb3JFYWNoKGRldmljZSA9PiB7CiAgICAgICAgLy8g5YGH6K6+5L2g5oOz6KaB5omT5Y2w5q+P5Liq6K6+5aSH5a+56LGh55qE6ZSu5YC85a+5CiAgICAgICAgZm9yIChjb25zdCBbZHJpdmVyVHlwZSwgZHJpdmVyTmFtZV0gb2YgT2JqZWN0LmVudHJpZXMoZGV2aWNlKSkgewogICAgICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICAgICAgaWYgKGRldmljZS5kcml2ZXJUeXBlID09PSBkcml2ZXJUeXBlICYmIGRldmljZS5pc0Nvbm5lY3RlZCA9PSBmYWxzZSkgewogICAgICAgICAgICAgIGRldmljZS5kZXZpY2UgPSBkcml2ZXJOYW1lOwogICAgICAgICAgICAgIGRldmljZS5kcml2ZXJOYW1lID0gZHJpdmVyTmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBsb2FkQmluZERldmljZUxpc3QoZGV2aWNlT2JqZWN0KSB7CiAgICAgIGNvbnNvbGUubG9nKCdsb2FkQmluZERldmljZUxpc3Q6JywgZGV2aWNlT2JqZWN0KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdsb2FkQmluZERldmljZUxpc3QnLCBkZXZpY2VPYmplY3QpOwoKICAgIH0sCiAgICBsb2FkQmluZERldmljZVR5cGVMaXN0KGRldmljZVR5cGVPYmplY3QpIHsKICAgICAgY29uc29sZS5sb2coJ2xvYWRCaW5kRGV2aWNlVHlwZUxpc3Q6JywgZGV2aWNlVHlwZU9iamVjdCk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnbG9hZEJpbmREZXZpY2VUeXBlTGlzdCcsIGRldmljZVR5cGVPYmplY3QpOwogICAgICBkZXZpY2VUeXBlT2JqZWN0LmZvckVhY2goZGV2aWNlVHlwZSA9PiB7CiAgICAgICAgY29uc3QgeyBUeXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc2JpbmQgfSA9IGRldmljZVR5cGU7CiAgICAgICAgdGhpcy51cGRhdGVEZXZpY2VzQ29ubmVjdChUeXBlLCBEZXZpY2VOYW1lLCBEcml2ZXJOYW1lLCBpc2JpbmQpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTZWxlY3RlZERyaXZlcihkcml2ZXJUeXBlKSB7CgogICAgICB0aGlzLnNlbGVjdGVkRHJpdmVyID0gbnVsbDsKICAgICAgdGhpcy5kZXZpY2VzLmZvckVhY2goZGV2aWNlID0+IHsKICAgICAgICBpZiAoZGV2aWNlLmRyaXZlclR5cGUgPT09IGRyaXZlclR5cGUpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWREcml2ZXIgPSBkZXZpY2UuZHJpdmVyTmFtZQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCdDdXJyZW50IGRyaXZlcnM6JywgdGhpcy5zZWxlY3RlZERyaXZlcik7CiAgICB9LAogICAgc3RhcnRMb2FkaW5nKCkgewogICAgICB0aGlzLmxvYWRpbmdEZXZpY2VTZWxlY3Rpb24gPSB0cnVlOwogICAgfSwKICAgIHN0b3BMb2FkaW5nKCkgewogICAgICB0aGlzLmxvYWRpbmdEZXZpY2VTZWxlY3Rpb24gPSBmYWxzZTsKICAgIH0sCiAgICBkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdChkZXZpY2VOYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKCdkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdDonLCBkZXZpY2VOYW1lKTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdkZWxldGVEZXZpY2VBbGxvY2F0aW9uTGlzdCcsIGRldmljZU5hbWUpOwogICAgfSwKICAgIFVuQmluZGluZ0RldmljZSh0eXBlLCBuYW1lLCBkcml2ZXJOYW1lKSB7CiAgICAgIGNvbnNvbGUubG9nKCdVbkJpbmRpbmdEZXZpY2U6JywgdHlwZSwgbmFtZSwgZHJpdmVyTmFtZSk7CiAgICAgIHRoaXMudXBkYXRlRGV2aWNlc0Nvbm5lY3QodHlwZSwgbmFtZSwgZHJpdmVyTmFtZSwgZmFsc2UpOwogICAgfSwKCiAgICBkaXNwbGF5RXJyb3JJbWFnZSgpIHsKICAgICAgY29uc29sZS5lcnJvcigiaW1hZ2UgaXMgZXJyb3IsIGxvYWQgZXJyb3JJbWFnZS5zdmciKTsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5DYW1lcmEtY2FudmFzJyk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpOwoKICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4gewogICAgICAgIC8vIOiOt+WPluiuvuWkh+WDj+e0oOavlAogICAgICAgIGNvbnN0IGRldmljZVBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwoKICAgICAgICAvLyDosIPmlbTnlLvluIPlsLrlr7jku6XpgILlupTpq5jmuIXmmL7npLoKICAgICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aCAqIGRldmljZVBpeGVsUmF0aW87CiAgICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodCAqIGRldmljZVBpeGVsUmF0aW87CiAgICAgICAgY3R4LnNjYWxlKGRldmljZVBpeGVsUmF0aW8sIGRldmljZVBpeGVsUmF0aW8pOyAvLyDnvKnmlL5jdHjku6XpgILlupTpq5jmuIXnlLvluIMKCiAgICAgICAgLy8g57uY5Yi25Zu+5YOPCiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIH07CgogICAgICBpbWFnZS5vbmVycm9yID0gKCkgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIGltYWdlIGZyb20gIiArIGltYWdlLnNyYyk7CiAgICAgICAgLy8g5Y+v5Lul5Zyo6L+Z6YeM5re75Yqg5aSH55So5Zu+5YOP5oiW5YW25LuW6ZSZ6K+v5aSE55CG6YC76L6RCiAgICAgIH07CgogICAgICAvLyDnoa7kv51FcnJvckltYWdl5piv5pyJ5pWI55qEVVJMCiAgICAgIGltYWdlLnNyYyA9IEVycm9ySW1hZ2U7IC8vIOivt+abv+aNouS4uuWunumZheeahOWbvuWDj+i3r+W+hAogICAgfSwKICAgIGhhbmRsZUVycm9yKG1lc3NhZ2UsIGxvY2F0aW9uLCBlcnJvciA9IG51bGwpIHsKICAgICAgY29uc3QgZXJyb3JNc2cgPSBlcnJvciA/IGAke21lc3NhZ2V9IGF0ICR7bG9jYXRpb259OiAke2Vycm9yfWAgOiBgJHttZXNzYWdlfSBhdCAke2xvY2F0aW9ufWA7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNc2cpOwogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKGVycm9yTXNnLCAnZXJyb3InKTsKICAgICAgdGhpcy5kaXNwbGF5RXJyb3JJbWFnZSgpOyAvLyDmmL7npLrplJnor6/lm77lg48KICAgIH0sCiAgICBzaG93U2VsZWN0ZGlzY29ubmVjdERyaXZlcihkcml2ZXJuYW1lKSB7CiAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3REaWFsb2cgPSB0cnVlOwogICAgICB0aGlzLmN1cnJlbnREaXNjb25uZWN0RHJpdmVyTmFtZSA9IGRyaXZlcm5hbWU7CiAgICB9LAogICAgY29uZmlybURpc2Nvbm5lY3QoKSB7CiAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ1Z1ZV9Db21tYW5kJywgJ2Rpc2Nvbm5lY3RTZWxlY3REcml2ZXI6JyArIHRoaXMuY3VycmVudERpc2Nvbm5lY3REcml2ZXJOYW1lKTsKICAgICAgdGhpcy5zaG93RGlzY29ubmVjdERpYWxvZyA9IGZhbHNlOwogICAgfSwKCiAgICAvLyDkuLvnlLvluIPngrnlh7vkuovku7YKICAgIGhhbmRsZU1haW5DYW52YXNDbGljayhldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HpvKDmoIfngrnlh7vkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKCF0aGlzLmVuYWJsZU1haW5DYW52YXNDbGljayB8fCB0aGlzLmlzRHJhZ2dpbmcgfHwgdGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47IC8vIOWmguaenOeUu+W4g+S4jeWPr+eCueWHu++8jOWImeS4jeWkhOeQhueCueWHu+S6i+S7tgogICAgICAvLyBjb25zb2xlLmxvZygn6Kem5Y+R6byg5qCH54K55Ye75LqL5Lu2OicsIGV2ZW50KTsKICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5tYWluQ2FudmFzOwogICAgICBpZiAoIWNhbnZhcykgcmV0dXJuOyAvLyDnoa7kv50gY2FudmFzIOWFg+e0oOWtmOWcqAogICAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOy8vIOiOt+WPliBjYW52YXMg5YWD57Sg55qE6L6555WM55+p5b2iCiAgICAgIGNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OwogICAgICBjb25zdCB5ID0gZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wOwogICAgICBjb25zb2xlLmxvZygnTW91c2UgY2xpY2tlZCBhdDonLCB4LCB5KTsKICAgICAgaWYgKCF0aGlzLmlzRm9jdXNMb29wU2hvb3RpbmcpIHsKICAgICAgICB0aGlzLlJPSV94ID0gKHggLyB3aW5kb3cuaW5uZXJXaWR0aCAqIHRoaXMudmlzaWJsZVdpZHRoIC0gdGhpcy5SZWRCb3hTaWRlTGVuZ3RoIC8gMikgKyB0aGlzLnZpc2libGVYIC0gdGhpcy52aXNpYmxlV2lkdGggLyAyOyAgLy8g6K6h566XUk9J55qEeOWdkOaghwogICAgICAgIHRoaXMuUk9JX3kgPSAoeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodCAtIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAvIDIpICsgdGhpcy52aXNpYmxlWSAtIHRoaXMudmlzaWJsZUhlaWdodCAvIDI7IC8vIOiuoeeul1JPSeeahHnlnZDmoIcKICAgICAgICAvLyB0aGlzLiRidXMuJGVtaXQoJ3NldFJlZEJveFBvc2l0aW9uJywgeCwgeSwgdGhpcy5ST0lfeCwgdGhpcy5ST0lfeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWxlY3RTdGFyWCA9ICh4IC8gd2luZG93LmlubmVyV2lkdGggKiB0aGlzLnZpc2libGVXaWR0aCkgKyB0aGlzLnZpc2libGVYIC0gdGhpcy52aXNpYmxlV2lkdGggLyAyIC0gdGhpcy5ST0lfeDsgLy8g6K6h566X6YCJ5oup5L2N572u55qEeOWdkOaghwogICAgICAgIHRoaXMuc2VsZWN0U3RhclkgPSAoeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodCkgKyB0aGlzLnZpc2libGVZIC0gdGhpcy52aXNpYmxlSGVpZ2h0IC8gMiAtIHRoaXMuUk9JX3k7IC8vIOiuoeeul+mAieaLqeS9jee9rueahHnlnZDmoIcKCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0U3RhclggPj0gMCAmJiB0aGlzLnNlbGVjdFN0YXJYIDwgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoICYmCiAgICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID49IDAgJiYgdGhpcy5zZWxlY3RTdGFyWSA8IHRoaXMuUmVkQm94U2lkZUxlbmd0aCkgewogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU2VsZWN0IFN0YXIgaXMgaW4gUk9JJywgJ2luZm8nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnU2VsZWN0IFN0YXIgaXMgbm90IGluIFJPSScsICdlcnJvcicpOwogICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWCA9IC0xOwogICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWSA9IC0xOwogICAgICAgIH0KICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ0FwcFNlbmRNZXNzYWdlJywgJ1Z1ZV9Db21tYW5kJywgJ3NlbmRTZWxlY3RTdGFyczonICsgdGhpcy5zZWxlY3RTdGFyWCArICc6JyArIHRoaXMuc2VsZWN0U3RhclkpOwogICAgICB9CiAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgfSwKCiAgICAvLyDkuLvnlLvluIPmi5bliqgKICAgIGhhbmRsZU1vdXNlRG93bihldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HpvKDmoIfmjInkuIvkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKHRoaXMuaXNEcmFnZ2luZyB8fCB0aGlzLmRyYXdJbWdEYXRhID09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5pc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5zdGFydFggPSBldmVudC5jbGllbnRYOwogICAgICB0aGlzLnN0YXJ0WSA9IGV2ZW50LmNsaWVudFk7CiAgICAgIHRoaXMuY3VycmVudFggPSBldmVudC5jbGllbnRYOwogICAgICB0aGlzLmN1cnJlbnRZID0gZXZlbnQuY2xpZW50WTsKCiAgICAgIC8vIOiuvue9ruS4gOS4quWumuaXtuWZqO+8jOavjzEwMG1z5omn6KGM5LiA5qyh6byg5qCH56e75Yqo55qE6YC76L6RCiAgICAgIHRoaXMubW92ZUludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcpIHJldHVybjsKCiAgICAgICAgY29uc3QgZHggPSB0aGlzLnN0YXJ0WCAtIHRoaXMuY3VycmVudFg7CiAgICAgICAgY29uc3QgZHkgPSB0aGlzLnN0YXJ0WSAtIHRoaXMuY3VycmVudFk7CiAgICAgICAgaWYgKGlzTmFOKGR4KSB8fCBpc05hTihkeSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IG5ld1Zpc2libGVYID0gdGhpcy52aXNpYmxlWCArIGR4IC8gd2luZG93LmlubmVyV2lkdGggKiB0aGlzLnZpc2libGVXaWR0aDsKICAgICAgICBsZXQgbmV3VmlzaWJsZVkgPSB0aGlzLnZpc2libGVZICsgZHkgLyB3aW5kb3cuaW5uZXJIZWlnaHQgKiB0aGlzLnZpc2libGVIZWlnaHQ7CiAgICAgICAgaWYgKG5ld1Zpc2libGVYIDwgMCkgewogICAgICAgICAgbmV3VmlzaWJsZVggPSAwOwogICAgICAgIH0KICAgICAgICBpZiAobmV3VmlzaWJsZVkgPCAwKSB7CiAgICAgICAgICBuZXdWaXNpYmxlWSA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChuZXdWaXNpYmxlWCA+IHRoaXMubWFpbkNhbWVyYVNpemVYKSB7CiAgICAgICAgICBuZXdWaXNpYmxlWCA9IHRoaXMubWFpbkNhbWVyYVNpemVYOwogICAgICAgIH0KICAgICAgICBpZiAobmV3VmlzaWJsZVkgPiB0aGlzLm1haW5DYW1lcmFTaXplWSkgewogICAgICAgICAgbmV3VmlzaWJsZVkgPSB0aGlzLm1haW5DYW1lcmFTaXplWTsKICAgICAgICB9CgogICAgICAgIHRoaXMudmlzaWJsZVggPSBuZXdWaXNpYmxlWDsKICAgICAgICB0aGlzLnZpc2libGVZID0gbmV3VmlzaWJsZVk7CgogICAgICAgIHRoaXMuc3RhcnRYID0gdGhpcy5jdXJyZW50WDsKICAgICAgICB0aGlzLnN0YXJ0WSA9IHRoaXMuY3VycmVudFk7CiAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn5ouW5Yqo5LqL5Lu2LOaLluWKqOi3neemuzonICsgZHggKyAnLCcgKyBkeSwgJ2luZm8nKTsKICAgICAgfSwgMTAwKTsKICAgIH0sCiAgICBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R6byg5qCH56e75Yqo5LqL5Lu2OicsICdpbmZvJyk7CiAgICAgIGlmICghdGhpcy5pc0RyYWdnaW5nKSByZXR1cm47CiAgICAgIHRoaXMuY3VycmVudFggPSBldmVudC5jbGllbnRYOwogICAgICB0aGlzLmN1cnJlbnRZID0gZXZlbnQuY2xpZW50WTsKICAgIH0sCiAgICBoYW5kbGVNb3VzZVVwKGV2ZW50KSB7CiAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkem8oOagh+aKrOi1t+S6i+S7tjonLCAnaW5mbycpOwogICAgICB0aGlzLmlzRHJhZ2dpbmcgPSBmYWxzZTsKCiAgICAgIC8vIOa4hemZpOWumuaXtuWZqAogICAgICBjbGVhckludGVydmFsKHRoaXMubW92ZUludGVydmFsSWQpOwogICAgICB0aGlzLm1vdmVJbnRlcnZhbElkID0gbnVsbDsKICAgIH0sCiAgICBoYW5kbGVXaGVlbChldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HpvKDmoIfmu5rova7kuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKHRoaXMuZHJhd0ltZ0RhdGEgPT0gbnVsbCkgcmV0dXJuOwogICAgICBjb25zdCBzY2FsZUNoYW5nZSA9IGV2ZW50LmRlbHRhWSA+IDAgPyAwLjEgOiAtMC4xOyAvLyDmoLnmja7mu5rova7nmoTmu5rliqjmlrnlkJHvvIzorqHnrpfnvKnmlL7mr5TkvovnmoTlj5jljJbph48KICAgICAgbGV0IG5ld1NjYWxlID0gdGhpcy5zY2FsZSArIHNjYWxlQ2hhbmdlOyAvLyDmm7TmlrDnvKnmlL7mr5TkvosKICAgICAgaWYgKG5ld1NjYWxlIDwgMC4xKSB7CiAgICAgICAgbmV3U2NhbGUgPSAwLjE7CiAgICAgIH0KICAgICAgaWYgKG5ld1NjYWxlID4gMSkgewogICAgICAgIG5ld1NjYWxlID0gMTsKICAgICAgfQoKICAgICAgLy8g5aaC5p6c5bey57uP5pyJ5LiA5Liq5b6F5omn6KGM55qE57yp5pS+5pON5L2c77yM5YiZ55u05o6l6L+U5ZueCiAgICAgIGlmICh0aGlzLnBlbmRpbmdTY2FsZUNoYW5nZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5qCH6K6w5pyJ5LiA5Liq5b6F5omn6KGM55qE57yp5pS+5pON5L2cCiAgICAgIHRoaXMucGVuZGluZ1NjYWxlQ2hhbmdlID0gdHJ1ZTsKCiAgICAgIC8vIOS9v+eUqCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUg5p2l5o6n5Yi257yp5pS+5pON5L2c55qE5omn6KGM6aKR546HCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7CiAgICAgICAgaWYgKG5ld1NjYWxlICE9IHRoaXMuc2NhbGUpIHsKICAgICAgICAgIHRoaXMuc2NhbGUgPSBuZXdTY2FsZTsgLy8g5pu05paw57yp5pS+5q+U5L6LCiAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFNjYWxlJywgdGhpcy5zY2FsZSk7CiAgICAgICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+e8qeaUvuavlOS+i+WPmOWMliznvKnmlL7mr5Tkvos6JyArIG5ld1NjYWxlLCAnaW5mbycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnvKnmlL7mr5TkvovmsqHmnInlj5jljJYs57yp5pS+5q+U5L6LOicgKyB0aGlzLnNjYWxlLCAnaW5mbycpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBlbmRpbmdTY2FsZUNoYW5nZSA9IGZhbHNlOyAvLyDmuIXpmaTlvoXmiafooYznmoTnvKnmlL7mk43kvZzmoIforrAKICAgICAgfSk7CiAgICB9LAoKICAgIGhhbmRsZU1haW5DYW52YXNUb3VjaChldmVudCkgewogICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5Hop6bmkbjkuovku7Y6JywgJ2luZm8nKTsKICAgICAgaWYgKCF0aGlzLmVuYWJsZU1haW5DYW52YXNDbGljayB8fCB0aGlzLmlzRHJhZ2dpbmcgfHwgdGhpcy5kcmF3SW1nRGF0YSA9PSBudWxsKSByZXR1cm47IC8vIOWmguaenOeUu+W4g+S4jeWPr+eCueWHu++8jOWImeS4jeWkhOeQhueCueWHu+S6i+S7tgogICAgICAvLyBjb25zb2xlLmxvZygn6Kem5Y+R6Kem5pG45LqL5Lu2OicsIGV2ZW50KTsKICAgICAgaWYgKCF0aGlzLmVuYWJsZU1haW5DYW52YXNDbGljayB8fCAhZXZlbnQudG91Y2hlcyB8fCBldmVudC50b3VjaGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICBjb25zdCBjYW52YXMgPSB0aGlzLiRyZWZzLm1haW5DYW52YXM7CiAgICAgIGlmICghY2FudmFzKSByZXR1cm47IC8vIOehruS/nSBjYW52YXMg5YWD57Sg5a2Y5ZyoCiAgICAgIGNvbnN0IHRvdWNoID0gZXZlbnQudG91Y2hlc1swXTsKICAgICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsvLyDojrflj5YgY2FudmFzIOWFg+e0oOeahOi+ueeVjOefqeW9ogogICAgICBjb25zdCB4ID0gdG91Y2guY2xpZW50WCAtIHJlY3QubGVmdDsKICAgICAgY29uc3QgeSA9IHRvdWNoLmNsaWVudFkgLSByZWN0LnRvcDsKICAgICAgY29uc29sZS5sb2coJ1RvdWNoIGF0OicsIHgsIHkpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOy8vIOmYu+atoum7mOiupOS6i+S7tu+8jOWmgumhtemdoua7muWKqAogICAgICBpZiAoIXRoaXMuaXNGb2N1c0xvb3BTaG9vdGluZykgewogICAgICAgIHRoaXMuUk9JX3ggPSAoeCAvIHdpbmRvdy5pbm5lcldpZHRoICogdGhpcy52aXNpYmxlV2lkdGggLSB0aGlzLlJlZEJveFNpZGVMZW5ndGggLyAyKSArIHRoaXMudmlzaWJsZVggLSB0aGlzLnZpc2libGVXaWR0aCAvIDIgLSB0aGlzLlJPSV94OyAgLy8g6K6h566XUk9J55qEeOWdkOaghwogICAgICAgIHRoaXMuUk9JX3kgPSAoeSAvIHdpbmRvdy5pbm5lckhlaWdodCAqIHRoaXMudmlzaWJsZUhlaWdodCAtIHRoaXMuUmVkQm94U2lkZUxlbmd0aCAvIDIpICsgdGhpcy52aXNpYmxlWSAtIHRoaXMudmlzaWJsZUhlaWdodCAvIDIgLSB0aGlzLlJPSV95OyAvLyDorqHnrpdST0nnmoR55Z2Q5qCHCiAgICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdzZXRSZWRCb3hQb3NpdGlvbicsIHgsIHksIHRoaXMuUk9JX3gsIHRoaXMuUk9JX3kpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VsZWN0U3RhclggPSAoeCAvIHdpbmRvdy5pbm5lcldpZHRoICogdGhpcy52aXNpYmxlV2lkdGgpICsgdGhpcy52aXNpYmxlWCAtIHRoaXMudmlzaWJsZVdpZHRoIC8gMiAtIHRoaXMuUk9JX3g7IC8vIOiuoeeul+mAieaLqeS9jee9rueahHjlnZDmoIcKICAgICAgICB0aGlzLnNlbGVjdFN0YXJZID0gKHkgLyB3aW5kb3cuaW5uZXJIZWlnaHQgKiB0aGlzLnZpc2libGVIZWlnaHQpICsgdGhpcy52aXNpYmxlWSAtIHRoaXMudmlzaWJsZUhlaWdodCAvIDIgLSB0aGlzLlJPSV95OyAvLyDorqHnrpfpgInmi6nkvY3nva7nmoR55Z2Q5qCHCgogICAgICAgIGlmICh0aGlzLnNlbGVjdFN0YXJYID49IDAgJiYgdGhpcy5zZWxlY3RTdGFyWCA8IHRoaXMuUmVkQm94U2lkZUxlbmd0aCAmJgogICAgICAgICAgdGhpcy5zZWxlY3RTdGFyWSA+PSAwICYmIHRoaXMuc2VsZWN0U3RhclkgPCB0aGlzLlJlZEJveFNpZGVMZW5ndGgpIHsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1NlbGVjdCBTdGFyIGlzIGluIFJPSScsICdpbmZvJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1NlbGVjdCBTdGFyIGlzIG5vdCBpbiBST0knLCAnZXJyb3InKTsKICAgICAgICAgIHRoaXMuc2VsZWN0U3RhclggPSAtMTsKICAgICAgICAgIHRoaXMuc2VsZWN0U3RhclkgPSAtMTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdBcHBTZW5kTWVzc2FnZScsICdWdWVfQ29tbWFuZCcsICdzZW5kU2VsZWN0U3RhcnM6JyArIHRoaXMuc2VsZWN0U3RhclggKyAnOicgKyB0aGlzLnNlbGVjdFN0YXJZKTsKICAgICAgfQogICAgICB0aGlzLmRyYXdJbWFnZURhdGEoKTsKICAgIH0sCiAgICBoYW5kbGVUb3VjaFN0YXJ0KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLmRyYXdJbWdEYXRhID09IG51bGwpIHJldHVybjsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R6Kem5pG45byA5aeL5LqL5Lu2OicsICdpbmZvJyk7CiAgICAgIGlmIChldmVudC50b3VjaGVzLmxlbmd0aCA9PT0gMSkgeyAvLyDljZXmjIfop6bmkbjvvIzlvIDlp4vmi5bliqgKICAgICAgICB0aGlzLmlzT25lVG91Y2ggPSB0cnVlOwogICAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeWNleaMh+inpuaRuOS6i+S7ticsICdpbmZvJyk7CiAgICAgICAgdGhpcy5pc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnN0YXJ0VG91Y2hYWzBdID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYOwogICAgICAgIHRoaXMuc3RhcnRUb3VjaFlbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgdGhpcy5jdXJyZW50VG91Y2hYWzBdID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYOwogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWVswXSA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WTsKICAgICAgICAvLyDmuIXpmaTlj6/og73lrZjlnKjnmoTlj4zmjIfop6bmkbjnmoTlrprml7blmagKICAgICAgICBpZiAodGhpcy56b29tSW50ZXJ2YWxJZCkgewogICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnpvb21JbnRlcnZhbElkKTsKICAgICAgICAgIHRoaXMuem9vbUludGVydmFsSWQgPSBudWxsOwogICAgICAgIH0KCgogICAgICAgIHRoaXMuaGFuZGxlTWFpbkNhbnZhc1RvdWNoKGV2ZW50KTsKICAgICAgfSBlbHNlIGlmIChldmVudC50b3VjaGVzLmxlbmd0aCA+PSAyKSB7IC8vIOWPjOaMh+inpuaRuO+8jOW8gOWni+e8qeaUvgogICAgICAgIHRoaXMuaXNPbmVUb3VjaCA9IGZhbHNlOwogICAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeWPjOaMh+inpuaRuOS6i+S7ticsICdpbmZvJyk7CiAgICAgICAgdGhpcy5pc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAvLyDorqHnrpfkuKTkuKrop6bmkbjngrnkuYvpl7TnmoTot53nprsKICAgICAgICBjb25zdCBkeCA9IHRoaXMuY3VycmVudFRvdWNoWFswXSAtIHRoaXMuY3VycmVudFRvdWNoWFsxXTsKICAgICAgICBjb25zdCBkeSA9IHRoaXMuY3VycmVudFRvdWNoWVswXSAtIHRoaXMuY3VycmVudFRvdWNoWVsxXTsKICAgICAgICB0aGlzLnN0YXJ0VG91Y2hEaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgICAgLy8g5riF6Zmk5Y+v6IO95a2Y5Zyo55qE5Y2V5oyH6Kem5pG455qE5a6a5pe25ZmoCiAgICAgICAgaWYgKHRoaXMubW92ZUludGVydmFsSWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb3ZlSW50ZXJ2YWxJZCk7CiAgICAgICAgICB0aGlzLm1vdmVJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CgoKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HlpJrmjIfop6bmkbjkuovku7bvvIzojrflj5blvZPliY3op6bmkbjngrnmlbDph486JyArIGV2ZW50LnRvdWNoZXMubGVuZ3RoLCAnaW5mbycpOwogICAgICB9CiAgICAgIAogICAgfSwKCiAgICBoYW5kbGVUb3VjaE1vdmUoZXZlbnQpIHsKICAgICAgLy8gdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn6Kem5Y+R6Kem5pG456e75Yqo5LqL5Lu2OicsICdpbmZvJyk7CiAgICAgIGlmICghdGhpcy5pc0RyYWdnaW5nIHx8IHRoaXMuZHJhd0ltZ0RhdGEgPT0gbnVsbCkgcmV0dXJuOwogICAgICBpZiAoZXZlbnQudG91Y2hlcy5sZW5ndGggPT0gMSkgewogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWFswXSA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICB0aGlzLmN1cnJlbnRUb3VjaFlbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgaWYgKHRoaXMuem9vbUludGVydmFsSWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy56b29tSW50ZXJ2YWxJZCk7CiAgICAgICAgICB0aGlzLnpvb21JbnRlcnZhbElkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMubW92ZUludGVydmFsSWQgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyDorr7nva7kuIDkuKrlrprml7blmajvvIzmr48xMDBtc+aJp+ihjOS4gOasoeinpuaRuOenu+WKqOeahOmAu+i+kQogICAgICAgIHRoaXMubW92ZUludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygn5omn6KGM6Kem5pG456e75YqoIScpOwogICAgICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcgfHwgIXRoaXMuaXNPbmVUb3VjaCkgcmV0dXJuOwoKICAgICAgICAgIGNvbnN0IGR4ID0gdGhpcy5zdGFydFRvdWNoWFswXSAtIHRoaXMuY3VycmVudFRvdWNoWFswXTsKICAgICAgICAgIGNvbnN0IGR5ID0gdGhpcy5zdGFydFRvdWNoWVswXSAtIHRoaXMuY3VycmVudFRvdWNoWVswXTsKICAgICAgICAgIGlmIChpc05hTihkeCkgfHwgaXNOYU4oZHkpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChkeCA9PSAwICYmIGR5ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCBuZXdWaXNpYmxlWCA9IHRoaXMudmlzaWJsZVggKyBkeCAvIHdpbmRvdy5pbm5lcldpZHRoICogdGhpcy52aXNpYmxlV2lkdGg7CiAgICAgICAgICBsZXQgbmV3VmlzaWJsZVkgPSB0aGlzLnZpc2libGVZICsgZHkgLyB3aW5kb3cuaW5uZXJIZWlnaHQgKiB0aGlzLnZpc2libGVIZWlnaHQ7CiAgICAgICAgICBpZiAobmV3VmlzaWJsZVggPCAwKSB7CiAgICAgICAgICAgIG5ld1Zpc2libGVYID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuZXdWaXNpYmxlWSA8IDApIHsKICAgICAgICAgICAgbmV3VmlzaWJsZVkgPSAwOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5ld1Zpc2libGVYID4gdGhpcy5tYWluQ2FtZXJhU2l6ZVgpIHsKICAgICAgICAgICAgbmV3VmlzaWJsZVggPSB0aGlzLm1haW5DYW1lcmFTaXplWDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuZXdWaXNpYmxlWSA+IHRoaXMubWFpbkNhbWVyYVNpemVZKSB7CiAgICAgICAgICAgIG5ld1Zpc2libGVZID0gdGhpcy5tYWluQ2FtZXJhU2l6ZVk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy52aXNpYmxlWCA9IG5ld1Zpc2libGVYOwogICAgICAgICAgdGhpcy52aXNpYmxlWSA9IG5ld1Zpc2libGVZOwoKICAgICAgICAgIHRoaXMuc3RhcnRUb3VjaFhbMF0gPSB0aGlzLmN1cnJlbnRUb3VjaFhbMF07CiAgICAgICAgICB0aGlzLnN0YXJ0VG91Y2hZWzBdID0gdGhpcy5jdXJyZW50VG91Y2hZWzBdOwoKICAgICAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgICAgIH0sIDEwMCk7CgogICAgICB9IGVsc2UgaWYgKGV2ZW50LnRvdWNoZXMubGVuZ3RoID49IDIpIHsKICAgICAgICB0aGlzLmN1cnJlbnRUb3VjaFhbMF0gPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7CiAgICAgICAgdGhpcy5jdXJyZW50VG91Y2hZWzBdID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRZOwogICAgICAgIHRoaXMuY3VycmVudFRvdWNoWFsxXSA9IGV2ZW50LnRvdWNoZXNbMV0uY2xpZW50WDsKICAgICAgICB0aGlzLmN1cnJlbnRUb3VjaFlbMV0gPSBldmVudC50b3VjaGVzWzFdLmNsaWVudFk7CgogICAgICAgIC8vIOa4hemZpOWPr+iDveWtmOWcqOeahOWNleaMh+inpuaRuOeahOWumuaXtuWZqAogICAgICAgIGlmICh0aGlzLm1vdmVJbnRlcnZhbElkKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMubW92ZUludGVydmFsSWQpOwogICAgICAgICAgdGhpcy5tb3ZlSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnpvb21JbnRlcnZhbElkICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g6K6+572u5LiA5Liq5a6a5pe25Zmo77yM5q+PMTAwbXPmiafooYzkuIDmrKHnvKnmlL7pgLvovpEKICAgICAgICB0aGlzLnpvb21JbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcgfHwgIXRoaXMuaXNPbmVUb3VjaCkgcmV0dXJuOwogICAgICAgICAgY29uc3QgZHggPSB0aGlzLmN1cnJlbnRUb3VjaFhbMF0gLSB0aGlzLmN1cnJlbnRUb3VjaFhbMV07CiAgICAgICAgICBjb25zdCBkeSA9IHRoaXMuY3VycmVudFRvdWNoWVswXSAtIHRoaXMuY3VycmVudFRvdWNoWVsxXTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+i3neemu+WPmOWMliBkaXN0YW5jZTonICsgZGlzdGFuY2UsICdpbmZvJyk7CiAgICAgICAgICBpZiAodGhpcy5zdGFydFRvdWNoRGlzdGFuY2UgPT0gMCkgewogICAgICAgICAgICB0aGlzLnN0YXJ0VG91Y2hEaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgICAgICAgfQogICAgICAgICAgLy8g6K6h566X57yp5pS+5q+U5L6L55qE5Y+Y5YyW6YePCiAgICAgICAgICBjb25zdCBzY2FsZUNoYW5nZSA9IGRpc3RhbmNlIC8gdGhpcy5zdGFydFRvdWNoRGlzdGFuY2U7CiAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfot53nprvlj5jljJbmr5Tkvosgc2NhbGVDaGFuZ2U6JyArIHNjYWxlQ2hhbmdlLCAnaW5mbycpOwogICAgICAgICAgbGV0IG5ld1NjYWxlID0gdGhpcy5zY2FsZSAqIHNjYWxlQ2hhbmdlOyAvLyDmm7TmlrDnvKnmlL7mr5TkvosKICAgICAgICAgIGlmIChuZXdTY2FsZSA8IDAuMSkgewogICAgICAgICAgICBuZXdTY2FsZSA9IDAuMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuZXdTY2FsZSA+IDEpIHsKICAgICAgICAgICAgbmV3U2NhbGUgPSAxOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5ld1NjYWxlICE9IHRoaXMuc2NhbGUpIHsKICAgICAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygn57yp5pS+5q+U5L6L5Y+Y5YyWLOe8qeaUvuavlOS+izonICsgbmV3U2NhbGUsICdpbmZvJyk7CiAgICAgICAgICAgIHRoaXMuc2NhbGUgPSBuZXdTY2FsZTsgLy8g5pu05paw57yp5pS+5q+U5L6LCiAgICAgICAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0U2NhbGUnLCB0aGlzLnNjYWxlKTsKICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfnvKnmlL7mr5TkvovmsqHmnInlj5jljJYs57yp5pS+5q+U5L6LOicgKyB0aGlzLnNjYWxlLCAnaW5mbycpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zdGFydFRvdWNoRGlzdGFuY2UgPSBkaXN0YW5jZTsgLy8g5pu05paw5Lik5Liq6Kem5pG454K55LmL6Ze055qE6Led56a7CiAgICAgICAgfSwgMTAwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCfop6blj5HlpJrmjIfop6bmkbjkuovku7bvvIzojrflj5blvZPliY3op6bmkbjngrnmlbDph486JyArIGV2ZW50LnRvdWNoZXMubGVuZ3RoLCAnaW5mbycpOwogICAgICB9CiAgICB9LAoKICAgIGhhbmRsZVRvdWNoRW5kKGV2ZW50KSB7CiAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+inpuWPkeinpuaRuOe7k+adn+S6i+S7tjonLCAnaW5mbycpOwogICAgICB0aGlzLmlzRHJhZ2dpbmcgPSBmYWxzZTsgLy8g5YGc5q2i5ouW5YqoCiAgICAgIC8vIOa4hemZpOWumuaXtuWZqAogICAgICBpZiAodGhpcy5tb3ZlSW50ZXJ2YWxJZCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb3ZlSW50ZXJ2YWxJZCk7CiAgICAgICAgdGhpcy5tb3ZlSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuem9vbUludGVydmFsSWQpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuem9vbUludGVydmFsSWQpOwogICAgICAgIHRoaXMuem9vbUludGVydmFsSWQgPSBudWxsOwogICAgICB9CiAgICB9LAoKICAgIFNjYWxlQ2hhbmdlKHR5cGUpIHsKICAgICAgaWYgKHRoaXMuZHJhd0ltZ0RhdGEgPT0gbnVsbCkgcmV0dXJuOwogICAgICBpZiAodHlwZSA9PSAnKycpIHsKICAgICAgICB0aGlzLnNjYWxlIC09IDAuMTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICctJykgewogICAgICAgIHRoaXMuc2NhbGUgKz0gMC4xOwogICAgICB9CiAgICAgIGlmICh0aGlzLnNjYWxlIDwgMC4xKSB7CiAgICAgICAgdGhpcy5zY2FsZSA9IDAuMTsKICAgICAgfQogICAgICBpZiAodGhpcy5zY2FsZSA+IDEpIHsKICAgICAgICB0aGlzLnNjYWxlID0gMTsKICAgICAgfQogICAgICB0aGlzLiRidXMuJGVtaXQoJ3NldFNjYWxlJywgdGhpcy5zY2FsZSk7CiAgICAgIHRoaXMuZHJhd0ltYWdlRGF0YSgpOwogICAgfSwKCiAgICAvLyDmmL7npLpST0nlm77lg48KICAgIHNob3dSb2lJbWFnZShmaWxlTmFtZSwgZGVzdFgsIGRlc3RZKSB7CiAgICAgIGlmICh0aGlzLlJlZEJveFNpZGVMZW5ndGggPT0gMCB8fCB0aGlzLlJlZEJveFNpZGVMZW5ndGggPT0gbnVsbCkgewogICAgICAgIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ1JlZEJveFNpZGVMZW5ndGggaXMgMCBvciBudWxsJywgJ2Vycm9yJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlzUHJvY2Vzc2luZ0ltYWdlKSB7CiAgICAgICAgdGhpcy5TZW5kQ29uc29sZUxvZ01zZygnSW1hZ2UgaXMgYmVpbmcgdHJhbnNtaXR0ZWQsIGN1cnJlbnQgcHJvY2Vzc2luZyBpcyBzbG93LCBza2lwcGluZyBvbmUgZnJhbWUuJywgJ3dhcm5pbmcnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pc1Byb2Nlc3NpbmdJbWFnZSA9IHRydWU7CiAgICAgIGNvbnN0IGltYWdlUGF0aCA9ICdpbWcvJyArIGZpbGVOYW1lOwogICAgICAvLyDliJvlu7rkuIDkuKpBYm9ydENvbnRyb2xsZXLlrp7kvovmnaXlj5bmtohmZXRjaOivt+axggogICAgICBjb25zdCBmZXRjaENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgIGNvbnN0IGZldGNoU2lnbmFsID0gZmV0Y2hDb250cm9sbGVyLnNpZ25hbDsKCiAgICAgIC8vIOS9v+eUqCBmZXRjaCBBUEkg6I635Y+W5LqM6L+b5Yi25pWw5o2uCiAgICAgIGZldGNoKGltYWdlUGF0aCwgeyBjYWNoZTogJ25vLXN0b3JlJywgc2lnbmFsOiBmZXRjaFNpZ25hbCB9KQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpCiAgICAgICAgLnRoZW4oYnVmZmVyID0+IHsKICAgICAgICAgIGxldCBzcmMsIG9yaWdpbmFsSW1nOCwgaW1nRGF0YSwgYXdiSW1nOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgdWludDE2QXJyYXkgPSBuZXcgVWludDE2QXJyYXkoYnVmZmVyKTsKICAgICAgICAgICAgLy8g5Yib5bu65LiA5Liq56m655qEIE1hdCDlr7nosaEKICAgICAgICAgICAgc3JjID0gbmV3IGN2Lk1hdCh0aGlzLlJlZEJveFNpZGVMZW5ndGgsIHRoaXMuUmVkQm94U2lkZUxlbmd0aCwgY3YuQ1ZfMTZVQzEpOwogICAgICAgICAgICBzcmMuZGF0YTE2VS5zZXQodWludDE2QXJyYXkpOwogICAgICAgICAgICBjdi5jdnRDb2xvcihzcmMsIHNyYywgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zLmN2bW9kZSk7CiAgICAgICAgICAgIG9yaWdpbmFsSW1nOCA9IHRoaXMuQml0MTZUbzhfU3RyZXRjaChzcmMsIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy5CLCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMuVyk7CgogICAgICAgICAgICBzcmMuZGVsZXRlKCk7IC8vIOmHiuaUvuWOn+Wni+eahCBNYXQg5a+56LGhCiAgICAgICAgICAgIHNyYyA9IG51bGw7IC8vIOa3u+WKoOi/meihjOS7o+egge+8jOehruS/nSBzcmMg5a+56LGh6KKr5riF55CGCgogICAgICAgICAgICBhd2JJbWcgPSB0aGlzLkltYWdlU29mdEFXQihvcmlnaW5hbEltZzgsIHRoaXMubGFzdEltYWdlUHJvY2Vzc1BhcmFtcy5nYWluUiwgdGhpcy5sYXN0SW1hZ2VQcm9jZXNzUGFyYW1zLmdhaW5CLCB0aGlzLmxhc3RJbWFnZVByb2Nlc3NQYXJhbXMub2Zmc2V0KTsKICAgICAgICAgICAgb3JpZ2luYWxJbWc4LmRlbGV0ZSgpOyAvLyDph4rmlL4gTWF0IOWvueixoQogICAgICAgICAgICBvcmlnaW5hbEltZzggPSBudWxsOyAvLyDmt7vliqDov5nooYzku6PnoIHvvIznoa7kv50gb3JpZ2luYWxJbWc4IOWvueixoeiiq+a4heeQhgoKICAgICAgICAgICAgLy8g5bCGIE1hdCDlr7nosaHovazmjaLlm54gSW1hZ2VEYXRhIOWvueixoQogICAgICAgICAgICBpbWdEYXRhID0gbmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoYXdiSW1nLmRhdGEpLCBhd2JJbWcuY29scywgYXdiSW1nLnJvd3MpOwogICAgICAgICAgICBhd2JJbWcuZGVsZXRlKCk7IC8vIOmHiuaUviBNYXQg5a+56LGhCiAgICAgICAgICAgIGF3YkltZyA9IG51bGw7IC8vIOa3u+WKoOi/meihjOS7o+egge+8jOehruS/nSBhd2JJbWcg5a+56LGh6KKr5riF55CGCiAgICAgICAgICAgIC8vIOWcqOaMh+WumuS9jee9ruW8gOWni+e7mOWItuWbvuWDjwogICAgICAgICAgICB0aGlzLmJ1ZmZlckN0eC5jbGVhclJlY3QodGhpcy5ST0lfeCwgdGhpcy5ST0lfeSwgdGhpcy5SZWRCb3hTaWRlTGVuZ3RoLCB0aGlzLlJlZEJveFNpZGVMZW5ndGgpOwogICAgICAgICAgICB0aGlzLmJ1ZmZlckN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgdGhpcy5ST0lfeCwgdGhpcy5ST0lfeSk7CiAgICAgICAgICAgIC8vIHRoaXMuU2VuZENvbnNvbGVMb2dNc2coJ+e7mOWItuS4gOasoVJPSeaVsOaNrjonICsgZmlsZU5hbWUgKyAnOicgKyB0aGlzLlJPSV94ICsgJzonICsgdGhpcy5ST0lfeSwgJ2luZm8nKTsKICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2VEYXRhKCk7CiAgICAgICAgICAgIHRoaXMuZm9jdXNlclBpY3R1cmVGaWxlTmFtZSA9IGZpbGVOYW1lOwoKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOWkhOeQhuWbvuWDj+Wksei0pTogJHtpbWFnZVBhdGh9YCwgZXJyb3IpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8g56Gu5L+dIE1hdCDlr7nosaHlkowgSW1hZ2VEYXRhIOWvueixoeiiq+WIoOmZpAogICAgICAgICAgICBpZiAoc3JjICYmICFzcmMuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICBzcmMuZGVsZXRlKCk7CiAgICAgICAgICAgICAgc3JjID0gbnVsbDsgLy8g5re75Yqg6L+Z6KGM5Luj56CB77yM56Gu5L+dIHNyYyDlr7nosaHooqvmuIXnkIYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3JpZ2luYWxJbWc4ICYmICFvcmlnaW5hbEltZzguaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICBvcmlnaW5hbEltZzguZGVsZXRlKCk7CiAgICAgICAgICAgICAgb3JpZ2luYWxJbWc4ID0gbnVsbDsgLy8g5re75Yqg6L+Z6KGM5Luj56CB77yM56Gu5L+dIG9yaWdpbmFsSW1nOCDlr7nosaHooqvmuIXnkIYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXdiSW1nICYmICFhd2JJbWcuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICBhd2JJbWcuZGVsZXRlKCk7CiAgICAgICAgICAgICAgYXdiSW1nID0gbnVsbDsgLy8g5re75Yqg6L+Z6KGM5Luj56CB77yM56Gu5L+dIGF3YkltZyDlr7nosaHooqvmuIXnkIYKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDnoa7kv50gYnVmZmVyIOiiq+a4heeQhgogICAgICAgICAgICBidWZmZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLmlzUHJvY2Vzc2luZ0ltYWdlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggcmVxdWVzdCBjYW5jZWxsZWQnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOiOt+WPluWbvuWDj+Wksei0pTogJHtpbWFnZVBhdGh9YCwgZXJyb3IpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5pc1Byb2Nlc3NpbmdJbWFnZSA9IGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgLy8g5Zyo57uE5Lu25Y246L295pe25Y+W5raIIGZldGNoIOivt+axggogICAgICB0aGlzLiRvbmNlKCdob29rOmJlZm9yZURlc3Ryb3knLCAoKSA9PiB7CiAgICAgICAgZmV0Y2hDb250cm9sbGVyLmFib3J0KCk7CiAgICAgIH0pOwogICAgfSwKICAgIHNldFJlZEJveFN0YXRlKGxlbmd0aCwgeCwgeSkgewogICAgICB0aGlzLlNlbmRDb25zb2xlTG9nTXNnKCdzZXRSZWRCb3hTdGF0ZTonICsgbGVuZ3RoICsgJywnICsgeCArICcsJyArIHksICdpbmZvJyk7CiAgICAgIHRoaXMuJGJ1cy4kZW1pdCgnc2V0UmVkQm94UG9zaXRpb24nLCB4LCB5KTsKICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRSZWRCb3hTaWRlTGVuZ3RoJywgbGVuZ3RoKTsKICAgIH0sCiAgICBzZXRGb2N1c2VyU3RhdGUoc3RhdGUpIHsKICAgICAgaWYgKHN0YXRlID09PSAnc2VsZWN0c3RhcnMnKSB7CiAgICAgICAgdGhpcy5pc0ZvY3VzTG9vcFNob290aW5nID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRm9jdXNMb29wU2hvb3RpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHNldFNob3dTZWxlY3RTdGFyKHN0YXRlKSB7CiAgICAgIHRoaXMuc2hvd1NlbGVjdFN0YXIgPSBzdGF0ZTsKICAgIH0sCiAgICBSZWRCb3hTaXplQ2hhbmdlKGxlbmd0aCkgewogICAgICB0aGlzLlJlZEJveFNpZGVMZW5ndGggPSBwYXJzZUludChsZW5ndGgpOwogICAgfSwKICAgIHNldE1haW5DYW1lcmFQYXJhbWV0ZXJzKHBhcmFtZXRlcnMpIHsKICAgICAgZm9yIChjb25zdCBwYXJhbWV0ZXIgaW4gcGFyYW1ldGVycykgewogICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLk1haW5DYW1lcmFDb25maWdJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gcGFyYW1ldGVyKTsKICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgaXRlbS52YWx1ZSA9IHBhcmFtZXRlcnNbcGFyYW1ldGVyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHBhcmFtZXRlciA9PSAnUmVkQm94U2l6ZScpIHsKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZXRSZWRCb3hTaWRlTGVuZ3RoJywgcGFyYW1ldGVyc1twYXJhbWV0ZXJdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOacquaJvuWIsOWPguaVsO+8miR7cGFyYW1ldGVyfWApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmNvbmZpcm1Db25maWd1cmF0aW9uKHRoaXMuTWFpbkNhbWVyYUNvbmZpZ0l0ZW1zKTsKICAgIH0sCiAgfSwKICBjb21wdXRlZDogewogICAgbmF2OiB7CiAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCduYXY6JywgdGhpcy4kc3RvcmUuc3RhdGUuc2hvd05hdmlnYXRpb25EcmF3ZXIpOwogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5zaG93TmF2aWdhdGlvbkRyYXdlcgogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7CiAgICAgICAgaWYgKHRoaXMuJHN0b3JlLnN0YXRlLnNob3dOYXZpZ2F0aW9uRHJhd2VyICE9PSB2KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnbmF2OicsIHRoaXMuJHN0b3JlLnN0YXRlLnNob3dOYXZpZ2F0aW9uRHJhd2VyKTsKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgndG9nZ2xlQm9vbCcsICdzaG93TmF2aWdhdGlvbkRyYXdlcicpCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3RvcmVDdXJyZW50TG9jYXRpb246IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRMb2NhdGlvbgogICAgfSwKICAgIGdldFFUQ2xpZW50VmVyc2lvbkNvbG9yKCkgewogICAgICBpZiAodGhpcy5RVENsaWVudFZlcnNpb24gPT09ICdOb3QgY29ubmVjdGVkJykgewogICAgICAgIHJldHVybiAncmdiYSgyNTUsIDAsIDAsIDAuNSknOyAvLyDnuqLoibLvvIzpgI/mmI7luqYgMC41CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNSknOyAvLyDpu5jorqTnmb3oibLvvIzpgI/mmI7luqYgMC41CiAgICAgIH0KICAgIH0sCgogIH0sCiAgd2F0Y2g6IHsKICAgIHN0b3JlQ3VycmVudExvY2F0aW9uOiBmdW5jdGlvbiAobG9jKSB7CiAgICAgIGNvbnN0IEREMlIgPSBNYXRoLlBJIC8gMTgwCiAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci5sYXRpdHVkZSA9IGxvYy5sYXQgKiBERDJSCiAgICAgIHRoaXMuJHN0ZWwuY29yZS5vYnNlcnZlci5sb25naXR1ZGUgPSBsb2MubG5nICogREQyUgogICAgICB0aGlzLiRzdGVsLmNvcmUub2JzZXJ2ZXIuZWxldmF0aW9uID0gbG9jLmFsdAoKICAgICAgLy8gQXQgc3RhcnR1cCwgd2UgbmVlZCB0byB3YWl0IGZvciB0aGUgbG9jYXRpb24gdG8gYmUgc2V0IGJlZm9yZSBkZWNpZGluZyB3aGljaAogICAgICAvLyBzdGFydHVwIHRpbWUgdG8gc2V0IHNvIHRoYXQgaXQncyBuaWdodCB0aW1lLgogICAgICBpZiAoIXRoaXMuc3RhcnRUaW1lSXNTZXQpIHsKICAgICAgICB0aGlzLiRzdGVsLmNvcmUub2JzZXJ2ZXIudXRjID0gc3doLmdldFRpbWVBZnRlclN1bnNldCh0aGlzLiRzdGVsKQogICAgICAgIHRoaXMuc3RhcnRUaW1lSXNTZXQgPSB0cnVlCiAgICAgIH0KICAgICAgLy8gSW5pdCBvZiB0aW1lIGFuZCBkYXRlIGlzIGNvbXBsZXRlCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0VmFsdWUnLCB7IHZhck5hbWU6ICdpbml0Q29tcGxldGUnLCBuZXdWYWx1ZTogdHJ1ZSB9KQogICAgfSwKICAgICRyb3V0ZTogZnVuY3Rpb24gKCkgewogICAgICAvLyByZWFjdCB0byByb3V0ZSBjaGFuZ2VzLi4uCiAgICAgIHRoaXMuc2V0U3RhdGVGcm9tUXVlcnlBcmdzKCkKICAgIH0sCiAgICBDdXJyZW50RHJpdmVyVHlwZShuZXdWYWwpIHsKICAgICAgLy8g5b2TIEN1cnJlbnREcml2ZXJUeXBlIOWPmOWMluaXtu+8jOabtOaWsCBzZWxlY3RlZERyaXZlcgogICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkRHJpdmVyKG5ld1ZhbCk7CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiAoKSB7CiAgICBsZXQgdGhhdCA9IHRoaXMKCiAgICB0aGlzLmdldExvY2F0aW9uSG9zdE5hbWUoKTsKCiAgICB0aGlzLmxvYWRJbWFnZVRvQ2FudmFzTWFpbkNhbWVyYSgpOwogICAgdGhpcy5sb2FkSW1hZ2VUb0NhbnZhc0d1aWRlckNhbWVyYSgpOwoKICAgIHRoaXMuaW5pdENhbnZhcygpOwogICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpOwoKICAgIGZvciAoY29uc3QgaSBpbiB0aGlzLiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpKSB7CiAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKClbaV0KICAgICAgaWYgKHBsdWdpbi5vbkFwcE1vdW50ZWQpIHsKICAgICAgICBwbHVnaW4ub25BcHBNb3VudGVkKHRoYXQpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmNvbm5lY3QoKTsKICAgIHRoaXMuc2V0dXBOZXR3b3JrU3RhdHVzTGlzdGVuZXIoKTsKCiAgICAvLyDkvb/nlKggUHJvbWlzZSDmo4Dmn6UgT3BlbkNWLmpzIOaYr+WQpuWKoOi9veWujOaIkAogICAgdGhpcy5sb2FkT3BlbkN2KCkudGhlbigoKSA9PiB7CiAgICAgIGlmICghdGhpcy5faXNEZXN0cm95ZWQpIHsgLy8g5qOA5p+l57uE5Lu25piv5ZCm5bey6ZSA5q+BCiAgICAgICAgY29uc29sZS5sb2coJ09wZW5DVi5qcyBpcyByZWFkeScpOwogICAgICAgIHRoaXMub25DdlJlYWR5KCk7ICAvLyDosIPnlKggT3BlbkNWIOWHhuWkh+WlveeahOWbnuiwgwogICAgICB9CiAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgT3BlbkNWLmpzOicsIGVycm9yKTsKICAgIH0pOwoKICAgIC8vIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgLy8gc2NyaXB0LnNyYyA9ICdodHRwczovL2RvY3Mub3BlbmN2Lm9yZy80LjUuNS9vcGVuY3YuanMnOwogICAgLy8gc2NyaXB0LmFzeW5jID0gdHJ1ZTsKICAgIC8vIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB0aGlzLm9uQ3ZSZWFkeSgpOwogICAgLy8gZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwoKICAgIGltcG9ydCgnQC9hc3NldHMvanMvc3RlbGxhcml1bS13ZWItZW5naW5lLndhc20nKS50aGVuKGYgPT4gewogICAgICBpZiAoIXRoaXMuX2lzRGVzdHJveWVkKSB7IC8vIOWGjeasoeajgOafpee7hOS7tuaYr+WQpuW3sumUgOavgQogICAgICAgIC8vIEluaXRpYWxpemUgdGhlIFN0ZWxXZWJFbmdpbmUgdmlld2VyIHNpbmdsZXRvbgogICAgICAgIC8vIEFmdGVyIHRoaXMgY2FsbCwgdGhlIFN0ZWxXZWJFbmdpbmUgc3RhdGUgd2lsbCBhbHdheXMgYmUgYXZhaWxhYmxlIGluIHZ1ZXggc3RvcmUKICAgICAgICAvLyBpbiB0aGUgJHN0b3JlLnN0ZWwgb2JqZWN0IGluIGEgcmVhY3RpdmUgd2F5ICh1c2VmdWwgZm9yIHZ1ZSBjb21wb25lbnRzKS4KICAgICAgICAvLyBUbyBtb2RpZnkgdGhlIHN0YXRlIG9mIHRoZSBTdGVsV2ViRW5naW5lLCBpdCdzIGVub3VnaCB0byBjYWxsL3NldCB2YWx1ZXMgZGlyZWN0bHkgb24gdGhlICRzdGVsIG9iamVjdAogICAgICAgIHRyeSB7CiAgICAgICAgICBzd2guaW5pdFN0ZWxXZWJFbmdpbmUodGhhdC4kc3RvcmUsIGYuZGVmYXVsdCwgdGhhdC4kcmVmcy5zdGVsQ2FudmFzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IGF1dG8gbG9jYXRpb24gZGV0ZWN0aW9uIChldmVuIGlmIHdlIGRvbid0IHVzZSBpdCkKICAgICAgICAgICAgc3doLmdldEdlb2xvY2F0aW9uKCkudGhlbihwID0+IHN3aC5nZW9Db2RlUG9zaXRpb24ocCwgdGhhdCkpLnRoZW4oKGxvYykgPT4gewogICAgICAgICAgICAgIHRoYXQuJHN0b3JlLmNvbW1pdCgnc2V0QXV0b0RldGVjdGVkTG9jYXRpb24nLCBsb2MpCiAgICAgICAgICAgIH0sIChlcnJvcikgPT4geyBjb25zb2xlLmxvZyhlcnJvcikgfSkKCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuc2V0Rm9udCgncmVndWxhcicsIHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ2ZvbnRzL1JvYm90by1SZWd1bGFyLnR0ZicsIDEuMzgpCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuc2V0Rm9udCgnYm9sZCcsIHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ2ZvbnRzL1JvYm90by1Cb2xkLnR0ZicsIDEuMzgpCiAgICAgICAgICAgIHRoYXQuJHN0ZWwuY29yZS5jb25zdGVsbGF0aW9ucy5zaG93X29ubHlfcG9pbnRlZCA9IGZhbHNlCgogICAgICAgICAgICB0aGF0LnNldFN0YXRlRnJvbVF1ZXJ5QXJncygpCiAgICAgICAgICAgIHRoYXQuZ3VpQ29tcG9uZW50ID0gJ0d1aScKICAgICAgICAgICAgZm9yIChjb25zdCBpIGluIHRoYXQuJHN0ZWxsYXJpdW1XZWJQbHVnaW5zKCkpIHsKICAgICAgICAgICAgICBjb25zdCBwbHVnaW4gPSB0aGF0LiRzdGVsbGFyaXVtV2ViUGx1Z2lucygpW2ldCiAgICAgICAgICAgICAgaWYgKHBsdWdpbi5vbkVuZ2luZVJlYWR5KSB7CiAgICAgICAgICAgICAgICBwbHVnaW4ub25FbmdpbmVSZWFkeSh0aGF0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF0aGF0LmRhdGFTb3VyY2VJbml0RG9uZSkgewogICAgICAgICAgICAgIC8vIFNldCBhbGwgZGVmYXVsdCBkYXRhIHNvdXJjZXMKICAgICAgICAgICAgICBjb25zdCBjb3JlID0gdGhhdC4kc3RlbC5jb3JlCiAgICAgICAgICAgICAgY29yZS5zdGFycy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N0YXJzJyB9KQoKICAgICAgICAgICAgICAvLyBBbGxvdyB0byBzcGVjaWZ5IGEgY3VzdG9tIHBhdGggZm9yIHNreSBjdWx0dXJlIGRhdGEKICAgICAgICAgICAgICBpZiAodGhhdC4kcm91dGUucXVlcnkuc2MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHRoYXQuJHJvdXRlLnF1ZXJ5LnNjLnN1YnN0cmluZyh0aGF0LiRyb3V0ZS5xdWVyeS5zYy5sYXN0SW5kZXhPZignLycpICsgMSkKICAgICAgICAgICAgICAgIGNvcmUuc2t5Y3VsdHVyZXMuYWRkRGF0YVNvdXJjZSh7IHVybDogdGhhdC4kcm91dGUucXVlcnkuc2MsIGtleToga2V5IH0pCiAgICAgICAgICAgICAgICBjb3JlLnNreWN1bHR1cmVzLmN1cnJlbnRfaWQgPSBrZXkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29yZS5za3ljdWx0dXJlcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3NreWN1bHR1cmVzL3dlc3Rlcm4nLCBrZXk6ICd3ZXN0ZXJuJyB9KQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29yZS5kc29zLmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvZHNvJyB9KQogICAgICAgICAgICAgIGNvcmUubGFuZHNjYXBlcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL2xhbmRzY2FwZXMvZ3VlcmVpbnMnLCBrZXk6ICdndWVyZWlucycgfSkKICAgICAgICAgICAgICBjb3JlLm1pbGt5d2F5LmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvc3VydmV5cy9taWxreXdheScgfSkKICAgICAgICAgICAgICAvLyBjb3JlLmRzcy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvZHNzJyB9KQogICAgICAgICAgICAgIGNvcmUubWlub3JfcGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL21wY29yYi5kYXQnLCBrZXk6ICdtcGNfYXN0ZXJvaWRzJyB9KQogICAgICAgICAgICAgIGNvcmUucGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvc3NvL21vb24nLCBrZXk6ICdtb29uJyB9KQogICAgICAgICAgICAgIGNvcmUucGxhbmV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL3N1cnZleXMvc3NvL3N1bicsIGtleTogJ3N1bicgfSkKICAgICAgICAgICAgICBjb3JlLnBsYW5ldHMuYWRkRGF0YVNvdXJjZSh7IHVybDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwgKyAnc2t5ZGF0YS9zdXJ2ZXlzL3Nzby9tb29uJywga2V5OiAnZGVmYXVsdCcgfSkKICAgICAgICAgICAgICBjb3JlLmNvbWV0cy5hZGREYXRhU291cmNlKHsgdXJsOiBwcm9jZXNzLmVudi5CQVNFX1VSTCArICdza3lkYXRhL0NvbWV0RWxzLnR4dCcsIGtleTogJ21wY19jb21ldHMnIH0pCiAgICAgICAgICAgICAgY29yZS5zYXRlbGxpdGVzLmFkZERhdGFTb3VyY2UoeyB1cmw6IHByb2Nlc3MuZW52LkJBU0VfVVJMICsgJ3NreWRhdGEvdGxlX3NhdGVsbGl0ZS5qc29ubC5neicsIGtleTogJ2pzb25sL3NhdCcgfSkKCiAgICAgICAgICAgICAgLy8gTW91bnQgUG9pbnRpbmcKICAgICAgICAgICAgICBnbFN0ZWwgPSB0aGF0LnNldEdsb2FiYWxTdGVsKHRoYXQuJHN0ZWwpOwogICAgICAgICAgICAgIGdsTGF5ZXIgPSB0aGF0LnNldEdsb2JhbExheWVyKHRoYXQuJHN0ZWwpOwogICAgICAgICAgICAgIGdsVGVzdENpcmNsZSA9IHRoYXQudGVzdEFkZENpcmNsZSh0aGF0LiRzdGVsLCBnbExheWVyKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRWYWx1ZScsIHsgdmFyTmFtZTogJ3dhc21TdXBwb3J0JywgbmV3VmFsdWU6IGZhbHNlIH0pCiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgfQp9Cg=="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAihBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;;;AAIA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["// Stellarium Web - Copyright (c) 2022 - Stellarium Labs SRL\n//\n// This program is licensed under the terms of the GNU AGPL v3, or\n// alternatively under a commercial licence.\n//\n// The terms of the AGPL v3 license can be found in the main directory of this\n// repository.\n\n<template>\n\n  <v-app>\n    <v-navigation-drawer v-model=\"drawer_2\" ref=\"Drawer_2\" app absolute temporary :width=\"DeviceIsConnected ? 200 : 200\"\n      style=\"left: 170px; backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.1);\">\n\n      <div v-show=\"isOpenDevicePage\">\n        <span\n          style=\"position: absolute; top: 0px; left: 50%; transform: translateX(-50%); font-size: 30px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n          {{ $t(CurrentDriverType) }}\n          <v-divider></v-divider>\n        </span>\n\n        <div :style=\"{ width: DeviceIsConnected ? '200px' : '200px' }\"\n          style=\"position: absolute; top: 50px; max-height: calc(100% - 95px); overflow-y: auto;\">\n\n          <div v-show=\"!DeviceIsConnected\" style=\"text-align: center;\">\n            <span style=\"display: inline-block; font-size: 15px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n              {{ $t('Device Connection') }}\n            </span>\n            <v-select :label=\"$t('Select Driver')\" :items=\"drivers\" item-text=\"label\" item-value=\"value\"\n              v-model=\"selectedDriver\" style=\"width: 150px; display: inline-block;\"></v-select>\n\n            <v-select v-if=\"CurrentDriverType === 'Mount' || CurrentDriverType === 'Focuser'\" :label=\"$t('Baud Rate')\"\n              :items=\"BaudRateItems\" item-text=\"label\" item-value=\"value\" v-model=\"BaudRateSelected\"\n              style=\"width: 150px; display: inline-block;\">\n            </v-select>\n\n            <v-row no-gutters>\n              <v-col cols=\"4\">\n                <button @click=\"clearDriver\" class=\"btn-confirm\" style=\"display: inline-block;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/delete.svg\" height=\"20px\"\n                      style=\"min-height: 20px; pointer-events: none;\"></img>\n                  </div>\n                </button>\n              </v-col>\n              <v-col cols=\"4\">\n                <button v-if=\"!isConnecting\" @click=\"connectDriver(selectedDriver)\" class=\"btn-confirm\"\n                  style=\"display: inline-block; background-color: green;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <v-icon color=\"white\">mdi-link</v-icon>\n                  </div>\n                </button>\n                <v-progress-circular v-else indeterminate color=\"green\" size=\"24\"></v-progress-circular>\n              </v-col>\n              <v-col cols=\"4\">\n                <button @click=\"confirmDriver\" class=\"btn-confirm\" style=\"display: inline-block;\">\n                  <template>\n                    <v-icon color=\"rgba(255, 255, 255)\">mdi-check-bold</v-icon>\n                  </template>\n                </button>\n              </v-col>\n            </v-row>\n          </div>\n\n          <!-- <div v-show=\"!DeviceIsConnected\" style=\"text-align: center;\">\n            <span style=\"display: inline-block; font-size: 15px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n              {{ $t('Device Connection') }}\n            </span>\n            <v-select :label=\"$t('Select Driver')\" :items=\"drivers\" item-text=\"label\" item-value=\"value\"\n              v-model=\"selectedDriver\" style=\"width: 150px; display: inline-block;\"></v-select>\n            <v-row no-gutters>\n              <v-col cols=\"6\">\n                <button @click=\"clearDriver\" class=\"btn-confirm\" style=\"display: inline-block;\">\n                  <div style=\"display: flex; justify-content: center; align-items: center;\">\n                    <img src=\"@/assets/images/svg/ui/delete.svg\" height=\"20px\"\n                      style=\"min-height: 20px; pointer-events: none;\"></img>\n                  </div>\n                </button>\n              </v-col>\n              <v-col cols=\"6\">\n                <button @click=\"confirmDriver\" class=\"btn-confirm\" style=\"display: inline-block;\">\n                  <template>\n                    <v-icon color=\"rgba(255, 255, 255)\">mdi-check-bold</v-icon>\n                  </template>\n                </button>\n              </v-col>\n            </v-row>\n\n          </div> -->\n\n          <div v-show=\"DeviceIsConnected\" v-for=\"(item, index) in CurrentConfigItems()\" :key=\"index\"\n            style=\"text-align: center; width: 200px;\">\n            <span v-if=\"index === 0\"\n              style=\"display: inline-block; font-size: 15px; color: rgba(255, 255, 255, 0.5); user-select: none;\">\n              {{ $t('Device Config Items') }}\n            </span>\n            <v-card-text>\n              <v-text-field v-if=\"item.inputType === 'text'\" v-model=\"item.value\" :label=\"item.label\"\n                style=\"width: 150px; display: inline-block;\"></v-text-field>\n\n              <div v-if=\"item.inputType === 'slider'\"\n                style=\"text-align: left; height: 30px; width: 150px; display: inline-block; margin-bottom: 20px;\">\n                <span\n                  style=\"display: inline-block; font-size: 15px; color: rgba(255, 255, 255, 0.5); user-select: none;\">{{\n                    item.label }}: {{ item.value }}</span>\n                <div>\n                  <button @click=\"decrement(item)\" class=\"get-click btn-slider\"\n                    style=\"position: absolute; left: 25px; transform: translateY(5px); user-select: none; font-size: 5px;\">\n                    <div style=\"display: flex; justify-content: center; align-items: center;\">\n                      <img src=\"@/assets/images/svg/ui/Minus.svg\" height=\"10px\"\n                        style=\"min-height: 10px; pointer-events: none;\"></img>\n                    </div>\n                  </button>\n                  <v-slider v-model=\"item.value\" :step=\"item.inputStep\" :max=\"item.inputMax\" :min=\"item.inputMin\"\n                    color=\"white\" class=\"align-center\"\n                    style=\"position: absolute; left: 45px; width: calc(100% - 90px);\"></v-slider>\n                  <button @click=\"increment(item)\" class=\"get-click btn-slider\"\n                    style=\"position: absolute; right: 25px; transform: translateY(5px); user-select: none; font-size: 5px;\">\n                    <div style=\"display: flex; justify-content: center; align-items: center;\">\n                      <img src=\"@/assets/images/svg/ui/Plus.svg\" height=\"10px\"\n                        style=\"min-height: 10px; pointer-events: none;\"></img>\n                    </div>\n                  </button>\n                </div>\n              </div>\n\n              <v-select v-if=\"item.inputType === 'select'\" v-model=\"item.value\" :label=\"item.label\"\n                :items=\"item.selectValue\" style=\"width: 150px; display: inline-block;\"></v-select>\n              <v-switch v-if=\"item.inputType === 'switch'\" v-model=\"item.value\" :label=\"item.label\"\n                style=\"width: 170px; display: inline-block; margin-bottom: -35px; margin-top: -35px;\"></v-switch>\n            </v-card-text>\n          </div>\n\n        </div>\n\n        <div v-show=\"DeviceIsConnected\"\n          style=\"text-align: center; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px;\">\n          <button @click=\"confirmConfiguration(CurrentConfigItems())\" class=\"btn-confirm\"\n            style=\"display: inline-block; user-select: none;\">\n            <v-icon color=\"rgba(255, 255, 255)\">mdi-check-bold</v-icon>\n          </button>\n          <button @click=\"disconnectDriver\" class=\"btn-confirm\" style=\"display: inline-block; background-color: red;\">\n            <div style=\"display: flex; justify-content: center; align-items: center;\">\n              <v-icon color=\"white\">mdi-link-off</v-icon>\n            </div>\n          </button>s\n        </div>\n\n        <!-- <div v-show=\"DeviceIsConnected\"\n          style=\"text-align: center; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; justify-content: center; width: 100%;\">\n          <button @click=\"confirmConfiguration(CurrentConfigItems())\" class=\"btn-confirm\"\n            style=\"display: inline-block; user-select: none;\">\n            <v-icon color=\"rgba(255, 255, 255)\">mdi-check-bold</v-icon>\n          </button>\n        </div> -->\n\n      </div>\n\n      <div v-show=\"isOpenPowerPage\">\n        <span\n          style=\"position: absolute; top: 0px; left: 50%; transform: translateX(-50%); font-size: 26px; color: rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap; \">\n          {{ $t('Power Management') }}\n          <v-divider></v-divider>\n        </span>\n\n        <div style=\"position: absolute; top: 50px; max-height: calc(100% - 50px); width: 200px; overflow-y: auto;\">\n          <v-list dense>\n\n            <v-list-item @click.stop=\"SwitchOutPutPower(1, OutPutPower_1_ON)\"\n              :style=\"{ height: '36px', marginBottom: '10px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/OutPutPower.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title>\n                  <span>\n                    <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('OutPut Power 1') }}\n                    </div>\n                    <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': OutPutPower_1_ON }\">{{\n                      OutPutPower_1_ON ?\n                        '[ON]' : '[OFF]' }}</div>\n                  </span>\n                </v-list-item-title>\n\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item @click.stop=\"SwitchOutPutPower(2, OutPutPower_2_ON)\"\n              :style=\"{ height: '36px', marginBottom: '10px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/OutPutPower.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title>\n                  <span>\n                    <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('OutPut Power 2') }}\n                    </div>\n                    <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': OutPutPower_2_ON }\">{{\n                      OutPutPower_2_ON ?\n                        '[ON]' : '[OFF]' }}</div>\n                  </span>\n                </v-list-item-title>\n\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-divider :style=\"{ marginBottom: '10px' }\"></v-divider>\n\n            <v-list-item @click.stop=\"RestartRaspberryPi()\" :style=\"{ height: '36px', marginBottom: '10px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/Reboot.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Restart')\n                  }}</v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item @click.stop=\"ShutdownRaspberryPi()\" :style=\"{ height: '36px', marginBottom: '10px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/PowerOFF.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Shut Down')\n                  }}</v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n\n          </v-list>\n        </div>\n\n      </div>\n\n    </v-navigation-drawer>\n\n    <v-navigation-drawer v-model=\"nav\" app :stateless=\"drawer_2\" temporary width=\"170\"\n      style=\"backdrop-filter: blur(5px); background-color: rgba(0, 0, 0, 0.1);\"> <!-- stateless temporary  -->\n      <v-layout column fill-height>\n        <v-list dense>\n          <template>\n            <div style=\"display: flex; justify-content: center; align-items: center;\">\n              <span style=\"font-size: 10px; color: rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap;\">\n                Client Version: {{ VueClientVersion }}\n              </span>\n            </div>\n            <div style=\"display: flex; justify-content: center; align-items: center;\">\n              <!-- <span style=\"font-size: 10px; color: getQTClientVersionColor,rgba(255, 255, 255, 0.5); user-select: none; white-space: nowrap;\">\n                Server Version: {{ QTClientVersion }}\n              </span> -->\n              <span :style=\"{\n                fontSize: '10px',\n                color: getQTClientVersionColor,\n                userSelect: 'none',\n                whiteSpace: 'nowrap'\n              }\">\n                Server Version: {{ QTClientVersion }}\n              </span>\n            </div>\n            <v-divider></v-divider>\n          </template>\n\n          <template>\n            <v-list-item @click.stop=\"QuitToMainApp()\" :style=\"{ height: '36px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/Quit.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Quit')\n                }}</v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item @click.stop=\"toggleStoreValue('showViewSettingsDialog')\" :style=\"{ height: '36px' }\">\n              <v-list-item-icon style=\"margin-right: 10px;\">\n                <div style=\"display: flex; justify-content: center; align-items: center;\">\n                  <img src=\"@/assets/images/svg/ui/Setting.svg\" height=\"30px\"\n                    style=\"min-height: 30px; pointer-events: none;\"></img>\n                </div>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('View Settings')\n                }}</v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n            <v-divider></v-divider>\n          </template>\n\n          <v-list-item @click.stop=\"openPowerManagerPage()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Power.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Power Management')\n              }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <!-- <v-list-item :disabled=\"loadingConnectAllDevice\" @touchstart=\"startConnectBtnPress\"\n            @touchend=\"endConnectBtnPress\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Connect.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px', userSelect: 'none' }\">{{\n                $t('Connect All') }}</v-list-item-title>\n              <v-progress-linear v-if=\"loadingConnectAllDevice\" indeterminate color=\"white\"\n                height=\"5\"></v-progress-linear>\n            </v-list-item-content>\n          </v-list-item> -->\n          <v-list-item :disabled=\"loadingConnectAllDevice\" @touchstart=\"startConnectBtnPress\"\n            @touchend=\"endConnectBtnPress\" @mousedown=\"startConnectBtnPress\" @mouseup=\"endConnectBtnPress\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Connect.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\">\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px', userSelect: 'none' }\">\n                {{ $t('Connect All') }}\n              </v-list-item-title>\n              <v-progress-linear v-if=\"loadingConnectAllDevice\" indeterminate color=\"white\"\n                height=\"5\"></v-progress-linear>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"disconnectAllDevice(false)\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DisConnect.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px', userSelect: 'none' }\">{{\n                $t('Disconnect All') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"DeviceAllocation()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/Allocation.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{\n                $t('DeviceAllocation') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"CalibratePolarAxis()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/PoleAxis.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{\n                $t('CalibratePolarAxis') }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"OpenIamgeFolder()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/FolderSwitch.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Image Files')\n              }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"OpenDebugLog()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DebugLog.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Logs')\n              }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-divider></v-divider>\n\n          <v-list-item v-for=\"(device, index) in devices\" :key=\"index\" @click.stop=\"selectDevice(device)\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/${device.driverType}.svg`)\" height=\"30px\"\n                  style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t(device.driverType) }}</div>\n                  <div :style=\"{ fontSize: '7px' }\" :class=\"{ 'connected-device': device.isConnected }\">{{ device.device}}\n                  </div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-divider></v-divider>\n\n          <v-list-item @click.stop=\"locationClicked()\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/Location.svg`)\" height=\"30px\" style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Lat & Long') }}</div>\n                  <div :style=\"{ fontSize: '7px' }\">{{ '(' + $store.state.currentLocation.lat + ', ' +\n                    $store.state.currentLocation.lng + ')' }}</div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"ShowConfirmDialog('Confirm', $t('Are you sure you need to refresh?'), 'Refresh')\"\n            :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img :src=\"require(`@/assets/images/svg/ui/Refresh.svg`)\" height=\"30px\" style=\"min-height: 30px\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title>\n                <span>\n                  <div :style=\"{ fontSize: '10px' }\">{{ $t('Refresh Page') }}</div>\n                </span>\n              </v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click.stop=\"toggleStoreValue('showDataCreditsDialog')\" :style=\"{ height: '36px' }\">\n            <v-list-item-icon style=\"margin-right: 10px;\">\n              <div style=\"display: flex; justify-content: center; align-items: center;\">\n                <img src=\"@/assets/images/svg/ui/DataCredits.svg\" height=\"30px\"\n                  style=\"min-height: 30px; pointer-events: none;\"></img>\n              </div>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title :style=\"{ height: '15px', padding: '1px', fontSize: '10px' }\">{{ $t('Data Credits')\n              }}</v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n\n        </v-list>\n      </v-layout>\n    </v-navigation-drawer>\n\n\n    <v-main>\n\n      <canvas v-show=false id=\"TestCanvas\" width=\"1920\" height=\"1080\"></canvas>\n\n      <v-container class=\"fill-height\" fluid style=\"padding: 0\">\n        <div id=\"stel\" v-bind:class=\"{ right_panel: $store.state.showSidePanel }\">\n          <div style=\"position: relative; width: 100%; height: 100%\">\n            <component v-bind:is=\"guiComponent\"></component>\n            <canvas id=\"stel-canvas\" ref='stelCanvas' :style=\"{ zIndex: canvasZIndexStel }\"></canvas>\n            <canvas ref=\"mainCanvas\" id=\"mainCamera-canvas\" :style=\"{ zIndex: canvasZIndexMainCamera }\"\n              @click=\"handleMainCanvasClick\" @touchstart=\"handleTouchStart\" @touchmove=\"handleTouchMove\"\n              @touchend=\"handleTouchEnd\" @mousedown=\"handleMouseDown\" @mouseup=\"handleMouseUp\"\n              @mousemove=\"handleMouseMove\" @wheel=\"handleWheel\">\n            </canvas>\n            <canvas ref=\"guiderCanvas\" id=\"guiderCamera-canvas\" :style=\"{ zIndex: canvasZIndexGuiderCamera }\"\n              @click=\"handleGuiderCanvasClick\"></canvas>\n            <!-- <img id=\"imageSrc\" alt=\"Source\" :src=\"imageSrc\" crossOrigin = \"\" /> -->\n\n          </div>\n        </div>\n\n\n      </v-container>\n    </v-main>\n\n    <v-dialog v-model=\"showDisconnectDialog\" persistent max-width=\"290\">\n      <v-card>\n        <v-card-title class=\"text-h5\">Confirm Action</v-card-title>\n        <v-card-text>Are you sure you want to disconnect the driver {{ currentDisconnectDriverName }}?</v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"red darken-1\" text @click=\"showDisconnectDialog = false\">Cancel</v-btn>\n          <v-btn color=\"green darken-1\" text @click=\"confirmDisconnect\">Confirm</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n\n  </v-app>\n\n</template>\n\n<script>\nimport _ from 'lodash'\nimport Gui from '@/components/gui.vue'\nimport GuiLoader from '@/components/gui-loader.vue'\nimport swh from '@/assets/sw_helpers.js'\nimport Moment from 'moment'\nimport BackgroundImage from '@/assets/images/svg/ui/Background.svg';\nimport ErrorImage from '@/assets/images/svg/ui/errorImage.svg';\n\nlet glTestCircle;\nlet glLayer;\nlet glStel;\n\nexport default {\n  data(context) {\n    return {\n      menuItems: [\n        { title: this.$t('View Settings'), icon: 'mdi-settings', store_var_name: 'showViewSettingsDialog', store_show_menu_item: 'showViewSettingsMenuItem' },\n        { title: this.$t('Planets Tonight'), icon: 'mdi-panorama-fisheye', store_var_name: 'showPlanetsVisibilityDialog', store_show_menu_item: 'showPlanetsVisibilityMenuItem' },\n        { divider: true }\n      ].concat(this.getPluginsMenuItems()).concat([\n        { title: this.$t('Data Credits'), footer: true, icon: 'mdi-copyright', store_var_name: 'showDataCreditsDialog' }\n      ]),\n      menuComponents: [].concat(this.getPluginsMenuComponents()),\n      guiComponent: 'GuiLoader',\n      startTimeIsSet: false,\n      initDone: false,\n      dataSourceInitDone: false,\n      imageSrc: 'https://i.imgur.com/egA5FIv.jpeg', // 替换为你的图像路径\n      cvReady: false,\n      canvasZIndexStel: -10,\n      canvasZIndexMainCamera: -11,\n      canvasZIndexGuiderCamera: -12,\n      currentcanvas: 'Stel',\n\n      WebSocketUrl: '',\n\n      websocket: null,\n      message: '',\n      receivedMessages: [],// 存储接收到的消息\n      sentMessages: [], // 存储已发送的消息\n      messageCounter: 0, // 用于生成唯一的消息ID\n      websocketState: 'disconnected', // 添加WebSocket连接状态\n      networkDisconnected: false, // 添加网络连接状态\n\n      QTClientVersion: 'Not connected',\n      VueClientVersion: process.env.VUE_APP_VERSION,\n\n      // isMessageBoxShow: false,\n\n      CurrentDriverType: '',\n      DeviceIsConnected: null,\n      confirmDriverType: '',\n\n      MainCameraOffsetMin: 0,\n      MainCameraOffsetMax: 0,\n\n      MainCameraGainMin: 0,\n      MainCameraGainMax: 0,\n\n      devices: [\n        { name: '导星镜', driverType: 'Guider', type: 'CCDs', ListNum: \"1\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Guider' },\n        { name: '主相机', driverType: 'MainCamera', type: 'CCDs', ListNum: \"20\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_MainCamera' },\n        { name: '赤道仪', driverType: 'Mount', type: 'Telescopes', ListNum: \"0\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Mount' },\n        { name: '望远镜', driverType: 'Telescopes', device: '', isConnected: false },\n        { name: '电动调焦器', driverType: 'Focuser', type: 'Focusers', ListNum: \"22\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_Focuser' },\n        { name: '电子极轴镜', driverType: 'PoleCamera', type: 'CCDs', ListNum: \"2\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_PoleCamera' },\n        { name: '滤镜轮', driverType: 'CFW', type: 'Filter Wheels', ListNum: \"21\", isget: false, device: '', BaudRate: 9600, driverName: '', isConnected: false, dialogStateVar: 'showDeviceSettingsDialog_CFW' },\n      ],\n\n      // Changing the label name also requires changing the emit signal name\n      GuiderConfigItems: [\n        { driverType: 'Guider', label: 'Guider Focal Length (mm)', value: '', inputType: 'text' },\n        { driverType: 'Guider', label: 'Multi Star Guider', value: false, inputType: 'switch' },\n        // { driverType: 'Guider', label: 'Guider Pixel size', value: '', inputType: 'text'},\n        { driverType: 'Guider', label: 'Guider Gain', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n        { driverType: 'Guider', label: 'Calibration step (ms)', value: '', inputType: 'text' },\n        { driverType: 'Guider', label: 'Ra Aggression', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n        { driverType: 'Guider', label: 'Dec Aggression', value: '', inputType: 'slider', inputMin: 0, inputMax: 100, inputStep: 1 },\n\n      ],\n\n      MainCameraConfigItems: [\n        // vue处理参数\n        { driverType: 'MainCamera', label: 'ImageGainR', value: '1', inputType: 'slider', inputMin: 0, inputMax: 3, inputStep: 0.01 },\n        { driverType: 'MainCamera', label: 'ImageGainB', value: '1', inputType: 'slider', inputMin: 0, inputMax: 3, inputStep: 0.01 },\n        { driverType: 'MainCamera', label: 'ImageOffset', value: '', inputType: 'slider', inputMin: 0, inputMax: 255, inputStep: 0.1},\n        { driverType: 'MainCamera', label: 'ImageCFA', value: '', inputType: 'select', selectValue: ['GR', 'GB', 'BG', 'RGGB'] },\n        // 硬件处理参数\n        { driverType: 'MainCamera', label: 'Binning', value: '', inputType: 'slider', inputMin: 1, inputMax: 4, inputStep: 1 },\n        { driverType: 'MainCamera', label: 'Temperature', value: '', inputType: 'slider', inputMin: -50, inputMax: 30, inputStep: 1 },\n        { driverType: 'MainCamera', label: 'Gain', value: '', inputType: 'slider', inputMin: 0, inputMax: 0, inputStep: 1 },\n        { driverType: 'MainCamera', label: 'Offset', value: '', inputType: 'slider', inputMin: 0, inputMax: 0, inputStep: 1 },\n        // { driverType: 'MainCamera', label: 'RedBox Side Length (px)', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [1]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [2]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [3]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [4]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [5]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [6]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [7]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [8]', value: '', inputType: 'text' },\n        { driverType: 'MainCamera', label: 'ExpTime [9]', value: '', inputType: 'text' },\n        // 在这里添加更多的配置项\n      ],\n\n      MountConfigItems: [\n\n      ],\n\n      TelescopesConfigItems: [\n        { driverType: 'Telescopes', num: 1, label: 'Focal Length (mm)', value: '', inputType: 'text' },\n      ],\n\n      FocuserConfigItems: [\n        // { driverType: 'Focuser', num: 1, label: 'RedBox Side Length (px)', value: '', inputType: 'text'},\n        { driverType: 'Focuser', num: 2, label: 'Min Step', value: '', inputType: 'text' },\n        { driverType: 'Focuser', num: 2, label: 'Sync Focuser Step', value: '', inputType: 'text' },\n\n      ],\n\n      PoleCameraConfigItems: [\n\n      ],\n\n      CFWConfigItems: [\n\n      ],\n\n      BeforeChangeConfigItems: [],\n\n\n\n      imageData: null,\n\n      histogramImage: null,\n      histogram_min: 0,    // 直方图自动拉伸的最小值\n      histogram_max: 255,  // 直方图自动拉伸的最大值\n\n      currentHistogramMin: 0,\n      currentHistogramMax: 255,\n\n      ImageGainR: 1,\n      ImageGainB: 1,\n\n      ImageOffset: 0,\n\n      ImageCFA: 'BG',\n\n      CanvasWidth: 1920,  // 主画布宽度\n      CanvasHeight: 1080, // 主画布高度\n\n      scale: 1, // 缩放比例\n      translateX: 0, // 平移x坐标\n      translateY: 0, // 平移y坐标\n      bufferCanvas: null, // 存储画布\n      bufferCtx: null, // 存储画布上下文\n      tempCanvas: null, // 临时画布\n      tempCtx: null, // 临时画布上下文\n\n      visibleWidth: 0, // 可见区域宽度\n      visibleHeight: 0, // 可见区域高度\n      visibleX: 0, // 可见区域x坐标\n      visibleY: 0, // 可见区域y坐标\n      isDragging: false, // 标记画布是否正在拖动\n      pendingScaleChange: false, // 标记画布是否正在缩放\n\n      touchStartX: 0, // 触摸开始x坐标\n      touchStartY: 0, // 触摸开始y坐标\n      startDistance: 0, // 触摸开始距离\n\n      moveIntervalId: null, // 拖动定时器\n      zoomIntervalId: null, // 缩放定时器\n\n\n      imageWidth: 0, // 图像宽度\n      imageHeight: 0, // 图像高度\n      drawImgData: null,\n      OriginalImage: null,\n      detectStarsImg: null,\n\n      isNotDrawStars: true,\n\n      mainCameraSizeX: 0,\n      mainCameraSizeY: 0,\n\n      ImageProportion: 0,\n\n      DetectedStarsList: [],\n      DetectedStarsFinish: false,\n\n      CartesianList: [],\n\n      PolarPoint_Altitude: 0,\n\n      LastPoint_AzAlt: null,\n\n      MarkCircleNum: 0,\n\n      LastCircle_RaDec: null,\n      LastCircle_AzAlt: null,\n\n      Circles: [],\n\n      drawer_2: null,    // 设置侧边栏的显示与隐藏\n\n      drivers: [], // 驱动选项数组\n      selectedDriver: null, // 选中的驱动\n\n      devicesList: [], // 设备选项数组\n      selectedDevice: null, // 选中的设备\n      ToBeConnectDevice: [],\n\n      loadingSelectDriver: false,\n      loadingConnectAllDevice: false,\n\n      CurrentLocationLng: 0,\n      CurrentLocationLat: 0,\n\n      histogramData: [],\n\n      ImageArrayBuffer: null,\n\n      isOpenDevicePage: false, // 设置设备页面是否打开\n      isOpenPowerPage: false, // 设置电源页面是否打开\n\n      OutPutPower_1_ON: true,\n      OutPutPower_2_ON: false,\n\n      isPolarAxisMode: false,\n\n      isTouching: false, // 标记是否正在处理触摸事件\n      ConnectBtnPressTimer: null,\n      ConnectBtnlongPressThreshold: 1000,\n      isConnectBtnLongPress: false, // 标记是否为长按\n      ConnectBtnCanClick: true,\n\n\n      haveDeviceConnect: false,\n      isConnecting: false, // 添加连接状态\n\n      disconnectTimeoutTriggered: false,\n      disconnectTimeout: null,\n\n      isDownloadingImage: false,\n      isDownloadingImageName: '',\n      isWaitingLogged: false, // 添加等待日志标志\n\n      showDisconnectDialog: false,\n      currentDisconnectDriverName: '',\n\n      enableMainCanvasClick: false, // 控制画布是否可以点击，用来移动调焦选择框和选星\n\n      lastImageProcessParams: { // 最后处理图像的参数\n        gainR: 1,\n        gainB: 1,\n        offset: 0,\n        CFA: 'BG',\n        mode: 1,\n        B: 0,\n        W: 65535,\n        cvmode: 0,\n      },\n      focuserPictureFileName: '',  // 焦距图片文件名\n      isProcessingImage: false,   // 控制是否正在处理图像\n      isFocusLoopShooting: false,  // 控制是否进行ROi循环拍摄\n      // focuserROIStarsList: [],  // 用来保存ROI区域的星点列表，分别保存x,y,HFR\n      selectStarX: -1,\n      selectStarY: -1,\n      DrawSelectStarX: -1,\n      DrawSelectStarY: -1,\n      DrawSelectStarHFR: -1,\n      ROI_x: -1,    // 用来保存ROI区域的x坐标\n      ROI_y: -1,    // 用来保存ROI区域的y坐标\n      ROI_length: 300, // 用来保存ROI区域的长度\n      showSelectStar: false,\n\n      isOneTouch: false,\n      currentTouchX: [0, 0],\n      currentTouchY: [0, 0],\n      startTouchX: [0, 0],\n      startTouchY: [0, 0],\n      startTouchDistance: 0,\n\n      // 定义波特率选项\n      BaudRateItems: [\n        { label: '9600', value: 9600 },\n        { label: '19200', value: 19200 },\n        { label: '38400', value: 38400 },\n        { label: '57600', value: 57600 },\n        { label: '115200', value: 115200 },\n        { label: '230400', value: 230400 },\n      ],\n      BaudRateSelected: 9600, // 波特率选择\n      cpuTemp: null,  // CPU温度\n      cpuUsage: null, // CPU使用率\n    }\n  },\n  components: {\n    Gui,\n    GuiLoader,\n    // MessageBox,\n  },\n  created() {\n    this.$bus.$on('AppSendMessage', this.sendMessage);\n    this.$bus.$on('AppUpdateDevices', this.updateDevices);\n    this.$bus.$on('Switch-MainPage', this.handleButtonTestClick);\n    this.$bus.$on('AutoHistogramNum', this.setAutoHistogramNum);\n    this.$bus.$on('HandleHistogramNum', this.applyHistStretch);\n    this.$bus.$on('ImageGainR', this.ImageGainSet);\n    this.$bus.$on('ImageGainB', this.ImageGainSet);\n    this.$bus.$on('Offset', this.ImageOffsetSet);\n    this.$bus.$on('Binning', this.BinningSet);\n    this.$bus.$on('Gain', this.GainSet);\n    this.$bus.$on('Offset', this.OffsetSet);\n    this.$bus.$on('ImageCFA', this.ImageCFASet);\n    this.$bus.$on('Temperature', this.CameraTemperatureSet);\n    this.$bus.$on('Focal Length (mm)', this.FocalLengthSet);\n    this.$bus.$on('Guider Focal Length (mm)', this.GuiderFocalLengthSet);\n    this.$bus.$on('Multi Star Guider', this.MultiStarGuiderSet);\n    this.$bus.$on('Guider Pixel size', this.GuiderPixelSizeSet);\n    this.$bus.$on('Guider Gain', this.GuiderGainSet);\n    this.$bus.$on('Calibration step (ms)', this.CalibrationDurationSet);\n    this.$bus.$on('Ra Aggression', this.RaAggressionSet);\n    this.$bus.$on('Dec Aggression', this.DecAggressionSet);\n    this.$bus.$on('Sync Focuser Step', this.SyncFocuserStep);\n    this.$bus.$on('ImageProportion', this.setImageProportion);\n    this.$bus.$on('MountGoto', this.lookatcircle);\n    this.$bus.$on('SwitchImageToShow', this.SwitchImageToShow);\n    this.$bus.$on('PolarPointAltitude', this.setPolarPointAltitude);\n    this.$bus.$on('showStelCanvas', this.showStelCanvas);\n    this.$bus.$on('RecalibratePolarAxis', this.RecalibratePolarAxis);\n    this.$bus.$on('CurrentExpTimeList', this.CurrentExpTimeList);\n    this.$bus.$on('disconnectAllDevice', this.disconnectAllDevice);\n    this.$bus.$on('GetConnectedDevices', this.ReturnConnectedDevices);\n    this.$bus.$on('CurrentCFWList', this.CurrentCFWList);\n    this.$bus.$on('calcWhiteBalanceGains', this.calcWhiteBalanceGains);\n    this.$bus.$on('SwitchOutPutPower', this.SwitchOutPutPower);\n    this.$bus.$on('PolarAxisMode', this.PolarAxisMode);\n    this.$bus.$on('SendConsoleLogMsg', this.SendConsoleLogMsg);\n    // this.$bus.$on('DisconnectDriverSuccess', this.disconnectDriversuccess);\n    this.$bus.$on('UnBindingDevice', this.UnBindingDevice);\n    this.$bus.$on('CloseWebView', this.QuitToMainApp)\n    this.$bus.$on('RedBoxSizeChange', this.RedBoxSizeChange);\n    this.$bus.$on('setFocuserState', this.setFocuserState);  // 设置调焦状态和进度\n    this.$bus.$on('setShowSelectStar', this.setShowSelectStar);  // 设置是否显示选择星点\n    this.$bus.$on('ScaleChange', this.ScaleChange);\n  },\n  methods: {\n    getLocationHostName() {\n      const hostname = window.location.hostname;\n      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      const port = window.location.protocol === 'https:' ? '8601' : '8600';\n      this.SendConsoleLogMsg('location hostname:' + hostname, 'info');\n      this.WebSocketUrl = `${protocol}//${hostname}:${port}`;\n      console.log('WebSocketUrl:', this.WebSocketUrl);\n    },\n    getQTClientVersion() {\n      this.sendMessage('Vue_Command', 'getQTClientVersion');\n    },\n    connect() {\n      // 替换为你的 WebSocket 服务器地址\n      // this.websocket = new WebSocket('ws://192.168.2.31:8600');  // process.env.VUE_APP_WEBSOCKET\n      // this.websocket = new WebSocket(process.env.VUE_APP_WEBSOCKET);\n      const wsOptions = {\n        rejectUnauthorized: false  // 禁用证书验证\n      };\n      this.websocket = new WebSocket(this.WebSocketUrl, [], wsOptions);\n\n      this.websocket.onopen = () => {\n        this.websocketState = 'connected';\n        this.networkDisconnected = false; // WebSocket连接成功时重置网络连接状态\n        if (this.disconnectTimeoutTriggered) {\n          this.callShowMessageBox('WebSocket connected', 'success');\n        }\n        this.$bus.$emit('ShowNetStatus', 'true');\n        this.StatusRecovery();\n        console.log('process.env.NODE_ENV:', process.env.NODE_ENV);\n      };\n      \n      this.websocket.onmessage = (message) => {\n        // console.log('QHYCCD | Received message:', message.data);\n\n        const data = JSON.parse(message.data);\n\n        if (data.type === 'QT_Return') {\n          const parts = data.message.split(':');\n          let messageType;\n          if (parts.length > 0) {\n            messageType = parts[0];\n            // console.log('QHYCCD | 获得信息('+messageType+'):', parts);\n          }\n          else {\n            console.error('消息格式错误，无法分割:', data.message);\n            return;\n          }\n          let acceptMessage = false;\n          if (data.message.startsWith('StagingScheduleData:')) {\n            console.log('------------------------------');\n            acceptMessage = true;\n            const parts = data.message.split('[');\n\n            if (parts.length > 0) {\n              console.log('parts.length: ', parts.length);\n              this.$bus.$emit('StagingScheduleData', data.message);\n            }\n            console.log('------------------------------');\n          }\n\n          if (data.message.startsWith('SendDebugMessage|')) {\n            acceptMessage = true;\n            const parts = data.message.split('|');\n            if (parts.length === 3) {\n              const type = parts[1];\n              const message = parts[2];\n              this.$bus.$emit('SendDebugMessage', type, message);\n            }\n          }\n\n          if (!acceptMessage) {\n            switch (messageType) {\n              case 'AddDriver':\n                if (parts.length === 3) {\n                  const label = parts[1];\n                  const value = parts[2];\n                  const type = this.CurrentDriverType;\n                  // 创建一个驱动对象\n                  const driver = { type, label, value };\n\n                  // if (type === 'MainCamera' && label === \"QHY CCD2\") {\n                  //   break;\n                  // }\n                  // if (type === 'Guider' && label === \"QHY CCD\") {\n                  //   break;\n                  // }\n\n                  // 检查label是否为\"QHY CCD\"或\"QFocuser\"，如果是，则插入到数组首位\n                  if (label === \"QHY CCD\" || label === \"QFocuser\" || label === \"QHY CCD2\") {\n                    this.drivers.unshift(driver); // 将新驱动添加到数组的开始位置\n                  } else {\n                    this.drivers.push(driver); // 将新驱动添加到数组的末尾\n                  }\n                }\n                break;\n\n              case 'AddDevice':\n                if (parts.length === 2) {\n                  const label = parts[1];\n                  console.log('QHYCCD | AddDevice: ', label);\n                  // const value = parts[2];\n                  const type = this.confirmDriverType;\n                  // 创建一个驱动对象\n                  const device = { type, label, label };\n                  console.log('QHYCCD | AddDevice: ', device);\n                  // this.$bus.$emit('add-device', device);\n                  this.devicesList.push(device);\n\n                  this.ToBeConnectDevice = [];\n                  this.devicesList.forEach(devicesList => {\n                    if (devicesList.type === this.CurrentDriverType) {\n                      this.ToBeConnectDevice.push(devicesList);\n                    }\n                  });\n\n                  this.loadingSelectDriver = false;\n                }\n                break;\n\n              case 'updateDevices_':\n                if (parts.length === 3) {\n                  const ListNum = parts[1];\n                  const name = parts[2];\n                  this.updateDevices_(ListNum, name);\n                }\n                break;\n\n              case 'ConnectSuccess':\n                if (parts.length === 4) {\n                  const type = parts[1];\n                  const deviceName = parts[2];\n                  const driverName = parts[3];\n\n                  if (deviceName != '') {\n                    this.updateDevicesConnect(type, deviceName, driverName, true);\n                  } else {\n                    this.updateDevicesConnect(type, deviceName, driverName, false);\n                  }\n                }\n                break;\n\n              case 'ConnectFailed':\n                if (parts.length === 2) {\n                  const reason = parts[1];\n                  this.callShowMessageBox(reason, 'error');\n                  this.loadingConnectAllDevice = false;\n                }\n                break;\n\n              case 'ScanFailed':\n                if (parts.length === 2) {\n                  const reason = parts[1];\n                  this.callShowMessageBox(reason, 'error');\n                  this.loadingSelectDriver = false;\n                }\n                break;\n\n              case 'AddDeviceType':\n                if (parts.length === 2) {\n                  const DeviceType = parts[1];\n                  this.$bus.$emit('AddDeviceType', DeviceType);\n                }\n                break;\n\n              case 'DeviceToBeAllocated':\n                if (parts.length === 4) {\n                  const DeviceType = parts[1];\n                  const DeviceIndex = parts[2];\n                  const DeviceName = parts[3];\n                  this.$bus.$emit('DeviceToBeAllocated', DeviceIndex, DeviceName);\n                }\n                break;\n\n              case 'ShowDeviceAllocationWindow':\n                this.$bus.$emit('toggleDeviceAllocationPanel');\n                this.nav = false;\n                break;\n\n              case 'ExposureCompleted':\n                this.$bus.$emit('ExposureCompleted');\n                break;\n\n              case 'SaveJpgSuccess':\n                if (parts.length === 4) {\n                  const fileName = parts[1];\n                  const roi_x = parts[2];\n                  const roi_y = parts[3];\n                  // this.$bus.$emit('showRoiImage', fileName);\n                  this.showRoiImage(fileName, roi_x, roi_y);\n                }\n                break;\n\n              case 'SaveBinSuccess':\n                if (parts.length === 2) {\n                  const fileName = parts[1];\n                  this.readBinFile('img/' + fileName);\n                  this.DetectedStarsFinish = false;\n                }\n                break;\n\n              case 'SaveGuiderImageSuccess':\n                if (parts.length === 2) {\n                  const fileName = parts[1];\n                  this.loadAndDisplayImage('img/' + fileName);\n                }\n                break;\n\n              case 'AddScatterChartData':\n                if (parts.length === 3) {\n                  const Data_x = parts[1];\n                  const Data_y = parts[2];\n                  const newDataPoint = [Data_x, Data_y];\n                  this.$bus.$emit('AddScatterChartData', newDataPoint);\n                }\n                break;\n\n              case 'AddLineChartData':\n                if (parts.length === 4) {\n                  const Data_x = parts[1];\n                  const Data_Ra = parts[2];\n                  const Data_Dec = parts[3];\n                  const newDataPoint_Ra = [Data_x, Data_Ra];\n                  const newDataPoint_Dec = [Data_x, Data_Dec];\n                  this.$bus.$emit('AddLineChartData', newDataPoint_Ra, newDataPoint_Dec);\n                }\n                break;\n\n              case 'SetLineChartRange':\n                if (parts.length === 3) {\n                  const min = parts[1];\n                  const max = parts[2];\n                  this.$bus.$emit('SetLineChartRange', min, max);\n                }\n                break;\n\n              case 'GuiderStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('GuiderStatus', status);\n                }\n                break;\n\n              case 'FocusChangeSpeedSuccess':\n                if (parts.length === 2) {\n                  const Speed = parts[1];\n                  this.$bus.$emit('FocusChangeSpeedSuccess', Speed);\n                }\n                break;\n\n\n              case 'FocusPosition':\n                if (parts.length === 3) {\n                  const CurrentPosition = parts[1];\n                  const TargetPosition = parts[2];\n                  this.$bus.$emit('FocusPosition', CurrentPosition, TargetPosition);\n                }\n                break;\n\n              case 'FocusMoveDone':\n                if (parts.length === 3) {\n                  const CurrentPosition = parts[1];\n                  const FWHM = parts[2];\n                  this.$bus.$emit('UpdateFWHM',CurrentPosition, FWHM);\n                  this.$bus.$emit('addData_Point', CurrentPosition, FWHM);\n                }\n                break;\n\n              case 'addMinPointData_Point':\n                if (parts.length === 3) {\n                  const x = parseInt(parts[1]);\n                  const y = parseFloat(parts[2]);\n                  this.$bus.$emit('addMinPointData_Point', x, y);\n                }\n                break;\n              case 'addLineData_Point':\n                if (parts.length === 2) {\n                    const dataList = parts[1].split(',');  // 将字符串分割成数组\n                    const coordinates = [];\n                    for (let i = 0; i < dataList.length-1; i += 2) {\n                        const x = parseInt(dataList[i]);\n                        const y = parseFloat(dataList[i + 1]);\n                        const coordinate = [x, y];\n                        coordinates.push(coordinate);\n                    }\n                    this.$bus.$emit('addLineData_Point', coordinates);\n                }\n                break;\n              case 'MainCameraSize':\n                if (parts.length === 3) {\n                  const SizeX = parts[1];\n                  const SizeY = parts[2];\n                  this.$bus.$emit('MainCameraSize', SizeX, SizeY);\n                  this.mainCameraSizeX = SizeX;\n                  this.mainCameraSizeY = SizeY;\n                }\n                break;\n\n              case 'MainCameraBinning':\n                if (parts.length === 2) {\n                  const bin = parseInt(parts[1]);\n                  this.$bus.$emit('MainCameraBinning', bin);\n                }\n                break;\n\n              case 'fitQuadraticCurve':\n                this.$bus.$emit('ClearfitQuadraticCurve');\n                for (let x = 0; x <= 601; x += 1) {\n                  const a = parts[x];\n                  const b = a.split('|');\n                  if (b.length === 2) {\n                    const x = b[0];\n                    const y = b[1];\n                    this.$bus.$emit('fitQuadraticCurve', x, y);\n                  }\n                }\n                break;\n\n              case 'fitQuadraticCurve_minPoint':\n                const x = parts[1];\n                const y = parts[2];\n                this.$bus.$emit('fitQuadraticCurve_minPoint', x, y);\n                break;\n\n\n              case 'TelescopePark':\n                if (parts.length === 2) {\n                  const Switch = parts[1];\n                  this.$bus.$emit('MountParkSwitch', Switch);\n                }\n                break;\n\n              case 'TelescopeTrack':\n                if (parts.length === 2) {\n                  const Switch = parts[1];\n                  this.$bus.$emit('MountTrackSwitch', Switch);\n                }\n                break;\n\n              case 'MountSetSpeedSuccess':\n                if (parts.length === 2) {\n                  const num = parts[1];\n                  this.$bus.$emit('newMountSlewRate', num);\n                }\n                break;\n\n\n              case 'TelescopePierSide':\n                if (parts.length === 2) {\n                  const Side = parts[1];\n                  this.$bus.$emit('updateMountPierSide', Side);\n                }\n                break;\n\n              case 'TelescopeTotalSlewRate':\n                if (parts.length === 2) {\n                  const num = parts[1];\n                  this.$bus.$emit('MountTotalSlewRate', num);\n                }\n                break;\n\n\n              case 'UpdateScheduleProcess':\n                if (parts.length === 3) {\n                  const RowNum = parts[1];\n                  const Process = parts[2];\n                  this.$bus.$emit('UpdateScheduleProcess', RowNum, Process);\n                }\n                break;\n\n              case 'ExpTimeList':\n                if (parts.length === 2) {\n                  this.$bus.$emit('initExpTimeList', parts[1]);\n                }\n                break;\n\n\n              case 'CameraInExposuring':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('CameraInExposuring', status);\n                }\n                break;\n\n              case 'AutoFocusOver':\n                this.$bus.$emit('AutoFocusOver');\n                break;\n\n              case 'CFWPositionMax':\n                if (parts.length === 2) {\n                  this.$bus.$emit('SetCFWPositionMax', parts[1]);\n\n                  for (let i = 1; i <= parts[1]; i++) {\n                    this.CFWConfigItems.push({ driverType: 'CFW', label: `CFW [${i}]`, value: '', inputType: 'text' });\n                  }\n\n                  this.$bus.$emit('AppSendMessage', 'Vue_Command', 'getCFWList');\n                }\n                break;\n\n\n              case 'SetCFWPositionSuccess':\n                if (parts.length === 2) {\n                  this.$bus.$emit('SetCFWPositionSuccess', parts[1]);\n                }\n                break;\n\n              case 'getCFWList':\n                if (parts.length === 2) {\n                  this.$bus.$emit('initCFWList', parts[1]);\n                }\n                break;\n\n              case 'GuiderSwitchStatus':\n                if (parts.length === 2) {\n                  this.$bus.$emit('GuiderSwitchStatus', parts[1]);\n                }\n                break;\n\n              case 'GuiderLoopExpStatus':\n                if (parts.length === 2) {\n                  this.$bus.$emit('GuiderLoopExpStatus', parts[1]);\n                }\n                break;\n\n              case 'TelescopeRADEC':\n                if (parts.length === 3) {\n                  this.UpdateCirclePos(parts[1], parts[2]);\n                }\n                break;\n\n\n              case 'TelescopeStatus':\n                if (parts.length === 2) {\n                  this.UpdateTelescopeStatus(parts[1]);\n                }\n                break;\n\n              case 'MainCameraStatus':\n                if (parts.length === 2) {\n                  this.UpdateMainCameraStatus(parts[1]);\n                }\n                break;\n\n\n              case 'MainCameraTemperature':\n                if (parts.length === 2) {\n                  this.UpdateMainCameraTemperature(parts[1]);\n                }\n                break;\n\n\n              case 'ShowAllImageFolder':\n                if (parts.length === 3) {\n                  this.$bus.$emit('ShowAllImageFolder', parts[1], parts[2]);\n                }\n                break;\n\n\n              case 'ImageFilesName':\n                if (parts.length === 2) {\n                  this.$bus.$emit('ImageFilesName', parts[1]);\n                }\n                break;\n\n\n              case 'USBCheck':\n                if (parts.length === 2) {\n                  const USBdata = parts[1].split(',');\n                  console.log('USB name: ', USBdata[0]);\n                  console.log('USB space: ', USBdata[1]);\n                  this.SendConsoleLogMsg('USB name:' + USBdata[0], 'info');\n                  this.SendConsoleLogMsg('USB space:' + USBdata[1], 'info');\n\n                  this.$bus.$emit('USB_Name_Sapce', USBdata[0], USBdata[1]);\n                }\n                break;\n\n              case 'ImageSaveErroe':\n                if (parts.length === 2) {\n                  const Erroe = parts[1];\n                  if (Erroe === 'USB-Null') {\n                    this.callShowMessageBox('No USB Drive Detected.', 'error');\n                  } else if (Erroe === 'USB-Multiple') {\n                    this.callShowMessageBox('Multiple USB drives detected, please remove excess USB drives.', 'error');\n                  }\n                }\n                break;\n\n              case 'DetectedStars':\n                console.log('Detected', parts.length, 'stars.');\n                this.SendConsoleLogMsg('Detected ' + parts.length + ' stars.', 'info');\n                this.DetectedStarsList = [];\n                for (let i = 0; i < parts.length; i++) {\n                  const a = parts[i];\n                  const b = a.split('|');\n                  if (b.length === 3) {\n                    const x = b[0];\n                    const y = b[1];\n                    const hfr = b[2];\n                    // console.log('Stars at(', x, ',', y, ') with HFR:', hfr);\n                    this.DetectedStarsList.push({ x: x, y: y, hfr: hfr });\n                  }\n                }\n                this.DetectedStarsFinish = true;\n                break;\n\n              case 'SolveImageResult':\n                if (parts.length === 5) {\n                  // this.UpdateCirclePos(parts[1], parts[2]);\n                  console.log('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):', parts[1], ',', parts[2], ',', parts[3], ',', parts[4]);\n                  this.SendConsoleLogMsg('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):' + parts[1] + ',' + parts[2] + ',' + parts[3] + ',' + parts[4], 'info');\n                  this.SolveResultMark(parts[1], parts[2], parts[3], parts[4]);\n                  this.$bus.$emit(\"ImageSolveFinished\", true);\n                  this.$bus.$emit('setParsingProgress', false);\n                }\n                break;\n\n              case 'SolveFovResult':\n                if (parts.length === 9) {\n                  const RaDec = [\n                    { Ra: parts[1], Dec: parts[2] },\n                    { Ra: parts[3], Dec: parts[4] },\n                    { Ra: parts[5], Dec: parts[6] },\n                    { Ra: parts[7], Dec: parts[8] },\n                  ];\n                  this.SolveFovMark(RaDec);\n                }\n                break;\n\n              case 'RealTimeSolveImageResult':\n                if (parts.length === 5) {\n                  console.log('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):', parts[1], ',', parts[2], ',', parts[3], ',', parts[4]);\n                  this.SendConsoleLogMsg('Solve Image Result(RA_Degree, DEC_Degree, Azimuth, Altitude):' + parts[1] + ',' + parts[2] + ',' + parts[3] + ',' + parts[4], 'info');\n                  const result = this.SolveResultMark_RealTime(parts[1], parts[2], parts[3], parts[4])\n                }\n                break;\n\n              case 'SolveImagefailed':\n                this.callShowMessageBox('Solve image faild...', 'error');\n                this.$bus.$emit(\"ImageSolveFinished\", false);\n                this.$bus.$emit('setParsingProgress', false);\n                break;\n\n              case 'MainCameraOffsetRange':\n                if (parts.length === 3) {\n                  console.log('MainCameraOffsetRange:', parts[1], ',', parts[2]);\n                  this.SendConsoleLogMsg('MainCameraOffsetRange:' + parts[1] + ',' + parts[2], 'info');\n                  this.MainCameraOffsetMin = parts[1];\n                  this.MainCameraOffsetMax = parts[2];\n\n                  const OffsetItem = this.MainCameraConfigItems.find(item => item.label === 'Offset');\n                  if (OffsetItem) {\n                    console.log('MainCameraOffsetRange:', parseInt(this.MainCameraOffsetMin, 10), ',', parseInt(this.MainCameraOffsetMax, 10));\n                    OffsetItem.inputMin = parseInt(this.MainCameraOffsetMin, 10);\n                    OffsetItem.inputMax = parseInt(this.MainCameraOffsetMax, 10);\n                  }\n                }\n                break;\n\n              case 'MainCameraGainRange':\n                if (parts.length === 3) {\n                  console.log('MainCameraGainRange:', parts[1], ',', parts[2]);\n                  this.SendConsoleLogMsg('MainCameraGainRange:' + parts[1] + ',' + parts[2], 'info');\n                  this.MainCameraGainMin = parts[1];\n                  this.MainCameraGainMax = parts[2];\n\n                  const gainItem = this.MainCameraConfigItems.find(item => item.label === 'Gain');\n                  if (gainItem) {\n                    console.log('MainCameraGainRange:', parseInt(this.MainCameraGainMin, 10), ',', parseInt(this.MainCameraGainMax, 10));\n                    gainItem.inputMin = parseInt(this.MainCameraGainMin, 10);\n                    gainItem.inputMax = parseInt(this.MainCameraGainMax, 10);\n                  }\n                }\n                break;\n\n              case 'OutputPowerStatus':\n                if (parts.length === 3) {\n                  const index = parseInt(parts[1], 10);\n                  const value = parseInt(parts[2], 10);\n\n                  if (index === 1) {\n                    this.OutPutPower_1_ON = value === 1;\n                  } else if (index === 2) {\n                    this.OutPutPower_2_ON = value === 1;\n                  }\n                }\n                break;\n\n              case 'PHD2StarBoxView':\n                if (parts.length === 2) {\n                  const view = parts[1];\n                  this.$bus.$emit('PHD2StarBoxView', view);\n                }\n                break;\n\n              case 'PHD2StarCrossView':\n                if (parts.length === 2) {\n                  const view = parts[1];\n                  this.$bus.$emit('PHD2StarCrossView', view);\n                }\n                break;\n\n              case 'PHD2StarBoxPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Box_X = parseInt(parts[3], 10);\n                  const Box_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2Box(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y);\n                }\n                break;\n\n              case 'PHD2MultiStarsPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Box_X = parseInt(parts[3], 10);\n                  const Box_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2MultiStars(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y);\n                }\n                break;\n\n              case 'ClearPHD2MultiStars':\n                this.$bus.$emit('ClearPHD2MultiStars');\n                break;\n\n              case 'PHD2StarCrossPosition':\n                if (parts.length === 5) {\n                  const PHD2ImageSize_X = parseInt(parts[1], 10);\n                  const PHD2ImageSize_Y = parseInt(parts[2], 10);\n                  const Cross_X = parseInt(parts[3], 10);\n                  const Cross_Y = parseInt(parts[4], 10);\n                  this.DrawPHD2Cross(PHD2ImageSize_X, PHD2ImageSize_Y, Cross_X, Cross_Y);\n                }\n                break;\n\n              case 'QTClientVersion':\n                if (parts.length === 2) {\n                  this.QTClientVersion = parts[1];\n                }\n                break;\n\n\n              case 'CaptureImageSaveStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  if (status === 'Repeat') {\n                    this.callShowMessageBox(this.$t('There is no need to save it again'), 'error');\n                  } else if (status === 'Success') {\n                    this.callShowMessageBox(this.$t('Image saved successfully'), 'success');\n                  } else if (status === 'Null') {\n                    this.callShowMessageBox(this.$t('No images to save'), 'error');\n                  }\n                }\n                break;\n\n              case 'INDIServerDebug':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('INDIServerDebug', message);\n                }\n                break;\n\n              case 'HotspotName':\n                if (parts.length === 2) {\n                  const Name = parts[1];\n                  this.$bus.$emit('HotspotName', Name);\n                }\n                break;\n\n              case 'EditHotspotNameSuccess':\n                this.$bus.$emit('EditHotspotNameSuccess');\n                break;\n\n              case 'DSLRsSetup':\n                if (parts.length === 2) {\n                  const Name = parts[1];\n                  this.$bus.$emit('ShowDSLRsSetup', Name);\n                }\n                break;\n\n              case 'ConfigureRecovery':\n                if (parts.length === 3) {\n                  const ConfigName = parts[1];\n                  const ConfigValue = parts[2];\n                  console.log('Configure:', ConfigName, ',', ConfigValue);\n                  this.SendConsoleLogMsg('Configure Recovery:' + parts[1] + ',' + parts[2], 'info');\n                  this.$bus.$emit(ConfigName, ConfigValue);\n\n                  if (parts[1] === 'FocalLength') {\n                    this.TelescopesConfigItems[0].value = parts[2];\n                    for (const device of this.devices) {\n                      if (device.driverType === 'Telescopes') {\n                        if (parts[2] === '' || parts[2] === NaN) {\n                          device.device = '';\n                        }else{\n                          device.device = parts[2] + ' mm';\n                        }\n                      }\n                    }\n                  }\n\n                  if (parts[1] === 'GuiderFocalLength') {\n                    this.GuiderConfigItems[0].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderFocalLength:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'Coordinates') {\n                    const [lat, lng] = parts[2].split(',').map(coord => parseFloat(coord.trim()));\n                    this.SetCurrentLocation(lat, lng);\n                  }\n\n                  if (parts[1] === 'MultiStarGuider') {\n                    this.GuiderConfigItems[1].value = (parts[2] === 'true');\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'MultiStarGuider:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'GuiderGain') {\n                    this.GuiderConfigItems[2].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderGain:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'CalibrationDuration') {\n                    this.GuiderConfigItems[3].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'CalibrationDuration:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'RaAggression') {\n                    this.GuiderConfigItems[4].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'RaAggression:' + parts[2]);\n                  }\n\n                  if (parts[1] === 'DecAggression') {\n                    this.GuiderConfigItems[5].value = parts[2];\n                    this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DecAggression:' + parts[2]);\n                  }\n                }\n                break;\n\n\n              case 'ConnectDriverSuccess':\n                if (parts.length === 2) {\n                  const device = parts[1];\n                  this.connectDriverSuccess(device);\n                }\n                break;\n\n              case 'ConnectDriverFailed':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.connectDriverFailed(message);\n                }\n                break;\n\n              case 'DisconnectDriverSuccess':\n                if (parts.length === 2) {\n                  const device = parts[1];\n                  this.disconnectDriversuccess(device);\n                }\n                break;\n\n              case 'DisconnectDriverFail':\n                if (parts.length === 2) {\n                  const driver = parts[1];\n                  this.disconnectDriverFail(device)\n                }\n\n              case 'SelectedDriverList':\n                if (parts.length >= 3) {\n                  const deviceObjects = parts.slice(1).reduce((acc, part, index, array) => {\n                    if (index % 2 === 0) {\n                      acc.push({ [array[index]]: array[index + 1] });\n                    }\n                    return acc;\n                  }, []);\n                  this.loadSelectedDriverList(deviceObjects);\n                }\n                break;\n\n\n              case 'BindDeviceList':\n                if (parts.length >= 3) {\n                  const deviceObjects = parts.slice(1).reduce((acc, part, index, array) => {\n                    if (index % 2 === 0) {\n                      acc.push({ [array[index]]: array[index + 1] });\n                    }\n                    return acc;\n                  }, []);\n                  this.loadBindDeviceList(deviceObjects);\n                }\n                break;\n\n\n              case 'BindDeviceTypeList':\n                if (parts.length >= 5) { // 确保至少有五个参数加上前缀\n                  const deviceTypeObjects = [];\n                  for (let i = 1; i < parts.length; i += 4) {\n                    const deviceTypeObject = {\n                      Type: parts[i],\n                      DeviceName: parts[i + 1],\n                      DriverName: parts[i + 2],\n                      isbind: parts[i + 3] == \"true\" ? true : false,\n                    };\n                    deviceTypeObjects.push(deviceTypeObject);\n                  }\n                  this.loadBindDeviceTypeList(deviceTypeObjects);\n                }\n                break;\n\n              case 'deleteDeviceAllocationList':\n                if (parts.length === 2) {\n                  const deviceName = parts[1];\n                  this.deleteDeviceAllocationList(deviceName);\n                }\n                break;\n\n              case 'deleteDeviceTypeAllocationList':\n                if (parts.length === 2) {\n                  const deviceType = parts[1];\n                  if (deviceType != '') {\n                    this.$bus.$emit('deleteDeviceTypeAllocationList', deviceType);\n                  }\n                  if (deviceType == 'CFW') {\n                    for (let i = 0; i < this.devices.length; i++) {\n                      if (this.devices[i].driverType == 'CFW') {\n                        this.devices[i].isConnected = false;\n                        this.devices[i].device = '';\n                        this.devices[i].driverName = '';\n                        this.devices[i].BaudRate = 9600;\n                        this.$bus.$emit('CFWConnected', 0);\n                      }\n                    }\n                  }\n                }\n                break;\n\n              case 'ParseInfoEmitted':\n                if (parts.length === 2) {\n                  const progress = parts[1];\n                  this.$bus.$emit('ParseInfoEmitted', progress);\n                }\n                break;\n\n              case 'GuiderUpdateStatus':\n                if (parts.length === 2) {\n                  const status = parts[1];\n                  this.$bus.$emit('GuiderUpdateStatus', parseInt(status, 10));\n                }\n                break;\n\n              case 'LoopSolveImageFinished':\n                this.$bus.$emit('LoopSolveImageFinished');\n                break;\n\n              case 'disconnectDevicehasortherdevice':\n                if (parts.length === 2) {\n                  const drivername = parts[1];\n                  this.showSelectdisconnectDriver(drivername);\n                }\n                break;\n\n              case 'getFocuserMoveState':\n                this.$bus.$emit('getFocuserMoveState');\n                break;\n\n              case 'FocusMoveToLimit':\n                if (parts.length === 2) {\n                  const errorlog = parts[1];\n                  this.callShowMessageBox(errorlog, 'error');\n                }\n                break;\n\n              case 'startFocusLoopSjootingfile':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('startFocusLoopSjootingfile', message);\n                }\n                break;\n\n              case 'setFocuserLoopingState':\n                if (parts.length === 2) {\n                  const message = parts[1];\n                  this.$bus.$emit('setFocuserLoopingState', message);\n                  if (message == 'true') {\n                    this.isFocusLoopShooting = true;\n                  } else {\n                    this.isFocusLoopShooting = false;\n                  }\n                }\n                break;\n\n              // case 'focuserROIStarsList':\n              //   if (parts.length === 4) {\n              //     const x = parts[1];\n              //     const y = parts[2];\n              //     const HFR = parts[3];\n              //     this.focuserROIStarsList.push({ x, y, HFR });\n              //   }\n              //   break;\n\n              // case 'clearFocuserROIStarsList':\n              //   this.focuserROIStarsList = [];\n              //   break;\n\n              case 'setSelectStarPosition':\n                if (parts.length === 4) {\n                  this.DrawSelectStarX = parseFloat(parts[1]);\n                  this.DrawSelectStarY = parseFloat(parts[2]);\n                  this.DrawSelectStarHFR = parseFloat(parts[3]);\n                }\n                break;\n\n              case 'SetRedBoxState':\n                if (parts.length === 4) {\n                  const length = parts[1];\n                  this.ROI_x = parseFloat(parts[2]);\n                  this.ROI_y = parseFloat(parts[3]);\n                  this.setRedBoxState(length, this.ROI_x, this.ROI_y);\n                  console.log('设置红色ROI框: ', length, this.ROI_x, this.ROI_y);\n                }\n                break;\n\n              case 'SetVisibleArea':\n                if (parts.length === 4) {\n                  this.visibleX = parseFloat(parts[1]);\n                  this.visibleY = parseFloat(parts[2]);\n                  this.scale = parseFloat(parts[3]);\n                  this.$bus.$emit('setScale', this.scale);\n                  console.log('设置可见区域: ', this.visibleX, this.visibleY, this.scale);\n                  this.SendConsoleLogMsg('update VisibleArea x=' + this.visibleX + ', y=' + this.visibleY + ', scale=' + this.scale, 'info');\n                }\n                break;\n\n              case 'SetSelectStars':\n                if (parts.length === 3) {\n                  this.selectStarX = parseFloat(parts[1]);\n                  this.selectStarY = parseFloat(parts[2]);\n                  this.SendConsoleLogMsg('update SelectStars x=' + this.selectStarX + ', y=' + this.selectStarY, 'info');\n                }\n                break;\n\n              case 'updateCPUInfo':\n                if (parts.length === 3) {\n                  let cpuTemp = parseFloat(parts[1]);\n                  let cpuUsage = parseFloat(parts[2]);\n                  this.cpuTemp = isNaN(cpuTemp) ? null : (cpuTemp % 1 === 0 ? cpuTemp : cpuTemp.toFixed(1));  // 如果 cpuTemp 是 NaN，设置为 null，否则如果 cpuTemp 是整数，就不保留小数，否则保留一位小数\n                  this.cpuUsage = isNaN(cpuUsage) ? null : (cpuUsage % 1 === 0 ? cpuUsage : cpuUsage.toFixed(1));  // 如果 cpuUsage 是 NaN，设置为 null，否则如果 cpuUsage 是整数，就不保留小数，否则保留一位小数\n                  this.$bus.$emit('updateCPUInfo', this.cpuTemp, this.cpuUsage);\n                }\n                break;\n\n              case 'TianWen':\n                if (parts.length === 4) {\n                  const notice_type = parts[1];\n                  const ra = parts[2];\n                  const dec = parts[3];\n                  this.$bus.$emit('TianWen', notice_type, ra, dec);\n                }\n                break;\n\n              case 'setMainCameraParameters':\n                if (parts.length >= 3) {\n                  let parameters = {};\n                  for (let i = 1; i < parts.length; i += 2) {\n                    const parameter = parts[i];\n                    const value = parts[i + 1];\n                    parameters[parameter] = value;\n                  }\n                  this.setMainCameraParameters(parameters);\n                }\n                break;\n\n              case 'localMessage':\n                if (parts.length === 4) {\n                  const lat = parts[1];\n                  const lon = parts[2];\n                  const language = parts[3];\n                  this.SendConsoleLogMsg('localMessage: ' + lat + ',' + lon + ',' + language, 'info');\n                  if (language == 'zh') {\n                    this.$bus.$emit('ClientLanguage', 'cn');\n                  } else {\n                    this.$bus.$emit('ClientLanguage', 'en');\n                  }\n                  this.$bus.$emit('setLocationLatAndLon', lat, lon);\n                }\n                break;\n\n              default:\n                console.warn('未处理命令: ', data.message);\n                break;\n            }\n          }\n        }\n        else if (data.type === 'QT_Confirm') {\n          // 处理确认消息\n          const messageId = data.msgid;\n          this.handleMessageResponse(messageId);\n        }else if (data.type === 'Process_Command') {\n          // 处理返回消息\n          const parts = data.message.split(':');\n          if (parts[0] === 'qtServerIsOver') {\n            this.callShowMessageBox('QT Server is over', 'error');\n            this.ShowConfirmDialog('restart', 'QT server encountered a segmentation fault or is frozen, please restart or exit!','restartQtServer');\n          }\n        }\n\n        this.receivedMessages.push(data.message); // 将接收到的消息添加到数组中\n      };\n\n      this.websocket.onerror = (error) => {\n        const errorDetails = {\n          type: error.type,\n          timestamp: new Date().toISOString(),\n          url: this.WebSocketUrl,\n          readyState: this.websocket.readyState,\n          protocol: this.websocket.protocol,\n          extensions: this.websocket.extensions\n        };\n        console.error('WebSocket Error Details:', errorDetails);\n        this.SendConsoleLogMsg('WebSocket Error: ' + JSON.stringify(errorDetails), 'error');\n        this.websocketState = 'error';\n        this.networkDisconnected = true;\n      };\n\n      this.websocket.onclose = () => {\n        console.log('QHYCCD | WebSocket disconnected');\n        this.websocketState = 'disconnected';\n        this.networkDisconnected = true; // WebSocket连接关闭时设置网络连接状态\n        console.log('QHYCCD | WebSocket disconnected');\n        this.$bus.$emit('ShowNetStatus', 'false');\n\n        // 设置一个定时器，1秒后检查网络状态\n        this.disconnectTimeout = setTimeout(() => {\n          if (this.networkDisconnected) { // 如果1秒后仍然断开\n            this.callShowMessageBox('WebSocket disconnected', 'error');\n            this.disconnectTimeoutTriggered = true;\n          }\n        }, 1000); // 1秒后执行\n\n        // 启动自动重连\n        this.reconnectWebSocket();\n      };\n    },\n\n    // 自动重连\n    reconnectWebSocket() {\n      setTimeout(() => {\n        console.log('QHYCCD | WebSocket reconnected');\n        this.SendConsoleLogMsg('WebSocket reconnected.', 'info');\n        this.connect();\n      }, 2000); // 2秒后尝试重新连接\n    },\n    // 自动重连\n\n    //监听网络连接状态\n    setupNetworkStatusListener() {\n      window.addEventListener('online', () => {\n        // 检查断开连接的定时器是否已经触发\n        if (this.disconnectTimeoutTriggered) {\n          this.callShowMessageBox('WebSocket connected', 'success');\n        }\n        clearTimeout(this.disconnectTimeout); // 清除断开连接的定时器\n        this.networkDisconnected = false; // 网络恢复时重置网络连接状态\n        this.$bus.$emit('ShowNetStatus', 'true');\n        this.StatusRecovery();\n        this.reconnectWebSocket(); // 网络恢复后自动重连WebSocket\n      });\n\n      window.addEventListener('offline', () => {\n        this.networkDisconnected = true; // 网络断开时设置网络连接状态\n        this.$bus.$emit('ShowNetStatus', 'false');\n        this.disconnectTimeoutTriggered = false; // 初始化断开连接定时器触发标志\n        // 设置一个定时器，1秒后检查网络状态\n        this.disconnectTimeout = setTimeout(() => {\n          if (this.networkDisconnected) { // 如果1秒后仍然断开\n            this.disconnectTimeoutTriggered = true; // 标记定时器已触发\n            this.callShowMessageBox('WebSocket disconnected', 'error');\n          }\n        }, 1000); // 1秒后执行\n      });\n    },\n    //监听网络连接状态\n\n    sendMessage(type, message) {\n      console.log(\"QHYCCD | sendMessage: \", message);\n\n      const messageId = this.generateMessageId(); // 生成唯一的消息ID\n      const messageObj = { type: type, msgid: messageId, message: message }; // 创建包含类型和消息的对象\n      const messageJson = JSON.stringify(messageObj); // 将消息对象转换为 JSON 字符串\n      const messageState = { msgid: messageId, text: messageJson, success: false }; // 创建包含消息和状态信息的对象\n\n      if (this.websocket.readyState === WebSocket.OPEN) {\n        this.websocket.send(messageJson);\n        // messageState.success = true; // 设置消息为成功\n      }\n      this.sentMessages.push(messageState); // 添加消息对象到已发送的消息数组\n    },\n\n    generateMessageId() {\n      // 使用时间戳和计数器生成唯一的消息ID\n      return Date.now() + \"-\" + (this.messageCounter++);\n    },\n\n    handleMessageResponse(messageId) {\n      // 根据返回的消息ID更新消息发送状态\n      const lastMessage = this.sentMessages[this.sentMessages.length - 1];\n      if (lastMessage && lastMessage.msgid === messageId) {\n        lastMessage.success = true;\n      }\n    },\n\n    // 消息框\n    callShowMessageBox(msg, type) {\n      console.log('QHYCCD | callShowMessageBox:', msg, type);\n      this.SendConsoleLogMsg(msg, type);\n      this.$bus.$emit('showMsgBox', msg, type);\n    },\n    // 消息框\n\n    locationClicked: function () {\n      this.$bus.$emit('Vue_Command', 'localMessage'); // 获取位置信息\n      this.$store.commit('toggleBool', 'showLocationDialog');\n\n      this.$bus.$emit('ResetTime');\n    },\n\n    SetCurrentLocation(lat, lng) {\n      console.log('SetCurrentLocation:', lat, ',', lng);\n      this.$bus.$emit('SendConsoleLogMsg', 'Set Current Location:' + lat + ',' + lng, 'info');\n      this.$bus.$emit('PolarPointAltitude', lat);\n      this.$bus.$emit('resetLocation', lat, lng);\n      const loc = {\n        short_name: 'Unknown',\n        country: 'Unknown',\n        lng: lng,\n        lat: lat,\n        alt: 0,\n        accuracy: 0,\n        street_address: ''\n      }\n      this.$store.commit('setCurrentLocation', loc);\n\n      this.$bus.$emit('ShowPositionInfo', lat, lng);\n\n      setTimeout(() => {\n        this.$bus.$emit('ResetTime');\n      }, 1000);\n    },\n    // 状态恢复\n    StatusRecovery() {\n      // this.sendMessage('SendConsoleLogMsg', '网络连接恢复，恢复当前状态!', 'warning');\n      this.getQTClientVersion();                // 获取QTClient版本\n      this.sendMessage('Vue_Command', 'getROIInfo'); // 获取ROI信息\n      this.sendMessage('Vue_Command', 'localMessage'); // 获取位置信息\n      this.sendMessage('Vue_Command', 'getMainCameraParameters'); // 获取主相机参数\n      this.RecalibratePolarAxis(); // 重新校准极轴\n      // this.sendMessage('Vue_Command', 'getStagingSolveResult'); // 获取定标结果\n      this.sendMessage('Vue_Command', 'getFocuserLoopingState'); // 获取焦距器循环状态\n      this.sendMessage('Vue_Command', 'getStagingScheduleData'); // 获取定标计划数据\n      this.sendMessage('Vue_Command', 'getStagingSolveResult'); // 获取定标结果\n      this.sendMessage('Vue_Command', 'getGPIOsStatus'); // 获取GPIO状态\n      this.sendMessage('Vue_Command', 'getStagingImage'); // 获取最后拍摄的图像\n\n      this.disconnectTimeoutTriggered = false;\n    },\n\n    openPowerManagerPage() {\n      this.isOpenDevicePage = false;\n      this.isOpenPowerPage = true;\n\n      this.drawer_2 = true;\n    },\n\n    QuitToMainApp() {\n      this.sendMessage('Broadcast_Msg', 'CloseWebView');\n    },\n\n    selectDevice(device) {\n      if (!this.haveDeviceConnect || (this.haveDeviceConnect) || device.driverType === 'Telescopes') {\n        this.isOpenDevicePage = true;\n        this.isOpenPowerPage = false;\n\n        if (device.isget === false) {\n          // device.isget = true;\n          this.sendMessage('Vue_Command', 'SelectIndiDriver:' + device.type + \":\" + device.ListNum);\n          this.drivers = [];\n        }\n\n        this.CurrentDriverType = device.driverType;\n        this.DeviceIsConnected = device.isConnected;\n        this.BaudRateSelected = device.BaudRate;\n        if (device.driverType === 'Telescopes') {\n          this.DeviceIsConnected = true;\n        }\n\n        this.drawer_2 = true;\n\n        this.ToBeConnectDevice = [];\n        this.devicesList.forEach(devicesList => {\n          if (devicesList.type === this.CurrentDriverType) {\n            this.ToBeConnectDevice.push(devicesList);\n          }\n        });\n      } else {\n        this.callShowMessageBox('The device is not connected.', 'error');\n      }\n\n    },\n\n    CurrentConfigItems() {\n      console.log('CurrentConfigItems: ', this.CurrentDriverType + 'ConfigItems');\n      switch (this.CurrentDriverType) {\n        case 'Guider':\n          return this.GuiderConfigItems;\n        case 'MainCamera':\n          return this.MainCameraConfigItems;\n        case 'Mount':\n          return this.MountConfigItems;\n        case 'Telescopes':\n          return this.TelescopesConfigItems;\n        case 'Focuser':\n          return this.FocuserConfigItems;\n        case 'PoleCamera':\n          return this.PoleCameraConfigItems;\n        case 'CFW':\n          return this.CFWConfigItems;\n        default:\n          return [];\n      }\n    },\n\n    confirmDriver() {\n      // 确定驱动的逻辑\n      console.log(\"QHYCCD | confirmDriver: \", this.selectedDriver);\n      this.SendConsoleLogMsg('Confirm Indi Driver:' + this.selectedDriver, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConfirmIndiDriver:' + this.selectedDriver + ':' + this.BaudRateSelected);\n      this.confirmDriverType = this.CurrentDriverType;\n      this.loadingSelectDriver = true;\n\n      this.devices.forEach(device => {\n        if (device.driverType === this.CurrentDriverType) {\n          device.device = this.selectedDriver;\n          device.driverName = this.selectedDriver;\n          device.BaudRate = this.BaudRateSelected;\n        }\n      });\n    },\n    clearDriver() {\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ClearIndiDriver');\n      this.SendConsoleLogMsg('Clear Indi Driver', 'info');\n      this.devices.forEach(device => {\n        if (device.driverType === this.CurrentDriverType) {\n          device.device = '';\n          device.driverName = '';\n          device.BaudRate = 9600;\n        }\n      });\n    },\n    confirmDevice() {\n      // 确定设备的逻辑\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConfirmIndiDevice:' + this.selectedDevice + ':' + this.selectedDriver);\n      // this.$bus.$emit('AppUpdateDevices', this.CurrentDriverType, this.selectedDevice);\n      this.updateDevices(this.CurrentDriverType, this.selectedDevice);\n    },\n\n    updateDevices(driverType, newDevice) {    // 手动选择\n      this.devices.forEach(device => {\n        if (device.driverType === driverType) {\n          device.device = newDevice;\n        }\n      });\n    },\n\n    updateDevices_(ListNum, newDevice) {    // 从文件导入\n      this.devices.forEach(device => {\n        if (device.ListNum === ListNum) {\n          device.device = newDevice;\n        }\n      });\n      this.loadingConnectAllDevice = false;\n    },\n\n    updateDevicesConnect(type, DeviceName, DriverName, isBind = true) {    // 连接成功\n      this.SendConsoleLogMsg('updateDevicesConnect' + type + ' ' + DeviceName + ' ' + DriverName + ' ' + isBind, 'info');\n      this.devices.forEach(device => {\n        if (device.driverType === type) {\n          if (isBind == true) {\n            device.device = DeviceName;\n          } else {\n            device.device = \"Not Bind Device\";\n          }\n          device.driverName = DriverName;\n          device.isConnected = true;\n        }\n      });\n      this.callShowMessageBox(DeviceName + ' success connected', 'success');\n      this.haveDeviceConnect = true;\n      this.loadingConnectAllDevice = false;\n\n      if (type === 'MainCamera') {\n        this.$bus.$emit('MainCameraConnected', 1);\n        console.log('MainCamera is Connected.');\n      } else if (type === 'Mount') {\n        this.$bus.$emit('MountConnected', 1);\n        console.log('Mount is Connected.');\n      } else if (type === 'CFW') {\n        this.$bus.$emit('CFWConnected', 1);\n        console.log('Mount is Connected.');\n      } else if (type === 'Focuser') {\n        this.$bus.$emit('FocuserConnected', 1);\n        console.log('Focuser is Connected.');\n      } else if (type === 'Guider') {\n        this.$bus.$emit('GuiderConnected', 1);\n        console.log('Guider is Connected.');\n      }\n      console.log('updateDevicesConnect: ', type, DeviceName, DriverName, isBind);\n\n      this.$bus.$emit('DeviceConnectSuccess', type, DeviceName, DriverName, isBind);\n    },\n    startConnectBtnPress(event) {\n      // 如果是触摸事件，标记并处理\n      if (event.type === 'touchstart') {\n        this.isTouching = true;\n        this.isConnectBtnLongPress = false; // 重置长按标记\n        this.ConnectBtnPressTimer = setTimeout(() => {\n          this.isConnectBtnLongPress = true; // 标记为长按\n          this.handleConnectBtnLongPress();\n        }, this.ConnectBtnlongPressThreshold);\n      }\n      // 如果是鼠标事件，且没有正在进行的触摸事件，则处理\n      else if (event.type === 'mousedown' && !this.isTouching) {\n        this.isConnectBtnLongPress = false; // 重置长按标记\n        this.ConnectBtnPressTimer = setTimeout(() => {\n          this.isConnectBtnLongPress = true; // 标记为长按\n          this.handleConnectBtnLongPress();\n        }, this.ConnectBtnlongPressThreshold);\n      }\n    },\n    endConnectBtnPress(event) {\n      // 如果是触摸事件，处理并重置标记\n      if (event.type === 'touchend') {\n        clearTimeout(this.ConnectBtnPressTimer); // 清除定时器\n        if (!this.isConnectBtnLongPress) {\n          this.handleConnectBtnClick(); // 如果不是长按，则触发点击事件\n        }\n        this.ConnectBtnPressTimer = null; // 重置定时器\n        this.isTouching = false; // 重置触摸标记\n      }\n      // 如果是鼠标事件，且没有正在进行的触摸事件，则处理\n      else if (event.type === 'mouseup' && !this.isTouching) {\n        clearTimeout(this.ConnectBtnPressTimer); // 清除定时器\n        if (!this.isConnectBtnLongPress) {\n          this.handleConnectBtnClick(); // 如果不是长按，则触发点击事件\n        }\n        this.ConnectBtnPressTimer = null; // 重置定时器\n      }\n    },\n    handleConnectBtnClick() {\n      if (this.haveDeviceConnect) {\n        this.callShowMessageBox('Please disconnect all devices first.', 'error');\n        return;\n      }\n      if (!this.ConnectBtnCanClick) return; // 如果不可点击，直接返回\n      this.ConnectBtnCanClick = false; // 设置为不可点击\n      console.log(\"Connect Button clicked\");\n\n      this.connectAllDevice();\n\n      // 恢复点击权限\n      setTimeout(() => {\n        this.ConnectBtnCanClick = true;\n      }, 1000); // 1秒后恢复\n    },\n    handleConnectBtnLongPress() {\n      if (this.haveDeviceConnect) {\n        this.callShowMessageBox('Please disconnect all devices first.', 'error');\n        return;\n      }\n      // 长按事件的处理\n      console.log(\"Connect Button long pressed\");\n\n      this.autoConnectAllDevice();\n    },\n    connectAllDevice() {\n      console.log(\"QHYCCD | connectAllDevice.\");\n      this.SendConsoleLogMsg('Connect All Device', 'info');\n      this.sendMessage('Vue_Command', 'connectAllDevice');\n      this.loadingConnectAllDevice = true;\n    },\n    autoConnectAllDevice() {\n      console.log(\"QHYCCD | autoConnectAllDevice.\");\n      this.SendConsoleLogMsg('Auto Connect All Device', 'info');\n      this.sendMessage('Vue_Command', 'autoConnectAllDevice');\n      this.loadingConnectAllDevice = true;\n    },\n\n    // connectAllDevice() {\n    //   console.log(\"QHYCCD | connectAllDevice.\");\n    //   this.SendConsoleLogMsg('Connect All Device', 'info');\n    //   this.sendMessage('Vue_Command', 'connectAllDevice');\n    //   this.loadingConnectAllDevice = true;\n    // },\n\n    // autoConnectAllDevice() {\n    //   console.log(\"QHYCCD | autoConnectAllDevice.\");\n    //   this.SendConsoleLogMsg('Auto Connect All Device', 'info');\n    //   this.sendMessage('Vue_Command', 'autoConnectAllDevice');\n    //   this.loadingConnectAllDevice = true;\n    // },\n\n    // startConnectBtnPress() {\n    //   this.isConnectBtnLongPress = false; // 重置长按标记\n    //   this.ConnectBtnPressTimer = setTimeout(() => {\n    //     this.isConnectBtnLongPress = true; // 标记为长按\n    //     this.handleConnectBtnLongPress();\n    //   }, this.ConnectBtnlongPressThreshold);\n    // },\n    // endConnectBtnPress() {\n    //   clearTimeout(this.ConnectBtnPressTimer); // 清除定时器\n    //   if (!this.isConnectBtnLongPress) {\n    //     this.handleConnectBtnClick(); // 如果不是长按，则触发点击事件\n    //   }\n    //   this.ConnectBtnPressTimer = null; // 重置定时器\n    // },\n    // handleConnectBtnClick() {\n    //   if (this.haveDeviceConnect) {\n    //     this.callShowMessageBox('Please disconnect all devices first.', 'error');\n    //     return;\n    //   }\n    //   if (!this.ConnectBtnCanClick) return; // 如果不可点击，直接返回\n    //   this.ConnectBtnCanClick = false; // 设置为不可点击\n    //   console.log(\"Connect Button clicked\");\n\n    //   this.connectAllDevice();\n\n    //   // 恢复点击权限\n    //   setTimeout(() => {\n    //     this.ConnectBtnCanClick = true;\n    //   }, 1000); // 1秒后恢复\n    // },\n    // handleConnectBtnLongPress() {\n    //   if (this.haveDeviceConnect) {\n    //     this.callShowMessageBox('Please disconnect all devices first.', 'error');\n    //     return;\n    //   }\n    //   // 长按事件的处理\n    //   console.log(\"Connect Button long pressed\");\n\n    //   this.autoConnectAllDevice();\n    // },\n\n    disconnectAllDevice(confirm) {\n      // 检查是否有设备的 isConnected 属性为 true\n      // const hasConnectedDevices = this.devices.some(device => device.isConnected);\n\n      if (this.haveDeviceConnect) {\n        if (confirm === false) {\n          this.ShowConfirmDialog('Confirm', 'Are you sure you want to disconnect all devices?', 'disconnectAllDevice');\n        } else {\n          this.sendMessage('Vue_Command', 'disconnectAllDevice');\n          this.SendConsoleLogMsg('Disconnect All Device', 'info');\n          this.haveDeviceConnect = false;\n          // this.devices.forEach(device => {\n          //   device.isConnected = false;\n          //   // device.device = '';\n          // });\n\n          this.$bus.$emit('MainCameraConnected', 0);\n          this.$bus.$emit('MountConnected', 0);\n          this.$bus.$emit('CFWConnected', 0);\n          this.$bus.$emit('FocuserConnected', 0);\n          this.$bus.$emit('GuiderConnected', 0);\n          this.claerDeviceList();\n        }\n      } else {\n        this.callShowMessageBox('No devices have been connected.', 'error');\n      }\n    },\n\n    // claerDeviceList() {\n    //   this.devices.forEach(device => {\n    //     device.isConnected = false;\n    //     device.isget = false;\n    //     device.device = ''; \n    //     device.driverName = '';\n    //   });\n    //   this.ToBeConnectDevice = [];\n    //   this.devicesList = [];\n    //   this.drivers = [];\n    //   this.$bus.$emit('claerDeviceAllocationList');\n    // },\n\n    claerDeviceList() {\n      this.devices.forEach(device => {\n        device.device = \"\";\n        device.isConnected = false;\n        device.isget = false;\n        device.driverName = '';\n        device.BaudRate = 9600;\n      });\n      this.ToBeConnectDevice = [];\n      this.devicesList = [];\n      this.drivers = [];\n      this.$bus.$emit('claerDeviceAllocationList');\n    },\n\n    SwitchOutPutPower(index, isPowerON) {\n      if (isPowerON) {\n        this.drawer_2 = false;\n        this.ShowConfirmDialog('Output Power:' + index, 'Are you sure you want to turn off this output power?', 'SwitchOutPutPower');\n      } else {\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'SwitchOutPutPower:' + index);\n        this.SendConsoleLogMsg('Switch OutPutPower' + index, 'info');\n      }\n    },\n\n    RestartRaspberryPi() {\n      this.drawer_2 = false;\n      this.ShowConfirmDialog('Restart', 'Are you sure you want to restart the Raspberry Pi?', 'RestartRaspberryPi');\n    },\n\n    ShutdownRaspberryPi() {\n      this.drawer_2 = false;\n      this.ShowConfirmDialog('Shut Down', 'Are you sure you want to shut down the Raspberry Pi?', 'ShutdownRaspberryPi');\n    },\n\n    ReturnConnectedDevices() {\n      this.devices.forEach(device => {\n        if (device.driverType === 'MainCamera') {\n          if (device.isConnected === true) {\n            this.$bus.$emit('MainCameraConnected', 1);\n            console.log('MainCamera is Connected.');\n            this.SendConsoleLogMsg('MainCamera is Connected.', 'info');\n          }\n        } else if (device.driverType === 'Mount') {\n          if (device.isConnected === true) {\n            this.$bus.$emit('MountConnected', 1);\n            console.log('Mount is Connected.');\n            this.SendConsoleLogMsg('Mount is Connected.', 'info');\n          }\n        }\n      });\n      this.sendMessage('Vue_Command', 'loadSelectedDriverList');\n      this.sendMessage('Vue_Command', 'loadBindDeviceList');\n      this.sendMessage('Vue_Command', 'loadBindDeviceTypeList');\n    },\n\n    OpenIamgeFolder() {\n      this.$bus.$emit('ImageManagerPanelOpen');\n      this.nav = false;\n    },\n\n    OpenDebugLog() {\n      this.$bus.$emit('toggleINDIDebugDialog');\n      this.nav = false;\n    },\n\n    SendConsoleLogMsg(message, type) {\n      if (type == 'error') {\n        console.error('Error: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else if (type == 'info') {\n        console.log('Info: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else if (type == 'warning') {\n        console.warn('Warning: ' + message);\n        this.$bus.$emit('SendConsoleLog', type, message);\n      } else {\n        console.log('Debug: ' + message);\n      }\n    },\n\n    DeviceAllocation() {\n      this.$bus.$emit('toggleDeviceAllocationPanel');\n      this.nav = false;\n    },\n\n    CurrentExpTimeList(index, value) {\n      const expTimeIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ExpTime [' + (index + 1) + ']');\n      if (expTimeIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.MainCameraConfigItems[expTimeIndex].value = value;\n      } else {\n        console.error('ExpTime [' + index + '] configuration item not found.');\n      }\n    },\n\n    CurrentCFWList(index, value) {\n      const expTimeIndex = this.CFWConfigItems.findIndex(item => item.label === 'CFW [' + (index + 1) + ']');\n      if (expTimeIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.CFWConfigItems[expTimeIndex].value = value;\n      } else {\n        console.error('CFW [' + index + '] configuration item not found.');\n      }\n    },\n\n    // confirmConfiguration(item) {\n    //   console.log(`QHYCCD | confirmConfiguration: ${item.value}`);\n    //   switch (item.driverType) {\n    //     case 'Guider':\n\n    //     case 'MainCamera':\n    //       this.$bus.$emit(item.label, item.label + ':' + item.value);\n    //     case 'Mount':\n\n    //     case 'Telescope':\n\n    //     case 'Focuser':\n    //         this.$bus.$emit(item.label, item.value);  //RedBox Side Length (px)\n\n    //     case 'PoleCamera':\n\n    //     case 'CFW':\n    //       if (item.label.startsWith('CFW [')) {\n    //         this.$bus.$emit('CFWvalue', item.label+':'+item.value);\n    //       }\n    //       else {\n    //         this.$bus.$emit(item.label, item.label+':'+item.value);\n    //       }\n    //   }\n    // },\n\n    confirmConfiguration(List) {\n      List.forEach(item => {\n        if (item.value !== '') {\n          // console.log(item.label, item.value);\n          this.SendConsoleLogMsg(item.label + ':' + item.value, 'info');\n          this.$bus.$emit(item.label, item.label + ':' + item.value);\n        }else if (item.value == '' && item.label === 'Focal Length (mm)'){\n          this.SendConsoleLogMsg(item.label + 'is NULL', 'info');\n          this.$bus.$emit(item.label, item.label+ ':' );\n        }\n      });\n      this.callShowMessageBox('Configuration has been modified!', 'success');\n    },\n\n    loadAndDisplayImage(imagePath) {\n      const canvas = document.getElementById('guiderCamera-canvas');\n      // const canvas = document.getElementById('mainCamera-canvas');\n      if (canvas.getContext) {\n        const ctx = canvas.getContext('2d');\n        const img = new Image();\n\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n          ctx.drawImage(img, 0, 0);\n          // this.$bus.$emit('showSolveImage', img);\n        };\n\n        // 添加错误处理\n        img.onerror = (error) => {\n          console.log(`加载图像失败: ${imagePath}`);\n          this.SendConsoleLogMsg(`加载图像失败: ${imagePath}`, 'error');\n        };\n\n        img.src = imagePath;\n      }\n    },\n\n    ImageGainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value); // 将值转换为 double 类型\n\n      if (signal === 'ImageGainR') {\n        // 处理 ImageGainR 信号\n        this.ImageGainR = doubleValue;\n        this.SendConsoleLogMsg('ImageGainR is set to:' + doubleValue, 'info');\n        this.sendMessage('Vue_Command', 'ImageGainR:' + doubleValue);\n      } else if (signal === 'ImageGainB') {\n        // 处理 ImageGainB 信号\n        this.ImageGainB = doubleValue;\n        this.SendConsoleLogMsg('ImageGainB is set to:' + doubleValue, 'info');\n        this.sendMessage('Vue_Command', 'ImageGainB:' + doubleValue);\n      }\n    },\n\n    // CameraOffsetSet(payload) {\n    //   const [signal, value] = payload.split(':'); // 拆分信号和值\n    //   const doubleValue = parseFloat(value); // 将值转换为 double 类型\n\n    //   console.log('CameraOffset is set to:', doubleValue);\n    //   this.SendConsoleLogMsg('CameraOffset is set to:' + doubleValue, 'info');\n    // },\n\n    ImageOffsetSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value); // 将值转换为 double 类型\n\n      this.ImageOffset = doubleValue;\n      console.log('Image Offset is set to:', doubleValue);\n      this.SendConsoleLogMsg('Image Offset is set to:' + doubleValue, 'info');\n      this.sendMessage('Vue_Command', 'ImageOffset:' + doubleValue);\n    },\n\n    BinningSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Image Binning is set to:', IntValue);\n      this.SendConsoleLogMsg('Image Binning is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetBinning:' + IntValue);\n      this.$bus.$emit('SetBinningNum', IntValue);\n    },\n\n    GainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Gain is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Gain is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraGain:' + IntValue);\n    },\n\n    OffsetSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Offset is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Offset is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraOffset:' + IntValue);\n    },\n\n    ImageCFASet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n\n      if (['GR', 'GB', 'BG', 'RGGB'].includes(value)) {\n        this.ImageCFA = value;\n        console.log('ImageCFA is set to:', value);\n        this.SendConsoleLogMsg('ImageCFA is set to:' + value, 'info');\n        this.sendMessage('Vue_Command', 'ImageCFA:' + value);\n      } else {\n        console.log(`Invalid value for ImageCFA: '${value}'. Please set it to one of 'GR', 'GB', 'BG', 'RGGB'.`);\n        this.callShowMessageBox(`Invalid value for ImageCFA: '${value}'. Please set it to one of 'GR', 'GB', 'BG', 'RGGB'.`, 'error');\n      }\n    },\n\n    CameraTemperatureSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      console.log('Camera Temperature is set to:', IntValue);\n      this.SendConsoleLogMsg('Camera Temperature is set to:' + IntValue, 'info');\n      this.sendMessage('Vue_Command', 'SetCameraTemperature:' + IntValue);\n    },\n\n    FocalLengthSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      \n      for (const device of this.devices) {\n        if (device.driverType === 'Telescopes') {\n          \n          if (value === '' || value === NaN) {\n            device.device = '';\n            this.SendConsoleLogMsg('Focal Length is set to:' + 0, 'info');\n            this.$bus.$emit('SetFocalLengthNum', '');\n          }else{\n            const IntValue = parseInt(value); // 将值转换为 Int 类型\n            device.device = value + ' mm';\n            this.SendConsoleLogMsg('Focal Length is set to:' + IntValue, 'info');\n            this.$bus.$emit('SetFocalLengthNum', IntValue);\n          }\n        }\n      }\n\n\n    },\n\n    GuiderFocalLengthSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value); // 将值转换为 Int 类型\n\n      \n      this.SendConsoleLogMsg('Guider Focal Length is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderFocalLength:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderFocalLength:' + IntValue);\n    },\n\n    MultiStarGuiderSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      this.SendConsoleLogMsg('Multi Star Guider is set to:' + value, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'MultiStarGuider:' + value);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:MultiStarGuider:' + value);\n    },\n\n    GuiderPixelSizeSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const doubleValue = parseFloat(value);\n      this.SendConsoleLogMsg('Guider Pixel size is set to:' + doubleValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderPixelSize:' + doubleValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderPixelSize:' + doubleValue);\n    },\n\n    GuiderGainSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Guider Gain is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderGain:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:GuiderGain:' + IntValue);\n    },\n\n    CalibrationDurationSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Guider Calibration step is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'CalibrationDuration:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:CalibrationDuration:' + IntValue);\n    },\n\n    RaAggressionSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Ra Aggression is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'RaAggression:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:RaAggression:' + IntValue);\n    },\n\n    DecAggressionSet(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Dec Aggression is set to:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DecAggression:' + IntValue);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'saveToConfigFile:DecAggression:' + IntValue);\n    },\n\n    SyncFocuserStep(payload) {\n      const [signal, value] = payload.split(':'); // 拆分信号和值\n      const IntValue = parseInt(value);\n      this.SendConsoleLogMsg('Sync Focuser Step:' + IntValue, 'info');\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'SyncFocuserStep:' + IntValue);\n    },\n\n    async readBinFile(fileName, retryCount = 1) {\n      while (this.isDownloadingImage) {\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        if (!this.isWaitingLogged) {\n          this.SendConsoleLogMsg('The image is already being processed. Please wait for the previous process to complete.', 'warning');\n          this.isWaitingLogged = true; // 确保只记录一次等待信息\n        }\n      }\n\n      if (this.isDownloadingImageName === fileName) {\n        this.SendConsoleLogMsg('The image(' + fileName + ') is already processed.', 'info');\n        return;\n      }\n\n      this.isDownloadingImage = true;\n      this.isWaitingLogged = false; // 重置等待日志标志\n      this.SendConsoleLogMsg('CaptureTestTime | Read image(' + fileName + ') data start.', 'info');\n\n      const startTime = new Date();\n      try {\n        // Check if the fileName is valid\n        if (!fileName || typeof fileName !== 'string') {\n          throw new Error('Invalid file name provided');\n        }\n\n        // Fetch with progress tracking\n        const response = await fetch(fileName, { cache: 'no-store' });\n        if (!response.ok) {\n          throw new Error(`Network response was not ok. Status: ${response.status}`);\n        }\n\n        const contentLength = response.headers.get('content-length');\n        if (!contentLength) {\n          throw new Error('Content-Length header is missing');\n        }\n\n        const total = parseInt(contentLength, 10);\n        if (isNaN(total) || total <= 0) {\n          throw new Error('Invalid content-length value');\n        }\n\n        let loaded = 0;\n\n        const reader = response.body.getReader();\n        const stream = new ReadableStream({\n          start: (controller) => {\n            const push = () => {\n              reader.read().then(({ done, value }) => {\n                if (done) {\n                  controller.close();\n                  return;\n                }\n                loaded += value.byteLength;\n                const percent = (loaded / total) * 100;\n                if (Math.round(percent) % 10 === 0) {\n                  this.SendConsoleLogMsg(`Progress: ${Math.round(percent)}%`, 'info');\n                  this.updateCaptureImageProgress(Math.round(percent));\n                }\n                this.SendConsoleLogMsg(`当前进度: ${Math.round(percent)}%`, 'info');\n                controller.enqueue(value);\n                push();\n              }).catch(error => {\n                console.error('Stream reading error:', error);\n                this.SendConsoleLogMsg('Stream reading error: ' + error.message, 'error');\n                controller.error(error);\n              });\n            };\n            push();\n          }\n        });\n\n        const newResponse = new Response(stream);\n        const blob = await newResponse.blob();\n\n        // FileReader with progress tracking\n        const fileReader = new FileReader();\n        fileReader.onload = () => {\n          this.ImageArrayBuffer = fileReader.result;\n\n          const endTime = new Date();\n          const elapsedTime = endTime.getTime() - startTime.getTime();\n          this.SendConsoleLogMsg('CaptureTestTime | Read image data end: ' + elapsedTime + ' ms', 'info');\n          if (!this.isPolarAxisMode) {\n            this.callShowMessageBox(`Read image data end: '${elapsedTime}' ms.`, 'info');\n          }\n          this.isDownloadingImageName = fileName;\n          this.processImage(this.ImageArrayBuffer);\n        };\n\n        fileReader.onerror = (error) => {\n          console.error('FileReader error:', error);\n          this.SendConsoleLogMsg('FileReader error: ' + error.message, 'error');\n        };\n\n        fileReader.readAsArrayBuffer(blob);\n      } catch (error) {\n        console.error('There was a problem with the fetch operation:', error);\n        this.SendConsoleLogMsg('There was a problem with the fetch operation: ' + error.message, 'error');\n\n        // 下载失败，重试\n        if (retryCount > 0) {\n          console.log('Retrying download...');\n          this.SendConsoleLogMsg('Retrying download...', 'warning');\n          this.isDownloadingImage = false;\n          this.updateCaptureImageProgress(100);\n          await this.readBinFile(fileName, retryCount - 1);\n        } else {\n          this.SendConsoleLogMsg('Max retries reached. Download failed.', 'error');\n        }\n      } finally {\n        this.isDownloadingImage = false; // 确保在任何情况下都重置状态\n      }\n    },\n    // async readBinFile(fileName, retryCount = 1) {\n    //   while (this.isDownloadingImage) {\n    //     await new Promise(resolve => setTimeout(resolve, 1000));\n    //     if (!this.isWaitingLogged) {\n    //       this.SendConsoleLogMsg('The image is already being processed. Please wait for the previous process to complete.', 'warning');\n    //       this.isWaitingLogged = true; // 确保只记录一次等待信息\n    //     }\n    //   }\n\n    //   if (this.isDownloadingImageName === fileName) {\n    //     this.SendConsoleLogMsg('The image(' + fileName + ') is already processed.', 'info');\n    //     return;\n    //   }\n\n    //   this.isDownloadingImage = true;\n    //   this.isWaitingLogged = false; // 重置等待日志标志\n    //   this.SendConsoleLogMsg('CaptureTestTime | Read image(' + fileName + ') data start.', 'info');\n\n    //   const startTime = new Date();\n    //   try {\n    //     // Fetch with progress tracking\n    //     const response = await fetch(fileName);\n    //     if (!response.ok) {\n    //       throw new Error('Network response was not ok');\n    //     }\n\n    //     const contentLength = response.headers.get('content-length');\n    //     if (!contentLength) {\n    //       throw new Error('Content-Length header is missing');\n    //     }\n\n    //     const total = parseInt(contentLength, 10);\n    //     let loaded = 0;\n\n    //     const reader = response.body.getReader();\n    //     const stream = new ReadableStream({\n    //       start: (controller) => {\n    //         const push = () => {\n    //           reader.read().then(({ done, value }) => {\n    //             if (done) {\n    //               controller.close();\n    //               return;\n    //             }\n    //             loaded += value.byteLength;\n    //             const percent = (loaded / total) * 100;\n    //             if (Math.round(percent) % 10 === 0) {\n    //               this.SendConsoleLogMsg(`Progress: ${Math.round(percent)}%`,'info');\n    //               this.updateCaptureImageProgress(Math.round(percent));\n    //             }\n    //             controller.enqueue(value);\n    //             push();\n    //           }).catch(error => {\n    //             console.error('Stream reading error:', error);\n    //             controller.error(error);\n    //           });\n    //         };\n    //         push();\n    //       }\n    //     });\n\n    //     const newResponse = new Response(stream);\n    //     const blob = await newResponse.blob();\n\n    //     // FileReader with progress tracking\n    //     const fileReader = new FileReader();\n    //     fileReader.onload = () => {\n    //       this.ImageArrayBuffer = fileReader.result;\n\n    //       const endTime = new Date();\n    //       const elapsedTime = endTime.getTime() - startTime.getTime();\n    //       this.SendConsoleLogMsg('CaptureTestTime | Read image data end: ' + elapsedTime + ' ms', 'info');\n    //       if (!this.isPolarAxisMode) {\n    //         this.callShowMessageBox(`Read image data end: '${elapsedTime}' ms.`, 'info');\n    //       }\n    //       this.isDownloadingImageName = fileName;\n    //       this.processImage(this.ImageArrayBuffer);\n    //     };\n\n    //     fileReader.onerror = (error) => {\n    //       console.error('FileReader error:', error);\n    //       this.SendConsoleLogMsg('FileReader error:' + error, 'error');\n    //     };\n\n    //     fileReader.readAsArrayBuffer(blob);\n    //   } catch (error) {\n    //     console.error('There was a problem with the fetch operation:', error);\n    //     this.SendConsoleLogMsg('There was a problem with the fetch operation:' + error, 'error');\n\n    //     // 下载失败，重试\n    //     if (retryCount > 0) {\n    //       console.log('Retrying download...');\n    //       this.SendConsoleLogMsg('Retrying download...', 'warning');\n    //       this.isDownloadingImage = false;\n    //       this.updateCaptureImageProgress(100);\n    //       await this.readBinFile(fileName, retryCount - 1);\n    //     }\n    //   } finally {\n    //     this.isDownloadingImage = false; // 确保在任何情况下都重置状态\n    //   }\n    // },\n\n    updateCaptureImageProgress(num) {\n      this.$bus.$emit('ShowCaptureImageProgress', num);\n    },\n\n    setImageProportion(value) {\n      this.ImageProportion = value;\n    },\n\n    // checkImageData(img) {\n    //   // 检查是否为 cv.Mat 类型\n    //   if (!(img instanceof cv.Mat)) {\n    //     this.SendConsoleLogMsg('The image is not a valid cv.Mat object.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像是否为空\n    //   if (img.empty()) {\n    //     this.SendConsoleLogMsg('The image is empty.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像深度是否为 8 位或 16 位\n    //   const depth = img.type() & cv.CV_MAT_DEPTH_MASK;\n    //   if (depth !== cv.CV_8U && depth !== cv.CV_16U) {\n    //     this.SendConsoleLogMsg('The image depth is not 8-bit or 16-bit.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像尺寸是否合理\n    //   if (img.rows <= 0 || img.cols <= 0) {\n    //     this.SendConsoleLogMsg('The image dimensions are not valid.', 'error');\n    //     return false;\n    //   }\n\n    //   // 检查图像数据是否超出范围或全为0\n    //   const data = img.data;\n    //   let isAllZero = true;\n    //   const maxValue = depth === cv.CV_8U ? 255 : 65535;\n\n    //   for (let i = 0; i < data.length; i++) {\n    //     if (data[i] < 0 || data[i] > maxValue) {\n    //       this.SendConsoleLogMsg('The image data contains out-of-range values.', 'error');\n    //       return false;\n    //     }\n    //     if (data[i] !== 0) {\n    //       isAllZero = false;\n    //     }\n    //   }\n\n    //   if (isAllZero) {\n    //     this.SendConsoleLogMsg('The image data is all zero.', 'error');\n    //     return false;\n    //   }\n    //   return true;\n    // },\n\n\n    processImage(imgArray) {\n      try {\n        const totalStartTime = new Date(); // 总开始时间\n\n        this.SendConsoleLogMsg('CaptureTestTime | Process image data start.', 'info');\n        const startTime = new Date();\n\n        const uint16Array = new Uint16Array(imgArray);\n\n        // 设置画布宽高常量\n        const canvasWidth = parseInt(this.mainCameraSizeX);\n        const canvasHeight = parseInt(this.mainCameraSizeY);\n\n        // 获取原始画布和修改后的画布以及对应上下文\n        const modifiedCanvas = document.getElementById('mainCamera-canvas');\n        const modifiedCtx = modifiedCanvas.getContext('2d');\n\n        modifiedCtx.clearRect(0, 0, modifiedCanvas.width, modifiedCanvas.height);\n\n        modifiedCanvas.width = canvasWidth;\n        modifiedCanvas.height = canvasHeight;\n\n        let mat = new cv.Mat(canvasHeight, canvasWidth, cv.CV_16UC1);\n        mat.data16U.set(uint16Array);\n\n        const matEndTime = new Date(); // mat 结束时间\n        this.SendConsoleLogMsg('CaptureTestTime | Mat creation time: ' + (matEndTime.getTime() - startTime.getTime()) + ' ms', 'info');\n\n        // 用户自定义参数\n        let gainR = this.ImageGainR;\n        let gainB = this.ImageGainB;\n        let offset = this.ImageOffset;\n        let CFA = this.ImageCFA;\n        let mode = 1;\n\n        // 参数\n        let B = 0;\n        let W = 65535;\n        let cvmode = 0;\n\n        const { blackLevel, whiteLevel } = this.GetAutoStretch(uint16Array, mode);\n        B = blackLevel;\n        W = whiteLevel;\n        const GetAutoStretchEndTime = new Date(); // GetAutoStretch 结束时间\n        this.SendConsoleLogMsg('CaptureTestTime | GetAutoStretch time: ' + (GetAutoStretchEndTime.getTime() - matEndTime.getTime()) + ' ms', 'info');\n\n        // 根据CFA设置颜色转换模式\n        if (CFA === 'GR') {\n          cvmode = cv.COLOR_BayerGR2RGBA;\n        } else if (CFA === 'GB') {\n          cvmode = cv.COLOR_BayerGB2RGBA;\n        } else if (CFA === 'BG') {\n          cvmode = cv.COLOR_BayerBG2RGBA;\n        } else if (CFA === 'RGGB') {\n          cvmode = cv.COLOR_BayerRG2RGBA;\n        }\n\n        // 对目标图像进行颜色转换\n        let dst = new cv.Mat();\n        try {\n          cv.cvtColor(mat, dst, cvmode);\n        } catch (error) {\n          this.handleError('cvtColor 出错', 'cvtColor', error);\n          mat.delete();\n          return;\n        }\n\n        const cvtColorEndTime = new Date(); // cvtColor 结束时间\n        this.SendConsoleLogMsg('CaptureTestTime | cvtColor time: ' + (cvtColorEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n        mat.delete();\n\n        // 调整图像大小\n        // cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n        // dst.delete();\n\n        // let originalImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n        // resizeImg.delete();\n\n        let resizeImg = new cv.Mat(); // 用来存储调整后的图像\n        if (this.isPolarAxisMode) {\n          // 调整图像大小\n          cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n          dst.delete();\n\n          let originalImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n          resizeImg.delete();\n\n          const Bit16To8_StretchEndTime = new Date(); // Bit16To8_Stretch 结束时间\n          this.SendConsoleLogMsg('CaptureTestTime | Bit16To8_Stretch time: ' + (Bit16To8_StretchEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n          let targetImg8 = this.ImageSoftAWB(originalImg8, gainR, gainB, offset);\n          this.$bus.$emit('showSolveImage', targetImg8);\n\n          const ImageSoftAWBEndTime = new Date(); // ImageSoftAWB 结束时间\n          this.SendConsoleLogMsg('CaptureTestTime | ImageSoftAWB time: ' + (ImageSoftAWBEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n        } else {\n          cv.resize(dst, resizeImg, new cv.Size(this.CanvasWidth, this.CanvasHeight), 0, 0, cv.INTER_LINEAR);\n          console.log('resizeImg.data.length: ', resizeImg.data.length);\n          console.log('resizeImg.cols: ', resizeImg.cols);\n          console.log('resizeImg.rows: ', resizeImg.rows);\n          let originalResizeImg8 = this.Bit16To8_Stretch(resizeImg, B, W);\n          console.log('originalResizeImg8.data.length: ', originalResizeImg8.data.length);\n          console.log('originalResizeImg8.cols: ', originalResizeImg8.cols);\n          console.log('originalResizeImg8.rows: ', originalResizeImg8.rows);\n          this.OriginalImage = new ImageData(new Uint8ClampedArray(originalResizeImg8.data), originalResizeImg8.cols, originalResizeImg8.rows);\n          resizeImg.delete();\n          console.log('dst.data.length: ', dst.data.length);\n          console.log('dst.cols: ', dst.cols);\n          console.log('dst.rows: ', dst.rows);\n          let originalImg8 = this.Bit16To8_Stretch(dst, B, W);\n          dst.delete();\n\n          const Bit16To8_StretchEndTime = new Date(); // Bit16To8_Stretch 结束时间\n          this.SendConsoleLogMsg('CaptureTestTime | Bit16To8_Stretch time: ' + (Bit16To8_StretchEndTime.getTime() - GetAutoStretchEndTime.getTime()) + ' ms', 'info');\n\n          // let targetImg8 = this.ImageSoftAWB(originalImg8, gainR, gainB, offset);\n\n          // const ImageSoftAWBEndTime = new Date(); // ImageSoftAWB 结束时间\n          // this.SendConsoleLogMsg('CaptureTestTime | ImageSoftAWB time: ' + (ImageSoftAWBEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n          \n          // originalImg8.delete();\n\n          this.lastImageProcessParams = {\n            gainR: gainR,\n            gainB: gainB,\n            offset: offset,\n            CFA: CFA,\n            mode: mode,\n            B: B,\n            W: W,\n            cvmode: cvmode,\n          };\n\n          modifiedCanvas.width = this.CanvasWidth;\n          modifiedCanvas.height = this.CanvasHeight;\n          let colorData = new ImageData(new Uint8ClampedArray(originalImg8.data), originalImg8.cols, originalImg8.rows);\n          this.drawImgData = colorData;\n          // 设置缓冲画布宽高\n          this.bufferCanvas.width = colorData.width;\n          this.bufferCanvas.height = colorData.height;\n          // 绘制缓存画布图像\n          this.bufferCtx.putImageData(colorData, 0, 0);\n          // 绘制主画布图像\n          this.drawImageData();\n\n          const DrawImageDataEndTime = new Date(); // DrawImageData 结束时间\n          this.SendConsoleLogMsg('CaptureTestTime | DrawImageData time: ' + (DrawImageDataEndTime.getTime() - Bit16To8_StretchEndTime.getTime()) + ' ms', 'info');\n\n          const endTime = new Date();\n          const elapsedTime = endTime.getTime() - startTime.getTime();\n          this.SendConsoleLogMsg('CaptureTestTime | Process image data end:' + elapsedTime + ' milliseconds', 'info');\n\n          // const totalEndTime = new Date(); // 总结束时间\n          // this.SendConsoleLogMsg('CaptureTestTime | Total process image data time: ' + (totalEndTime.getTime() - totalStartTime.getTime()) + ' ms', 'info');\n\n          this.$bus.$emit('showCaptureImage');\n          this.MakeHistogram(colorData);\n          this.histogramImage = colorData;\n\n          const checkDetectedStarsFinish = () => {\n            if (this.DetectedStarsFinish) {\n              this.detectStarsImg = this.DrawDetectStars(targetImg8, this.DetectedStarsList);\n              targetImg8.delete();\n              clearInterval(intervalId);\n            }\n          };\n\n          const intervalId = setInterval(checkDetectedStarsFinish, 1000);\n        }\n\n        // if (this.isNotDrawStars) {\n        //   this.drawImageData(this.drawImgData);\n        // } else {\n        //   if (this.detectStarsImg != null) {\n        //     this.drawImageData(this.detectStarsImg);\n        //   } else {\n        //     this.drawImageData(this.drawImgData);\n        //   }\n        // }\n\n        // const windowWidth = window.innerWidth;\n        // const windowHeight = window.innerHeight;\n\n        // const minTranslateX = this.imageWidth - this.CanvasWidth;\n        // const minTranslateY = this.imageHeight - this.CanvasHeight;\n\n        // // 计算初始的 ScaleImageSize_X 和 ScaleImageSize_Y\n        // this.ScaleImageSize_X = Math.floor(minTranslateX / this.CanvasWidth * windowWidth + windowWidth);\n        // this.ScaleImageSize_Y = Math.floor(minTranslateY / this.CanvasHeight * windowHeight + windowHeight);\n\n        // this.$bus.$emit('ScaleImageSize', this.ScaleImageSize_X, this.ScaleImageSize_Y);\n\n      } catch (error) {\n        this.handleError('Process image data error', 'processImage', error);\n        if (mat) {\n          mat.delete();\n        }\n        if (resizeImg) {\n          resizeImg.delete();\n        }\n        if (originalImg8) {\n          originalImg8.delete();\n        }\n        if (targetImg8) {\n          targetImg8.delete();\n        }\n      }\n    },\n\n    // histogramStretch(imageData, min, max) {\n    //   const startTime = new Date();\n    //   // Convert ImageData to cv.Mat\n    //   const image = cv.matFromImageData(imageData);\n    //   let Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 转换图像数据时间: ' + (Time1.getTime() - startTime.getTime()) + ' ms', 'info');\n    //   // Perform the histogram stretch\n    //   const channels = new cv.MatVector();\n    //   cv.split(image, channels); // Split channels (BGR) into separate Mat objects\n    //   let Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 分割通道时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Calculate alpha and beta for each channel\n    //   let alpha = 255.0 / (max - min);\n    //   let beta = -min * alpha;\n\n    //   if (alpha < 0) {\n    //     alpha = 0;\n    //     beta = 0;\n    //   } else if (alpha > 255) {\n    //     alpha = 255;\n    //     beta = 0;\n    //   }\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 计算alpha和beta时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   // Iterate over each channel and apply histogram stretching\n    //   for (let i = 0; i < channels.size(); i++) {\n    //     let channel = channels.get(i);\n\n\n    //     // Apply histogram stretching to the channel\n    //     channel.convertTo(channel, -1, alpha, beta);\n\n    //     // Release the memory of channel\n    //     channel.delete();\n    //   }\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 各通道拉伸时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Merge the channels back into a single image\n    //   const stretchImage = new cv.Mat();\n    //   cv.merge(channels, stretchImage);\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 合并通道时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   // Release the memory of channels and MatVector\n    //   channels.delete();\n\n    //   // Convert cv.Mat back to ImageData\n    //   const stretchedImageData = new ImageData(new Uint8ClampedArray(stretchImage.data), stretchImage.cols, stretchImage.rows);\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 转换图像数据时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Clean up\n    //   image.delete();\n    //   stretchImage.delete();\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('histogramStretch | 释放内存时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n    //   this.SendConsoleLogMsg('histogramStretch | 总时间: ' + (Time1.getTime() - startTime.getTime()) + ' ms', 'info');\n    //   return stretchedImageData;\n    // },\n\n    histogramStretch(imageData, min, max) {\n      const startTime = new Date();\n      // Calculate alpha and beta\n      let alpha = 255.0 / (max - min);\n      let beta = -min * alpha;\n\n      if (alpha < 0) {\n        alpha = 0;\n        beta = 0;\n      } else if (alpha > 255) {\n        alpha = 255;\n        beta = 0;\n      }\n\n      // Apply histogram stretching directly on ImageData\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        for (let j = 0; j < 3; j++) { // For each color channel\n          let value = imageData.data[i + j];\n          value = value * alpha + beta;\n          imageData.data[i + j] = Math.max(0, Math.min(255, value));\n        }\n      }\n\n      const endTime = new Date();\n      this.SendConsoleLogMsg('histogramStretch | 总时间: ' + (endTime.getTime() - startTime.getTime()) + ' ms', 'info');\n      return imageData;\n    },\n    localWhiteBalanceAdjustment(imageData, gainR, gainB, offset) {\n      // 分离通道\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        for (let j = 0; j < 3; j++) { // For each color channel\n          if (j == 0) {\n            value = imageData.data[i + j];\n            value = value * gainB + offset;\n          } else if (j == 2) {\n            value = imageData.data[i + j];\n            value = value * gainR + offset;\n          } else {\n            value = imageData.data[i + j];\n            value = value * 1 + offset;\n          }\n          imageData.data[i + j] = Math.max(0, Math.min(255, value));\n        }\n      }\n\n\n      return imageData;\n    },\n\n    initCanvas() {\n      this.bufferCanvas = document.createElement('canvas');\n      this.bufferCtx = this.bufferCanvas.getContext('2d');\n\n      this.tempCanvas = document.createElement('canvas');\n      this.tempCtx = this.tempCanvas.getContext('2d');\n    },\n\n    //*/*/*/*/*/*/*/*/*/*/*/\n    SwitchImageToShow(isOriginal) {\n      // console.log('Show Original Image: ', isOriginal);\n      this.SendConsoleLogMsg('Show Original Image:' + isOriginal, 'info');\n      this.isNotDrawStars = isOriginal;\n      if (isOriginal) {\n        // document.removeEventListener('click', this.handleTouchOrMouseDown);\n        this.enableMainCanvasClick = false;\n        this.drawImageData();\n      } else {\n        // document.addEventListener('click', this.handleTouchOrMouseDown);\n        this.enableMainCanvasClick = true;\n        // this.drawImageData(this.detectStarsImg);\n      }\n    },\n\n    // drawImageData() {\n    //   if (this.bufferCanvas == null) {\n    //     this.SendConsoleLogMsg('drawImageData error: bufferCanvas is null or undefined.', 'error');\n    //     return;\n    //   }\n    //   // 可用相关参数\n    //   // window.innerWidth; // 窗口宽度\n    //   // window.innerHeight; // 窗口高度\n    //   // this.scale 缩放比例\n    //   // this.translateX 平移x坐标\n    //   // this.translateY 平移y坐标\n    //   // this.CanvasWidth 主画布宽度 1920\n    //   // this.CanvasHeight 主画布高度 1080\n    //   // this.mainCameraSizeX 原始图像宽度\n    //   // this.mainCameraSizeY 原始图像高度\n    //   // this.bufferCanvas.width 缓冲画布宽度\n    //   // this.bufferCanvas.height 缓冲画布高度\n    //   // this.ImageProportion 图像比例\n    //   // this.ROI_x ROI的x坐标\n    //   // this.ROI_y ROI的y坐标\n    //   // this.ROI_length ROI的长度\n\n    //   // console.log('当前画布参数:\\n bufferCanvas.width: ', this.bufferCanvas.width, '\\n bufferCanvas.height: ', this.bufferCanvas.height, '\\n ImageProportion: ', this.ImageProportion, '\\n scale: ', this.scale, '\\n visibleX: ', this.visibleX, '\\n visibleY: ', this.visibleY, '\\n visibleWidth: ', this.visibleWidth, '\\n visibleHeight: ', this.visibleHeight, '\\n ROI_x: ', this.ROI_x, '\\n ROI_y: ', this.ROI_y, '\\n ROI_length: ', this.ROI_length);\n\n    //   let startTime = new Date();\n    //   let Time1 = new Date();\n\n    //   // 计算可见区域\n    //   const newVisibleWidth = this.bufferCanvas.width * this.scale;\n    //   const newVisibleHeight = newVisibleWidth / this.ImageProportion;\n\n    //   // 计算可见区域x坐标\n    //   let newVisibleX = this.visibleX;\n    //   // 计算可见区域y坐标\n    //   let newVisibleY = this.visibleY;\n\n    //   // 避免图像越界\n    //   if (newVisibleX - newVisibleWidth / 2 < 0) {\n    //     newVisibleX = newVisibleWidth / 2;\n    //   } else if (newVisibleX + newVisibleWidth / 2 > this.bufferCanvas.width) {\n    //     newVisibleX = this.bufferCanvas.width - newVisibleWidth / 2;\n    //   }\n\n    //   if (newVisibleY - newVisibleHeight / 2 < 0) {\n    //     newVisibleY = newVisibleHeight / 2;\n    //   } else if (newVisibleY + newVisibleHeight / 2 > this.bufferCanvas.height) {\n    //     newVisibleY = this.bufferCanvas.height - newVisibleHeight / 2;\n    //   }\n\n    //   // 更新ROI区域\n    //   // 计算可见区域的边界\n    //   const visibleLeft = newVisibleX - newVisibleWidth / 2;\n    //   const visibleRight = newVisibleX + newVisibleWidth / 2;\n    //   const visibleTop = newVisibleY - newVisibleHeight / 2;\n    //   const visibleBottom = newVisibleY + newVisibleHeight / 2;\n\n    //   // 计算 ROI 区域的边界\n    //   const roiLeft = this.ROI_x;\n    //   const roiRight = this.ROI_x + this.ROI_length;\n    //   const roiTop = this.ROI_y;\n    //   const roiBottom = this.ROI_y + this.ROI_length;\n\n    //   // 判断 ROI 区域是否在可见区域内\n    //   const isRoiInVisible = roiRight >= visibleLeft && roiLeft <= visibleRight && roiBottom >= visibleTop && roiTop <= visibleBottom;\n\n    //   // 计算 ROI 区域在屏幕上的位置，中心点坐标\n    //   const roiScreenX = (this.ROI_x - visibleLeft) * (window.innerWidth / newVisibleWidth) + this.RedBoxSideLength * window.innerWidth / newVisibleWidth / 2;\n    //   const roiScreenY = (this.ROI_y - visibleTop) * (window.innerHeight / newVisibleHeight) + this.RedBoxSideLength * window.innerHeight / newVisibleHeight / 2;\n    //   // this.SendConsoleLogMsg('ROI 区域在屏幕上的位置: ' + roiScreenX + '*' + roiScreenY + '长度 ' + this.RedBoxSideLength * window.innerWidth / newVisibleWidth + '*' + this.RedBoxSideLength * window.innerHeight / newVisibleHeight, 'info');\n    //   this.$bus.$emit('setRedBoxLength', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n    //   this.$bus.$emit('setRedBoxPosition', roiScreenX, roiScreenY);\n    //   // if (isRoiInVisible) {\n    //   //   console.log('ROI 区域在可见区域内, RedBoxSideLength: ', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, ', ', this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n    //   // } else {\n    //   //   console.log('ROI 区域不在可见区域内, RedBoxSideLength: ', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, ', ', this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n    //   // }\n\n    //   let Time2 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 计算相关参数时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // Draw buffer canvas on main canvas\n    //   const canvas = this.$refs.mainCanvas;\n    //   const ctx = canvas.getContext('2d');\n    //   ctx.clearRect(0, 0, canvas.width, canvas.height);\n    //   // 获取绘制的图像数据\n    //   let imageData = this.bufferCtx.getImageData(newVisibleX - newVisibleWidth / 2, newVisibleY - newVisibleHeight / 2, newVisibleWidth, newVisibleHeight);\n\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 获取绘制的图像数据时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n\n    //   // if (this.currentHistogramMax != 255 || this.currentHistogramMin != 0) {\n    //   //   imageData = this.histogramStretch(imageData, this.currentHistogramMin, this.currentHistogramMax);\n    //   // }\n\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 直方图拉伸时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n      \n      \n    //   // Create a temporary canvas to draw the ImageData\n    //   let tempCanvas = document.createElement('canvas');\n    //   tempCanvas.width = imageData.width;\n    //   tempCanvas.height = imageData.height;\n    //   let tempCtx = tempCanvas.getContext('2d');\n    //   tempCtx.putImageData(imageData, 0, 0);\n\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 创建临时画布并绘制时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n\n    //   // Draw the ImageData on the main canvas\n    //   ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, 0, 0, canvas.width, canvas.height);\n\n    //   Time2 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 绘制图像时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n    //   // ctx.drawImage(this.bufferCanvas, newVisibleX - newVisibleWidth / 2, newVisibleY - newVisibleHeight / 2, newVisibleWidth, newVisibleHeight, 0, 0, canvas.width, canvas.height);\n    //   // this.SendConsoleLogMsg('绘制图像,可见区域:' + newVisibleX + ',' + newVisibleY + ',' + newVisibleWidth + ',' + newVisibleHeight, 'info');\n    //   this.visibleX = newVisibleX;\n    //   this.visibleY = newVisibleY;\n    //   this.visibleWidth = newVisibleWidth;\n    //   this.visibleHeight = newVisibleHeight;\n\n    //   this.$bus.$emit('setCurrentMainCanvasHasImage', true); // 发送给电调，用于判断是否可以进行循环拍摄\n    //   // 发送消息给QT客户端，用于信息图标\n    //   this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendRedBoxState:' + this.RedBoxSideLength + ':' + this.ROI_x + ':' + this.ROI_y);\n    //   this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendVisibleArea:' + this.visibleX + ':' + this.visibleY + ':' + this.scale);\n      \n    //   // 如果选择了星点，则根据选择位置，在ROI区域中绘制一个圆\n    //   if (this.DrawSelectStarX != -1 && this.DrawSelectStarY != -1 && this.showSelectStar) {\n    //     let radius, canvasStarX, canvasStarY, color;\n    //     // 如果有星点\n    //     if (this.DrawSelectStarHFR != -1) {\n    //       radius = this.DrawSelectStarHFR/this.scale*2;\n    //       canvasStarX = (this.DrawSelectStarX + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n    //       canvasStarY = (this.DrawSelectStarY + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n    //       color = 'green'; // 有星点，绘制绿色的圆\n    //     } else {\n    //       // 否则，在选择的位置绘制一个圆\n    //       radius = 10/this.scale; // 你可以根据需要调整这个值\n    //       canvasStarX = (this.DrawSelectStarX + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n    //       canvasStarY = (this.DrawSelectStarY + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n    //       color = 'red'; // 无星点，绘制红色的圆\n    //     }\n\n    //     // 获取绘制圆的位置的图像数据\n    //     const imageData = ctx.getImageData(canvasStarX - radius, canvasStarY - radius, 2 * radius, 2 * radius);\n    //     // 发送图像数据给显示框\n    //     this.$bus.$emit('selectStarImage', imageData);\n\n    //     // 在指定位置开始绘制圆\n    //     ctx.beginPath();\n    //     ctx.arc(canvasStarX, canvasStarY, radius, 0, 2 * Math.PI);\n    //     ctx.strokeStyle = color;\n    //     ctx.lineWidth = 3;\n    //     ctx.stroke();\n    //     ctx.closePath();\n    //   }\n\n    //   Time1 = new Date();\n    //   this.SendConsoleLogMsg('drawImageData | 绘制星点时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n\n    //   this.SendConsoleLogMsg('drawImageData | 总时间: ' + (Time1.getTime() - startTime.getTime()) + ' ms', 'info');\n    // },\n\n    \n   drawImageData() {\n      if (this.bufferCanvas == null) {\n        this.SendConsoleLogMsg('drawImageData error: bufferCanvas is null or undefined.', 'error');\n        return;\n      }\n      // 可用相关参数\n      // window.innerWidth; // 窗口宽度\n      // window.innerHeight; // 窗口高度\n      // this.scale 缩放比例\n      // this.translateX 平移x坐标\n      // this.translateY 平移y坐标\n      // this.CanvasWidth 主画布宽度 1920\n      // this.CanvasHeight 主画布高度 1080\n      // this.mainCameraSizeX 原始图像宽度\n      // this.mainCameraSizeY 原始图像高度\n      // this.bufferCanvas.width 缓冲画布宽度\n      // this.bufferCanvas.height 缓冲画布高度\n      // this.ImageProportion 图像比例\n      // this.ROI_x ROI的x坐标\n      // this.ROI_y ROI的y坐标\n      // this.ROI_length ROI的长度\n\n      // console.log('当前画布参数:\\n bufferCanvas.width: ', this.bufferCanvas.width, '\\n bufferCanvas.height: ', this.bufferCanvas.height, '\\n ImageProportion: ', this.ImageProportion, '\\n scale: ', this.scale, '\\n visibleX: ', this.visibleX, '\\n visibleY: ', this.visibleY, '\\n visibleWidth: ', this.visibleWidth, '\\n visibleHeight: ', this.visibleHeight, '\\n ROI_x: ', this.ROI_x, '\\n ROI_y: ', this.ROI_y, '\\n ROI_length: ', this.ROI_length);\n\n      let startTime = new Date();\n      let Time1 = new Date();\n\n      // 计算可见区域\n      const newVisibleWidth = this.bufferCanvas.width * this.scale;\n      const newVisibleHeight = newVisibleWidth / this.ImageProportion;\n\n      // 计算可见区域x坐标\n      let newVisibleX = this.visibleX;\n      // 计算可见区域y坐标\n      let newVisibleY = this.visibleY;\n\n      // 避免图像越界\n      if (newVisibleX - newVisibleWidth / 2 < 0) {\n        newVisibleX = newVisibleWidth / 2;\n      } else if (newVisibleX + newVisibleWidth / 2 > this.bufferCanvas.width) {\n        newVisibleX = this.bufferCanvas.width - newVisibleWidth / 2;\n      }\n\n      if (newVisibleY - newVisibleHeight / 2 < 0) {\n        newVisibleY = newVisibleHeight / 2;\n      } else if (newVisibleY + newVisibleHeight / 2 > this.bufferCanvas.height) {\n        newVisibleY = this.bufferCanvas.height - newVisibleHeight / 2;\n      }\n\n      // 更新ROI区域\n      // 计算可见区域的边界\n      const visibleLeft = newVisibleX - newVisibleWidth / 2;\n      const visibleRight = newVisibleX + newVisibleWidth / 2;\n      const visibleTop = newVisibleY - newVisibleHeight / 2;\n      const visibleBottom = newVisibleY + newVisibleHeight / 2;\n\n      // 计算 ROI 区域的边界\n      const roiLeft = this.ROI_x;\n      const roiRight = this.ROI_x + this.ROI_length;\n      const roiTop = this.ROI_y;\n      const roiBottom = this.ROI_y + this.ROI_length;\n\n      // 判断 ROI 区域是否在可见区域内\n      const isRoiInVisible = roiRight >= visibleLeft && roiLeft <= visibleRight && roiBottom >= visibleTop && roiTop <= visibleBottom;\n\n      // 计算 ROI 区域在屏幕上的位置，中心点坐标\n      const roiScreenX = (this.ROI_x - visibleLeft) * (window.innerWidth / newVisibleWidth) + this.RedBoxSideLength * window.innerWidth / newVisibleWidth / 2;\n      const roiScreenY = (this.ROI_y - visibleTop) * (window.innerHeight / newVisibleHeight) + this.RedBoxSideLength * window.innerHeight / newVisibleHeight / 2;\n      // this.SendConsoleLogMsg('ROI 区域在屏幕上的位置: ' + roiScreenX + '*' + roiScreenY + '长度 ' + this.RedBoxSideLength * window.innerWidth / newVisibleWidth + '*' + this.RedBoxSideLength * window.innerHeight / newVisibleHeight, 'info');\n      this.$bus.$emit('setRedBoxLength', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n      this.$bus.$emit('setRedBoxPosition', roiScreenX, roiScreenY);\n      // if (isRoiInVisible) {\n      //   console.log('ROI 区域在可见区域内, RedBoxSideLength: ', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, ', ', this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n      // } else {\n      //   console.log('ROI 区域不在可见区域内, RedBoxSideLength: ', this.RedBoxSideLength * window.innerWidth / newVisibleWidth, ', ', this.RedBoxSideLength * window.innerHeight / newVisibleHeight);\n      // }\n\n      let Time2 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 计算相关参数时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n      // Draw buffer canvas on main canvas\n      const canvas = this.$refs.mainCanvas;\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      // 获取绘制的图像数据\n      // let imageData = this.bufferCtx.getImageData(newVisibleX - newVisibleWidth / 2, newVisibleY - newVisibleHeight / 2, newVisibleWidth, newVisibleHeight);\n\n      Time1 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 获取绘制的图像数据时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n      \n      // Create a temporary canvas to draw the ImageData\n      this.tempCtx.clearRect(0, 0, this.tempCanvas.width, this.tempCanvas.height);\n      this.tempCanvas.width = canvas.width;\n      this.tempCanvas.height = canvas.height;\n      this.tempCtx.drawImage(this.bufferCanvas, newVisibleX - newVisibleWidth / 2, newVisibleY - newVisibleHeight / 2, newVisibleWidth, newVisibleHeight, 0, 0, canvas.width, canvas.height);\n\n      Time1 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 创建临时画布并绘制时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n\n      let imageData = this.tempCtx.getImageData(0, 0, this.tempCanvas.width, this.tempCanvas.height);\n\n      if (this.currentHistogramMax != 255 || this.currentHistogramMin != 0) {\n        imageData = this.histogramStretch(imageData, this.currentHistogramMin, this.currentHistogramMax);\n      }\n\n      if (this.ImageGainR != 1 || this.ImageGainB != 1 || this.ImageOffset != 0) {\n        imageData = this.localWhiteBalanceAdjustment(imageData, this.ImageGainR, this.ImageGainB, this.ImageOffset);\n      }\n      this.tempCtx.putImageData(imageData, 0, 0);\n\n      Time2 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 直方图拉伸时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n      // Draw the ImageData on the main canvas\n      ctx.drawImage(this.tempCanvas, 0, 0, this.tempCanvas.width, this.tempCanvas.height, 0, 0, canvas.width, canvas.height);\n\n      Time1 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 绘制图像时间: ' + (Time1.getTime() - Time2.getTime()) + ' ms', 'info');\n      // ctx.drawImage(this.bufferCanvas, newVisibleX - newVisibleWidth / 2, newVisibleY - newVisibleHeight / 2, newVisibleWidth, newVisibleHeight, 0, 0, canvas.width, canvas.height);\n      // this.SendConsoleLogMsg('绘制图像,可见区域:' + newVisibleX + ',' + newVisibleY + ',' + newVisibleWidth + ',' + newVisibleHeight, 'info');\n      this.visibleX = newVisibleX;\n      this.visibleY = newVisibleY;\n      this.visibleWidth = newVisibleWidth;\n      this.visibleHeight = newVisibleHeight;\n\n      this.$bus.$emit('setCurrentMainCanvasHasImage', true); // 发送给电调，用于判断是否可以进行循环拍摄\n      // 发送消息给QT客户端，用于信息图标\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendRedBoxState:' + this.RedBoxSideLength + ':' + this.ROI_x + ':' + this.ROI_y);\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendVisibleArea:' + this.visibleX + ':' + this.visibleY + ':' + this.scale);\n      \n      // 如果选择了星点，则根据选择位置，在ROI区域中绘制一个圆\n      if (this.DrawSelectStarX != -1 && this.DrawSelectStarY != -1 && this.showSelectStar) {\n        let radius, canvasStarX, canvasStarY, color;\n        // 如果有星点\n        if (this.DrawSelectStarHFR != -1) {\n          radius = this.DrawSelectStarHFR/this.scale*2;\n          canvasStarX = (this.DrawSelectStarX + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n          canvasStarY = (this.DrawSelectStarY + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n          color = 'green'; // 有星点，绘制绿色的圆\n        } else {\n          // 否则，在选择的位置绘制一个圆\n          radius = 10/this.scale; // 你可以根据需要调整这个值\n          canvasStarX = (this.DrawSelectStarX + this.ROI_x - visibleLeft) * ctx.canvas.width / newVisibleWidth;\n          canvasStarY = (this.DrawSelectStarY + this.ROI_y - visibleTop) * ctx.canvas.height / newVisibleHeight;\n          color = 'red'; // 无星点，绘制红色的圆\n        }\n\n        // 获取绘制圆的位置的图像数据\n        const imageData = ctx.getImageData(canvasStarX - radius, canvasStarY - radius, 2 * radius, 2 * radius);\n        // 发送图像数据给显示框\n        this.$bus.$emit('selectStarImage', imageData);\n\n        // 在指定位置开始绘制圆\n        ctx.beginPath();\n        ctx.arc(canvasStarX, canvasStarY, radius, 0, 2 * Math.PI);\n        ctx.strokeStyle = color;\n        ctx.lineWidth = 3;\n        ctx.stroke();\n        ctx.closePath();\n      }\n\n      Time2 = new Date();\n      this.SendConsoleLogMsg('drawImageData | 绘制星点时间: ' + (Time2.getTime() - Time1.getTime()) + ' ms', 'info');\n\n      this.SendConsoleLogMsg('drawImageData | 总时间: ' + (Time2.getTime() - startTime.getTime()) + ' ms', 'info');\n    },\n\n    addEventListeners() {\n \n    },\n\n    // 节流函数\n    throttle(func, delay) {\n      let lastExecuted = 0;\n      return function (...args) {\n        const now = Date.now();\n        if (now - lastExecuted >= delay) {\n          func.apply(this, args);\n          lastExecuted = now;\n        }\n      };\n    },\n\n    ImageSoftAWB(img8, gainR, gainB, offset) {\n      // 分离通道\n      let channels = new cv.MatVector();\n      cv.split(img8, channels);\n\n      const b = channels.get(0);\n      const g = channels.get(1);\n      const r = channels.get(2);\n\n      // 自适应直方图均衡化\n      const clahe = new cv.CLAHE(2.0, new cv.Size(8, 8));\n      clahe.apply(b, b);\n      clahe.apply(g, g);\n      clahe.apply(r, r);\n\n      // 应用增益和偏置\n      r.convertTo(r, -1, gainR, offset);\n      b.convertTo(b, -1, gainB, offset);\n      g.convertTo(g, -1, 1, offset); // 对绿色通道应用偏置但不改变增益\n\n      // 更新 channels 中的通道数据\n      channels.set(0, b);\n      channels.set(1, g);\n      channels.set(2, r);\n\n      // 合并通道\n      let mergedImg = new cv.Mat();\n      cv.merge(channels, mergedImg);\n\n      // 释放资源\n      b.delete(); // 释放 b\n      g.delete(); // 释放 g\n      r.delete(); // 释放 r\n      channels.delete();\n      clahe.delete(); // 释放 clahe\n\n\n\n      return mergedImg;\n    },\n\n    // Bit16To8_Stretch(img16, B, W) {\n    //   console.log('Bit16To8_Stretch | B = ' + B + ', W = ' + W);\n    //   let img8 = new cv.Mat();\n    //   img8.create(img16.rows, img16.cols, cv.CV_8UC4);\n    //   img16.convertTo(img8, cv.CV_8U, 255.0 / (W - B), -B * 255.0 / (W - B));\n\n    //   const result = img8.clone(); // 克隆 img8 以返回结果\n    //   img8.delete(); // 释放 img8\n\n    //   return result;\n    // },\n    Bit16To8_Stretch(img16, B, W) {\n      console.log('Bit16To8_Stretch | B = ' + B + ', W = ' + W);\n      let img8 = new cv.Mat(img16.rows, img16.cols, cv.CV_8UC4);\n      img16.convertTo(img8, cv.CV_8U, 255.0 / (W - B), -B * 255.0 / (W - B));\n      return img8;\n    },\n\n    DrawDetectStars(image, Stars) {\n      console.log('Draw circle on the Capture Image(', image.cols, ',', image.rows, ').');\n      if (!(image instanceof cv.Mat)) {\n        throw new Error('Invalid image data');\n      }\n      Stars.forEach(star => {\n        let centerX = Math.round(star.x / (this.mainCameraSizeX / image.cols));\n        let centerY = Math.round(star.y / (this.mainCameraSizeY / image.rows));\n        let radius = Math.round(star.hfr);\n\n        console.log('Draw circle at(', centerX, ',', centerY, ') with radius:', radius);\n\n        let center = new cv.Point(centerX, centerY);\n        let color = new cv.Scalar(255, 0, 0, 255);\n        let thickness = 2; // 圆圈厚度\n\n        cv.circle(image, center, radius, color, thickness);\n\n        // 添加 hfr 值到圆的上方\n        // 确保 star.hfr 是一个数字\n        let hfrValue = parseFloat(star.hfr);\n        if (isNaN(hfrValue)) {\n          hfrValue = 0; // 如果 star.hfr 不能转换为数字，则默认值设为0\n        }\n\n        // 保留到小数点后2位\n        let text = hfrValue.toFixed(2);\n        let fontFace = cv.FONT_HERSHEY_SIMPLEX;\n        let fontScale = 1;\n        let textColor = new cv.Scalar(255, 0, 0, 255);\n        let textThickness = 2;\n\n        // 手动设置文本的位置，假设字体高度大约为10像素\n        let textX = centerX - (text.length * 10); // 估算每个字符宽度为5像素\n        let textY = centerY - radius - 3; // 圆的上方 3 像素\n\n        // 在图像上绘制文本\n        cv.putText(image, text, new cv.Point(textX, textY), fontFace, fontScale, textColor, textThickness);\n      });\n\n      const imageData = new ImageData(new Uint8ClampedArray(image.data), image.cols, image.rows);\n\n      return imageData;\n    },\n\n    DrawPHD2Box(PHD2ImageSize_X, PHD2ImageSize_Y, Box_X, Box_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const BoxWidth = 20 / ratioZoomX;\n      const BoxHeight = 20 / ratioZoomY;\n\n      const BoxStartX = Box_X / ratioZoomX - BoxWidth / 2;\n      const BoxStartY = Box_Y / ratioZoomY - BoxHeight / 2;\n\n      this.$bus.$emit('PHD2BoxPosition', BoxStartX, BoxStartY, BoxWidth, BoxHeight);\n    },\n\n    DrawPHD2Cross(PHD2ImageSize_X, PHD2ImageSize_Y, Cross_X, Cross_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const CrossStartX = Cross_X / ratioZoomX;\n      const CrossStartY = Cross_Y / ratioZoomY;\n\n      this.$bus.$emit('PHD2CrossPosition', CrossStartX, CrossStartY);\n    },\n\n    DrawPHD2MultiStars(PHD2ImageSize_X, PHD2ImageSize_Y, Star_X, Star_Y) {\n      const ratioZoomX = PHD2ImageSize_X / window.innerWidth;\n      const ratioZoomY = PHD2ImageSize_Y / window.innerHeight;\n\n      const StarStartX = Star_X / ratioZoomX - 12 / 2;\n      const StarStartY = Star_Y / ratioZoomY - 12 / 2;\n\n      this.$bus.$emit('PHD2MultiStarsPosition', StarStartX, StarStartY);\n    },\n\n    GetAutoStretch(imgData, mode) {\n      if (imgData.length === 0) {\n        return { blackLevel: 0, whiteLevel: 65535 };\n      }\n\n      const length = imgData.length;\n      let mean = 0;\n      let M2 = 0;\n\n      for (let i = 0; i < length; i++) {\n        const delta = imgData[i] - mean;\n        mean += delta / (i + 1);\n        M2 += delta * (imgData[i] - mean);\n      }\n\n      const variance = M2 / length;\n      const std = Math.sqrt(variance);\n\n      let a, b;\n      switch (mode) {\n        case 0:\n          a = 3;\n          b = 5;\n          break;\n        case 1:\n          a = 2;\n          b = 5;\n          break;\n        case 2:\n          a = 3;\n          b = 8;\n          break;\n        default:\n          a = 2;\n          b = 8;\n      }\n\n      let bx = Math.max(0, mean - std * a);\n      let wx = Math.min(65535, mean + std * b);\n\n      let blackLevel = Math.round(bx);\n      let whiteLevel = Math.round(wx);\n\n      if (blackLevel >= whiteLevel) {\n        blackLevel = whiteLevel - 1;\n      }\n\n      return { blackLevel, whiteLevel };\n    },\n\n    fetchImage(imagePath) {\n      const url = imagePath;\n      const xhr = new XMLHttpRequest();\n\n      xhr.responseType = 'blob'; // 设置响应类型为 blob\n\n      xhr.onload = () => {\n        if (xhr.status === 200) {\n          const imageUrl = URL.createObjectURL(xhr.response);\n          // 在这里，您可以将 imageUrl 设置到某个 <img> 元素上，或者做其他处理\n          this.$bus.$emit('showCaptureImage');\n          this.displayImageOnCanvas(imageUrl); // 将图像显示在Canvas上\n        } else {\n          console.error('Failed to fetch the image. Status:', xhr.status);\n        }\n      };\n\n      xhr.onerror = () => {\n        console.error('There was an error fetching the image.');\n      };\n\n      xhr.open('GET', url, true);\n      xhr.send();\n    },\n\n    displayImageOnCanvas(imageUrl) {\n      const showcanvas = document.getElementById('mainCamera-canvas');\n      const canvas = document.getElementById('TestCanvas');\n      const showctx = showcanvas.getContext('2d');\n      const ctx = canvas.getContext('2d');\n      showcanvas.width = this.CanvasWidth;\n      showcanvas.height = this.CanvasHeight;\n      console.log('QHYCCD | canvas size:', showcanvas.width, showcanvas.height);\n\n      const img = new Image();\n      img.setAttribute('crossOrigin', '');\n      img.onload = () => {\n        this.histogramImage = img;\n\n        // 计算图像的缩放比例以使其铺满固定大小的 Canvas\n        const scaleWidth = showcanvas.width / img.width;\n        const scaleHeight = showcanvas.height / img.height;\n\n        const width = img.width * scaleWidth;\n        const height = img.height * scaleHeight;\n\n        // 清空 Canvas\n        showctx.clearRect(0, 0, showcanvas.width, showcanvas.height);\n        ctx.clearRect(0, 0, showcanvas.width, showcanvas.height);\n\n        // 在 Canvas 上绘制图像\n        showctx.drawImage(img, 0, 0, width, height);\n        ctx.drawImage(img, 0, 0, width, height);\n        console.log('QHYCCD | crossOrigin:', img.crossOrigin);\n        this.imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        console.log('QHYCCD | imageData:', this.imageData);\n        this.MakeHistogram(this.imageData);\n      };\n      img.src = imageUrl;\n    },\n\n    MakeHistogram(imageData) {\n      console.log('MakeHistogram');\n\n      // 计算三个通道的直方图\n      this.histogramData = this.calculateHistogram(imageData);\n\n      this.$bus.$emit('showHistogram', this.histogramData);\n    },\n\n    calculateHistogram(imageData) {\n      console.log('QHYCCD | calculateHistogram');\n      const histogram = [\n        Array(256).fill(0), // 存储蓝色通道直方图\n        Array(256).fill(0), // 存储绿色通道直方图\n        Array(256).fill(0)  // 存储红色通道直方图\n      ];\n\n      // 分别计算三个通道的直方图\n      for (let i = 0; i < imageData.data.length; i += 4) {\n        const r = imageData.data[i];\n        const g = imageData.data[i + 1];\n        const b = imageData.data[i + 2];\n\n        // 更新每个通道的直方图\n        histogram[0][b]++;\n        histogram[1][g]++;\n        histogram[2][r]++;\n      }\n\n      return histogram;\n    },\n\n    applyHistStretch(Min, Max) {\n      this.currentHistogramMin = Min;\n      this.currentHistogramMax = Max;\n      this.drawImageData();\n      this.$bus.$emit('ChangeDialPosition', Min, Max);\n    },\n\n    setAutoHistogramNum(min, max) {\n      this.histogram_min = min;\n      this.histogram_max = max;\n      this.currentHistogramMin = min;\n      this.currentHistogramMax = max;\n    },\n\n    calcWhiteBalanceGains() {\n      // const Gains = this.calculateWhiteBalanceGains(this.histogramData, this.ImageOffset);\n      const startTime = new Date();\n      const Gains = this.calculateWhiteBalanceGains();\n      const endTime = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 总时间: ' + (endTime.getTime() - startTime.getTime()) + ' ms', 'info');\n\n      this.ImageGainR = Gains.GainR;\n      this.ImageGainB = Gains.GainB;\n\n      const GainRIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ImageGainR');\n      if (GainRIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.MainCameraConfigItems[GainRIndex].value = this.ImageGainR;\n      } else {\n        console.error('ImageGainR configuration item not found.');\n      }\n\n      const GainBIndex = this.MainCameraConfigItems.findIndex(item => item.label === 'ImageGainB');\n      if (GainBIndex !== -1) { // 确保找到了对应的配置项\n        // 更新 ExpTime1 配置项的值\n        this.MainCameraConfigItems[GainBIndex].value = this.ImageGainB;\n      } else {\n        console.error('ImageGainB configuration item not found.');\n      }\n\n      this.drawImageData();\n      // this.processImage(this.ImageArrayBuffer);\n    },\n\n    // calculateWhiteBalanceGains(histogram, offset) {\n    //   let sumR = 0, sumG = 0, sumB = 0;\n    //   let countR = 0, countG = 0, countB = 0;\n\n    //   // for (let i = 0; i < 256; i++) {\n    //   //   sumR += histogram[2][i] * i;\n    //   //   sumG += histogram[1][i] * i;\n    //   //   sumB += histogram[0][i] * i;\n\n    //   //   countR += histogram[2][i];\n    //   //   countG += histogram[1][i];\n    //   //   countB += histogram[0][i];\n    //   // }\n\n    //   for (let i = 0; i < 256; i++) {\n    //     // Subtract offset from pixel value\n    //     const adjustedR = Math.max(i - offset, 0);\n    //     const adjustedG = Math.max(i - offset, 0);\n    //     const adjustedB = Math.max(i - offset, 0);\n\n    //     sumR += histogram[2][i] * adjustedR;\n    //     sumG += histogram[1][i] * adjustedG;\n    //     sumB += histogram[0][i] * adjustedB;\n\n    //     countR += histogram[2][i];\n    //     countG += histogram[1][i];\n    //     countB += histogram[0][i];\n    //   }\n\n    //   const meanR = sumR / countR;\n    //   const meanG = sumG / countG;\n    //   const meanB = sumB / countB;\n\n    //   // Calculate gains\n    //   const GainR = meanG / meanR;\n    //   const GainB = meanG / meanB;\n\n    //   console.log(`GainR: ${GainR}, GainB: ${GainB}`);\n    //   return { GainR, GainB };\n    // },\n\n    calculateWhiteBalanceGains() {\n      if (!(this.OriginalImage instanceof ImageData)) {\n        throw new Error('Invalid image data');\n      }\n\n      let time1 = new Date();\n      // 创建一个新的 cv.Mat 对象\n      let img8 = cv.matFromImageData(this.OriginalImage);\n      let time2 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 创建 cv.Mat 对象时间: ' + (time2.getTime() - time1.getTime()) + ' ms', 'info');\n\n      let gainR = this.ImageGainR;\n      let gainB = this.ImageGainB;\n      let offset = this.ImageOffset;\n\n      const channels = new cv.MatVector();\n      cv.split(img8, channels);\n      time1 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 分割通道时间: ' + (time1.getTime() - time2.getTime()) + ' ms', 'info');\n\n      const b = channels.get(0);\n      const g = channels.get(1);\n      const r = channels.get(2);\n      time2 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 获取通道时间: ' + (time2.getTime() - time1.getTime()) + ' ms', 'info');\n\n      // 自适应直方图均衡化\n      const clahe = new cv.CLAHE(2.0, new cv.Size(8, 8));\n      clahe.apply(b, b);\n      clahe.apply(g, g);\n      clahe.apply(r, r);\n      time1 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 自适应直方图均衡化时间: ' + (time1.getTime() - time2.getTime()) + ' ms', 'info');\n\n      // 使用中位数计算增益\n      const medianB = new cv.Mat();\n      const medianG = new cv.Mat();\n      const medianR = new cv.Mat();\n      cv.medianBlur(b, medianB, 5);\n      cv.medianBlur(g, medianG, 5);\n      cv.medianBlur(r, medianR, 5);\n      time2 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 中位数计算增益时间: ' + (time2.getTime() - time1.getTime()) + ' ms', 'info');\n\n      const avgB = cv.mean(medianB)[0];\n      const avgG = cv.mean(medianG)[0];\n      const avgR = cv.mean(medianR)[0];\n\n      time1 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 计算增益时间: ' + (time1.getTime() - time2.getTime()) + ' ms', 'info');\n\n      gainR = Math.min(Math.max(avgG / avgR, 0.1), 3);\n      gainB = Math.min(Math.max(avgG / avgB, 0.1), 3);\n\n      // 应用增益和偏置\n      r.convertTo(r, -1, gainR, offset);\n      b.convertTo(b, -1, gainB, offset);\n      g.convertTo(g, -1, 1, offset); // 对绿色通道应用偏置但不改变增益\n\n      time2 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 应用增益和偏置时间: ' + (time2.getTime() - time1.getTime()) + ' ms', 'info');\n\n      // 更新 channels 中的通道数据\n      channels.set(0, b);\n      channels.set(1, g);\n      channels.set(2, r);\n\n      time1 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 更新 channels 中的通道数据时间: ' + (time1.getTime() - time2.getTime()) + ' ms', 'info');\n\n      // 合并通道回 img8\n      cv.merge(channels, img8);\n\n      time2 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 合并通道时间: ' + (time2.getTime() - time1.getTime()) + ' ms', 'info');\n\n      b.delete();\n      g.delete();\n      r.delete();\n      medianB.delete();\n      medianG.delete();\n      medianR.delete();\n      channels.delete();\n\n      time1 = new Date();\n      this.SendConsoleLogMsg('calcWhiteBalanceGains | 删除通道时间: ' + (time1.getTime() - time2.getTime()) + ' ms', 'info');\n\n      // if (this.isPolarAxisMode) {\n      //   this.$bus.$emit('showSolveImage', img8);\n      // }\n      // else {\n      //   // 创建用于绘制的 ImageData 对象，并在修改后的画布上绘制图像\n      //   let colorData = new ImageData(new Uint8ClampedArray(img8.data), img8.cols, img8.rows);\n      //   img8.delete();\n      //   this.drawImgData = colorData;\n      //   this.drawImageData();\n\n      //   this.$bus.$emit('showCaptureImage');\n\n      //   this.MakeHistogram(colorData);\n      //   this.histogramImage = colorData;\n\n      // }\n      return { GainR: gainR, GainB: gainB };\n    },\n\n    loadOpenCv() {\n      return new Promise((resolve, reject) => {\n        if (typeof cv === 'undefined') {\n          // 如果 cv 未定义，尝试加载 OpenCV.js\n          const script = document.createElement('script');\n          script.src = '/opencv.js'; // 使用 public 文件夹中的路径\n          script.async = true;\n          script.onload = () => {\n            resolve();\n          };\n          script.onerror = (error) => {\n            reject(error);\n          };\n          document.head.appendChild(script);\n        } else {\n          // 如果 cv 已定义，直接解析\n          resolve();\n        }\n      });\n    },\n\n    // loadOpenCv() {\n    //   return new Promise((resolve, reject) => {\n    //     if (typeof cv === 'undefined') {\n    //       const script = document.createElement('script');\n    //       script.src = 'https://docs.opencv.org/4.5.5/opencv.js';\n    //       script.async = true;\n    //       script.onload = () => {\n    //         if (typeof cv !== 'undefined') {\n    //           resolve();\n    //         } else {\n    //           reject(new Error('Failed to load OpenCV.js'));\n    //         }\n    //       }\n    //       script.onerror = (error) => {\n    //         reject(error);\n    //       }\n    //       document.head.appendChild(script);\n    //     } else {\n    //       resolve();\n    //     }\n    //   });\n    // },\n\n    onCvReady() {\n\n      // Test if some of opencv method can work.\n      if (cv) {\n        console.log(\"QHYCCD | OpenCV.js is ready.\");\n        this.SendConsoleLogMsg('OpenCV.js is ready.', 'info');\n      } else {\n        console.log(\"QHYCCD | Failed to load OpenCV.js\");\n        this.SendConsoleLogMsg('Failed to load OpenCV.js.', 'error');\n      }\n\n      this.cvReady = true;\n    },\n\n\n    loadImageToCanvasMainCamera: function () {\n      const canvas = document.getElementById('mainCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n      image.src = BackgroundImage;\n    },\n    loadImageToCanvasGuiderCamera: function () {\n      const canvas = document.getElementById('guiderCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n      image.src = BackgroundImage;\n    },\n\n\n    showGuiderCameraCanvas() {\n      // 动态更新z-index\n      this.canvasZIndexStel = -10;\n      this.canvasZIndexMainCamera = -11;\n      this.canvasZIndexGuiderCamera = 0;\n      this.$bus.$emit('setParsingProgress', false);\n\n      // this.convertToGrayscale();\n    },\n\n    showStelCanvas() {\n      if (this.isPolarAxisMode) {\n        this.$bus.$emit('setParsingProgress', true);\n      } else {\n        this.$bus.$emit('setParsingProgress', false);\n      }\n      this.canvasZIndexStel = 0;\n      this.canvasZIndexMainCamera = -10;\n      this.canvasZIndexGuiderCamera = -11;\n    },\n\n    showMainCameraCanvas() {\n      this.canvasZIndexStel = -10;\n      this.canvasZIndexMainCamera = 0;\n      this.canvasZIndexGuiderCamera = -11;\n      this.$bus.$emit('setParsingProgress', false);\n    },\n\n\n    handleButtonTestClick() {\n      // this.changeOrder();\n      if (this.currentcanvas === 'Stel') {\n        this.currentcanvas = 'MainCamera';\n        this.showMainCameraCanvas();\n      }\n      else if (this.currentcanvas === 'MainCamera') {\n        this.currentcanvas = 'GuiderCamera';\n        this.showGuiderCameraCanvas();\n      }\n      else if (this.currentcanvas === 'GuiderCamera') {\n        this.currentcanvas = 'Stel';\n        this.showStelCanvas();\n      }\n    },\n\n    getPluginsMenuItems: function () {\n      let res = []\n      for (const i in this.$stellariumWebPlugins()) {\n        const plugin = this.$stellariumWebPlugins()[i]\n        if (plugin.menuItems) {\n          res = res.concat(plugin.menuItems)\n        }\n      }\n      return res\n    },\n    getPluginsMenuComponents: function () {\n      let res = []\n      for (const i in this.$stellariumWebPlugins()) {\n        const plugin = this.$stellariumWebPlugins()[i]\n        if (plugin.menuComponents) {\n          res = res.concat(plugin.menuComponents)\n        }\n      }\n      return res\n    },\n    toggleStoreValue: function (storeVarName) {\n      this.nav = false;\n      this.$store.commit('toggleBool', storeVarName)\n    },\n    getStoreValue: function (storeVarName) {\n      return _.get(this.$store.state, storeVarName)\n    },\n    setStateFromQueryArgs: function () {\n      // Check whether the observing panel must be displayed\n      this.$store.commit('setValue', { varName: 'showSidePanel', newValue: this.$route.path.startsWith('/p/') })\n\n      // Set the core's state from URL query arguments such\n      // as date, location, view direction & fov\n      let that = this\n\n      if (!this.initDone) {\n        this.$stel.core.time_speed = 1\n        let d = new Date()\n        if (this.$route.query.date) {\n          d = new Moment(this.$route.query.date).toDate()\n          this.$stel.core.observer.utc = d.getMJD()\n          this.startTimeIsSet = true\n        }\n\n        if (this.$route.query.lng && this.$route.query.lat) {\n          const pos = { lat: Number(this.$route.query.lat), lng: Number(this.$route.query.lng), alt: this.$route.query.elev ? Number(this.$route.query.elev) : 0, accuracy: 1 }\n          swh.geoCodePosition(pos, that).then((loc) => {\n            that.$store.commit('setCurrentLocation', loc)\n          }, (error) => { console.log(error) })\n        }\n\n        this.$stel.core.observer.yaw = this.$route.query.az ? Number(this.$route.query.az) * Math.PI / 180 : 0\n        this.$stel.core.observer.pitch = this.$route.query.alt ? Number(this.$route.query.alt) * Math.PI / 180 : 30 * Math.PI / 180\n        this.$stel.core.fov = this.$route.query.fov ? Number(this.$route.query.fov) * Math.PI / 180 : 120 * Math.PI / 180\n\n        this.initDone = true\n      }\n\n      if (this.$route.path.startsWith('/skysource/')) {\n        const name = decodeURIComponent(this.$route.path.substring(11))\n        console.log('Will select object: ' + name)\n        this.SendConsoleLogMsg('Will select object: ' + name, 'info');\n        return swh.lookupSkySourceByName(name).then(ss => {\n          if (!ss) {\n            return\n          }\n          let obj = swh.skySource2SweObj(ss)\n          if (!obj) {\n            obj = this.$stel.createObj(ss.model, ss)\n            this.$selectionLayer.add(obj)\n          }\n          if (!obj) {\n            console.warning(\"Can't find object in SWE: \" + ss.names[0])\n          }\n          swh.setSweObjAsSelection(obj)\n        }, err => {\n          console.log(err)\n          console.log(\"Couldn't find skysource for name: \" + name)\n          this.SendConsoleLogMsg(\"Couldn't find skysource for name: \" + name, 'error');\n        })\n      }\n    },\n\n    lookatcircle() {\n      // glStel.core.selection = glTestCircle;\n      glStel.pointAndLock(glTestCircle);\n    },\n\n    setGloabalStel: function (stel) {\n      return stel;\n    },\n\n    setGlobalLayer: function (stel) {\n      return stel.createLayer({ id: 'testLayerStars', z: 7, visible: true });\n    },\n\n    vec3_from_sphe: function (ra_degree, dec_degree, out) {\n      const cp = Math.cos(dec_degree * Math.PI / 180);\n      out[0] = Math.cos(ra_degree * Math.PI / 180) * cp;\n      out[1] = Math.sin(ra_degree * Math.PI / 180) * cp;\n      out[2] = Math.sin(dec_degree * Math.PI / 180);\n    },\n\n    testAddCircle: function (stel, layer) {\n      console.log(\"Add a circle star near polaris\");\n\n      let circle = stel.createObj('circle', { id: 'my circle  ', model_data: {} });\n\n      circle.update();\n      layer.add(circle);\n\n      // Select\n      stel.core.selection = circle;\n      stel.pointAndLock(circle);\n\n      // Circle Property\n      let mm = circle.pos;\n      this.vec3_from_sphe(2.52971, 89.2641, mm);\n      circle.pos = mm;\n      console.log(\"circle pos:\" + mm);\n      circle.label = \"\";\n      circle.frame = 1;\n      circle.size = [0.05, 0.05];\n      circle.color = [0, 1, 0, 0.25];\n      circle.border_color = [0, 1, 0, 1];\n\n      return circle;\n    },\n\n    UpdateCirclePos(Ra_degree, Dec_degree) {\n      let mm = glTestCircle.pos;\n      this.vec3_from_sphe(Ra_degree, Dec_degree, mm);\n      glTestCircle.pos = mm;\n    },\n\n    UpdateTelescopeStatus(status) {\n      this.$bus.$emit('MountStatus', status);\n      if (status === 'Slewing') {\n        glTestCircle.color = [1, 0, 0, 0.25];\n        glTestCircle.border_color = [1, 0, 0, 1];\n      }\n      else {\n        glTestCircle.color = [0, 1, 0, 0.25];\n        glTestCircle.border_color = [0, 1, 0, 1];\n      }\n    },\n\n    UpdateMainCameraStatus(status) {\n      this.$bus.$emit('MainCameraStatus', status);\n      if (status === 'Exposuring') {\n\n      }\n      else {\n\n      }\n    },\n\n    UpdateMainCameraTemperature(value) {\n      // console.log('Main Camera Temperature:', value + '°');\n      this.$bus.$emit('MainCameraTemperature', value);\n    },\n\n    setPolarPointAltitude(Altitude) {\n      this.PolarPoint_Altitude = Altitude;\n      console.log('Polar Point Altitude:', this.PolarPoint_Altitude);\n      this.SendConsoleLogMsg('Polar Point Altitude:' + this.PolarPoint_Altitude, 'info');\n    },\n\n    AddMarkCircle: function (stel, layer, frame, label) {\n      let circle = stel.createObj('circle', { id: 'my circle  ', model_data: {} });\n\n      circle.update();\n      layer.add(circle);\n\n      // Select\n      stel.core.selection = circle;\n      stel.pointAndLock(circle);\n\n      // Circle Property\n      let mm = circle.pos;\n      this.vec3_from_sphe(2.52971, 89.2641, mm);\n      circle.pos = mm;\n      circle.label = label;\n      circle.frame = frame;\n      circle.size = [0.04, 0.04];\n      circle.color = [1, 1, 1, 0.5];\n      circle.border_color = [1, 1, 1, 1];\n\n      return circle;\n    },\n\n    AddMarkRectangle: function (stel, layer, RaDec) {\n      let line = stel.createObj('geojson', {\n        data: {\n          \"type\": \"FeatureCollection\",\n          \"features\": [\n            {\n              \"type\": \"Feature\",\n              \"properties\": {\n                \"stroke\": \"#FFFFFF\",\n                \"stroke-opacity\": 1,\n                \"fill\": \"#1E90FF\",\n                \"fill-opacity\": 0.25\n              },\n              \"geometry\": {\n                \"type\": \"Polygon\",\n                \"coordinates\": [\n                  [\n                    // [139.76, 35.52], [139.32, 33.41], [140.92, 33.08], [141.35, 35.19], [139.76, 35.52]\n                    [parseFloat(RaDec[0].Ra), parseFloat(RaDec[0].Dec)], [parseFloat(RaDec[1].Ra), parseFloat(RaDec[1].Dec)],\n                    [parseFloat(RaDec[2].Ra), parseFloat(RaDec[2].Dec)], [parseFloat(RaDec[3].Ra), parseFloat(RaDec[3].Dec)],\n                    [parseFloat(RaDec[0].Ra), parseFloat(RaDec[0].Dec)]\n                  ]\n                ]\n              }\n            },\n          ]\n        }\n      });\n\n      line.update();\n      layer.add(line);\n\n      return line;\n    },\n\n    getCiecleAzAlt(Circle) {\n      let obs = this.$stel.core.observer;\n      let cirs = this.$stel.convertFrame(obs, 'ICRF', 'CIRS', Circle.getInfo('radec'));\n      let observed = this.$stel.convertFrame(obs, 'CIRS', 'OBSERVED', cirs);\n      // const azalt = this.$stel.c2s(this.$stel.convertFrame(this.$stel.core.observer, 'ICRF', 'OBSERVED', obj.getInfo('radec')))\n      let azalt = this.$stel.c2s(observed);\n      let az = this.$stel.anp(azalt[0]);\n      let alt = this.$stel.anp(azalt[1]);\n\n      const az_raf = this.$stel.a2af(az, 1);\n      const Az_degree = (az_raf.degrees < 0 ? az_raf.degrees + 180 : az_raf.degrees) + az_raf.arcminutes / 60 + az_raf.arcseconds / 3600;\n\n      const alt_raf = this.$stel.a2af(alt, 1);\n      const Alt_degree = alt_raf.degrees + alt_raf.arcminutes / 60 + alt_raf.arcseconds / 3600;\n\n      console.log('AzAlt:', Az_degree, Alt_degree);\n\n      return { Az_degree, Alt_degree };\n    },\n\n    SolveResultMark(RaDegree, DecDegree, Azimuth, Altitude) {\n      let MarkCircle_RaDec = this.AddMarkCircle(this.$stel, glLayer, 1, \"RaDec\");\n      let mm = MarkCircle_RaDec.pos;\n      this.vec3_from_sphe(RaDegree, DecDegree, mm);\n      MarkCircle_RaDec.pos = mm;\n      console.log(\"RaDec circle coordinates:\" + mm);\n\n      const AzAlt = this.getCiecleAzAlt(MarkCircle_RaDec);\n      glLayer.remove(MarkCircle_RaDec);\n\n      this.MarkCircleNum++;\n      let Label = \"AzAlt_Vue_\" + this.MarkCircleNum;\n\n      let MarkCircle_AltAz = this.AddMarkCircle(this.$stel, glLayer, 4, Label);\n      mm = MarkCircle_AltAz.pos;\n      this.vec3_from_sphe(AzAlt.Az_degree, AzAlt.Alt_degree, mm);\n      MarkCircle_AltAz.pos = mm;\n      console.log(\"AzAlt_Vue circle coordinates:\" + mm);\n\n      console.log(\"AzAlt_Vue circle x:\" + mm[0]);\n      console.log(\"AzAlt_Vue circle y:\" + mm[1]);\n      console.log(\"AzAlt_Vue circle z:\" + mm[2]);\n\n      this.LastPoint_AzAlt = this.getCiecleAzAlt(MarkCircle_AltAz);\n\n      this.CalculationPolarPoint(mm);\n\n      // 将创建的圆存储到数组中\n      // this.Circles.push(MarkCircle_RaDec);\n      this.Circles.push(MarkCircle_AltAz);\n\n    },\n\n    RemoveAllCircles() {\n      this.Circles.forEach(circle => {\n        glLayer.remove(circle);\n      });\n      this.Circles = [];\n    },\n\n    SolveResultMark_RealTime(RaDegree, DecDegree, Azimuth, Altitude) {\n      this.LastCircle_RaDec = this.AddMarkCircle(this.$stel, glLayer, 1, \"RaDec\");\n      let mm = this.LastCircle_RaDec.pos;\n      this.vec3_from_sphe(RaDegree, DecDegree, mm);\n      this.LastCircle_RaDec.pos = mm;\n      console.log(\"RaDec circle coordinates:\" + mm);\n\n      const AzAlt = this.getCiecleAzAlt(this.LastCircle_RaDec);\n      glLayer.remove(this.LastCircle_RaDec);\n\n      if (this.LastCircle_AzAlt !== null && this.LastCircle_AzAlt !== undefined) {\n        glLayer.remove(this.LastCircle_AzAlt);\n      }\n      this.LastCircle_AzAlt = this.AddMarkCircle(this.$stel, glLayer, 4, 'Current');\n      mm = this.LastCircle_AzAlt.pos;\n      this.vec3_from_sphe(AzAlt.Az_degree, AzAlt.Alt_degree, mm);\n      this.LastCircle_AzAlt.pos = mm;\n      this.LastCircle_AzAlt.color = [0, 1, 1, 0.25];\n      console.log(\"AzAlt_Vue circle coordinates:\" + mm);\n\n      console.log(\"AzAlt_Vue circle x:\" + mm[0]);\n      console.log(\"AzAlt_Vue circle y:\" + mm[1]);\n      console.log(\"AzAlt_Vue circle z:\" + mm[2]);\n\n      this.Current_AzAlt = this.getCiecleAzAlt(this.LastCircle_AzAlt);\n      console.log(\"Current AzAlt:\", this.Current_AzAlt.Az_degree, this.Current_AzAlt.Alt_degree);\n      this.$bus.$emit('ShowCurrentAzAltText', this.Current_AzAlt.Az_degree, this.Current_AzAlt.Alt_degree);\n    },\n\n\n    CalculationPolarPoint(coordinate) {\n      this.CartesianList.push(coordinate);\n\n      if (this.CartesianList.length < 3) {\n        return;\n      }\n\n      this.$bus.$emit('HideSingleSolveBtn');\n\n      // 获取三个点的坐标\n      const p1 = this.CartesianList[0];\n      const p2 = this.CartesianList[1];\n      const p3 = this.CartesianList[2];\n\n      // 计算两个向量\n      const v1 = [\n        p2[0] - p1[0],\n        p2[1] - p1[1],\n        p2[2] - p1[2]\n      ];\n\n      const v2 = [\n        p3[0] - p1[0],\n        p3[1] - p1[1],\n        p3[2] - p1[2]\n      ];\n\n      // 计算法向量\n      const normal = [\n        v1[1] * v2[2] - v1[2] * v2[1],\n        v1[2] * v2[0] - v1[0] * v2[2],\n        v1[0] * v2[1] - v1[1] * v2[0]\n      ];\n\n      // 计算法向量的长度\n      const normalLength = Math.sqrt(normal[0] ** 2 + normal[1] ** 2 + normal[2] ** 2);\n\n      // 归一化法向量\n      const unitNormal = [\n        normal[0] / normalLength,\n        normal[1] / normalLength,\n        normal[2] / normalLength\n      ];\n\n      // 假设球的半径为r，圆心为(0, 0, 0)\n      const r = 1; // 根据你的实际情况调整\n\n      // 计算与球面的交点\n      const intersection1 = [\n        unitNormal[0] * r,\n        unitNormal[1] * r,\n        unitNormal[2] * r\n      ];\n\n      const intersection2 = [\n        -unitNormal[0] * r,\n        -unitNormal[1] * r,\n        -unitNormal[2] * r\n      ];\n\n      console.log('Intersection Points:', intersection1, intersection2);\n\n      // 选择离(0,0,1)更近的交点\n      const closerIntersection = intersection1[2] > 0 ? intersection1 : intersection2;\n\n      let MarkCircle_FakePolarPoint = this.AddMarkCircle(this.$stel, glLayer, 4, \"FakePolarPoint\");\n      let mm = MarkCircle_FakePolarPoint.pos;\n      mm[0] = closerIntersection[0];\n      mm[1] = closerIntersection[1];\n      mm[2] = closerIntersection[2];\n      MarkCircle_FakePolarPoint.pos = mm;\n      console.log(\"FakePolarPoint circle coordinates:\" + mm);\n\n      const AzAlt_FakePolarPoint = this.getCiecleAzAlt(MarkCircle_FakePolarPoint);\n\n      console.log(\"Fake Polar Point AzAlt:\", AzAlt_FakePolarPoint.Az_degree, ',', AzAlt_FakePolarPoint.Alt_degree);\n\n      this.Circles.push(MarkCircle_FakePolarPoint);\n\n      let AzAlt_PolarPoint = {\n        Az_degree: 0,\n        Alt_degree: this.PolarPoint_Altitude\n      };\n\n      // console.log(\"Real Polar Point AzAlt:\", AzAlt_PolarPoint.Az_degree, ',', AzAlt_PolarPoint.Alt_degree);\n      this.SendConsoleLogMsg('Real Polar Point AzAlt:' + AzAlt_PolarPoint.Az_degree + ',' + AzAlt_PolarPoint.Alt_degree, 'info');\n      // console.log(\"Last Point AzAlt:\", this.LastPoint_AzAlt.Az_degree, this.LastPoint_AzAlt.Alt_degree);\n      this.SendConsoleLogMsg('Last Point AzAlt:' + this.LastPoint_AzAlt.Az_degree + ',' + this.LastPoint_AzAlt.Alt_degree, 'info');\n\n      ////////////////////////////////////////////////\n\n      // // 将球坐标转换为笛卡尔坐标\n      // let fakePolarPoint = this.sphericalToCartesian(AzAlt_FakePolarPoint.Az_degree, AzAlt_FakePolarPoint.Alt_degree);\n      // let polarPoint = this.sphericalToCartesian(AzAlt_PolarPoint.Az_degree, AzAlt_PolarPoint.Alt_degree);\n      // let lastPoint = this.sphericalToCartesian(this.LastPoint_AzAlt.Az_degree, this.LastPoint_AzAlt.Alt_degree);\n\n      // // 计算旋转四元数\n      // let quaternion = this.computeQuaternion(fakePolarPoint, polarPoint);\n\n      // // 应用旋转\n      // let fourthPoint = this.applyQuaternion(lastPoint, quaternion);\n\n      // // 将结果转换回球坐标\n      // let fourthPointAzAlt = this.cartesianToSpherical(fourthPoint);\n      // console.log(\"Fourth Point AzAlt:\", fourthPointAzAlt.Az_degree, ',', fourthPointAzAlt.Alt_degree);\n\n      ////////////////////////////////////////////////\n\n      // 计算角度差值，考虑角度的循环性质\n      function calculateAngleDifference(angle1, angle2) {\n        let difference = angle2 - angle1;\n        while (difference > 180) difference -= 360;\n        while (difference < -180) difference += 360;\n        return difference;\n      }\n\n      let azimuthDifference = calculateAngleDifference(AzAlt_FakePolarPoint.Az_degree, AzAlt_PolarPoint.Az_degree);\n      let altitudeDifference = AzAlt_PolarPoint.Alt_degree - AzAlt_FakePolarPoint.Alt_degree;\n\n      // 应用差值到LastPoint\n      let fourthPointAzAlt = {\n        Az_degree: this.LastPoint_AzAlt.Az_degree + azimuthDifference,\n        Alt_degree: this.LastPoint_AzAlt.Alt_degree + altitudeDifference\n      };\n\n      // 确保方位角在0到360度之间\n      fourthPointAzAlt.Az_degree = (fourthPointAzAlt.Az_degree + 360) % 360;\n\n      // 确保高度角在-90到90度之间\n      fourthPointAzAlt.Alt_degree = Math.max(Math.min(fourthPointAzAlt.Alt_degree, 90), -90);\n\n      console.log(\"Fourth Point AzAlt:\", fourthPointAzAlt.Az_degree, ',', fourthPointAzAlt.Alt_degree);\n\n      this.$bus.$emit('ShowAzAltText', azimuthDifference, altitudeDifference, fourthPointAzAlt.Az_degree, fourthPointAzAlt.Alt_degree);\n\n      ////////////////////////////////////////////////\n\n      // 将角度转换为弧度\n      function degreesToRadians(degrees) {\n        return degrees * Math.PI / 180;\n      }\n\n      // 将球坐标转换为笛卡尔坐标\n      function sphericalToCartesian(azimuth, altitude) {\n        let az = degreesToRadians(azimuth);\n        let alt = degreesToRadians(altitude);\n        let x = Math.cos(alt) * Math.cos(az);\n        let y = Math.cos(alt) * Math.sin(az);\n        let z = Math.sin(alt);\n        return { x: x, y: y, z: z };\n      }\n\n      // 将第四个点转换为笛卡尔坐标\n      let fourthPointCartesian = sphericalToCartesian(fourthPointAzAlt.Az_degree, fourthPointAzAlt.Alt_degree);\n      console.log(\"Fourth Point Cartesian:\", fourthPointCartesian.x, ',', fourthPointCartesian.y, ',', fourthPointCartesian.z);\n\n      let MarkCircle_fourthPoint = this.AddMarkCircle(this.$stel, glLayer, 4, \"Target Point\");\n      mm = MarkCircle_fourthPoint.pos;\n      mm[0] = fourthPointCartesian.x;\n      mm[1] = fourthPointCartesian.y;\n      mm[2] = fourthPointCartesian.z;\n      MarkCircle_fourthPoint.pos = mm;\n      MarkCircle_fourthPoint.color = [1, 0, 0, 0.25];\n\n      this.Circles.push(MarkCircle_fourthPoint);\n\n      // 清空列表，准备下次计算\n      this.CartesianList = [];\n      this.MarkCircleNum = 0;\n    },\n\n    // 将角度转换为弧度\n    degreesToRadians(degrees) {\n      return degrees * Math.PI / 180;\n    },\n\n    // 将球坐标转换为笛卡尔坐标\n    sphericalToCartesian(azimuth, altitude) {\n      let az = this.degreesToRadians(azimuth);\n      let alt = this.degreesToRadians(altitude);\n      let x = Math.cos(alt) * Math.cos(az);\n      let y = Math.cos(alt) * Math.sin(az);\n      let z = Math.sin(alt);\n      return { x: x, y: y, z: z };\n    },\n\n    // 计算旋转四元数\n    computeQuaternion(from, to) {\n      let w = from.x * to.x + from.y * to.y + from.z * to.z + 1;\n      let x = from.y * to.z - from.z * to.y;\n      let y = from.z * to.x - from.x * to.z;\n      let z = from.x * to.y - from.y * to.x;\n\n      let norm = Math.sqrt(w * w + x * x + y * y + z * z);\n      return { w: w / norm, x: x / norm, y: y / norm, z: z / norm };\n    },\n\n    // 应用四元数旋转\n    applyQuaternion(point, quat) {\n      let x = quat.w * quat.w * point.x + 2 * quat.y * quat.w * point.z - 2 * quat.z * quat.w * point.y + quat.x * quat.x * point.x + 2 * quat.y * quat.x * point.y + 2 * quat.z * quat.x * point.z - quat.z * quat.z * point.x - quat.y * quat.y * point.x;\n      let y = 2 * quat.x * quat.y * point.x + quat.y * quat.y * point.y + 2 * quat.z * quat.y * point.z + 2 * quat.w * quat.z * point.x - quat.z * quat.z * point.y + quat.w * quat.w * point.y - 2 * quat.x * quat.w * point.z - quat.x * quat.x * point.y;\n      let z = 2 * quat.x * quat.z * point.x + 2 * quat.y * quat.z * point.y + quat.z * quat.z * point.z - 2 * quat.w * quat.y * point.x - quat.y * quat.y * point.z + 2 * quat.w * quat.x * point.y - quat.x * quat.x * point.z + quat.w * quat.w * point.z;\n      return { x: x, y: y, z: z };\n    },\n\n    // 将笛卡尔坐标转换回球坐标\n    cartesianToSpherical(cartesian) {\n      let r = Math.sqrt(cartesian.x ** 2 + cartesian.y ** 2 + cartesian.z ** 2);\n      let azimuth = Math.atan2(cartesian.y, cartesian.x);\n      let altitude = Math.asin(cartesian.z / r);\n      return {\n        Az_degree: azimuth * 180 / Math.PI,\n        Alt_degree: altitude * 180 / Math.PI\n      };\n    },\n\n    SolveFovMark(RaDec) {\n      console.log('RaDec[4]:', RaDec);\n\n      let rectangle = this.AddMarkRectangle(this.$stel, glLayer, RaDec);\n\n      this.Circles.push(rectangle);\n\n    },\n\n    CalibratePolarAxis() {\n      this.$bus.$emit('CalibratePolarAxisMode');\n      // this.$bus.$emit('AppSendMessage', 'Vue_Command', 'StartLoopCapture');\n      this.nav = false;\n    },\n\n    RecalibratePolarAxis() {\n      // 清空列表，准备下次计算\n      this.CartesianList = [];\n      this.MarkCircleNum = 0;\n      this.RemoveAllCircles();\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ClearSloveResultList');\n    },\n\n    ShowConfirmDialog(Title, Text, ToDo) {\n      // window.location.reload();\n      this.nav = false;\n      this.$bus.$emit('ShowConfirmDialog', Title, Text, ToDo);\n    },\n\n    decrement(item) {\n      console.log('decrement:', item.value);\n      if (item.value > item.inputMin) {\n        item.value -= item.inputStep;\n      }\n    },\n\n    increment(item) {\n      console.log('increment:', item.value);\n      if (item.value < item.inputMax) {\n        item.value += item.inputStep;\n      }\n    },\n\n    PolarAxisMode(bool) {\n      this.isPolarAxisMode = bool;\n    },\n\n    handleGuiderCanvasClick(event) {\n      const canvas = this.$refs.guiderCanvas;\n      const rect = canvas.getBoundingClientRect();\n      const x = event.clientX - rect.left; // 点击坐标X\n      const y = event.clientY - rect.top;  // 点击坐标Y\n      console.log(`Clicked at: (${x}, ${y})`);\n      const CanvasWidth = window.innerWidth;\n      const CanvasHeight = window.innerHeight;\n      this.$bus.$emit('AppSendMessage', 'Vue_Command', 'GuiderCanvasClick:' + CanvasWidth + ':' + CanvasHeight + ':' + x + ':' + y);\n    },\n    connectDriver() {\n      this.isConnecting = true;\n      // this.isOpenDevicePage = false;\n      this.startLoading();\n      const DeviceType = this.CurrentDriverType;\n      for (const device of this.devices) {\n        if (device.driverType === DeviceType && device.isConnected == false) {\n          const DriverName = device.driverName;\n          if (DriverName == '') {\n            this.SendConsoleLogMsg('No driver selected', 'warning');\n            this.isConnecting = false;\n            return;\n          }\n          this.$bus.$emit('AppSendMessage', 'Vue_Command', 'ConnectDriver:' + DriverName + ':' + DeviceType);\n          this.SendConsoleLogMsg('Start Connecting driver:' + DeviceType + ' ' + DriverName, 'info');\n          return;\n        }\n      }\n    },\n    connectDriverSuccess(devicetype) {\n      console.log('connectDriverSuccess:', devicetype);\n      this.SendConsoleLogMsg(\"connectDriverSuccess:\" + devicetype, 'info');\n      this.isConnecting = false;\n      if (this.drawer_2 == true) {\n        this.drawer_2 = false\n      }\n\n      this.stopLoading();\n    },\n    connectDriverFailed(message) {\n      console.log('connectDriverFailed:', message);\n      this.SendConsoleLogMsg(\"connectDriverFailed:\" + message, 'error');\n      this.isConnecting = false;\n      this.stopLoading();\n    },\n    disconnectDriver() {\n      const DeviceType = this.CurrentDriverType;\n      for (const device of this.devices) {\n        if (device.driverType === DeviceType && device.isConnected) {\n          this.$bus.$emit('AppSendMessage', 'Vue_Command', 'DisconnectDevice:' + device.device + \":\" + DeviceType);\n        }\n      }\n    },\n    disconnectDriversuccess(devicetype) {\n      console.log('disconnectDevicesuccess:', devicetype);\n      this.drawer_2 = false\n      if (devicetype == \"all\") {\n        this.sendMessage('Vue_Command', 'disconnectAllDevice');\n        this.SendConsoleLogMsg('Disconnect All Device', 'info');\n        this.haveDeviceConnect = false;\n        this.$bus.$emit('MainCameraConnected', 0);\n        this.$bus.$emit('MountConnected', 0);\n        this.$bus.$emit('CFWConnected', 0);\n        this.$bus.$emit('GuiderConnected', 0);\n        this.claerDeviceList();\n        this.$bus.$emit('deleteDeviceTypeAllocationList', 'all');\n        return;\n      };\n\n      for (const device of this.devices) {\n        if (device.driverType === devicetype && device.isConnected) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n      for (const device of this.ToBeConnectDevice) {\n        if (device.driverType === devicetype) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n\n      this.$bus.$emit('deleteDeviceTypeAllocationList', devicetype);\n      if (devicetype == \"MainCamera\") {\n        this.$bus.$emit('MainCameraConnected', 0);\n      } else if (devicetype == \"Mount\") {\n        this.$bus.$emit('MountConnected', 0);\n      } else if (devicetype == \"CFW\") {\n        this.$bus.$emit('CFWConnected', 0);\n      } else if (devicetype == \"Guider\") {\n        this.$bus.$emit('GuiderConnected', 0);\n      }\n    },\n\n    disconnectDriverFail(devicetype) {\n      console.log('disconnectDeviceFail:', devicetype);\n      this.drawer_2 = false\n      if (devicetype == \"all\") {\n        this.sendMessage('Vue_Command', 'disconnectAllDevice');\n        this.SendConsoleLogMsg('Disconnect All Device', 'info');\n        this.haveDeviceConnect = false;\n        this.$bus.$emit('MainCameraConnected', 0);\n        this.$bus.$emit('MountConnected', 0);\n        this.$bus.$emit('CFWConnected', 0);\n        this.$bus.$emit('GuiderConnected', 0);\n        this.claerDeviceList();\n        this.$bus.$emit('deleteDeviceTypeAllocationList', 'all');\n        return;\n      };\n\n      for (const device of this.devices) {\n        if (device.driverType === devicetype && device.isConnected) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n      for (const device of this.ToBeConnectDevice) {\n        if (device.driverType === devicetype) {\n          device.isConnected = false;\n          device.isget = false;\n          device.device = device.driverName;\n        }\n      }\n\n      this.$bus.$emit('deleteDeviceTypeAllocationList', devicetype);\n      if (devicetype == \"MainCamera\") {\n        this.$bus.$emit('MainCameraConnected', 0);\n      } else if (devicetype == \"Mount\") {\n        this.$bus.$emit('MountConnected', 0);\n      } else if (devicetype == \"CFW\") {\n        this.$bus.$emit('CFWConnected', 0);\n      } else if (devicetype == \"Guider\") {\n        this.$bus.$emit('GuiderConnected', 0);\n      }\n    },\n    loadSelectedDriverList(deviceObject) {\n      console.log('loadSelectedDriverList:', deviceObject);\n      deviceObject.forEach(device => {\n        // 假设你想要打印每个设备对象的键值对\n        for (const [driverType, driverName] of Object.entries(device)) {\n          this.devices.forEach(device => {\n            if (device.driverType === driverType && device.isConnected == false) {\n              device.device = driverName;\n              device.driverName = driverName;\n            }\n          });\n        }\n      });\n    },\n    loadBindDeviceList(deviceObject) {\n      console.log('loadBindDeviceList:', deviceObject);\n      this.$bus.$emit('loadBindDeviceList', deviceObject);\n\n    },\n    loadBindDeviceTypeList(deviceTypeObject) {\n      console.log('loadBindDeviceTypeList:', deviceTypeObject);\n      this.$bus.$emit('loadBindDeviceTypeList', deviceTypeObject);\n      deviceTypeObject.forEach(deviceType => {\n        const { Type, DeviceName, DriverName, isbind } = deviceType;\n        this.updateDevicesConnect(Type, DeviceName, DriverName, isbind);\n      });\n    },\n    updateSelectedDriver(driverType) {\n\n      this.selectedDriver = null;\n      this.devices.forEach(device => {\n        if (device.driverType === driverType) {\n          this.selectedDriver = device.driverName\n        }\n      });\n      console.log('Current drivers:', this.selectedDriver);\n    },\n    startLoading() {\n      this.loadingDeviceSelection = true;\n    },\n    stopLoading() {\n      this.loadingDeviceSelection = false;\n    },\n    deleteDeviceAllocationList(deviceName) {\n      console.log('deleteDeviceAllocationList:', deviceName);\n      this.$bus.$emit('deleteDeviceAllocationList', deviceName);\n    },\n    UnBindingDevice(type, name, driverName) {\n      console.log('UnBindingDevice:', type, name, driverName);\n      this.updateDevicesConnect(type, name, driverName, false);\n    },\n\n    displayErrorImage() {\n      console.error(\"image is error, load errorImage.svg\");\n      const canvas = document.getElementById('mainCamera-canvas');\n      const ctx = canvas.getContext('2d');\n      const image = new Image();\n\n      image.onload = () => {\n        // 获取设备像素比\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // 调整画布尺寸以适应高清显示\n        canvas.width = image.width * devicePixelRatio;\n        canvas.height = image.height * devicePixelRatio;\n        ctx.scale(devicePixelRatio, devicePixelRatio); // 缩放ctx以适应高清画布\n\n        // 绘制图像\n        ctx.drawImage(image, 0, 0);\n      };\n\n      image.onerror = () => {\n        console.error(\"Failed to load image from \" + image.src);\n        // 可以在这里添加备用图像或其他错误处理逻辑\n      };\n\n      // 确保ErrorImage是有效的URL\n      image.src = ErrorImage; // 请替换为实际的图像路径\n    },\n    handleError(message, location, error = null) {\n      const errorMsg = error ? `${message} at ${location}: ${error}` : `${message} at ${location}`;\n      console.error(errorMsg);\n      this.SendConsoleLogMsg(errorMsg, 'error');\n      this.displayErrorImage(); // 显示错误图像\n    },\n    showSelectdisconnectDriver(drivername) {\n      this.showDisconnectDialog = true;\n      this.currentDisconnectDriverName = drivername;\n    },\n    confirmDisconnect() {\n      this.sendMessage('Vue_Command', 'disconnectSelectDriver:' + this.currentDisconnectDriverName);\n      this.showDisconnectDialog = false;\n    },\n\n    // 主画布点击事件\n    handleMainCanvasClick(event) {\n      // this.SendConsoleLogMsg('触发鼠标点击事件:', 'info');\n      if (!this.enableMainCanvasClick || this.isDragging || this.drawImgData == null) return; // 如果画布不可点击，则不处理点击事件\n      // console.log('触发鼠标点击事件:', event);\n      const canvas = this.$refs.mainCanvas;\n      if (!canvas) return; // 确保 canvas 元素存在\n      const rect = canvas.getBoundingClientRect();// 获取 canvas 元素的边界矩形\n      const x = event.clientX - rect.left;\n      const y = event.clientY - rect.top;\n      console.log('Mouse clicked at:', x, y);\n      if (!this.isFocusLoopShooting) {\n        this.ROI_x = (x / window.innerWidth * this.visibleWidth - this.RedBoxSideLength / 2) + this.visibleX - this.visibleWidth / 2;  // 计算ROI的x坐标\n        this.ROI_y = (y / window.innerHeight * this.visibleHeight - this.RedBoxSideLength / 2) + this.visibleY - this.visibleHeight / 2; // 计算ROI的y坐标\n        // this.$bus.$emit('setRedBoxPosition', x, y, this.ROI_x, this.ROI_y);\n      } else {\n        this.selectStarX = (x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2 - this.ROI_x; // 计算选择位置的x坐标\n        this.selectStarY = (y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2 - this.ROI_y; // 计算选择位置的y坐标\n\n        if (this.selectStarX >= 0 && this.selectStarX < this.RedBoxSideLength &&\n          this.selectStarY >= 0 && this.selectStarY < this.RedBoxSideLength) {\n          this.SendConsoleLogMsg('Select Star is in ROI', 'info');\n        } else {\n          this.SendConsoleLogMsg('Select Star is not in ROI', 'error');\n          this.selectStarX = -1;\n          this.selectStarY = -1;\n        }\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendSelectStars:' + this.selectStarX + ':' + this.selectStarY);\n      }\n      this.drawImageData();\n    },\n\n    // 主画布拖动\n    handleMouseDown(event) {\n      // this.SendConsoleLogMsg('触发鼠标按下事件:', 'info');\n      if (this.isDragging || this.drawImgData == null) return;\n      this.isDragging = true;\n      this.startX = event.clientX;\n      this.startY = event.clientY;\n      this.currentX = event.clientX;\n      this.currentY = event.clientY;\n\n      // 设置一个定时器，每100ms执行一次鼠标移动的逻辑\n      this.moveIntervalId = setInterval(() => {\n        if (!this.isDragging) return;\n\n        const dx = this.startX - this.currentX;\n        const dy = this.startY - this.currentY;\n        if (isNaN(dx) || isNaN(dy)) {\n          return;\n        }\n        let newVisibleX = this.visibleX + dx / window.innerWidth * this.visibleWidth;\n        let newVisibleY = this.visibleY + dy / window.innerHeight * this.visibleHeight;\n        if (newVisibleX < 0) {\n          newVisibleX = 0;\n        }\n        if (newVisibleY < 0) {\n          newVisibleY = 0;\n        }\n        if (newVisibleX > this.mainCameraSizeX) {\n          newVisibleX = this.mainCameraSizeX;\n        }\n        if (newVisibleY > this.mainCameraSizeY) {\n          newVisibleY = this.mainCameraSizeY;\n        }\n\n        this.visibleX = newVisibleX;\n        this.visibleY = newVisibleY;\n\n        this.startX = this.currentX;\n        this.startY = this.currentY;\n        this.drawImageData();\n        // this.SendConsoleLogMsg('拖动事件,拖动距离:' + dx + ',' + dy, 'info');\n      }, 100);\n    },\n    handleMouseMove(event) {\n      // this.SendConsoleLogMsg('触发鼠标移动事件:', 'info');\n      if (!this.isDragging) return;\n      this.currentX = event.clientX;\n      this.currentY = event.clientY;\n    },\n    handleMouseUp(event) {\n      // this.SendConsoleLogMsg('触发鼠标抬起事件:', 'info');\n      this.isDragging = false;\n\n      // 清除定时器\n      clearInterval(this.moveIntervalId);\n      this.moveIntervalId = null;\n    },\n    handleWheel(event) {\n      // this.SendConsoleLogMsg('触发鼠标滚轮事件:', 'info');\n      if (this.drawImgData == null) return;\n      const scaleChange = event.deltaY > 0 ? 0.1 : -0.1; // 根据滚轮的滚动方向，计算缩放比例的变化量\n      let newScale = this.scale + scaleChange; // 更新缩放比例\n      if (newScale < 0.1) {\n        newScale = 0.1;\n      }\n      if (newScale > 1) {\n        newScale = 1;\n      }\n\n      // 如果已经有一个待执行的缩放操作，则直接返回\n      if (this.pendingScaleChange) {\n        return;\n      }\n\n      // 标记有一个待执行的缩放操作\n      this.pendingScaleChange = true;\n\n      // 使用 requestAnimationFrame 来控制缩放操作的执行频率\n      requestAnimationFrame(() => {\n        if (newScale != this.scale) {\n          this.scale = newScale; // 更新缩放比例\n          this.$bus.$emit('setScale', this.scale);\n          this.drawImageData();\n          this.SendConsoleLogMsg('缩放比例变化,缩放比例:' + newScale, 'info');\n        } else {\n          this.SendConsoleLogMsg('缩放比例没有变化,缩放比例:' + this.scale, 'info');\n        }\n        this.pendingScaleChange = false; // 清除待执行的缩放操作标记\n      });\n    },\n\n    handleMainCanvasTouch(event) {\n      // this.SendConsoleLogMsg('触发触摸事件:', 'info');\n      if (!this.enableMainCanvasClick || this.isDragging || this.drawImgData == null) return; // 如果画布不可点击，则不处理点击事件\n      // console.log('触发触摸事件:', event);\n      if (!this.enableMainCanvasClick || !event.touches || event.touches.length === 0) return;\n      const canvas = this.$refs.mainCanvas;\n      if (!canvas) return; // 确保 canvas 元素存在\n      const touch = event.touches[0];\n      const rect = canvas.getBoundingClientRect();// 获取 canvas 元素的边界矩形\n      const x = touch.clientX - rect.left;\n      const y = touch.clientY - rect.top;\n      console.log('Touch at:', x, y);\n      event.preventDefault();// 阻止默认事件，如页面滚动\n      if (!this.isFocusLoopShooting) {\n        this.ROI_x = (x / window.innerWidth * this.visibleWidth - this.RedBoxSideLength / 2) + this.visibleX - this.visibleWidth / 2 - this.ROI_x;  // 计算ROI的x坐标\n        this.ROI_y = (y / window.innerHeight * this.visibleHeight - this.RedBoxSideLength / 2) + this.visibleY - this.visibleHeight / 2 - this.ROI_y; // 计算ROI的y坐标\n        // this.$bus.$emit('setRedBoxPosition', x, y, this.ROI_x, this.ROI_y);\n      } else {\n        this.selectStarX = (x / window.innerWidth * this.visibleWidth) + this.visibleX - this.visibleWidth / 2 - this.ROI_x; // 计算选择位置的x坐标\n        this.selectStarY = (y / window.innerHeight * this.visibleHeight) + this.visibleY - this.visibleHeight / 2 - this.ROI_y; // 计算选择位置的y坐标\n\n        if (this.selectStarX >= 0 && this.selectStarX < this.RedBoxSideLength &&\n          this.selectStarY >= 0 && this.selectStarY < this.RedBoxSideLength) {\n          this.SendConsoleLogMsg('Select Star is in ROI', 'info');\n        } else {\n          this.SendConsoleLogMsg('Select Star is not in ROI', 'error');\n          this.selectStarX = -1;\n          this.selectStarY = -1;\n        }\n        this.$bus.$emit('AppSendMessage', 'Vue_Command', 'sendSelectStars:' + this.selectStarX + ':' + this.selectStarY);\n      }\n      this.drawImageData();\n    },\n    handleTouchStart(event) {\n      if (this.drawImgData == null) return;\n      // this.SendConsoleLogMsg('触发触摸开始事件:', 'info');\n      if (event.touches.length === 1) { // 单指触摸，开始拖动\n        this.isOneTouch = true;\n        // this.SendConsoleLogMsg('触发单指触摸事件', 'info');\n        this.isDragging = true;\n        this.startTouchX[0] = event.touches[0].clientX;\n        this.startTouchY[0] = event.touches[0].clientY;\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        // 清除可能存在的双指触摸的定时器\n        if (this.zoomIntervalId) {\n          clearInterval(this.zoomIntervalId);\n          this.zoomIntervalId = null;\n        }\n\n\n        this.handleMainCanvasTouch(event);\n      } else if (event.touches.length >= 2) { // 双指触摸，开始缩放\n        this.isOneTouch = false;\n        // this.SendConsoleLogMsg('触发双指触摸事件', 'info');\n        this.isDragging = true;\n        // 计算两个触摸点之间的距离\n        const dx = this.currentTouchX[0] - this.currentTouchX[1];\n        const dy = this.currentTouchY[0] - this.currentTouchY[1];\n        this.startTouchDistance = Math.sqrt(dx * dx + dy * dy);\n        // 清除可能存在的单指触摸的定时器\n        if (this.moveIntervalId) {\n          clearInterval(this.moveIntervalId);\n          this.moveIntervalId = null;\n        }\n\n\n      } else {\n        // this.SendConsoleLogMsg('触发多指触摸事件，获取当前触摸点数量:' + event.touches.length, 'info');\n      }\n      \n    },\n\n    handleTouchMove(event) {\n      // this.SendConsoleLogMsg('触发触摸移动事件:', 'info');\n      if (!this.isDragging || this.drawImgData == null) return;\n      if (event.touches.length == 1) {\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        if (this.zoomIntervalId) {\n          clearInterval(this.zoomIntervalId);\n          this.zoomIntervalId = null;\n        }\n        if (this.moveIntervalId != null) {\n          return;\n        }\n        // 设置一个定时器，每100ms执行一次触摸移动的逻辑\n        this.moveIntervalId = setInterval(() => {\n          // console.log('执行触摸移动!');\n          if (!this.isDragging || !this.isOneTouch) return;\n\n          const dx = this.startTouchX[0] - this.currentTouchX[0];\n          const dy = this.startTouchY[0] - this.currentTouchY[0];\n          if (isNaN(dx) || isNaN(dy)) {\n            return;\n          }\n          if (dx == 0 && dy == 0) {\n            return;\n          }\n\n          let newVisibleX = this.visibleX + dx / window.innerWidth * this.visibleWidth;\n          let newVisibleY = this.visibleY + dy / window.innerHeight * this.visibleHeight;\n          if (newVisibleX < 0) {\n            newVisibleX = 0;\n          }\n          if (newVisibleY < 0) {\n            newVisibleY = 0;\n          }\n          if (newVisibleX > this.mainCameraSizeX) {\n            newVisibleX = this.mainCameraSizeX;\n          }\n          if (newVisibleY > this.mainCameraSizeY) {\n            newVisibleY = this.mainCameraSizeY;\n          }\n\n          this.visibleX = newVisibleX;\n          this.visibleY = newVisibleY;\n\n          this.startTouchX[0] = this.currentTouchX[0];\n          this.startTouchY[0] = this.currentTouchY[0];\n\n          this.drawImageData();\n        }, 100);\n\n      } else if (event.touches.length >= 2) {\n        this.currentTouchX[0] = event.touches[0].clientX;\n        this.currentTouchY[0] = event.touches[0].clientY;\n        this.currentTouchX[1] = event.touches[1].clientX;\n        this.currentTouchY[1] = event.touches[1].clientY;\n\n        // 清除可能存在的单指触摸的定时器\n        if (this.moveIntervalId) {\n          clearInterval(this.moveIntervalId);\n          this.moveIntervalId = null;\n        }\n        if (this.zoomIntervalId != null) {\n          return;\n        }\n        // 设置一个定时器，每100ms执行一次缩放逻辑\n        this.zoomIntervalId = setInterval(() => {\n          if (!this.isDragging || !this.isOneTouch) return;\n          const dx = this.currentTouchX[0] - this.currentTouchX[1];\n          const dy = this.currentTouchY[0] - this.currentTouchY[1];\n          const distance = Math.sqrt(dx * dx + dy * dy);\n          this.SendConsoleLogMsg('距离变化 distance:' + distance, 'info');\n          if (this.startTouchDistance == 0) {\n            this.startTouchDistance = distance;\n          }\n          // 计算缩放比例的变化量\n          const scaleChange = distance / this.startTouchDistance;\n          this.SendConsoleLogMsg('距离变化比例 scaleChange:' + scaleChange, 'info');\n          let newScale = this.scale * scaleChange; // 更新缩放比例\n          if (newScale < 0.1) {\n            newScale = 0.1;\n          }\n          if (newScale > 1) {\n            newScale = 1;\n          }\n          if (newScale != this.scale) {\n            this.SendConsoleLogMsg('缩放比例变化,缩放比例:' + newScale, 'info');\n            this.scale = newScale; // 更新缩放比例\n            this.$bus.$emit('setScale', this.scale);\n            this.drawImageData();\n          } else {\n            this.SendConsoleLogMsg('缩放比例没有变化,缩放比例:' + this.scale, 'info');\n          }\n          this.startTouchDistance = distance; // 更新两个触摸点之间的距离\n        }, 100);\n      } else {\n        this.SendConsoleLogMsg('触发多指触摸事件，获取当前触摸点数量:' + event.touches.length, 'info');\n      }\n    },\n\n    handleTouchEnd(event) {\n      // this.SendConsoleLogMsg('触发触摸结束事件:', 'info');\n      this.isDragging = false; // 停止拖动\n      // 清除定时器\n      if (this.moveIntervalId) {\n        clearInterval(this.moveIntervalId);\n        this.moveIntervalId = null;\n      }\n      if (this.zoomIntervalId) {\n        clearInterval(this.zoomIntervalId);\n        this.zoomIntervalId = null;\n      }\n    },\n\n    ScaleChange(type) {\n      if (this.drawImgData == null) return;\n      if (type == '+') {\n        this.scale -= 0.1;\n      } else if (type == '-') {\n        this.scale += 0.1;\n      }\n      if (this.scale < 0.1) {\n        this.scale = 0.1;\n      }\n      if (this.scale > 1) {\n        this.scale = 1;\n      }\n      this.$bus.$emit('setScale', this.scale);\n      this.drawImageData();\n    },\n\n    // 显示ROI图像\n    showRoiImage(fileName, destX, destY) {\n      if (this.RedBoxSideLength == 0 || this.RedBoxSideLength == null) {\n        this.SendConsoleLogMsg('RedBoxSideLength is 0 or null', 'error');\n        return;\n      }\n      if (this.isProcessingImage) {\n        this.SendConsoleLogMsg('Image is being transmitted, current processing is slow, skipping one frame.', 'warning');\n        return;\n      }\n      this.isProcessingImage = true;\n      const imagePath = 'img/' + fileName;\n      // 创建一个AbortController实例来取消fetch请求\n      const fetchController = new AbortController();\n      const fetchSignal = fetchController.signal;\n\n      // 使用 fetch API 获取二进制数据\n      fetch(imagePath, { cache: 'no-store', signal: fetchSignal })\n        .then(response => response.arrayBuffer())\n        .then(buffer => {\n          let src, originalImg8, imgData, awbImg;\n          try {\n            const uint16Array = new Uint16Array(buffer);\n            // 创建一个空的 Mat 对象\n            src = new cv.Mat(this.RedBoxSideLength, this.RedBoxSideLength, cv.CV_16UC1);\n            src.data16U.set(uint16Array);\n            cv.cvtColor(src, src, this.lastImageProcessParams.cvmode);\n            originalImg8 = this.Bit16To8_Stretch(src, this.lastImageProcessParams.B, this.lastImageProcessParams.W);\n\n            src.delete(); // 释放原始的 Mat 对象\n            src = null; // 添加这行代码，确保 src 对象被清理\n\n            awbImg = this.ImageSoftAWB(originalImg8, this.lastImageProcessParams.gainR, this.lastImageProcessParams.gainB, this.lastImageProcessParams.offset);\n            originalImg8.delete(); // 释放 Mat 对象\n            originalImg8 = null; // 添加这行代码，确保 originalImg8 对象被清理\n\n            // 将 Mat 对象转换回 ImageData 对象\n            imgData = new ImageData(new Uint8ClampedArray(awbImg.data), awbImg.cols, awbImg.rows);\n            awbImg.delete(); // 释放 Mat 对象\n            awbImg = null; // 添加这行代码，确保 awbImg 对象被清理\n            // 在指定位置开始绘制图像\n            this.bufferCtx.clearRect(this.ROI_x, this.ROI_y, this.RedBoxSideLength, this.RedBoxSideLength);\n            this.bufferCtx.putImageData(imgData, this.ROI_x, this.ROI_y);\n            // this.SendConsoleLogMsg('绘制一次ROI数据:' + fileName + ':' + this.ROI_x + ':' + this.ROI_y, 'info');\n            this.drawImageData();\n            this.focuserPictureFileName = fileName;\n\n          } catch (error) {\n            console.error(`处理图像失败: ${imagePath}`, error);\n          } finally {\n            // 确保 Mat 对象和 ImageData 对象被删除\n            if (src && !src.isDeleted()) {\n              src.delete();\n              src = null; // 添加这行代码，确保 src 对象被清理\n            }\n            if (originalImg8 && !originalImg8.isDeleted()) {\n              originalImg8.delete();\n              originalImg8 = null; // 添加这行代码，确保 originalImg8 对象被清理\n            }\n            if (awbImg && !awbImg.isDeleted()) {\n              awbImg.delete();\n              awbImg = null; // 添加这行代码，确保 awbImg 对象被清理\n            }\n            // 确保 buffer 被清理\n            buffer = null;\n            this.isProcessingImage = false;\n          }\n        })\n        .catch(error => {\n          if (error.name === 'AbortError') {\n            console.log('Fetch request cancelled');\n          } else {\n            console.error(`获取图像失败: ${imagePath}`, error);\n          }\n          this.isProcessingImage = false;\n        });\n\n      // 在组件卸载时取消 fetch 请求\n      this.$once('hook:beforeDestroy', () => {\n        fetchController.abort();\n      });\n    },\n    setRedBoxState(length, x, y) {\n      this.SendConsoleLogMsg('setRedBoxState:' + length + ',' + x + ',' + y, 'info');\n      this.$bus.$emit('setRedBoxPosition', x, y);\n      this.$bus.$emit('setRedBoxSideLength', length);\n    },\n    setFocuserState(state) {\n      if (state === 'selectstars') {\n        this.isFocusLoopShooting = true;\n      } else {\n        this.isFocusLoopShooting = false;\n      }\n    },\n    setShowSelectStar(state) {\n      this.showSelectStar = state;\n    },\n    RedBoxSizeChange(length) {\n      this.RedBoxSideLength = parseInt(length);\n    },\n    setMainCameraParameters(parameters) {\n      for (const parameter in parameters) {\n        const item = this.MainCameraConfigItems.find(item => item.label === parameter);\n        if (item) {\n          item.value = parameters[parameter];\n        } else {\n          if (parameter == 'RedBoxSize') {\n            this.$bus.$emit('setRedBoxSideLength', parameters[parameter]);\n          } else {\n            console.error(`未找到参数：${parameter}`);\n          }\n        }\n      }\n      this.confirmConfiguration(this.MainCameraConfigItems);\n    },\n  },\n  computed: {\n    nav: {\n      get: function () {\n        console.log('nav:', this.$store.state.showNavigationDrawer);\n        return this.$store.state.showNavigationDrawer\n      },\n      set: function (v) {\n        if (this.$store.state.showNavigationDrawer !== v) {\n          console.log('nav:', this.$store.state.showNavigationDrawer);\n          this.$store.commit('toggleBool', 'showNavigationDrawer')\n        }\n      }\n    },\n    storeCurrentLocation: function () {\n      return this.$store.state.currentLocation\n    },\n    getQTClientVersionColor() {\n      if (this.QTClientVersion === 'Not connected') {\n        return 'rgba(255, 0, 0, 0.5)'; // 红色，透明度 0.5\n      } else {\n        return 'rgba(255, 255, 255, 0.5)'; // 默认白色，透明度 0.5\n      }\n    },\n\n  },\n  watch: {\n    storeCurrentLocation: function (loc) {\n      const DD2R = Math.PI / 180\n      this.$stel.core.observer.latitude = loc.lat * DD2R\n      this.$stel.core.observer.longitude = loc.lng * DD2R\n      this.$stel.core.observer.elevation = loc.alt\n\n      // At startup, we need to wait for the location to be set before deciding which\n      // startup time to set so that it's night time.\n      if (!this.startTimeIsSet) {\n        this.$stel.core.observer.utc = swh.getTimeAfterSunset(this.$stel)\n        this.startTimeIsSet = true\n      }\n      // Init of time and date is complete\n      this.$store.commit('setValue', { varName: 'initComplete', newValue: true })\n    },\n    $route: function () {\n      // react to route changes...\n      this.setStateFromQueryArgs()\n    },\n    CurrentDriverType(newVal) {\n      // 当 CurrentDriverType 变化时，更新 selectedDriver\n      this.updateSelectedDriver(newVal);\n    }\n  },\n  mounted: function () {\n    let that = this\n\n    this.getLocationHostName();\n\n    this.loadImageToCanvasMainCamera();\n    this.loadImageToCanvasGuiderCamera();\n\n    this.initCanvas();\n    this.addEventListeners();\n\n    for (const i in this.$stellariumWebPlugins()) {\n      const plugin = this.$stellariumWebPlugins()[i]\n      if (plugin.onAppMounted) {\n        plugin.onAppMounted(that)\n      }\n    }\n\n    this.connect();\n    this.setupNetworkStatusListener();\n\n    // 使用 Promise 检查 OpenCV.js 是否加载完成\n    this.loadOpenCv().then(() => {\n      if (!this._isDestroyed) { // 检查组件是否已销毁\n        console.log('OpenCV.js is ready');\n        this.onCvReady();  // 调用 OpenCV 准备好的回调\n      }\n    }).catch(error => {\n      console.error('Error loading OpenCV.js:', error);\n    });\n\n    // const script = document.createElement('script');\n    // script.src = 'https://docs.opencv.org/4.5.5/opencv.js';\n    // script.async = true;\n    // script.onload = () => this.onCvReady();\n    // document.head.appendChild(script);\n\n    import('@/assets/js/stellarium-web-engine.wasm').then(f => {\n      if (!this._isDestroyed) { // 再次检查组件是否已销毁\n        // Initialize the StelWebEngine viewer singleton\n        // After this call, the StelWebEngine state will always be available in vuex store\n        // in the $store.stel object in a reactive way (useful for vue components).\n        // To modify the state of the StelWebEngine, it's enough to call/set values directly on the $stel object\n        try {\n          swh.initStelWebEngine(that.$store, f.default, that.$refs.stelCanvas, function () {\n            // Start auto location detection (even if we don't use it)\n            swh.getGeolocation().then(p => swh.geoCodePosition(p, that)).then((loc) => {\n              that.$store.commit('setAutoDetectedLocation', loc)\n            }, (error) => { console.log(error) })\n\n            that.$stel.setFont('regular', process.env.BASE_URL + 'fonts/Roboto-Regular.ttf', 1.38)\n            that.$stel.setFont('bold', process.env.BASE_URL + 'fonts/Roboto-Bold.ttf', 1.38)\n            that.$stel.core.constellations.show_only_pointed = false\n\n            that.setStateFromQueryArgs()\n            that.guiComponent = 'Gui'\n            for (const i in that.$stellariumWebPlugins()) {\n              const plugin = that.$stellariumWebPlugins()[i]\n              if (plugin.onEngineReady) {\n                plugin.onEngineReady(that)\n              }\n            }\n\n            if (!that.dataSourceInitDone) {\n              // Set all default data sources\n              const core = that.$stel.core\n              core.stars.addDataSource({ url: process.env.BASE_URL + 'skydata/stars' })\n\n              // Allow to specify a custom path for sky culture data\n              if (that.$route.query.sc) {\n                const key = that.$route.query.sc.substring(that.$route.query.sc.lastIndexOf('/') + 1)\n                core.skycultures.addDataSource({ url: that.$route.query.sc, key: key })\n                core.skycultures.current_id = key\n              } else {\n                core.skycultures.addDataSource({ url: process.env.BASE_URL + 'skydata/skycultures/western', key: 'western' })\n              }\n\n              core.dsos.addDataSource({ url: process.env.BASE_URL + 'skydata/dso' })\n              core.landscapes.addDataSource({ url: process.env.BASE_URL + 'skydata/landscapes/guereins', key: 'guereins' })\n              core.milkyway.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/milkyway' })\n              // core.dss.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/dss' })\n              core.minor_planets.addDataSource({ url: process.env.BASE_URL + 'skydata/mpcorb.dat', key: 'mpc_asteroids' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/moon', key: 'moon' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/sun', key: 'sun' })\n              core.planets.addDataSource({ url: process.env.BASE_URL + 'skydata/surveys/sso/moon', key: 'default' })\n              core.comets.addDataSource({ url: process.env.BASE_URL + 'skydata/CometEls.txt', key: 'mpc_comets' })\n              core.satellites.addDataSource({ url: process.env.BASE_URL + 'skydata/tle_satellite.jsonl.gz', key: 'jsonl/sat' })\n\n              // Mount Pointing\n              glStel = that.setGloabalStel(that.$stel);\n              glLayer = that.setGlobalLayer(that.$stel);\n              glTestCircle = that.testAddCircle(that.$stel, glLayer);\n\n            }\n          })\n        } catch (e) {\n          this.$store.commit('setValue', { varName: 'wasmSupport', newValue: false })\n        }\n      }\n    });\n\n  }\n}\n</script>\n\n<style>\nbody {\n  background-color: black;\n  -webkit-touch-callout: none;\n  /* iOS */\n  -webkit-user-select: none;\n  /* 所有WebKit浏览器 */\n  user-select: none;\n}\n\na {\n  color: #82b1ff;\n}\n\na:link {\n  text-decoration-line: none;\n}\n\n.divider_menu {\n  margin-top: 8px;\n  margin-bottom: 8px;\n}\n\nhtml {\n  overflow-y: visible;\n}\n\nhtml,\nbody,\n#app {\n  overflow-y: visible !important;\n  overflow-x: visible;\n  position: fixed !important;\n  width: 100%;\n  height: 100%;\n  padding: 0 !important;\n  font-size: 10px;\n}\n\n.fullscreen {\n  overflow-y: hidden;\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  padding: 0 !important;\n}\n\n.click-through {\n  pointer-events: none;\n}\n\n.get-click {\n  pointer-events: all;\n}\n\n.dialog {\n  background: transparent;\n}\n\n.menu__content {\n  background-color: transparent !important;\n}\n\n#stel {\n  height: 100%;\n  width: 100%;\n  position: absolute;\n}\n\n#stel-canvas {\n  width: 100%;\n  height: 100%;\n}\n\n#mainCamera-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n#guiderCamera-canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.right_panel {\n  padding-right: 400px;\n}\n\n.v-btn {\n  margin-left: 8px;\n  margin-right: 8px;\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n\n.v-application--wrap {\n  min-height: 100% !important;\n}\n\n\n.my-custom-button {\n  background-color: #4CAF50;\n  /* 绿色背景 */\n  color: white;\n  /* 白色文字 */\n  padding: 15px 32px;\n  /* 内边距 */\n  text-align: center;\n  /* 文字居中 */\n  text-decoration: none;\n  /* 无文本装饰 */\n  display: inline-block;\n  /* 行内块显示 */\n  font-size: 16px;\n  /* 字体大小 */\n  margin: 4px 2px;\n  /* 外边距 */\n  cursor: pointer;\n  /* 鼠标样式 */\n  border: none;\n  /* 无边框 */\n}\n\n.connected-device {\n  color: #4dc251;\n}\n\n.btn-confirm {\n  width: 60px;\n  height: 30px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n}\n\n.btn-slider {\n  width: 20px;\n  height: 20px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n}\n\n.btn-confirm:active,\n.btn-slider:active {\n  transform: scale(0.95);\n  background-color: rgba(255, 255, 255, 0.5);\n}\n</style>\n"]}]}